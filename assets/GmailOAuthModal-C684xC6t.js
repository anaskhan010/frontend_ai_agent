import{j as e,ax as u,aS as C,bx as A,bz as R}from"./ui-Tc0IGQ9z.js";import{r as c}from"./vendor-DG599jyl.js";import{t as j,q as I,r as S,s as k,v as _,x as E,B as y,a as T}from"./index-14XkMcJs.js";const D=({isOpen:o,onClose:n,onSuccess:g,userId:B,redirectPath:L,useIntegrationApi:w=!1})=>{const[d,l]=c.useState("idle"),[b,r]=c.useState(""),f=c.useRef(null),i=c.useRef(!1),N=w?"/api/integration-gmail":"/api/gmail",p=async()=>{l("loading"),r("Opening Gmail authentication...");try{const s=await T.get(`${N}/auth/url`,{params:{redirectPath:"popup"}});if(!s.data.success)throw new Error(s.data.message||"Failed to generate Gmail auth URL");console.log("ðŸ”„ Opening Gmail OAuth in popup window");const a=window.open(s.data.data.authUrl,"gmail-oauth","width=600,height=700,scrollbars=yes,resizable=yes,status=yes,location=yes,toolbar=no,menubar=no");if(!a)throw new Error("Popup blocked. Please allow popups for this site.");const x=setInterval(()=>{a.closed&&(clearInterval(x),setTimeout(()=>{i.current||(l("error"),r("Authentication was cancelled. Please try again."))},500))},1e3);setTimeout(()=>{a.closed||(a.close(),clearInterval(x),i.current||(l("error"),r("Authentication timeout. Please try again.")))},3e5)}catch(s){console.error("Gmail OAuth error:",s),l("error"),r(s.message||"Failed to initiate Gmail OAuth")}},h=s=>{var a;s.type==="GMAIL_AUTH_SUCCESS"?(console.log("ðŸŽ‰ Received Gmail OAuth success:",s),i.current=!0,l("success"),r("Gmail connected successfully!"),j.success(`Gmail connected successfully! (${((a=s.data)==null?void 0:a.email)||"Unknown"})`),g(s.data),setTimeout(()=>{n()},1500)):s.type==="GMAIL_AUTH_ERROR"&&(console.log("âŒ Received Gmail OAuth error:",s),i.current=!0,l("error"),r(s.message||"Failed to connect Gmail"),j.error(s.message||"Failed to connect Gmail"),setTimeout(()=>{n()},3e3))};c.useEffect(()=>{if(!o)return;const s=t=>{console.log("ðŸ” Received postMessage:",t.data,"from origin:",t.origin),!(!t.data||typeof t.data!="object")&&h(t.data)};let a=null;try{a=new BroadcastChannel("gmail_oauth_channel"),a.onmessage=t=>{console.log("ðŸ” Received BroadcastChannel message:",t.data),t.data&&typeof t.data=="object"&&h(t.data)}}catch{console.log("âš ï¸ BroadcastChannel not supported")}const G=setInterval(()=>{try{const t=localStorage.getItem("gmail_oauth_result");if(t){const m=JSON.parse(t);m.timestamp&&Date.now()-m.timestamp<3e4&&(console.log("ðŸ” Found localStorage result:",m),localStorage.removeItem("gmail_oauth_result"),h(m))}}catch{}},500);return window.addEventListener("message",s),()=>{window.removeEventListener("message",s),a&&a.close(),clearInterval(G)}},[o,g,n]),c.useEffect(()=>{o&&(l("idle"),r(""),i.current=!1,localStorage.removeItem("gmail_oauth_result"))},[o]);const v=()=>{l("idle"),r(""),f.current&&(f.current.src="about:blank"),n()};return e.jsx(I,{open:o,onOpenChange:v,children:e.jsxs(S,{className:"max-w-2xl max-h-[80vh]",children:[e.jsxs(k,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5 text-blue-600"}),"Connect Gmail Account"]}),e.jsx(E,{children:"Connect your Gmail account to enable email automation in your workflows"})]}),e.jsxs("div",{className:"space-y-4",children:[d==="idle"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"p-6 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx(u,{className:"h-12 w-12 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Gmail Integration"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"By connecting your Gmail account, you'll be able to:"}),e.jsxs("ul",{className:"text-sm text-gray-600 text-left space-y-1 mb-4",children:[e.jsx("li",{children:"â€¢ Read and send emails automatically"}),e.jsx("li",{children:"â€¢ Create email-based workflow triggers"}),e.jsx("li",{children:"â€¢ Access Gmail data in your automations"})]})]}),e.jsxs(y,{onClick:p,className:"w-full h-12 bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Connect With Gmail"]}),e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["Please authenticate your Gmail account to allow access to AI CRUITMENT.",e.jsx("a",{href:"#",className:"text-blue-600 underline ml-1",children:"View privacy policy"})]})]}),d==="loading"&&e.jsx("div",{className:"text-center space-y-6 py-8",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(u,{className:"h-10 w-10 text-blue-600"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(C,{className:"h-3 w-3 text-white animate-spin"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Redirecting to Gmail"}),e.jsx("p",{className:"text-sm text-gray-600 max-w-md",children:b})]}),e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200 max-w-md",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})})}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Secure Authentication"}),e.jsx("p",{children:"You will be redirected to Gmail's secure authentication page. After completing authentication, you'll be returned to your workflow."})]})]})})]})}),d==="success"&&e.jsx("div",{className:"text-center space-y-4",children:e.jsxs("div",{className:"p-6 bg-green-50 rounded-lg border border-green-200",children:[e.jsx(A,{className:"h-12 w-12 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-green-900 mb-2",children:"Successfully Connected!"}),e.jsx("p",{className:"text-sm text-green-700",children:"Your Gmail account has been connected successfully. You can now use Gmail in your workflows."})]})}),d==="error"&&e.jsx("div",{className:"text-center space-y-4",children:e.jsxs("div",{className:"p-6 bg-red-50 rounded-lg border border-red-200",children:[e.jsx(R,{className:"h-12 w-12 text-red-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Connection Failed"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:b}),e.jsx(y,{onClick:p,variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-50",children:"Try Again"})]})})]})]})})};export{D as G};
//# sourceMappingURL=GmailOAuthModal-C684xC6t.js.map
