import{j as e,aS as p,aC as Y,bx as q,bW as $,C as te,aI as me,as as ae,ar as ie,bR as ge,cl as be,by as we,bz as W,bA as de,K as je,bX as Ne,S as pe,I as fe,T as ve}from"./ui-CZ40mCLE.js";import{r as f}from"./vendor-DG599jyl.js";import{b as E,u as Ce,c as R}from"./query-Dkjx6fBT.js";import{s as J,v as Z,n as re,x as ye,P as Se,Q as Ae,R as ee,U as se,C as h,c as b,d as w,b as x,e as Ie,B as u,u as Pe,A as Te,t as k,a as Fe,q as oe,r as ce}from"./index-DAuDxp-c.js";import{T as he,a as xe,b as v,c,d as ue,e as i}from"./table-DKSJ-9yH.js";import{g as Re,a as ke,b as Ee,l as qe,p as Me,r as De,c as Le,d as Oe}from"./campaignService-C24eMw8M.js";import{h as Ve}from"./phoneNumberService-CFUjUAON.js";import{g as Be}from"./agentService-_dZ-yfpB.js";import{C as Ke,d as Ue,e as Qe}from"./CallRecordingPlayer-DiBmU5aW.js";import{u as _e}from"./router-BnJytTjr.js";import"./slider-C_0rE4fI.js";function $e({campaignId:j,onClose:z}){var B,K,U,Q,_,T;const[C,M]=f.useState("overview"),[D,L]=f.useState(null),[y,O]=f.useState(!1),{data:S,isLoading:g}=E({queryKey:["campaign",j],queryFn:()=>Re(j),retry:1}),{data:N,isLoading:H}=E({queryKey:["campaignCalls",j],queryFn:()=>ke(j),retry:1}),a=S==null?void 0:S.data,A=(N==null?void 0:N.data)||{},n=Object.values(A);console.log("ðŸ” Campaign calls data:",A),console.log("ðŸ” Calls list:",n),n.length>0&&(console.log("ðŸ” First call structure:",n[0]),console.log("ðŸ” First call customer:",n[0].customer),console.log("ðŸ” First call status:",n[0].status));const I=t=>{let s=t.duration||0;if(!s&&t.startedAt&&t.endedAt){const r=new Date(t.startedAt).getTime(),o=new Date(t.endedAt).getTime();s=Math.round((o-r)/1e3)}return{...t,duration:s,customer:t.customer||{name:null,email:null,number:null}}};console.log("Raw calls data:",N==null?void 0:N.data),console.log("Calls object:",A),console.log("Calls list:",n),console.log("First call in list:",n[0]),n[0]&&(console.log("First call ID access:",n[0].id),console.log("First call keys:",Object.keys(n[0])));const{data:l}=E({queryKey:["phoneNumber",a==null?void 0:a.phoneNumberId],queryFn:()=>Ve(a.phoneNumberId),enabled:!!(a!=null&&a.phoneNumberId),retry:1}),{data:d}=E({queryKey:["assistant",a==null?void 0:a.assistantId],queryFn:()=>Be(a.assistantId),enabled:!!(a!=null&&a.assistantId),retry:1}),P=t=>{var o,m,F;console.log("Converting campaign call to CallHistoryItem:",t);const s=t.id,r={id:s,call_id:s,customer_number:((o=t.customer)==null?void 0:o.number)||"",status:t.status,type:"outbound",duration:t.duration||0,cost:t.cost||0,transcript:t.transcript||((m=t.analysis)==null?void 0:m.summary)||"",recording_url:t.recording,recordingUrl:t.recording,recording:t.recording,assistant_id:a==null?void 0:a.assistantId,assistant_name:(F=d==null?void 0:d.data)==null?void 0:F.name,end_reason:t.endedReason,started_at:t.startedAt,ended_at:t.endedAt,created_at:t.startedAt||new Date().toISOString(),updated_at:t.endedAt||new Date().toISOString(),metadata:{customer:t.customer}};return console.log("Converted CallHistoryItem:",r),r},G=t=>{const r={scheduled:{className:"bg-blue-500/20 text-blue-400 border-blue-500/30",icon:e.jsx(te,{className:"h-3 w-3 mr-1"})},"in-progress":{className:"bg-gradient-to-r from-orange-500/30 to-yellow-500/30 text-yellow-400 border-orange-500/50 shadow-lg shadow-orange-500/10",icon:e.jsx($,{className:"h-3 w-3 mr-1"})},ended:{className:"bg-green-500/20 text-green-400 border-green-500/30",icon:e.jsx(q,{className:"h-3 w-3 mr-1"})}}[t]||{className:"bg-white/10 text-white/70 border-white/20",icon:null};return e.jsxs(re,{variant:"outline",className:`flex items-center ${r.className}`,children:[r.icon,t==="in-progress"?"Running":t.charAt(0).toUpperCase()+t.slice(1)]})},X=t=>{const s={queued:"bg-purple-500/20 text-purple-400 border-purple-500/30",ringing:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30","in-progress":"bg-gradient-to-r from-orange-500/30 to-yellow-500/30 text-yellow-400 border-orange-500/50",ended:"bg-green-500/20 text-green-400 border-green-500/30",failed:"bg-red-500/20 text-red-400 border-red-500/30"};return e.jsx(re,{variant:"outline",className:s[t]||"bg-white/10 text-white/70 border-white/20",children:t})},V=t=>{if(!t)return"0:00";const s=Math.floor(t/60),r=t%60;return`${s}:${r.toString().padStart(2,"0")}`};return g?e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsx(Z,{className:"text-white",children:"Campaign Details"})}),e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(p,{className:"h-8 w-8 animate-spin text-orange-500"})})]}):a?e.jsxs(e.Fragment,{children:[e.jsxs(J,{className:"border-b border-white/10  pb-4",children:[e.jsxs(Z,{className:"flex items-center gap-3 text-white text-xl",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-500 via-orange-600 to-red-600 rounded-xl shadow-lg shadow-orange-500/20 flex items-center justify-center",children:e.jsx(Y,{className:"h-5 w-5 text-white"})}),a.name,G(a.status)]}),e.jsxs(ye,{className:"text-white/50 ml-13",children:["Created on ",new Date(a.createdAt).toLocaleDateString()]})]}),e.jsxs(Se,{value:C,onValueChange:M,className:"w-full",children:[e.jsxs(Ae,{className:"grid w-full grid-cols-3 bg-white/5 border border-white/10 p-1 rounded-lg",children:[e.jsx(ee,{value:"overview",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500/30 data-[state=active]:to-yellow-500/30 data-[state=active]:text-yellow-400 data-[state=active]:border-orange-500/50 data-[state=active]:shadow-lg data-[state=active]:shadow-orange-500/10 text-white/60 hover:text-white/80 transition-all rounded-md",children:"Overview"}),e.jsx(ee,{value:"calls",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500/30 data-[state=active]:to-yellow-500/30 data-[state=active]:text-yellow-400 data-[state=active]:border-orange-500/50 data-[state=active]:shadow-lg data-[state=active]:shadow-orange-500/10 text-white/60 hover:text-white/80 transition-all rounded-md",children:"Calls"}),e.jsx(ee,{value:"analytics",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500/30 data-[state=active]:to-yellow-500/30 data-[state=active]:text-yellow-400 data-[state=active]:border-orange-500/50 data-[state=active]:shadow-lg data-[state=active]:shadow-orange-500/10 text-white/60 hover:text-white/80 transition-all rounded-md",children:"Analytics"})]}),e.jsxs(se,{value:"overview",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(h,{className:"bg-white/[0.02] border border-white/5 hover:border-orange-500/30 transition-all",children:[e.jsx(b,{className:"pb-2",children:e.jsxs(w,{className:"text-sm font-medium flex items-center gap-2 text-white/70",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg shadow-blue-500/20",children:e.jsx(me,{className:"h-4 w-4 text-white"})}),"Total Calls"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:n.length}),e.jsx("p",{className:"text-xs text-white/50 mt-1",children:"Actual calls made"})]})]}),e.jsxs(h,{className:"bg-white/[0.02] border border-white/5 hover:border-green-500/30 transition-all",children:[e.jsx(b,{className:"pb-2",children:e.jsxs(w,{className:"text-sm font-medium flex items-center gap-2 text-white/70",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center shadow-lg shadow-green-500/20",children:e.jsx(q,{className:"h-4 w-4 text-white"})}),"Completed"]})}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold text-green-400",children:a.callsCounterEnded||0})})]}),e.jsxs(h,{className:"bg-white/[0.02] border border-white/5 hover:border-orange-500/30 transition-all",children:[e.jsx(b,{className:"pb-2",children:e.jsxs(w,{className:"text-sm font-medium flex items-center gap-2 text-white/70",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-orange-500 to-yellow-500 rounded-lg flex items-center justify-center shadow-lg shadow-orange-500/20",children:e.jsx(ae,{className:"h-4 w-4 text-white"})}),"Pick Up Rate"]})}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:a.callsCounterEnded>0?`${Math.round((a.callsCounterEnded-a.callsCounterEndedVoicemail)/a.callsCounterEnded*100)}%`:"0%"})})]}),e.jsxs(h,{className:"bg-white/[0.02] border border-white/5 hover:border-purple-500/30 transition-all",children:[e.jsx(b,{className:"pb-2",children:e.jsxs(w,{className:"text-sm font-medium flex items-center gap-2 text-white/70",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center shadow-lg shadow-purple-500/20",children:e.jsx(Y,{className:"h-4 w-4 text-white"})}),"Voicemail"]})}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:a.callsCounterEndedVoicemail||0})})]})]}),e.jsxs(h,{className:"bg-white/[0.02] border border-white/5",children:[e.jsx(b,{className:"border-b border-white/5",children:e.jsxs(w,{className:"text-white flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-orange-500 to-red-500 rounded-lg flex items-center justify-center shadow-lg shadow-orange-500/20",children:e.jsx(ie,{className:"h-4 w-4 text-white"})}),"Campaign Information"]})}),e.jsx(x,{className:"space-y-3 pt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-white/[0.02] rounded-lg border border-white/5",children:[e.jsx("p",{className:"text-sm font-medium text-white/50",children:"Phone Number"}),e.jsx("p",{className:"text-sm font-mono text-orange-400",children:((B=l==null?void 0:l.data)==null?void 0:B.number)||((K=l==null?void 0:l.data)==null?void 0:K.friendlyName)||a.phoneNumberId}),((U=l==null?void 0:l.data)==null?void 0:U.number)&&e.jsx("p",{className:"text-xs text-white/40",children:l.data.friendlyName||"AI CRUITMENT Number"})]}),e.jsxs("div",{className:"p-3 bg-white/[0.02] rounded-lg border border-white/5",children:[e.jsx("p",{className:"text-sm font-medium text-white/50",children:"Assistant"}),e.jsx("p",{className:"text-sm text-white",children:((Q=d==null?void 0:d.data)==null?void 0:Q.name)||a.assistantId||a.workflowId||"N/A"}),((_=d==null?void 0:d.data)==null?void 0:_.name)&&e.jsxs("p",{className:"text-xs text-white/40",children:["ID: ",a.assistantId]})]}),e.jsxs("div",{className:"p-3 bg-white/[0.02] rounded-lg border border-white/5",children:[e.jsx("p",{className:"text-sm font-medium text-white/50",children:"Created"}),e.jsx("p",{className:"text-sm text-white",children:new Date(a.createdAt).toLocaleString()})]}),e.jsxs("div",{className:"p-3 bg-white/[0.02] rounded-lg border border-white/5",children:[e.jsx("p",{className:"text-sm font-medium text-white/50",children:"Last Updated"}),e.jsx("p",{className:"text-sm text-white",children:new Date(a.updatedAt).toLocaleString()})]})]})})]})]}),e.jsx(se,{value:"calls",className:"space-y-4 mt-4",children:e.jsxs(h,{className:"bg-white/[0.02] border border-white/5",children:[e.jsxs(b,{className:"border-b border-white/5",children:[e.jsxs(w,{className:"flex items-center gap-2 text-white",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-orange-500 to-red-500 rounded-lg flex items-center justify-center shadow-lg shadow-orange-500/20",children:e.jsx(Y,{className:"h-4 w-4 text-white"})}),"Campaign Calls"]}),e.jsx(Ie,{className:"text-white/50",children:"Individual call details and outcomes"})]}),e.jsx(x,{className:"pt-4",children:H?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(p,{className:"h-8 w-8 animate-spin text-orange-500"})}):e.jsx("div",{className:"rounded-lg border border-white/10 overflow-hidden",children:e.jsxs(he,{children:[e.jsx(xe,{children:e.jsxs(v,{className:"bg-white/[0.02] border-b border-white/10 hover:bg-white/[0.03]",children:[e.jsx(c,{className:"text-white/60",children:"Customer"}),e.jsx(c,{className:"text-white/60",children:"Phone Number"}),e.jsx(c,{className:"text-white/60",children:"Status"}),e.jsx(c,{className:"text-white/60",children:"Duration"}),e.jsx(c,{className:"text-white/60",children:"Started"}),e.jsx(c,{className:"text-white/60",children:"Recording"})]})}),e.jsx(ue,{children:n.length===0?e.jsx(v,{children:e.jsx(i,{colSpan:6,className:"text-center text-white/50 py-8",children:"No calls found for this campaign"})}):n.map(t=>{var r,o,m;const s=I(t);return e.jsxs(v,{className:"border-b border-white/5 hover:bg-white/[0.03] transition-colors",children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:((r=s.customer)==null?void 0:r.name)||"Unknown Customer"}),e.jsx("div",{className:"text-xs text-white/40",children:((o=s.customer)==null?void 0:o.email)||"-"})]})}),e.jsx(i,{className:"font-mono text-orange-400",children:((m=s.customer)==null?void 0:m.number)||"-"}),e.jsx(i,{children:X(s.status)}),e.jsx(i,{className:"text-white",children:V(s.duration)}),e.jsx(i,{className:"text-white/70",children:s.startedAt?new Date(s.startedAt).toLocaleString():"-"}),e.jsx(i,{children:e.jsx("div",{className:"flex gap-2",children:e.jsxs(u,{size:"sm",variant:"outline",className:"bg-gradient-to-r from-orange-500/10 to-yellow-500/10 border-orange-500/30 text-orange-400 hover:bg-orange-500/20 hover:border-orange-500/50 hover:text-orange-300",onClick:()=>{L(t),O(!0)},title:"Play Recording & View Transcript",children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"Recording"]})})})]},t.id)})})]})})})]})}),e.jsx(se,{value:"analytics",className:"space-y-4 mt-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(h,{className:"bg-white/[0.02] border border-white/5",children:[e.jsx(b,{className:"border-b border-white/5",children:e.jsxs(w,{className:"text-white flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg shadow-blue-500/20",children:e.jsx(ae,{className:"h-4 w-4 text-white"})}),"Call Status Distribution"]})}),e.jsx(x,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 rounded-lg bg-white/[0.02]",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Scheduled"}),e.jsx("span",{className:"text-sm font-medium text-blue-400",children:a.callsCounterScheduled||0})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded-lg bg-white/[0.02]",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Queued"}),e.jsx("span",{className:"text-sm font-medium text-purple-400",children:a.callsCounterQueued||0})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded-lg bg-white/[0.02]",children:[e.jsx("span",{className:"text-sm text-white/70",children:"In Progress"}),e.jsx("span",{className:"text-sm font-medium text-yellow-400",children:a.callsCounterInProgress||0})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded-lg bg-white/[0.02]",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Completed"}),e.jsx("span",{className:"text-sm font-medium text-green-400",children:a.callsCounterEnded||0})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded-lg bg-white/[0.02]",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Voicemail"}),e.jsx("span",{className:"text-sm font-medium text-orange-400",children:a.callsCounterEndedVoicemail||0})]})]})})]}),e.jsxs(h,{className:"bg-white/[0.02] border border-white/5",children:[e.jsx(b,{className:"border-b border-white/5",children:e.jsxs(w,{className:"text-white flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-orange-500 to-red-500 rounded-lg flex items-center justify-center shadow-lg shadow-orange-500/20",children:e.jsx(ge,{className:"h-4 w-4 text-white"})}),"Performance Metrics"]})}),e.jsx(x,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 rounded-lg bg-white/[0.02]",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Success Rate"}),e.jsx("span",{className:"text-sm font-medium text-green-400",children:a.callsCounterEnded>0?`${Math.round((a.callsCounterEnded-a.callsCounterEndedVoicemail)/a.callsCounterEnded*100)}%`:"0%"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded-lg bg-white/[0.02]",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Completion Rate"}),e.jsx("span",{className:"text-sm font-medium text-blue-400",children:((T=a.customers)==null?void 0:T.length)>0?`${Math.round(a.callsCounterEnded/a.customers.length*100)}%`:"0%"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded-lg bg-white/[0.02]",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Avg Duration"}),e.jsx("span",{className:"text-sm font-medium text-yellow-400",children:n.length>0?V(Math.round(n.reduce((t,s)=>t+(s.duration||0),0)/n.length)):"0:00"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded-lg bg-white/[0.02]",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Total Cost"}),e.jsxs("span",{className:"text-sm font-medium text-orange-400",children:["$",n.reduce((t,s)=>t+(s.cost||0),0).toFixed(2)]})]})]})})]}),e.jsxs(h,{className:"md:col-span-2 bg-white/[0.02] border border-white/5",children:[e.jsx(b,{className:"border-b border-white/5",children:e.jsxs(w,{className:"text-white flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center shadow-lg shadow-purple-500/20",children:e.jsx(ie,{className:"h-4 w-4 text-white"})}),"Call Outcomes"]})}),e.jsx(x,{className:"pt-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-lg bg-green-500/10 border border-green-500/20",children:[e.jsx("div",{className:"w-10 h-10 mx-auto bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center shadow-lg shadow-green-500/20 mb-2",children:e.jsx(q,{className:"h-5 w-5 text-white"})}),e.jsx("div",{className:"text-2xl font-bold text-green-400",children:n.filter(t=>t.status==="ended"&&t.duration&&t.duration>30).length}),e.jsx("div",{className:"text-xs text-green-400/70",children:"Successful Calls"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/20",children:[e.jsx("div",{className:"w-10 h-10 mx-auto bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-full flex items-center justify-center shadow-lg shadow-yellow-500/20 mb-2",children:e.jsx(te,{className:"h-5 w-5 text-white"})}),e.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:n.filter(t=>t.status==="ended"&&(!t.duration||t.duration<=30)).length}),e.jsx("div",{className:"text-xs text-yellow-400/70",children:"Short Calls"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-orange-500/10 border border-orange-500/20",children:[e.jsx("div",{className:"w-10 h-10 mx-auto bg-gradient-to-br from-orange-500 to-orange-600 rounded-full flex items-center justify-center shadow-lg shadow-orange-500/20 mb-2",children:e.jsx(be,{className:"h-5 w-5 text-white"})}),e.jsx("div",{className:"text-2xl font-bold text-orange-400",children:a.callsCounterEndedVoicemail||0}),e.jsx("div",{className:"text-xs text-orange-400/70",children:"Voicemails"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-red-500/10 border border-red-500/20",children:[e.jsx("div",{className:"w-10 h-10 mx-auto bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center shadow-lg shadow-red-500/20 mb-2",children:e.jsx(we,{className:"h-5 w-5 text-white"})}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:n.filter(t=>t.status!=="ended").length}),e.jsx("div",{className:"text-xs text-red-400/70",children:"Failed Calls"})]})]})})]})]})})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-white/10",children:e.jsx(u,{onClick:z,className:"bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white shadow-lg shadow-orange-500/20",children:"Close"})}),y&&D&&e.jsx(Ke,{call:P(D),isOpen:y,onClose:()=>{O(!1),L(null)},customGetRecording:Qe,customGetTranscript:Ue})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsx(Z,{className:"text-white",children:"Campaign Details"})}),e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-white/60",children:"Campaign not found"})})]})}const as=()=>{var t;const j=_e(),[z,C]=f.useState(!1),[M,D]=f.useState(null),[L,y]=f.useState(!1),[O,S]=f.useState(0),g=Ce(),{user:N}=Pe(),{isSuperAdmin:H}=Te(),{data:a,isLoading:A,error:n}=E({queryKey:["outboundCampaigns"],queryFn:()=>Ee(),retry:(s,r)=>{var m;return[404,204,402].includes((m=r==null?void 0:r.response)==null?void 0:m.status)?!1:s<1}}),I=R({mutationFn:qe,onSuccess:()=>{g.invalidateQueries({queryKey:["outboundCampaigns"]}),k.success("Campaign launched successfully")},onError:s=>{var m,F,ne,le;const r=((F=(m=s.response)==null?void 0:m.data)==null?void 0:F.message)||"Failed to launch campaign";((le=(ne=s.response)==null?void 0:ne.data)==null?void 0:le.currentStatus)==="in-progress"?k.info("Campaign is already running"):k.error(r),g.invalidateQueries({queryKey:["outboundCampaigns"]})}}),l=R({mutationFn:Me,onSuccess:()=>{g.invalidateQueries({queryKey:["outboundCampaigns"]})}});R({mutationFn:De,onSuccess:()=>{g.invalidateQueries({queryKey:["outboundCampaigns"]})}});const d=R({mutationFn:Le,onSuccess:()=>{g.invalidateQueries({queryKey:["outboundCampaigns"]})}}),P=R({mutationFn:Oe,onSuccess:()=>{g.invalidateQueries({queryKey:["outboundCampaigns"]})}}),G=s=>{I.mutate(s)},X=s=>{l.mutate(s)},V=s=>{confirm("Are you sure you want to cancel this campaign?")&&d.mutate(s)},B=s=>{confirm("Are you sure you want to delete this campaign? This action cannot be undone.")&&P.mutate(s)},K=s=>{D(s),C(!0)},U=()=>{g.invalidateQueries({queryKey:["outboundCampaigns"]}),k.success("Campaigns refreshed")},Q=async()=>{if(H){j("/outbound/create-campaign");return}try{const r=(await Fe.get("/api/credits/balance")).data.data;if(!r||parseFloat(r.available_credits)<1){S((r==null?void 0:r.available_credits)||0),y(!0);return}j("/outbound/create-campaign")}catch(s){console.error("Error checking credit balance:",s),k.error("Unable to verify credit balance. Please try again.")}},_=s=>{const o={scheduled:{variant:"outline",icon:e.jsx(te,{className:"h-3 w-3 mr-1"}),label:"Scheduled"},"in-progress":{variant:"default",icon:e.jsx($,{className:"h-3 w-3 mr-1"}),label:"Running"},ended:{variant:"secondary",icon:e.jsx(q,{className:"h-3 w-3 mr-1"}),label:"Ended"}}[s]||{variant:"outline",icon:e.jsx(W,{className:"h-3 w-3 mr-1"}),label:s.charAt(0).toUpperCase()+s.slice(1)};return e.jsxs(re,{variant:o.variant,className:"flex items-center",children:[o.icon,o.label]})},T=Array.isArray(a==null?void 0:a.data)?a.data:[];if(n){const r=((t=n==null?void 0:n.response)==null?void 0:t.status)===402;return e.jsx("div",{className:"app-shell-bg min-h-screen w-full overflow-auto",children:e.jsxs("div",{className:"p-6 max-w-[1600px] mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-white",children:"Outbound"}),e.jsx("p",{className:"text-white/65",children:"Create and manage outbound campaigns"})]}),e.jsx(h,{className:"neo-card",children:e.jsx(x,{className:"pt-6",children:e.jsx("div",{className:"text-center",children:r?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-12 w-12 text-orange-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-white",children:"Insufficient Credits"}),e.jsx("p",{className:"text-white/65 mb-4",children:"You need credits to access campaign features. Please purchase credits to continue."}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(u,{onClick:()=>j("/credits/purchase"),className:"neo-btn bg-orange-500 hover:bg-orange-600",children:"Purchase Credits"}),e.jsxs(u,{variant:"outline",onClick:()=>window.location.reload(),className:"neo-topbar-btn",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-white/65 mb-4",children:"Unable to connect to the backend API. Please ensure the backend server is running."}),e.jsx(u,{onClick:()=>window.location.reload(),className:"neo-btn",children:"Retry Connection"})]})})})})]})})}return e.jsx("div",{className:"app-shell-bg min-h-screen w-full overflow-auto",children:e.jsxs("div",{className:"p-6 max-w-[1600px] mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-white",children:"Outbound"}),e.jsx("p",{className:"text-white/65",children:"Create and manage outbound campaigns"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{style:{background:"linear-gradient(180deg, rgba(255,77,79,0.25), rgba(168,14,34,0.25))",borderColor:"rgba(255,77,79,0.35)"},onClick:U,title:"Refresh Campaigns",className:"neo-btn flex items-center gap-2 text-red-300 hover:text-red-200",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(u,{className:"neo-btn",onClick:Q,children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Create Campaign"]})]})]}),e.jsx(h,{className:"neo-card",children:e.jsx(x,{children:A?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(p,{className:"h-8 w-8 animate-spin"})}):e.jsxs(he,{children:[e.jsx(xe,{children:e.jsxs(v,{className:"border-b border-white/10 hover:bg-transparent",children:[e.jsx(c,{className:"text-white/65",children:"Campaign Name"}),e.jsx(c,{className:"text-white/65",children:"Status"}),e.jsx(c,{className:"text-white/65",children:"Total Calls"}),e.jsx(c,{className:"text-white/65",children:"Completed"}),e.jsx(c,{className:"text-white/65",children:"Pick Up"}),e.jsx(c,{className:"text-white/65",children:"Actions"})]})}),e.jsx(ue,{children:T.length===0?e.jsx(v,{className:"border-b border-white/5",children:e.jsx(i,{colSpan:7,className:"text-center text-white/65 py-8",children:"No campaigns found. Create your first campaign to get started."})}):T.map(s=>{var r;return e.jsxs(v,{className:"border-b border-white/5 hover:bg-white/5",children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.name}),e.jsxs("div",{className:"text-xs text-white/65",children:["Created on ",new Date(s.createdAt).toLocaleDateString()]})]})}),e.jsx(i,{children:_(s.status)}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-1 text-white",children:[e.jsx(me,{className:"h-3 w-3"}),((r=s.customers)==null?void 0:r.length)||s.callsCounterEnded||0,s.status==="in-progress"&&e.jsxs("span",{className:"ml-2 text-xs text-green-400 font-medium",children:["(",s.callsCounterInProgress||0," active)"]})]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-1 text-white",children:[e.jsx(q,{className:"h-3 w-3"}),s.callsCounterEnded||0]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-1 text-white",children:[e.jsx(ae,{className:"h-3 w-3"}),s.callsCounterEnded>0?`${Math.round((s.callsCounterEnded-s.callsCounterEndedVoicemail)/s.callsCounterEnded*100)}%`:"0%"]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex gap-2",children:[s.status==="scheduled"&&e.jsx(u,{size:"sm",variant:"outline",onClick:()=>G(s.id),disabled:I.isPending,title:"Launch Campaign",className:"neo-topbar-btn",children:I.isPending?e.jsx(p,{className:"h-3 w-3 animate-spin"}):e.jsx($,{className:"h-3 w-3"})}),s.status==="in-progress"&&e.jsx(u,{size:"sm",variant:"outline",onClick:()=>X(s.id),disabled:l.isPending,title:"Pause Campaign",className:"neo-topbar-btn",children:l.isPending?e.jsx(p,{className:"h-3 w-3 animate-spin"}):e.jsx(Ne,{className:"h-3 w-3"})}),(s.status==="scheduled"||s.status==="in-progress")&&e.jsx(u,{size:"sm",variant:"outline",onClick:()=>V(s.id),disabled:d.isPending,title:"Cancel Campaign",className:"neo-topbar-btn",children:d.isPending?e.jsx(p,{className:"h-3 w-3 animate-spin"}):e.jsx(pe,{className:"h-3 w-3"})}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>K(s),title:"View Details",className:"neo-topbar-btn bg-gradient-to-r from-orange-500/10 to-yellow-500/10 border-orange-500/30 text-orange-400 hover:bg-orange-500/20 hover:border-orange-500/50 hover:text-orange-300",children:e.jsx(fe,{className:"h-3 w-3"})}),s.status==="ended"&&e.jsx(u,{size:"sm",variant:"outline",onClick:()=>B(s.id),disabled:P.isPending,title:"Delete Campaign",className:"neo-topbar-btn",children:P.isPending?e.jsx(p,{className:"h-3 w-3 animate-spin"}):e.jsx(ve,{className:"h-3 w-3 text-red-400"})})]})})]},s.id)})})]})})}),M&&e.jsx(oe,{open:z,onOpenChange:C,children:e.jsx(ce,{className:"max-w-4xl max-h-[90vh] overflow-y-auto neon-fire-scroll bg-[#0b0f2e] border-white/10 text-white",children:e.jsx($e,{campaignId:M.id,onClose:()=>C(!1)})})}),e.jsx(oe,{open:L,onOpenChange:y,children:e.jsx(ce,{className:"max-w-md bg-[#0b0f2e] border-white/10 text-white",children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"p-3 bg-orange-500/10 rounded-full",children:e.jsx(W,{className:"h-8 w-8 text-orange-400"})})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Insufficient Credits"}),e.jsxs("p",{className:"text-white/65 mb-6",children:["You need at least 1 credit to use campaign creation.",e.jsxs("span",{className:"block mt-1",children:["Current balance: ",O," credits"]})]}),e.jsx("div",{className:"space-y-3",children:e.jsx("p",{className:"text-xs text-white/65",children:"Credits are added instantly after purchase"})})]})})})]})})};export{as as default};
//# sourceMappingURL=Outbound-BPBcrySA.js.map
