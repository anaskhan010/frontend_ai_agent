import{j as e,cu as C,ba as H,a1 as z,aA as I,bc as K,S as M,av as W,aw as X}from"./ui-Bcnk-Zux.js";import{r as _}from"./vendor-D6QveUxv.js";import{b as Y}from"./query-CO-DO_55.js";import{P as O}from"./Page-Cw4AkXu3.js";import{H as E}from"./Header-RmoPuMXB.js";import{c as k,ac as G,u as J,a as D,B as V,j as U,v as A,C as S,l as T,n as L,k as q,o as Z,U as ee,V as se,W as R,X as ae,t as $}from"./index-CnGOntes.js";import{S as x}from"./skeleton-BOZe0XVu.js";import{T as re,a as te,b as B,c as v,d as ie,e as c}from"./table-RYRZeZk7.js";import{b as ne,N as p}from"./router-jXXg-8rg.js";import"./scroll-area-CgE1Gapf.js";import"./index-BuBVdwgz.js";import"./sheet-Dvm26hBH.js";const le=G("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),N=_.forwardRef(({className:t,variant:n,...r},h)=>e.jsx("div",{ref:h,role:"alert",className:k(le({variant:n}),t),...r}));N.displayName="Alert";const ce=_.forwardRef(({className:t,...n},r)=>e.jsx("h5",{ref:r,className:k("mb-1 font-medium leading-none tracking-tight",t),...n}));ce.displayName="AlertTitle";const w=_.forwardRef(({className:t,...n},r)=>e.jsx("div",{ref:r,className:k("text-sm [&_p]:leading-relaxed",t),...n}));w.displayName="AlertDescription";const de=({children:t,permission:n,permissions:r,requireAll:h=!1,role:a,roles:d,requireSuperAdmin:j=!1,redirectTo:f="/login",showError:m=!0})=>{const{isLoggedIn:y,loading:o}=J(),{hasPermission:b,hasAnyPermission:s,hasAllPermissions:u,role:l,isSuperAdmin:g,loading:P}=D(),i=ne();return!o&&!y?e.jsx(p,{to:f,state:{from:i},replace:!0}):o||P?e.jsx(e.Fragment,{children:t}):j&&!g?m?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(N,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(w,{children:"Super admin privileges required to access this page."})]})}):e.jsx(p,{to:"/dashboard",replace:!0}):a&&(!l||l.name!==a)?m?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(N,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(w,{children:`${a} role required to access this page.`})]})}):e.jsx(p,{to:"/dashboard",replace:!0}):d&&d.length>0&&(!l||!d.includes(l.name))?m?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(N,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(w,{children:`One of the following roles required: ${d.join(", ")}`})]})}):e.jsx(p,{to:"/dashboard",replace:!0}):n&&!b(n)?m?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(N,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(w,{children:"You don't have permission to access this page."})]})}):e.jsx(p,{to:"/dashboard",replace:!0}):r&&r.length>0&&!(h?u(r):s(r))?m?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(N,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(w,{children:"You don't have the required permissions to access this page."})]})}):e.jsx(p,{to:"/dashboard",replace:!0}):e.jsx(e.Fragment,{children:t})},F=({children:t,permission:n,permissions:r,requireAll:h=!1,role:a,roles:d,requireSuperAdmin:j=!1,fallback:f,hideWhenNoAccess:m=!1,disabled:y,...o})=>{const{hasPermission:b,hasAnyPermission:s,hasAllPermissions:u,role:l,isSuperAdmin:g,loading:P}=D();if(P)return e.jsx(V,{disabled:!0,...o,children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-300"})});let i=!0;return j&&!g&&(i=!1),i&&a&&(!l||l.name!==a)&&(i=!1),i&&d&&d.length>0&&(!l||!d.includes(l.name))&&(i=!1),i&&n&&!b(n)&&(i=!1),i&&r&&r.length>0&&((h?u(r):s(r))||(i=!1)),!i&&m?null:!i&&f?e.jsx(e.Fragment,{children:f}):e.jsx(V,{disabled:y||!i,...o,children:t})},oe=async()=>(await U.get("/api/permissions")).data.data,be=()=>{const[t,n]=_.useState(""),[r,h]=_.useState("all"),{data:a,isLoading:d,error:j,refetch:f}=Y({queryKey:["permissions"],queryFn:oe}),m=s=>{n(s)},y=async(s,u)=>{var l,g;if(window.confirm(`Are you sure you want to delete the permission "${u}"?`))try{await U.delete(`/api/permissions/${s}`),$.success("Permission deleted successfully"),f()}catch(P){$.error(((g=(l=P.response)==null?void 0:l.data)==null?void 0:g.message)||"Failed to delete permission")}};if(j)return console.error("Error fetching permissions",j),e.jsx("div",{children:"Error loading permissions"});let o=(a==null?void 0:a.filter(s=>s.name.toLowerCase().includes(t.toLowerCase())||s.display_name.toLowerCase().includes(t.toLowerCase())||s.description.toLowerCase().includes(t.toLowerCase())||s.category.toLowerCase().includes(t.toLowerCase())))||[];r!=="all"&&(o=o.filter(s=>s.category.toLowerCase()===r.toLowerCase()));const b=[...new Set((a==null?void 0:a.map(s=>s.category))||[])];return e.jsx(de,{requireSuperAdmin:!0,children:e.jsxs(O,{children:[e.jsx(E,{title:"Permission Management",buttonText:"Create Permission",filterByName:!0,filterWord:t,onFilterChange:m,useSheet:!1,showViewToggle:!1,showFilters:!1}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(A,{variant:"secondary",className:"px-3 py-1",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),e.jsxs("span",{children:[o.length," Permissions"]})]})}),e.jsxs(F,{requireSuperAdmin:!0,className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Create Permission"]})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(S,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Total Permissions"}),e.jsx(H,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(q,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All permissions"})]})]}),e.jsxs(S,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"System Permissions"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(q,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.filter(s=>s.is_system_permission).length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Built-in permissions"})]})]}),e.jsxs(S,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Custom Permissions"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(q,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.filter(s=>!s.is_system_permission).length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"User-created permissions"})]})]}),e.jsxs(S,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Categories"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(q,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Permission categories"})]})]})]}),e.jsxs(S,{children:[e.jsxs(T,{children:[e.jsx(L,{children:"Permissions"}),e.jsx(Z,{children:"Manage system permissions and their assignments"})]}),e.jsx(q,{children:e.jsxs(ee,{value:r,onValueChange:h,children:[e.jsxs(se,{className:"grid w-full grid-cols-5",children:[e.jsx(R,{value:"all",children:"All"}),e.jsx(R,{value:"pages",children:"Pages"}),e.jsx(R,{value:"users",children:"Users"}),e.jsx(R,{value:"roles",children:"Roles"}),e.jsx(R,{value:"system",children:"System"})]}),e.jsx(ae,{value:r,className:"mt-4",children:e.jsxs(re,{children:[e.jsx(te,{children:e.jsxs(B,{children:[e.jsx(v,{children:"Permission"}),e.jsx(v,{children:"Resource"}),e.jsx(v,{children:"Action"}),e.jsx(v,{children:"Category"}),e.jsx(v,{children:"Type"}),e.jsx(v,{children:"Actions"})]})}),e.jsx(ie,{children:d?Array.from({length:8}).map((s,u)=>e.jsxs(B,{children:[e.jsx(c,{children:e.jsxs("div",{children:[e.jsx(x,{className:"h-4 w-32 mb-1"}),e.jsx(x,{className:"h-3 w-24"})]})}),e.jsx(c,{children:e.jsx(x,{className:"h-6 w-16"})}),e.jsx(c,{children:e.jsx(x,{className:"h-6 w-16"})}),e.jsx(c,{children:e.jsx(x,{className:"h-4 w-20"})}),e.jsx(c,{children:e.jsx(x,{className:"h-6 w-20"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-8 w-8"}),e.jsx(x,{className:"h-8 w-8"})]})})]},`permission-skeleton-${u}`)):o.map(s=>e.jsxs(B,{children:[e.jsx(c,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.display_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.name})]})}),e.jsx(c,{children:e.jsx(A,{variant:"outline",children:s.resource})}),e.jsx(c,{children:e.jsx(A,{variant:"secondary",children:s.action})}),e.jsx(c,{children:e.jsx(A,{variant:"default",children:s.category})}),e.jsx(c,{children:e.jsx(A,{variant:s.is_system_permission?"secondary":"default",children:s.is_system_permission?"System":"Custom"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{requireSuperAdmin:!0,size:"sm",variant:"outline",children:e.jsx(W,{className:"h-3 w-3"})}),!s.is_system_permission&&e.jsx(F,{requireSuperAdmin:!0,size:"sm",variant:"outline",onClick:()=>y(s.id,s.display_name),children:e.jsx(X,{className:"h-3 w-3"})})]})})]},s.id))})]})})]})})]})]})]})})};export{be as default};
//# sourceMappingURL=Permissions-CJTaRd9m.js.map
