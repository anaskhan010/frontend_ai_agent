import{j as e,bC as tt,bD as ne,ag as st,G as $e,bE as Ae,O as Fe,T as Re,aG as Ze,bh as Ke,bu as Oe,au as qe,aT as Se,bs as at,br as rt,M as ot,ar as nt,b5 as ue,aP as lt,aM as it,k as ze,D as ct,bF as dt,bG as ut,bH as mt,aY as pt,Z as gt}from"./ui-CNbESIMS.js";import{r as a}from"./vendor-DG599jyl.js";import{u as xt,b as ht,c as ke}from"./query-DFkYe0MV.js";import{B as $}from"./button-BpHONB4D.js";import{I as Ve}from"./input-DOIJ2OtM.js";import{L as Z}from"./label-DkC73-VZ.js";import{T as _e}from"./textarea-BUHDDiup.js";import{S as ft,a as bt,b as yt,c as vt,d as Nt}from"./select-CSg3IHkG.js";import{S as wt}from"./switch-B0bnOhoa.js";import{_ as jt}from"./vapi-CWmUDqtF.js";import{C as Pe,b as Ie,c as Te,a as Me}from"./card-pTI7iGfo.js";import{D as Je,f as Qe,a as Ct,b as St,c as kt}from"./dialog-MmBhddhZ.js";import{B as me}from"./badge-DO_1G0Ng.js";import{t as E,e as Le}from"./index-CvuFKe2_.js";import{T as Ue,a as Ye,b as Be,c as Xe}from"./tooltip-Cmi_YW71.js";import{b as Pt,t as It}from"./workflowService-CAeF4YPZ.js";import{V as Ge}from"./vapiService-BPjloZCJ.js";import{d as Tt,u as Mt}from"./router-BavLd_S0.js";import"./index-DklBfCbe.js";import"./index-HDeFwIcs.js";import"./index-U78YeT7B.js";import"./index-Dvc3OkzL.js";const He=({children:o,variant:x,size:d,className:k,onClick:P,...v})=>e.jsx("button",{className:`inline-flex items-center justify-center font-medium transition-colors ${k||""}`,onClick:P,...v,children:o}),Ee=({children:o,variant:x,className:d,...k})=>e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${d||""}`,...k,children:o}),Et=({data:o,selected:x,nodeId:d})=>{var N,j;const[k,P]=a.useState(!1),[v,A]=a.useState(o);a.useEffect(()=>{A(o)},[o]);const I=()=>{switch(o.type){case"conversation":return e.jsx(ne,{className:"h-4 w-4 text-blue-600"});case"apiRequest":return e.jsx("div",{className:"h-4 w-4 bg-purple-600 rounded"});case"transferCall":return e.jsx("div",{className:"h-4 w-4 bg-green-600 rounded"});case"endCall":return e.jsx("div",{className:"h-4 w-4 bg-red-600 rounded"});case"tool":return e.jsx("div",{className:"h-4 w-4 bg-orange-600 rounded"});default:return e.jsx(ne,{className:"h-4 w-4 text-blue-600"})}},w=()=>o.isStart?"border-green-500 bg-green-50":x?"border-blue-500 shadow-lg":"border-gray-300 hover:border-gray-400";return e.jsxs("div",{className:`group relative w-[280px] bg-gradient-to-br from-white via-gray-50/30 to-white border-2 rounded-2xl shadow-lg transition-all duration-300 cursor-move hover:shadow-xl hover:shadow-teal-500/10 hover:scale-102 ${w()}`,style:{filter:x?"drop-shadow(0 12px 28px rgba(20, 184, 166, 0.2))":"drop-shadow(0 6px 16px rgba(0, 0, 0, 0.08))",backdropFilter:"blur(8px)",background:x?"linear-gradient(135deg, #ffffff 0%, #f0fdfa 30%, #ffffff 100%)":"linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #ffffff 100%)"},draggable:!1,onMouseDown:S=>{const M=S.target;(M.closest("button")||M.closest('[role="button"]')||M.closest("[data-connection-point]"))&&(S.stopPropagation(),S.preventDefault())},title:"Click and drag to move this node",children:[e.jsx("div",{className:"absolute -top-1.5 left-1/2 transform -translate-x-1/2 w-3 h-3 bg-white border-2 border-teal-500 rounded-full cursor-crosshair transition-all duration-200 hover:scale-125 hover:border-teal-600 z-40",title:"Input connection point - drag from another node's output to connect here","data-connection-point":"input","data-node-id":d,style:{boxShadow:"0 0 0 1px rgba(255, 255, 255, 0.9), 0 2px 4px rgba(20, 184, 166, 0.3)"}}),e.jsx("div",{className:"p-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"h-4 w-4 text-gray-400 cursor-move"}),e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:I()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:v.name||"Conversation"}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[v.isStart&&e.jsxs(Ee,{variant:"secondary",className:"text-xs bg-green-100 text-green-700",children:[e.jsx(st,{className:"h-3 w-3 mr-1"}),"Start"]}),((N=v.globalNodePlan)==null?void 0:N.enabled)&&e.jsxs(Ee,{variant:"outline",className:"text-xs border-orange-200 text-orange-700",children:[e.jsx($e,{className:"h-3 w-3 mr-1"}),"Global"]}),v.variables&&v.variables.length>0&&e.jsxs(Ee,{variant:"outline",className:"text-xs border-purple-200 text-purple-700",children:[e.jsx(Ae,{className:"h-3 w-3 mr-1"}),v.variables.length]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(He,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-gray-100 rounded-md",onClick:S=>{S.stopPropagation(),S.preventDefault(),o.onConfigure?o.onConfigure():P(!0)},children:e.jsx(Fe,{className:"h-4 w-4 text-gray-500"})}),!v.isStart&&e.jsx(He,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-red-100 text-red-500 hover:text-red-700 rounded-md",onClick:S=>{S.stopPropagation(),S.preventDefault(),confirm("Are you sure you want to delete this node?")&&o.onDelete()},children:e.jsx(Re,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"p-3 space-y-2",children:e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-medium text-gray-900 mb-1",children:"Prompt"}),e.jsx("div",{className:"text-gray-600 leading-relaxed",children:((j=v.prompt)==null?void 0:j.length)>80?`${v.prompt.substring(0,80)}...`:v.prompt||"No prompt configured"})]})}),v.type!=="endCall"&&e.jsx("div",{className:"absolute -bottom-1.5 left-1/2 transform -translate-x-1/2 w-3 h-3 bg-white border-2 border-teal-500 rounded-full cursor-crosshair transition-all duration-200 hover:scale-125 hover:border-teal-600 z-40",title:"Output connection point - drag to another node's input to connect","data-connection-point":"output","data-node-id":d,onMouseDown:S=>{var M;if(S.stopPropagation(),S.preventDefault(),console.log("ðŸ”— Starting manual connection from node:",d),o.onManualConnectionStart&&d){const W=S.currentTarget.getBoundingClientRect(),Y=(M=S.currentTarget.closest("[data-canvas]"))==null?void 0:M.getBoundingClientRect();if(Y){const L=W.left+W.width/2-Y.left,B=W.top+W.height/2-Y.top;o.onManualConnectionStart(d,{x:L,y:B})}}},style:{boxShadow:"0 0 0 1px rgba(255, 255, 255, 0.9), 0 2px 4px rgba(20, 184, 166, 0.3)"}}),v.type!=="endCall"&&e.jsx("div",{className:"absolute -bottom-12 left-1/2 transform -translate-x-1/2 z-30 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("button",{className:"w-8 h-8 bg-teal-500 hover:bg-teal-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl border-2 border-white hover:scale-110 active:scale-95",title:"Add new connected node",onClick:S=>{S.stopPropagation(),console.log("âž• Quick add node for:",d),o.onConnectionStart&&d&&o.onConnectionStart(d,{x:0,y:0})},style:{boxShadow:"0 0 0 2px rgba(255, 255, 255, 0.9), 0 4px 12px rgba(20, 184, 166, 0.3)"},children:e.jsx("span",{className:"text-lg font-bold leading-none",children:"+"})})})]})},Dt=({nodes:o,edges:x,onNodesChange:d,onEdgesChange:k,onNodeClick:P,selectedNode:v,nodeTypes:A,onEdgeLabelClick:I})=>{const[w,N]=a.useState(!1),[j,S]=a.useState(null),[M,W]=a.useState({x:0,y:0}),[Y,L]=a.useState(0),[B,n]=a.useState(!1),[C,F]=a.useState(1),[h,H]=a.useState({x:0,y:0}),[X,te]=a.useState(!1),[K,se]=a.useState({x:0,y:0}),[c,T]=a.useState({x:0,y:0}),[f,q]=a.useState(!1),[D,le]=a.useState(null),[G,_]=a.useState({x:0,y:0}),U=a.useRef(null),z=a.useRef(o),J=a.useRef(d),pe=a.useRef(P);z.current=o,J.current=d,pe.current=P;const ae=a.useCallback(t=>{var g;t.preventDefault();const i=(g=U.current)==null?void 0:g.getBoundingClientRect();if(!i)return;const l=t.clientX-i.left,u=t.clientY-i.top,m=t.deltaY>0?.9:1.1,p=Math.min(Math.max(C*m,.1),3),b=p/C,y=l-(l-h.x)*b,s=u-(u-h.y)*b;F(p),H({x:y,y:s})},[C,h]),re=a.useCallback(t=>{const i=t.target;i.closest("[data-node]")||i.closest("button")||i.closest("[data-connection-point]")||t.button===0&&(t.preventDefault(),te(!0),se({x:t.clientX,y:t.clientY}),T({...h}),document.body.style.cursor="grabbing")},[h]),Q=a.useCallback(t=>{if(X){t.preventDefault();const i=t.clientX-K.x,l=t.clientY-K.y;H({x:c.x+i,y:c.y+l})}},[X,K,c]),ge=a.useCallback(()=>{X&&(te(!1),document.body.style.cursor="default")},[X]),be=a.useCallback((t,i)=>{console.log("ðŸ”— Starting manual connection from:",t,"at position:",i);const l=o.find(p=>p.id===t);if(!l){console.error("âŒ Source node not found:",t);return}const u=l.position.x+140,m=l.position.y+180;q(!0),le({nodeId:t,x:u,y:m}),document.body.style.cursor="crosshair",console.log("âœ… Manual connection started from:",t,{x:u,y:m})},[o]),xe=a.useCallback(t=>{var i;if(f){const l=(i=U.current)==null?void 0:i.getBoundingClientRect();if(l){const u=t.clientX-l.left,m=t.clientY-l.top,p=(u-h.x)/C,b=(m-h.y)/C;_({x:p,y:b})}}},[f,C,h]),he=a.useCallback(t=>{var y;if(!f||!D)return;const i=(y=U.current)==null?void 0:y.getBoundingClientRect();if(!i)return;const l=t.clientX-i.left,u=t.clientY-i.top,m=(l-h.x)/C,p=(u-h.y)/C;console.log("ðŸŽ¯ Trying to complete connection at:",{mouseX:m,mouseY:p});const b=o.find(s=>{const g=s.position.x,R=s.position.x+280,V=s.position.y,O=s.position.y+180,ee=m>=g&&m<=R&&p>=V&&p<=O&&s.id!==D.nodeId;return ee&&console.log("ðŸŽ¯ Found target node:",s.id,{nodeBounds:{left:g,right:R,top:V,bottom:O},mousePos:{mouseX:m,mouseY:p}}),ee});if(b&&k)if(x.find(g=>g.source===D.nodeId&&g.target===b.id))console.log("âš ï¸ Connection already exists between these nodes");else{const g={id:`edge-${D.nodeId}-${b.id}-${Date.now()}`,source:D.nodeId,target:b.id,label:"Manual Connection",type:"default"},R=[...x,g];k(R),console.log("âœ… Created manual connection:",D.nodeId,"->",b.id)}else console.log("âŒ No valid target node found for connection");q(!1),le(null),document.body.style.cursor="default"},[f,D,o,x,k]),ye=a.useCallback(t=>{console.log("âž• Adding new node after:",t);const i=o.find(y=>y.id===t);if(!i)return;const l=`node-${Date.now()}`,u={id:l,type:"conversation",position:{x:i.position.x,y:i.position.y+300},data:{type:"conversation",name:"New Conversation",prompt:"Enter your prompt here...",firstMessage:"",isStart:!1,variables:[],globalNodePlan:{enabled:!1}}},m={id:`edge-${t}-${l}`,source:t,target:l,label:"Auto Connection"},p=[...o,u],b=[...x,m];J.current(p),k&&k(b)},[o,x,k]),ve=a.useCallback((t,i)=>{var g;const l=t.target;if(l.closest("button")||l.closest('[role="button"]')||l.closest("[data-connection-point]"))return;t.preventDefault(),t.stopPropagation();const u=(g=U.current)==null?void 0:g.getBoundingClientRect();if(!u)return;const m=t.clientX-u.left,p=t.clientY-u.top,b=(m-h.x)/C,y=(p-h.y)/C,s={x:b-i.position.x,y:y-i.position.y};N(!0),S(i.id),W(s),n(!1)},[C,h]),Ne=a.useCallback(t=>{var i;if(Q(t),w&&j){t.preventDefault();const l=(i=U.current)==null?void 0:i.getBoundingClientRect();if(!l)return;const u=t.clientX-l.left,m=t.clientY-l.top,p=(u-h.x)/C,b=(m-h.y)/C,y=p-M.x,s=b-M.y,g=z.current.find(V=>V.id===j);if(g){const V=Math.abs(y-g.position.x),O=Math.abs(s-g.position.y);(V>2||O>2)&&n(!0)}const R=z.current.map(V=>V.id===j?{...V,position:{x:y,y:s}}:V);z.current=R,L(V=>V+1),J.current(R)}xe(t)},[w,j,M,xe,C,h,Q]),fe=a.useCallback(t=>{ge(),w&&(t.preventDefault(),N(!1),S(null),W({x:0,y:0})),he(t)},[w,he,ge]),ie=a.useCallback(t=>{B||pe.current(t),n(!1)},[B]),r=a.useCallback(()=>!x||x.length===0?null:x.map((t,i)=>{const l=z.current,u=l.find(ce=>ce.id===t.source),m=l.find(ce=>ce.id===t.target);if(!u||!m)return null;const p=u.position.x+140,b=u.position.y+160,y=m.position.x+140,s=m.position.y-8,g=p+(y-p)/2,R=b+(s-b)/2,V=Math.sqrt(Math.pow(y-p,2)+Math.pow(s-b,2)),O=Math.min(V*.4,100),ee=p,oe=b+O,we=y,je=s-O,Ce=`M ${p} ${b} C ${ee} ${oe}, ${we} ${je}, ${y} ${s}`;return e.jsxs("g",{children:[e.jsx("defs",{children:e.jsx("marker",{id:`arrowhead-${i}`,markerWidth:"8",markerHeight:"6",refX:"7",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:e.jsx("polygon",{points:"0 0, 8 3, 0 6",fill:"#6b7280"})})}),e.jsx("path",{d:Ce,stroke:"#6b7280",strokeWidth:"2",fill:"none",strokeLinecap:"round",markerEnd:`url(#arrowhead-${i})`,className:"transition-all duration-300 hover:stroke-teal-500"}),e.jsx("foreignObject",{x:g-60,y:R-12,width:"120",height:"24",className:"pointer-events-auto",children:e.jsx("div",{className:"bg-white text-gray-800 text-xs font-medium px-3 py-1 rounded-full text-center shadow-md border border-gray-200 cursor-pointer hover:shadow-lg transition-shadow",onClick:ce=>{ce.stopPropagation(),I&&I(t)},children:t.label||"Connection"})})]},`edge-${i}`)}),[x,Y,I]);return e.jsxs("div",{className:"relative w-full h-full bg-gradient-to-br from-slate-50 via-white to-gray-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.12]",style:{backgroundImage:`
            linear-gradient(rgba(99, 102, 241, 0.15) 1px, transparent 1px),
            linear-gradient(90deg, rgba(99, 102, 241, 0.15) 1px, transparent 1px)
          `,backgroundSize:"24px 24px"}}),e.jsxs("div",{ref:U,"data-canvas":"true",className:"relative w-full h-full",onMouseDown:re,onMouseMove:Ne,onMouseUp:fe,onMouseLeave:fe,onWheel:ae,style:{cursor:X?"grabbing":"grab"},children:[e.jsxs("div",{className:"absolute inset-0",style:{transform:`translate(${h.x}px, ${h.y}px) scale(${C})`,transformOrigin:"0 0"},children:[o.map(t=>{var i,l,u,m,p,b;return e.jsx("div",{"data-node":"true",className:"absolute",style:{left:t.position.x,top:t.position.y,zIndex:10},onMouseDown:y=>ve(y,t),onClick:()=>ie(t),children:e.jsx(Et,{data:{name:((i=t.data)==null?void 0:i.name)||t.type,type:t.type,prompt:((l=t.data)==null?void 0:l.prompt)||"",firstMessage:((u=t.data)==null?void 0:u.firstMessage)||"",isStart:((m=t.data)==null?void 0:m.isStart)||!1,variables:((p=t.data)==null?void 0:p.variables)||[],globalNodePlan:((b=t.data)==null?void 0:b.globalNodePlan)||{enabled:!1},onUpdate:y=>{const s=z.current.map(g=>g.id===t.id?{...g,data:{...g.data,...y}}:g);J.current(s)},onDelete:()=>{const y=z.current.filter(g=>g.id!==t.id),s=x.filter(g=>g.source!==t.id&&g.target!==t.id);J.current(y),k&&k(s)},onConfigure:()=>ie(t),onConnectionStart:()=>ye(t.id),onManualConnectionStart:be},selected:(v==null?void 0:v.id)===t.id,nodeId:t.id})},t.id)}),e.jsxs("svg",{className:"absolute inset-0 pointer-events-none",style:{zIndex:5},width:"100%",height:"100%",children:[r(),f&&D&&e.jsxs("g",{children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"connectionPreview",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#14b8a6",stopOpacity:"1.0"}),e.jsx("stop",{offset:"100%",stopColor:"#06b6d4",stopOpacity:"0.8"})]})}),e.jsx("path",{d:`M ${D.x} ${D.y} Q ${D.x+(G.x-D.x)/2} ${D.y+50}, ${G.x} ${G.y}`,stroke:"url(#connectionPreview)",strokeWidth:"3",fill:"none",strokeLinecap:"round",strokeDasharray:"8,4",className:"animate-pulse"}),e.jsx("circle",{cx:G.x,cy:G.y,r:"6",fill:"#14b8a6",stroke:"white",strokeWidth:"2",className:"animate-pulse"})]})]})]}),e.jsxs("div",{className:"absolute bottom-4 right-4 bg-white rounded-lg shadow-sm border border-gray-200 z-50 flex items-center gap-1 px-2 py-1",children:[e.jsx("button",{className:"w-7 h-7 hover:bg-gray-100 rounded flex items-center justify-center text-gray-600 hover:text-gray-800 transition-colors",onClick:()=>{const t=Math.max(C*.8,.1);F(t)},title:"Zoom Out",children:e.jsx("span",{className:"text-sm font-bold leading-none",children:"âˆ’"})}),e.jsxs("div",{className:"text-xs text-gray-500 font-medium px-2 min-w-[40px] text-center",children:[Math.round(C*100),"%"]}),e.jsx("button",{className:"w-7 h-7 hover:bg-gray-100 rounded flex items-center justify-center text-gray-600 hover:text-gray-800 transition-colors",onClick:()=>{const t=Math.min(C*1.2,3);F(t)},title:"Zoom In",children:e.jsx("span",{className:"text-sm font-bold leading-none",children:"+"})})]})]})]})},de=({data:o,selected:x,nodeId:d})=>{const[k,P]=a.useState(!1),v=I=>{switch(I){case"conversation":return{icon:e.jsx(ne,{className:"h-4 w-4 text-white"}),bgColor:"bg-teal-500"};case"apiRequest":return{icon:e.jsx($e,{className:"h-4 w-4 text-white"}),bgColor:"bg-blue-500"};case"transferCall":return{icon:e.jsx(Ae,{className:"h-4 w-4 text-white"}),bgColor:"bg-green-500"};case"endCall":return{icon:e.jsx(Re,{className:"h-4 w-4 text-white"}),bgColor:"bg-red-500"};case"tool":return{icon:e.jsx(Fe,{className:"h-4 w-4 text-white"}),bgColor:"bg-orange-500"};default:return{icon:e.jsx(ne,{className:"h-4 w-4 text-white"}),bgColor:"bg-teal-500"}}},A=I=>{switch(I){case"conversation":return"Conversation";case"apiRequest":return"API Request";case"transferCall":return"Transfer Call";case"endCall":return"End Call";case"tool":return"Tool";default:return"Node"}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`
          relative rounded-2xl border-2 shadow-xl transition-all duration-300 min-w-[300px] max-w-[340px] bg-gradient-to-br from-white via-slate-50 to-white backdrop-blur-sm
          ${x?"border-indigo-500 shadow-2xl ring-4 ring-indigo-100":"border-gray-200 hover:border-indigo-300 hover:shadow-lg"}
          ${o.isStart?"ring-4 ring-blue-100 border-blue-400 shadow-blue-100":""}
        `,style:{minHeight:"140px",boxShadow:x?"0 25px 50px -12px rgba(79, 70, 229, 0.25), 0 0 0 1px rgba(79, 70, 229, 0.05)":"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(0, 0, 0, 0.05)",transform:x?"scale(1.02)":"scale(1)"},onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-gray-100 bg-gradient-to-r from-slate-50 to-gray-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`
              w-10 h-10 rounded-xl flex items-center justify-center shadow-lg transition-all duration-300 hover:scale-110
              ${v(o.type).bgColor}
            `,style:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:v(o.type).icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-base text-gray-900 tracking-tight",children:o.name||A(o.type)}),e.jsxs("div",{className:"text-xs text-gray-500 font-medium mt-0.5",children:[o.type.charAt(0).toUpperCase()+o.type.slice(1)," Node"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-indigo-50 text-gray-500 hover:text-indigo-600 rounded-lg transition-all duration-200",children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-indigo-50 text-gray-500 hover:text-indigo-600 rounded-lg transition-all duration-200",children:e.jsx(Ae,{className:"h-4 w-4"})}),!o.isStart&&e.jsx($,{variant:"ghost",size:"sm",onClick:I=>{I.stopPropagation(),window.confirm("Are you sure you want to delete this node?")&&o.onDelete()},className:"h-8 w-8 p-0 hover:bg-red-50 text-gray-500 hover:text-red-600 rounded-lg transition-all duration-200",title:"Delete node",children:e.jsx(Re,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 bg-gradient-to-b from-indigo-500 to-purple-500 rounded-full"}),"Prompt Configuration"]}),e.jsx("div",{className:"text-gray-600 leading-relaxed bg-gray-50 p-3 rounded-lg border border-gray-100",children:o.prompt&&o.prompt.length>100?`${o.prompt.substring(0,100)}...`:o.prompt||"No Prompt Specified"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs bg-gradient-to-r from-indigo-50 to-purple-50 p-3 rounded-lg border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Cost: $0.09/min"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Latency: 1.1s"})]})]})]}),e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 w-4 h-4 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full z-20 border-3 border-white cursor-pointer hover:scale-150 hover:from-indigo-500 hover:to-indigo-700 transition-all duration-300 shadow-lg","data-connection-point":"input","data-node-id":d,title:"Input connection point",style:{top:"-8px",boxShadow:"0 4px 12px rgba(79, 70, 229, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3)"}}),e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 w-4 h-4 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full z-20 border-3 border-white cursor-pointer hover:scale-150 hover:from-purple-500 hover:to-purple-700 transition-all duration-300 shadow-lg","data-connection-point":"output","data-node-id":d,title:"Output connection point - drag to connect",onMouseDown:I=>{I.stopPropagation(),I.preventDefault(),console.log("ðŸ”— Starting connection from node:",d),o.onConnectionStart&&d&&o.onConnectionStart(d,{x:0,y:0})},style:{bottom:"-8px",boxShadow:"0 4px 12px rgba(139, 92, 246, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3)"}}),k&&o.type!=="endCall"&&e.jsx("div",{className:"absolute -bottom-16 left-1/2 transform -translate-x-1/2 z-30",children:e.jsxs("button",{className:"w-12 h-12 bg-gradient-to-br from-indigo-500 via-indigo-600 to-purple-600 hover:from-indigo-600 hover:via-indigo-700 hover:to-purple-700 text-white rounded-full flex items-center justify-center transition-all duration-300 shadow-2xl hover:shadow-3xl hover:scale-110 border-2 border-white",style:{boxShadow:"0 8px 25px rgba(79, 70, 229, 0.4), 0 0 0 4px rgba(255, 255, 255, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},onClick:I=>{I.stopPropagation(),o.onConnectionStart&&d&&o.onConnectionStart(d,{x:0,y:0})},title:"Add new node",children:[e.jsx("span",{className:"text-xl font-bold leading-none drop-shadow-sm",children:"+"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-indigo-400 animate-ping opacity-30"})]})})]})})},$t=[{type:"conversation",label:"Conversation",description:"AI conversation with users",icon:"MessageCircle",color:"bg-blue-100 text-blue-600",category:"core",configuration:{fields:[{name:"name",type:"text",label:"Node Name",description:"Name for this conversation node",required:!0,defaultValue:"Conversation"},{name:"firstMessage",type:"text",label:"First Message",description:"Initial message to send to the user",required:!1,defaultValue:"Hello! How can I help you today?"},{name:"prompt",type:"textarea",label:"System Prompt",description:"Instructions for the AI assistant",required:!0,defaultValue:"You are a helpful AI assistant. Respond naturally and helpfully to user queries."},{name:"model",type:"select",label:"AI Model",description:"Choose the AI model to use",required:!0,options:[{label:"GPT-4",value:"gpt-4"},{label:"GPT-3.5 Turbo",value:"gpt-3.5-turbo"},{label:"Claude 3",value:"claude-3"}],defaultValue:"gpt-4"},{name:"temperature",type:"number",label:"Temperature",description:"Controls randomness (0.0 to 1.0)",required:!1,defaultValue:.7}]}},{type:"apiRequest",label:"API Request",description:"Make HTTP requests",icon:"Zap",color:"bg-purple-100 text-purple-600",category:"integration",configuration:{fields:[{name:"name",type:"text",label:"Node Name",required:!0,defaultValue:"API Request"},{name:"method",type:"select",label:"HTTP Method",required:!0,options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"}],defaultValue:"GET"},{name:"url",type:"text",label:"URL",description:"API endpoint URL",required:!0,defaultValue:""},{name:"headers",type:"textarea",label:"Headers (JSON)",description:"HTTP headers as JSON object",required:!1,defaultValue:"{}"},{name:"body",type:"textarea",label:"Request Body (JSON)",description:"Request body for POST/PUT requests",required:!1,defaultValue:"{}"}]}},{type:"transferCall",label:"Transfer Call",description:"Transfer to another number",icon:"PhoneCall",color:"bg-green-100 text-green-600",category:"telephony",configuration:{fields:[{name:"name",type:"text",label:"Node Name",required:!0,defaultValue:"Transfer Call"},{name:"destination",type:"text",label:"Destination Number",description:"Phone number to transfer to",required:!0,defaultValue:""},{name:"transferMessage",type:"text",label:"Transfer Message",description:"Message to play before transfer",required:!1,defaultValue:"Please hold while I transfer you."},{name:"summary",type:"textarea",label:"Call Summary",description:"Summary to provide to the receiving party",required:!1,defaultValue:""}]}},{type:"endCall",label:"End Call",description:"Terminate the call",icon:"StopCircle",color:"bg-red-100 text-red-600",category:"telephony",configuration:{fields:[{name:"name",type:"text",label:"Node Name",required:!0,defaultValue:"End Call"},{name:"endMessage",type:"text",label:"End Message",description:"Final message before ending call",required:!1,defaultValue:"Thank you for calling. Have a great day!"}]}},{type:"tool",label:"Tool",description:"Use external tools",icon:"Wrench",color:"bg-orange-100 text-orange-600",category:"integration",configuration:{fields:[{name:"name",type:"text",label:"Node Name",required:!0,defaultValue:"Tool"},{name:"toolType",type:"select",label:"Tool Type",required:!0,options:[{label:"Web Search",value:"web_search"},{label:"Calculator",value:"calculator"},{label:"Weather",value:"weather"},{label:"Custom Function",value:"custom"}],defaultValue:"web_search"},{name:"configuration",type:"textarea",label:"Tool Configuration (JSON)",description:"Tool-specific configuration",required:!1,defaultValue:"{}"}]}}],et=async()=>{try{return new Promise(o=>{setTimeout(()=>o($t),500)})}catch(o){throw console.error("Error fetching VAPI node types:",o),o}},At=async o=>{try{return(await et()).find(d=>d.type===o)||null}catch(x){throw console.error("Error fetching node type configuration:",x),x}},Rt=({isOpen:o,onClose:x,node:d,onSave:k})=>{const[P,v]=a.useState(null),[A,I]=a.useState({}),[w,N]=a.useState(!1);a.useEffect(()=>{d&&o&&(console.log("Side panel opened for node:",d),j())},[d,o]);const j=async()=>{if(d){N(!0);try{const n=await At(d.type);v(n);const C={...d.data};I(C),console.log("Loaded node config:",n),console.log("Initial form data:",C)}catch(n){console.error("Failed to load node configuration:",n)}finally{N(!1)}}},S=a.useCallback((n,C)=>{console.log("Field change:",n,C),I(F=>{const h={...F,[n]:C};return console.log("Updated form data:",h),h})},[]),M=a.useCallback(()=>{console.log("Saving node configuration:",A),k(A)},[A,k]),W=a.useCallback(()=>{console.log("Closing side panel"),x()},[x]),Y=()=>{switch(d==null?void 0:d.type){case"conversation":return e.jsx(ne,{className:"h-5 w-5 text-blue-600"});case"apiRequest":return e.jsx("div",{className:"h-5 w-5 bg-purple-600 rounded"});case"transferCall":return e.jsx("div",{className:"h-5 w-5 bg-green-600 rounded"});case"endCall":return e.jsx("div",{className:"h-5 w-5 bg-red-600 rounded"});case"tool":return e.jsx("div",{className:"h-5 w-5 bg-orange-600 rounded"});default:return e.jsx(ne,{className:"h-5 w-5 text-blue-600"})}},L=()=>{switch(d==null?void 0:d.type){case"conversation":return"Conversation Node";case"apiRequest":return"API Request Node";case"transferCall":return"Transfer Call Node";case"endCall":return"End Call Node";case"tool":return"Tool Node";default:return"Node"}},B=n=>{var F;const C=A[n.name]||"";switch(n.type){case"text":return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Z,{htmlFor:n.name,className:"text-sm font-medium text-gray-700",children:[n.label,n.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(Ve,{id:n.name,value:C,onChange:h=>S(n.name,h.target.value),placeholder:n.description,className:"w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),n.description&&e.jsx("p",{className:"text-xs text-gray-500",children:n.description})]},n.name);case"textarea":return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Z,{htmlFor:n.name,className:"text-sm font-medium text-gray-700",children:[n.label,n.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(_e,{id:n.name,value:C,onChange:h=>S(n.name,h.target.value),placeholder:n.description,className:"w-full min-h-[120px] border-gray-300 focus:border-blue-500 focus:ring-blue-500 resize-none"}),n.description&&e.jsx("p",{className:"text-xs text-gray-500",children:n.description})]},n.name);case"select":return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Z,{htmlFor:n.name,className:"text-sm font-medium text-gray-700",children:[n.label,n.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs(ft,{value:C,onValueChange:h=>S(n.name,h),children:[e.jsx(bt,{className:"w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(yt,{placeholder:n.description})}),e.jsx(vt,{children:(F=n.options)==null?void 0:F.map(h=>e.jsx(Nt,{value:h.value,children:h.label},h.value))})]}),n.description&&e.jsx("p",{className:"text-xs text-gray-500",children:n.description})]},n.name);case"boolean":return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Z,{htmlFor:n.name,className:"text-sm font-medium text-gray-700",children:n.label}),n.description&&e.jsx("p",{className:"text-xs text-gray-500",children:n.description})]}),e.jsx(wt,{id:n.name,checked:C,onCheckedChange:h=>S(n.name,h)})]},n.name);case"number":return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Z,{htmlFor:n.name,className:"text-sm font-medium text-gray-700",children:[n.label,n.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(Ve,{id:n.name,type:"number",value:C,onChange:h=>S(n.name,parseFloat(h.target.value)||0),placeholder:n.description,className:"w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),n.description&&e.jsx("p",{className:"text-xs text-gray-500",children:n.description})]},n.name);default:return null}};return o?e.jsx("div",{className:"fixed inset-y-0 right-0 z-50 w-96 bg-white border-l border-gray-200 shadow-xl",onMouseDown:n=>n.stopPropagation(),onMouseMove:n=>n.stopPropagation(),onMouseUp:n=>n.stopPropagation(),onClick:n=>n.stopPropagation(),children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[Y(),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:L()}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configure node settings"})]})]}),e.jsx($,{variant:"ghost",size:"sm",onClick:W,className:"h-8 w-8 p-0",children:e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:w?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):P?e.jsx("div",{className:"space-y-6",children:P.configuration.fields.map(B)}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No configuration available for this node type."})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx($,{variant:"outline",onClick:W,className:"flex-1",children:"Cancel"}),e.jsx($,{onClick:M,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:"Save Changes"})]})})]})}):null},Vt=({isOpen:o,onClose:x,edge:d,onSave:k})=>{const[P,v]=a.useState(""),[A,I]=a.useState("");a.useEffect(()=>{d&&(v(d.label||""),I(""))},[d]);const w=()=>{d&&P.trim()&&(k(d.id,P.trim()),x())},N=j=>{j.key==="Escape"?x():j.key==="Enter"&&(j.ctrlKey||j.metaKey)&&w()};return!o||!d?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:x}),e.jsxs("div",{className:"fixed right-0 top-0 h-full w-96 bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out",onKeyDown:N,tabIndex:-1,children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-teal-50 to-emerald-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Connection Label"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Customize the condition text for this workflow connection"})]}),e.jsx($,{variant:"ghost",size:"sm",onClick:x,className:"h-8 w-8 p-0 hover:bg-gray-100",children:e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Connection Details"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{children:["From: ",e.jsx("span",{className:"font-medium",children:d.source})]}),e.jsxs("div",{children:["To: ",e.jsx("span",{className:"font-medium",children:d.target})]}),e.jsxs("div",{children:["ID: ",e.jsx("span",{className:"font-mono",children:d.id})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"edge-label",className:"text-sm font-medium text-gray-900",children:"Condition Label"}),e.jsx(Ve,{id:"edge-label",value:P,onChange:j=>v(j.target.value),placeholder:"e.g., if the user said yes",className:"w-full",autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"This text will appear on the connection line between nodes"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"edge-description",className:"text-sm font-medium text-gray-900",children:"Description (Optional)"}),e.jsx(_e,{id:"edge-description",value:A,onChange:j=>I(j.target.value),placeholder:"Add additional details about this condition...",className:"w-full h-20 resize-none"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Internal notes about this connection condition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-sm font-medium text-gray-900",children:"Quick Templates"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:["if the user said yes","if the user said no","if user needs help","if call should transfer","if information collected","default path"].map(j=>e.jsx("button",{onClick:()=>v(j),className:"text-left px-3 py-2 text-xs bg-gray-50 hover:bg-teal-50 rounded border border-gray-200 hover:border-teal-200 transition-colors",children:j},j))})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Press Ctrl+Enter to save, Esc to cancel"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx($,{variant:"outline",onClick:x,className:"px-4",children:"Cancel"}),e.jsxs($,{onClick:w,disabled:!P.trim(),className:"px-4 bg-teal-600 hover:bg-teal-700",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]})]})})]})]})},Wt=({workflowId:o,workflowData:x,workflowName:d="Unnamed Workflow",workflowDescription:k="",onCallStart:P,onCallEnd:v,onError:A})=>{const I="eb3b26e3-7dbb-4fd6-a545-a954756a43aa",w=a.useRef(null),[N,j]=a.useState({isConnected:!1,isConnecting:!1,isMuted:!1,volumeLevel:0,callDuration:0,status:"idle"}),[S,M]=a.useState([]),[W,Y]=a.useState(null),[L,B]=a.useState(!1),n=a.useRef(null);a.useEffect(()=>{console.log("ðŸ”§ Initializing VAPI with key:",`${I.substring(0,8)}...`);try{w.current=new jt(I),console.log("âœ… VAPI instance created successfully"),C()}catch(c){console.error("âŒ Failed to initialize VAPI:",c),E.error("Failed to initialize VAPI. Please check your API key.")}return()=>{w.current&&w.current.stop(),n.current&&clearInterval(n.current)}},[I]);const C=()=>{w.current&&(w.current.on("call-start",()=>{console.log("ðŸŽ™ï¸ VAPI call started"),j(c=>({...c,isConnected:!0,isConnecting:!1,status:"connected"})),F(),E.success("Call connected! You can now speak."),P==null||P()}),w.current.on("call-end",()=>{console.log("ðŸ“ž VAPI call ended"),j(c=>({...c,isConnected:!1,isConnecting:!1,status:"ended"})),n.current&&(clearInterval(n.current),n.current=null),E.info("Call ended"),v==null||v()}),w.current.on("speech-start",()=>{console.log("ðŸ—£ï¸ Speech started")}),w.current.on("speech-end",()=>{console.log("ðŸ¤ Speech ended")}),w.current.on("volume-level",c=>{j(T=>({...T,volumeLevel:c}))}),w.current.on("message",c=>{if(console.log("ðŸ“¨ VAPI message:",c),c.type==="transcript"&&c.transcript){const T={role:c.role||"assistant",content:c.transcript,timestamp:new Date,type:"transcript"};M(f=>[...f,T])}}),w.current.on("error",c=>{console.error("âŒ VAPI error:",c),j(T=>({...T,isConnected:!1,isConnecting:!1,status:"error"})),E.error(`Call error: ${c.message||"Unknown error"}`),A==null||A(c)}))},F=()=>{n.current=setInterval(()=>{j(c=>({...c,callDuration:c.callDuration+1}))},1e3)},h=c=>{const T=Math.floor(c/60),f=c%60;return`${T}:${f.toString().padStart(2,"0")}`},H=async()=>{try{console.log("ðŸ” Performing demo login...");const c=await fetch("https://ai.research-hero.com/api/auth/demo-login",{method:"POST",headers:{"Content-Type":"application/json"}});if(c.ok){const T=await c.json();if(T.success&&T.data.token)return Le.setItem("token",T.data.token),console.log("âœ… Demo login successful"),E.success("Demo login successful"),T.data.token}throw new Error("Demo login failed")}catch(c){return console.error("âŒ Demo login error:",c),E.error("Demo login failed"),null}},X=async()=>{try{B(!0),console.log("ðŸ”„ Creating/syncing VAPI workflow...");let c=Le.getItem("token");if(console.log("ðŸ”‘ Auth token:",c?`${c.substring(0,20)}...`:"NOT FOUND"),!c&&(console.log("ðŸ” No token found, attempting demo login..."),c=await H(),!c))throw new Error("Authentication failed. Please log in.");const T={name:d,description:k,workflowId:o,nodes:(x==null?void 0:x.nodes)||[],edges:(x==null?void 0:x.edges)||[]};console.log("ðŸ“¤ Sending workflow to VAPI:","https://ai.research-hero.com/api/workflows/vapi/sync"),console.log("ðŸ“‹ Workflow data:",T);const f=await fetch("https://ai.research-hero.com/api/workflows/vapi/sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(T)});if(console.log("ðŸ“¥ Response status:",f.status,f.statusText),!f.ok){const D=await f.text();throw console.error("âŒ API Error Response:",D),f.status===401?new Error("Authentication failed. Please log in again."):f.status===403?new Error("Access denied. You may not have permission to create workflows."):new Error(`Failed to sync workflow: ${f.status} ${f.statusText}`)}const q=await f.json();if(console.log("ðŸ“¥ API Response:",q),q.success&&q.workflowId)return console.log("âœ… VAPI workflow synced:",q.workflowId),q.workflowId;throw new Error(q.error||"Failed to sync workflow")}catch(c){return console.error("âŒ Error syncing VAPI workflow:",c),E.error(`Failed to sync workflow: ${(c==null?void 0:c.message)||"Unknown error"}`),null}finally{B(!1)}},te=async()=>{if(console.log("ðŸš€ Starting VAPI web call..."),!w.current){E.error("VAPI not initialized. Please check your API key configuration.");return}try{j(f=>({...f,isConnecting:!0,status:"connecting",callDuration:0})),M([]),console.log("ðŸ”„ Syncing workflow to VAPI...");const c=await X();if(!c)throw new Error("Failed to sync workflow to VAPI");console.log("ðŸ“ž Starting workflow call with ID:",c);const T={workflowId:c,metadata:{portalWorkflowId:o,workflowName:d,initiatedFrom:"portal"}};await w.current.start(T)}catch(c){console.error("âŒ Error starting web call:",c),j(T=>({...T,isConnecting:!1,status:"error"})),E.error(`Failed to start call: ${(c==null?void 0:c.message)||"Unknown error"}`)}},K=()=>{console.log("ðŸ›‘ Stopping VAPI web call..."),w.current&&w.current.stop()},se=()=>{if(w.current){const c=!N.isMuted;w.current.setMuted(c),j(T=>({...T,isMuted:c})),E.info(c?"Microphone muted":"Microphone unmuted")}};return e.jsxs(Je,{children:[e.jsx(Qe,{asChild:!0,children:e.jsxs($,{variant:"outline",size:"sm",className:"bg-gradient-to-r from-teal-500 to-cyan-600 hover:from-teal-600 hover:to-cyan-700 text-white border-none shadow-lg hover:shadow-xl transition-all duration-300 relative group overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx(Oe,{className:"h-4 w-4 mr-2 relative z-10"}),e.jsx("span",{className:"relative z-10",children:"Web Call"}),N.isConnected&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse"})]})}),e.jsxs(Ct,{className:"max-w-4xl max-h-[90vh] overflow-hidden","aria-describedby":"vapi-web-call-description",children:[e.jsxs(St,{children:[e.jsxs(kt,{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5 text-teal-600"}),e.jsx("span",{children:"VAPI Web Call"})]}),e.jsx(me,{variant:N.status==="connected"?"default":"secondary",children:N.status==="idle"?"Ready":N.status==="connecting"?"Connecting...":N.status==="connected"?"Connected":N.status==="ended"?"Ended":"Error"})]}),e.jsx("div",{id:"vapi-web-call-description",className:"sr-only",children:"VAPI Web Call interface for making voice calls with AI assistants"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-[600px]",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Pe,{children:[e.jsx(Ie,{children:e.jsxs(Te,{className:"text-lg flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5 text-teal-600"}),"Call Controls"]})}),e.jsxs(Me,{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:!N.isConnected&&!N.isConnecting?e.jsx($,{onClick:te,size:"lg",className:"w-20 h-20 rounded-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-2xl transition-all duration-300 hover:shadow-3xl hover:scale-110",disabled:L,children:L?e.jsx(Se,{className:"h-8 w-8 animate-spin"}):e.jsx(qe,{className:"h-8 w-8"})}):N.isConnecting?e.jsx($,{size:"lg",className:"w-20 h-20 rounded-full bg-yellow-500 text-white shadow-2xl",disabled:!0,children:e.jsx(Se,{className:"h-8 w-8 animate-spin"})}):e.jsx($,{onClick:K,size:"lg",className:"w-20 h-20 rounded-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white shadow-2xl transition-all duration-300 hover:shadow-3xl hover:scale-110",children:e.jsx(at,{className:"h-8 w-8"})})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[N.status==="idle"&&"Ready to start call",N.status==="connecting"&&"Connecting to assistant...",N.status==="connected"&&"Call in progress",N.status==="ended"&&"Call ended",N.status==="error"&&"Call error occurred"]}),N.isConnected&&e.jsx("div",{className:"text-2xl font-mono font-bold text-teal-600",children:h(N.callDuration)})]}),N.isConnected&&e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsxs($,{onClick:se,variant:"outline",size:"sm",className:N.isMuted?"bg-red-100 border-red-300":"",children:[N.isMuted?e.jsx(rt,{className:"h-4 w-4 mr-2 text-red-600"}):e.jsx(ot,{className:"h-4 w-4 mr-2"}),N.isMuted?"Unmute":"Mute"]}),e.jsxs($,{variant:"outline",size:"sm",children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),"Volume"]})]})]})]}),e.jsxs(Pe,{children:[e.jsx(Ie,{children:e.jsxs(Te,{className:"text-lg flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5 text-blue-600"}),"Call Information"]})}),e.jsx(Me,{children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Workflow:"}),e.jsx("div",{className:"font-medium",children:d})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Workflow ID:"}),e.jsx("div",{className:"font-mono text-xs bg-gray-100 p-1 rounded mt-1 break-all",children:o||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Assistant ID:"}),e.jsx("div",{className:"font-mono text-xs bg-gray-100 p-1 rounded mt-1 break-all",children:L?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"w-3 h-3 animate-spin"}),"Creating assistant..."]}):W||"Will be created on call start"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"API Status:"}),e.jsx("div",{className:"mt-1",children:e.jsx(me,{variant:"default",className:"bg-green-100 text-green-800",children:"âœ… VAPI Configured"})})]})]})})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs(Pe,{className:"h-full",children:[e.jsx(Ie,{children:e.jsxs(Te,{className:"text-lg flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-purple-600"}),"Live Transcript"]})}),e.jsx(Me,{className:"h-[500px] overflow-y-auto",children:S.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Start a call to see the live transcript"})]})}):e.jsx("div",{className:"space-y-3",children:S.map((c,T)=>e.jsx("div",{className:`flex gap-3 ${c.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] p-3 rounded-lg ${c.role==="user"?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.role==="user"?e.jsx(lt,{className:"h-4 w-4"}):e.jsx(it,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs opacity-75",children:c.timestamp.toLocaleTimeString()})]}),e.jsx("p",{className:"text-sm",children:c.content})]})},T))})})]})})]})]})]})};let We=0;const De=()=>`node_${We++}`,ns=()=>{var ie;const{id:o}=Tt(),x=Mt();xt();const[d,k]=a.useState([]),[P,v]=a.useState([]),[A,I]=a.useState(null),[w,N]=a.useState(!1),[j,S]=a.useState(null),[M,W]=a.useState(!1),[Y,L]=a.useState(!1),[B,n]=a.useState(""),[C,F]=a.useState(!1),[h,H]=a.useState(null),[X,te]=a.useState([]),[K,se]=a.useState(!1),[c,T]=a.useState(null),{data:f,isLoading:q,error:D}=ht({queryKey:["workflow",o],queryFn:()=>(console.log("Fetching workflow with ID:",o),Pt(o)),enabled:!!o,retry:1});a.useEffect(()=>{console.log("WorkflowBuilder - ID:",o),console.log("WorkflowBuilder - Loading:",q),console.log("WorkflowBuilder - Error:",D),console.log("WorkflowBuilder - Data:",f)},[o,q,D,f]);const le=ke({mutationFn:({id:r,data:t})=>Ge.autoSaveWorkflow(r,t),onSuccess:()=>{S(new Date),N(!1)},onError:()=>{N(!1)}}),G=ke({mutationFn:({id:r,data:t})=>Ge.updateWorkflow(r,t),onSuccess:()=>{S(new Date),E.success("Workflow saved successfully")},onError:r=>{console.error("Save error:",r),E.error("Failed to save workflow")}});ke({mutationFn:It,onSuccess:()=>{E.success("Workflow test initiated successfully")}});const _=a.useCallback((r,t)=>{k(i=>t.isStart===!0||t.start===!0?i.map(l=>l.id===r?{...l,data:{...l.data,...t,isStart:!0,start:!0}}:{...l,data:{...l.data,isStart:!1,start:!1}}):i.map(l=>l.id===r?{...l,data:{...l.data,...t}}:l))},[]),U=a.useCallback(r=>{k(t=>t.filter(i=>i.id!==r)),v(t=>t.filter(i=>i.source!==r&&i.target!==r))},[]),z=a.useCallback(r=>{k(t=>{const i=t.find(l=>l.id===r);return i&&(H(i),F(!0)),t})},[]),J=a.useCallback(r=>{h&&_(h.id,r)},[h]),pe=a.useCallback(()=>{F(!1),H(null)},[]),ae=a.useRef(_),re=a.useRef(U),Q=a.useRef(z);ae.current=_,re.current=U,Q.current=z,a.useEffect(()=>{var r,t;if(f!=null&&f.data){const i=f.data,l=((r=i.nodes)==null?void 0:r.map((m,p)=>{const b=m.name||`node-${p}`;console.log(`ðŸ” Loading node ${p}:`,{originalType:m.type,name:m.name,nodeData:m});let y=m.type;const s=m.type;return s==="transfer"?y="transferCall":(s==="hangup"||s==="end")&&(y="endCall"),console.log(`ðŸ”„ Mapped node type: ${s} â†’ ${y}`),{id:b,type:y,position:m.position||{x:p*250+100,y:p*150+100},draggable:!0,selectable:!0,data:{...m,type:y,onUpdate:g=>ae.current(b,g),onDelete:()=>re.current(b),onConfigure:()=>Q.current(b)}}}))||[],u=((t=i.edges)==null?void 0:t.map((m,p)=>{var b,y;return{id:`edge-${p}`,source:m.from,target:m.to,label:((b=m.condition)==null?void 0:b.prompt)||((y=m.condition)==null?void 0:y.expression)||""}}))||[];if(k(l),v(u),We=Math.max(We,l.length),l.length===0){const m=De(),p=De(),b={id:m,type:"conversation",position:{x:250,y:150},data:{type:"conversation",name:"support-greeting",prompt:"Greet the customer and ask about their issue.",firstMessage:"Hello! How can I help you today?",isStart:!0,start:!0,onUpdate:g=>ae.current(m,g),onDelete:()=>re.current(m),onConfigure:()=>Q.current(m)}},y={id:p,type:"conversation",position:{x:250,y:400},data:{type:"conversation",name:"New Conversation",prompt:"Enter your prompt here...",isStart:!1,onUpdate:g=>ae.current(p,g),onDelete:()=>re.current(p),onConfigure:()=>Q.current(p)}},s={id:"edge-1",source:m,target:p,label:"if the user said yes"};k([b,y]),v([s])}}},[f]),a.useEffect(()=>{},[d,P,o,w]),a.useEffect(()=>{(async()=>{try{const t=await et();te(t)}catch(t){console.error("Failed to fetch VAPI node types:",t),E.error("Failed to load node types")}})()},[]),a.useEffect(()=>{const r=t=>{console.log("Page is about to reload/unload!"),console.trace("Reload triggered from:")};return window.addEventListener("beforeunload",r),()=>window.removeEventListener("beforeunload",r)},[]),a.useCallback(()=>{var l;if(console.log("âš¡ AUTO-SAVE TRIGGERED - handleAutoSave function called"),!o||w)return;N(!0);const r=d.map((u,m)=>{var b;const p={type:u.type,name:u.id,isStart:m===0||u.data.isStart===!0};switch(u.type){case"conversation":const y={...p,prompt:u.data.prompt||"You are a helpful AI assistant."};return u.data.variables&&u.data.variables.length>0&&(y.variables=u.data.variables),(b=u.data.globalNodePlan)!=null&&b.enabled&&(y.globalNodePlan=u.data.globalNodePlan),y;case"apiRequest":return{...p,method:u.data.method||"GET",url:u.data.url||"",headers:u.data.headers||{},body:u.data.body||{},timeoutSeconds:u.data.timeoutSeconds||20};case"transferCall":return{...p,destination:u.data.destination||"",transferPlan:{destination:u.data.destination||"",message:u.data.transferMessage||"Please hold while I transfer you.",summary:u.data.summary||""}};case"endCall":return{...p};case"tool":return{...p,toolIds:u.data.toolIds||[],tools:u.data.tools||[]};default:return{...p,prompt:u.data.prompt||"Default prompt"}}}),t=P.map(u=>({from:u.source,to:u.target,condition:u.label?{type:"ai",prompt:u.label}:void 0})),i={name:((l=f==null?void 0:f.data)==null?void 0:l.name)||"Unnamed Workflow",nodes:r,edges:t};console.log("Sending to VAPI API:",i),le.mutate({id:o,data:i})},[o,d,P,w,le]),a.useCallback((r,t)=>{if(console.log("onConnect called with:",r,"->",t),P.find(u=>u.source===r&&u.target===t)){console.log("Connection already exists, skipping");return}const l={id:`edge-${Date.now()}`,source:r,target:t};console.log("Creating new edge:",l),v(u=>{const m=[...u,l];return console.log("Updated edges:",m),m}),E.success("Nodes connected successfully")},[P]);const ge=a.useCallback(r=>{console.log("Node clicked:",r.id,r.type),I(r),H(r),F(!0)},[]),be=a.useCallback(r=>{k(r)},[]),xe=a.useCallback(r=>{v(r)},[]),he=a.useCallback(r=>{console.log("ðŸ·ï¸ Edge label clicked:",r),T(r),se(!0)},[]),ye=a.useCallback((r,t)=>{console.log("ðŸ’¾ Saving edge label:",r,t),v(i=>i.map(l=>l.id===r?{...l,label:t}:l)),E.success("Connection label updated")},[]),ve=a.useCallback((r,t)=>{const i=De(),l=t||{x:Math.random()*400+100,y:Math.random()*300+100};console.log("Adding node:",i,"type:",r,"at position:",l);const u={id:i,type:r,position:l,data:{type:r,name:`${r.charAt(0).toUpperCase()+r.slice(1)} Node`,prompt:r==="conversation"?"You are a helpful AI assistant. Respond naturally and helpfully to user queries.":"",firstMessage:r==="conversation"?"Hello! How can I help you today?":"",isStart:d.length===0,start:d.length===0,onUpdate:m=>_(i,m),onDelete:()=>U(i),onConfigure:()=>z(i),...r==="apiRequest"&&{method:"GET",url:"",headers:{},body:{}},...r==="transferCall"&&{destination:"",transferPlan:{message:"",summary:""}},...r==="tool"&&{toolIds:[],tools:[]}}};k(m=>[...m,u])},[d.length,_,U,z]),Ne=()=>{var y;if(console.log("ðŸ”¥ SAVE BUTTON CLICKED - handleSave function called"),!o||d.length===0){E.error("No workflow to save");return}const r=d.map((s,g)=>{console.log(`ðŸ” Processing node ${g}:`,{id:s.id,originalType:s.type,data:s.data});let R=s.type;s.type==="transferCall"?R="transfer":s.type==="endCall"&&(R="hangup"),["conversation","tool","assistant","start","say","gather","end","hangup","apiRequest","transfer"].includes(R)||(console.warn(`âš ï¸ Invalid node type "${R}" for node "${s.id}", defaulting to "conversation"`),R="conversation"),console.log(`ðŸ”„ Node type mapping: ${s.type} â†’ ${R}`);const O={type:R,name:s.id,isStart:g===0||s.data.isStart===!0};switch(s.type){case"conversation":const ee={...O,prompt:s.data.prompt||"You are a helpful AI assistant."};return s.data.variables&&s.data.variables.length>0&&(ee.variables=s.data.variables),ee;case"apiRequest":let oe=s.data.url||"";return(!oe||!oe.startsWith("https://"))&&(oe="https://api.example.com/endpoint",console.warn(`âš ï¸ Using default URL for apiRequest node "${s.id}" - original URL: "${s.data.url}"`)),{...O,method:s.data.method||"GET",url:oe,headers:s.data.headers||{},body:s.data.body||{}};case"transferCall":return{...O,destination:s.data.destination||"",transferPlan:{destination:s.data.destination||"",message:s.data.transferMessage||"Please hold while I transfer you.",summary:s.data.summary||""}};case"endCall":return{...O};case"tool":return{...O,toolIds:s.data.toolIds||[],tools:s.data.tools||[]};default:const we=["prompt","variables","globalNodePlan"],je=Object.fromEntries(Object.entries(s.data).filter(([Ce])=>we.includes(Ce)));return{...O,prompt:s.data.prompt||"Default prompt",...je}}}).filter(s=>s!==null),t=P.map(s=>({from:s.source,to:s.target,condition:s.label?{type:"ai",prompt:s.label}:void 0}));console.log("Saving workflow with data:",{nodes:r,edges:t}),console.log("ðŸ” DEBUGGING WORKFLOW SAVE:"),console.log("Total nodes to save:",r.length),r.forEach((s,g)=>{console.log(`Node ${g}: type="${s.type}", name="${s.name}", isStart=${s.isStart}`),console.log(`Node ${g} properties:`,Object.keys(s)),console.log(`Node ${g} full object:`,JSON.stringify(s,null,2))});const i=["conversation","tool","assistant","start","say","gather","end","hangup","apiRequest","transfer"],l=r.filter(s=>!i.includes(s.type));if(l.length>0){console.error("âŒ Invalid node types found:",l.map(s=>({name:s.name,type:s.type}))),E.error(`Invalid node types: ${l.map(s=>s.type).join(", ")}`);return}console.log("âœ… All node types are valid!");const u=["position","start","firstMessage"];if(r.some(s=>u.some(g=>g in s))){console.error("ERROR: Found forbidden properties in nodes!",r),E.error("Internal error: Forbidden properties found in nodes");return}const p=r.filter(s=>s.isStart===!0);if(p.length!==1){console.error("ERROR: Must have exactly one start node!",{startNodes:p,workflowNodes:r}),E.error("Workflow must have exactly one start node");return}console.log("Final workflow data being sent to VAPI:",JSON.stringify({nodes:r,edges:t},null,2)),r.forEach((s,g)=>{console.log(`Node ${g} (${s.name}):`,{type:s.type,isStart:s.isStart,hasStart:"start"in s,hasPosition:"position"in s,keys:Object.keys(s)})});const b={name:((y=f==null?void 0:f.data)==null?void 0:y.name)||"Unnamed Workflow",nodes:r,edges:t};G.mutate({id:o,data:b})},fe=a.useMemo(()=>({conversation:de,apiRequest:de,transferCall:de,endCall:de,tool:de}),[]);return q?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Loading workflow..."})]})}):D?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-red-600 mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Error Loading Workflow"}),e.jsx("p",{className:"text-gray-600 mb-4",children:D instanceof Error?D.message:"Failed to load workflow"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Workflow ID: ",o]})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsxs($,{onClick:()=>x("/workflows"),variant:"outline",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Back to Workflows"]}),e.jsx($,{onClick:()=>window.location.reload(),children:"Try Again"})]})]})}):e.jsxs("div",{className:"h-screen flex flex-col bg-white",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-3 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs($,{variant:"ghost",size:"sm",onClick:()=>x("/workflows"),className:"text-gray-600 hover:text-gray-900",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:((ie=f==null?void 0:f.data)==null?void 0:ie.name)||"Untitled Workflow"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500",children:[e.jsx("span",{className:"flex items-center gap-1",children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),"Auto-saving..."]}):j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Saved ",j.toLocaleTimeString()]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),"Not saved"]})}),e.jsx("div",{className:"h-3 w-px bg-gray-300"}),e.jsxs(me,{variant:"secondary",className:"text-xs",children:[d.length," nodes"]}),e.jsxs(me,{variant:"secondary",className:"text-xs",children:[P.length," connections"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsx(Ue,{children:e.jsxs(Ye,{children:[e.jsx(Be,{asChild:!0,children:e.jsx($,{variant:"outline",size:"sm",onClick:Ne,disabled:w||G.isPending,className:"text-gray-600",children:G.isPending?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):e.jsx(Ke,{className:"h-4 w-4"})})}),e.jsx(Xe,{children:"Save Workflow"})]})}),e.jsx(Je,{open:Y,onOpenChange:L,children:e.jsx(Qe,{asChild:!0})}),e.jsx(Wt,{workflowId:o,workflowData:f,onCallStart:()=>{console.log("ðŸŽ™ï¸ Web call started for workflow:",o),console.log("ðŸŽ™ï¸ Workflow data:",f),E.success("Web call started successfully!")},onCallEnd:()=>{console.log("ðŸŽ™ï¸ Web call ended for workflow:",o),E.info("Web call ended")},onError:r=>{console.error("ðŸŽ™ï¸ Web call error:",r),E.error(`Web call error: ${r.message||"Unknown error"}`)}})]})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:`${M?"w-16":"w-72"} bg-gray-50 border-r border-gray-200 flex-shrink-0 transition-all duration-200`,children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[!M&&e.jsx("h3",{className:"font-semibold text-gray-900",children:"Add Nodes"}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>W(!M),className:"text-gray-600 hover:text-gray-900",children:M?e.jsx(ct,{className:"h-4 w-4"}):e.jsx(dt,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-2",children:X.map(r=>{const i=(l=>{switch(l){case"MessageCircle":return ue;case"Zap":return gt;case"PhoneCall":return pt;case"StopCircle":return mt;case"Wrench":return ut;default:return ue}})(r.icon);return e.jsx(Ue,{children:e.jsxs(Ye,{children:[e.jsx(Be,{asChild:!0,children:e.jsxs("div",{className:`flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-white hover:shadow-sm transition-all duration-200 bg-white ${M?"justify-center":""}`,draggable:!0,onDragStart:l=>{l.dataTransfer.setData("application/reactflow",r.type),l.dataTransfer.effectAllowed="move"},onClick:()=>ve(r.type),children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${r.color}`,children:e.jsx(i,{className:"h-4 w-4"})}),!M&&e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.label}),e.jsx("div",{className:"text-xs text-gray-500",children:r.description})]})]})}),M&&e.jsx(Xe,{side:"right",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.label}),e.jsx("div",{className:"text-xs text-gray-500",children:r.description})]})})]})},r.type)})})]})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Dt,{nodes:d,edges:P,onNodesChange:be,onEdgesChange:xe,onNodeClick:ge,selectedNode:A,nodeTypes:fe,onEdgeLabelClick:he}),d.length===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ue,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Start Building Your Workflow"}),e.jsx("p",{className:"text-gray-500 mb-4 max-w-sm",children:"Drag nodes from the sidebar or click on them to add to your workflow"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-400",children:[e.jsx("span",{children:"Tip: Start with a"}),e.jsx(me,{variant:"secondary",className:"text-xs",children:"Conversation"}),e.jsx("span",{children:"node"})]})]})})]})]}),e.jsx(Rt,{isOpen:C,onClose:pe,node:h,onSave:J}),e.jsx(Vt,{isOpen:K,onClose:()=>se(!1),edge:c,onSave:ye})]})};export{ns as default};
//# sourceMappingURL=WorkflowBuilder-BWIyoC74.js.map
