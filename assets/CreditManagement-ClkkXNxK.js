import{j as e,J as Q,aB as W,bw as X,b_ as Y,bf as Z,N as ee,K as se,H as te,y as ae}from"./ui-S570Xcny.js";import{r}from"./vendor-DG599jyl.js";import{C as c,a as o,b as I,c as $}from"./card-DMfGhRm1.js";import{B as d}from"./button-BSd9MMPp.js";import{I as w}from"./input-jxB46izN.js";import{B as re}from"./badge-ij7fArnn.js";import{T as ne,a as ie,b as y,c as _}from"./tabs-CbOWgAXT.js";import{T as le,a as de,b as z,c as m,d as ce,e as x}from"./table-Beiyegzh.js";import{D as oe,a as me,b as xe,c as je,d as he}from"./dialog-Cc2g-8Kh.js";import{d as C,t as b}from"./index-YNP4OU4_.js";import"./router-BavLd_S0.js";import"./query-Cab5P5bd.js";const Le=()=>{var U,E,M;const[t,j]=r.useState([]),[a,h]=r.useState(null),[u,n]=r.useState(!0),[l,O]=r.useState(""),[p,S]=r.useState(null),[q,g]=r.useState(!1),[v,T]=r.useState(""),[A,L]=r.useState(""),[N,D]=r.useState(1),[P,G]=r.useState(1);r.useEffect(()=>{F()},[N]);const F=async()=>{try{n(!0);const[s,i]=await Promise.all([C.get(`/api/credits/admin/users?page=${N}&limit=20`),C.get("/api/credits/admin/analytics?days=30")]);j(s.data.data.users),G(s.data.data.pagination.totalPages),h(i.data.data)}catch(s){console.error("Error fetching credit data:",s),b.error("Failed to load credit data")}finally{n(!1)}},J=async()=>{if(!p||!v){b.error("Please enter an adjustment amount");return}try{await C.post("/api/credits/admin/adjust",{userId:p.user_id,amount:parseFloat(v),reason:A||"Admin adjustment"}),b.success(`Credits ${v>0?"added to":"deducted from"} ${p.email}`),g(!1),T(""),L(""),S(null),F()}catch(s){console.error("Error adjusting credits:",s),b.error("Failed to adjust credits")}},R=t.filter(s=>{var i,B,H,k;return((i=s.email)==null?void 0:i.toLowerCase().includes(l.toLowerCase()))||((B=s.first_name)==null?void 0:B.toLowerCase().includes(l.toLowerCase()))||((H=s.last_name)==null?void 0:H.toLowerCase().includes(l.toLowerCase()))||((k=s.username)==null?void 0:k.toLowerCase().includes(l.toLowerCase()))}),f=s=>s==null?"0":parseFloat(s).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}),K=s=>s<=0?"text-red-600":s<=10?"text-yellow-600":"text-green-600",V=s=>s<=0?{variant:"destructive",text:"No Credits"}:s<=10?{variant:"secondary",text:"Low Credits"}:s<=50?{variant:"outline",text:"Medium"}:{variant:"default",text:"Good"};return u?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Credit Management"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[...Array(4)].map((s,i)=>e.jsx(c,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})})},i))})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Credit Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Monitor and manage user credits across the platform"})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(d,{variant:"outline",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Export Data"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(c,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:t.length})]}),e.jsx(W,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["$",(U=a==null?void 0:a.payments)!=null&&U.total_revenue?(a.payments.total_revenue/100).toFixed(2):"0.00"]})]}),e.jsx(X,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Credits Sold"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:(E=a==null?void 0:a.payments)!=null&&E.total_credits_sold?f(a.payments.total_credits_sold):"0"})]}),e.jsx(Y,{className:"h-8 w-8 text-purple-600"})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Credits Used"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:(M=a==null?void 0:a.usage)!=null&&M.total_credits_consumed?f(a.usage.total_credits_consumed):"0"})]}),e.jsx(Z,{className:"h-8 w-8 text-orange-600"})]})})})]}),e.jsxs(ne,{defaultValue:"users",className:"w-full",children:[e.jsxs(ie,{className:"grid w-full grid-cols-3",children:[e.jsx(y,{value:"users",children:"User Credits"}),e.jsx(y,{value:"transactions",children:"Recent Transactions"}),e.jsx(y,{value:"analytics",children:"Analytics"})]}),e.jsxs(_,{value:"users",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(w,{placeholder:"Search users...",value:l,onChange:s=>O(s.target.value),className:"pl-10 w-64"})]}),e.jsxs(d,{variant:"outline",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Filter"]})]})}),e.jsx(c,{children:e.jsx(o,{className:"p-0",children:e.jsxs(le,{children:[e.jsx(de,{children:e.jsxs(z,{children:[e.jsx(m,{children:"User"}),e.jsx(m,{children:"Total Credits"}),e.jsx(m,{children:"Used Credits"}),e.jsx(m,{children:"Available Credits"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Last Purchase"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(ce,{children:R.map(s=>{const i=V(parseFloat(s.available_credits||0));return e.jsxs(z,{children:[e.jsx(x,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.first_name," ",s.last_name]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})}),e.jsx(x,{className:"font-medium",children:f(s.total_credits)}),e.jsx(x,{className:"text-red-600",children:f(s.used_credits)}),e.jsx(x,{className:K(parseFloat(s.available_credits||0)),children:e.jsx("div",{className:"font-medium",children:f(s.available_credits)})}),e.jsx(x,{children:e.jsx(re,{variant:i.variant,children:i.text})}),e.jsx(x,{children:s.last_purchase_at?new Date(s.last_purchase_at).toLocaleDateString():"Never"}),e.jsx(x,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>{S(s),g(!0)},children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"outline",children:e.jsx(ae,{className:"h-4 w-4"})})]})})]},s.user_id)})})]})})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",R.length," of ",t.length," users"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>D(s=>Math.max(1,s-1)),disabled:N===1,children:"Previous"}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>D(s=>Math.min(P,s+1)),disabled:N===P,children:"Next"})]})]})]}),e.jsx(_,{value:"transactions",children:e.jsx(ue,{})}),e.jsx(_,{value:"analytics",children:e.jsx(pe,{analytics:a})})]}),e.jsx(oe,{open:q,onOpenChange:g,children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(je,{children:"Adjust Credits"}),e.jsxs(he,{children:["Adjust credits for ",p==null?void 0:p.email]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Amount"}),e.jsx(w,{type:"number",placeholder:"Enter amount (positive to add, negative to deduct)",value:v,onChange:s=>T(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Reason"}),e.jsx(w,{placeholder:"Reason for adjustment",value:A,onChange:s=>L(s.target.value)})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(d,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(d,{onClick:J,children:"Adjust Credits"})]})]})]})})]})},ue=()=>{const[t,j]=r.useState([]),[a,h]=r.useState(!0);r.useEffect(()=>{u()},[]);const u=async()=>{try{const n=await C.get("/api/credits/admin/transactions?limit=50");j(n.data.data||[])}catch(n){console.error("Error fetching transactions:",n)}finally{h(!1)}};return a?e.jsx("div",{children:"Loading transactions..."}):e.jsxs(c,{children:[e.jsx(I,{children:e.jsx($,{children:"Recent Credit Transactions"})}),e.jsx(o,{children:e.jsx("p",{className:"text-gray-500",children:"Transaction history will be displayed here"})})]})},pe=({analytics:t})=>{var j,a,h,u,n,l;return e.jsx("div",{className:"space-y-6",children:e.jsxs(c,{children:[e.jsx(I,{children:e.jsx($,{children:"Credit System Analytics"})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Usage Statistics"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Operations:"}),e.jsx("span",{className:"font-medium",children:((j=t==null?void 0:t.usage)==null?void 0:j.total_operations)||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Credits Consumed:"}),e.jsx("span",{className:"font-medium",children:((a=t==null?void 0:t.usage)==null?void 0:a.total_credits_consumed)||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Average per Operation:"}),e.jsx("span",{className:"font-medium",children:((h=t==null?void 0:t.usage)==null?void 0:h.avg_credits_per_operation)||0})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Payment Statistics"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Payments:"}),e.jsx("span",{className:"font-medium",children:((u=t==null?void 0:t.payments)==null?void 0:u.total_payments)||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Successful Payments:"}),e.jsx("span",{className:"font-medium",children:((n=t==null?void 0:t.payments)==null?void 0:n.successful_payments)||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Success Rate:"}),e.jsxs("span",{className:"font-medium",children:[((l=t==null?void 0:t.payments)==null?void 0:l.total_payments)>0?(t.payments.successful_payments/t.payments.total_payments*100).toFixed(1):0,"%"]})]})]})]})]})})]})})};export{Le as default};
//# sourceMappingURL=CreditManagement-ClkkXNxK.js.map
