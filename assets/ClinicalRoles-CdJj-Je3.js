import{j as e,aW as ee,D as P,S as Q,O as se,aA as ae,N as le,H as ie,T as re}from"./ui-BZ34e_bG.js";import{r as p}from"./vendor-DG599jyl.js";import{u as te,b as B,c as R}from"./query-BwaCLewj.js";import{g as ne,a as ce,c as de,u as oe,d as me}from"./clinicalRoleService-DNifyI19.js";import{C as o,a as m,b as g,c as v}from"./card-BYrCuzD5.js";import{B as d}from"./button-Cm3qqFtR.js";import{I as n}from"./input-DmGou_SQ.js";import{B as I}from"./badge-CiNZHaLO.js";import{D as A,a as xe,b as M,c as U,d as W}from"./dialog-Dr0dXxlM.js";import{T as he,a as ue,b as z,c as x,d as je,e as h}from"./table-C6M1Val8.js";import{t as c}from"./index-DWPNxztX.js";import"./router-BavLd_S0.js";const De=()=>{const[u,K]=p.useState(""),[G,b]=p.useState(!1),[V,y]=p.useState(!1),[S,D]=p.useState(null),[a,t]=p.useState({name:"",display_name:"",description:"",hierarchy_level:5,permissions:{view:[],add:[],update:[],delete:[]}}),j=te(),{data:N,isLoading:T,error:$}=B({queryKey:["clinical-roles"],queryFn:ne,refetchOnWindowFocus:!1}),J=(N==null?void 0:N.data)||[],{data:i,isLoading:f}=B({queryKey:["clinical-role-stats"],queryFn:ce,refetchOnWindowFocus:!1}),C=R({mutationFn:de,onSuccess:()=>{j.invalidateQueries(["clinical-roles"]),j.invalidateQueries(["clinical-role-stats"]),b(!1),_(),c.success("Clinical role created successfully")},onError:s=>{var l,r;c.error(((r=(l=s.response)==null?void 0:l.data)==null?void 0:r.message)||"Failed to create clinical role")}}),w=R({mutationFn:({id:s,data:l})=>oe(s,l),onSuccess:()=>{j.invalidateQueries(["clinical-roles"]),y(!1),_(),c.success("Clinical role updated successfully")},onError:s=>{var l,r;c.error(((r=(l=s.response)==null?void 0:l.data)==null?void 0:r.message)||"Failed to update clinical role")}}),L=R({mutationFn:me,onSuccess:()=>{j.invalidateQueries(["clinical-roles"]),j.invalidateQueries(["clinical-role-stats"]),c.success("Clinical role deleted successfully")},onError:s=>{var l,r;c.error(((r=(l=s.response)==null?void 0:l.data)==null?void 0:r.message)||"Failed to delete clinical role")}}),_=()=>{t({name:"",display_name:"",description:"",hierarchy_level:5,permissions:{view:[],add:[],update:[],delete:[]}}),D(null)},X=s=>{D(s),t({name:s.name,display_name:s.display_name,description:s.description||"",hierarchy_level:s.hierarchy_level,permissions:s.permissions}),y(!0)},Y=s=>{if(s.is_system_role){c.error("Cannot delete system roles");return}window.confirm(`Are you sure you want to delete the role "${s.display_name}"?`)&&L.mutate(s.id)},F=s=>{if(s.preventDefault(),!a.name||!a.display_name){c.error("Name and display name are required");return}S?w.mutate({id:S.id,data:a}):C.mutate(a)},k=J.filter(s=>{var l;return s.display_name.toLowerCase().includes(u.toLowerCase())||s.name.toLowerCase().includes(u.toLowerCase())||((l=s.description)==null?void 0:l.toLowerCase().includes(u.toLowerCase()))}),Z=s=>s>=9?"bg-red-100 text-red-800":s>=7?"bg-orange-100 text-orange-800":s>=5?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800";return $?e.jsx("div",{className:"p-6",children:e.jsx(o,{children:e.jsx(m,{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Clinical Roles"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load clinical roles. Please try again later."})]})})})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Clinical Roles"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage clinical research roles and permissions"})]}),e.jsxs(A,{open:G,onOpenChange:b,children:[e.jsx(xe,{asChild:!0,children:e.jsxs(d,{onClick:_,children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Create Role"]})}),e.jsxs(M,{className:"max-w-2xl",children:[e.jsx(U,{children:e.jsx(W,{children:"Create Clinical Role"})}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Role Name"}),e.jsx(n,{value:a.name,onChange:s=>t({...a,name:s.target.value}),placeholder:"e.g., clinical_research_coordinator",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Display Name"}),e.jsx(n,{value:a.display_name,onChange:s=>t({...a,display_name:s.target.value}),placeholder:"e.g., Clinical Research Coordinator",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx(n,{value:a.description,onChange:s=>t({...a,description:s.target.value}),placeholder:"Role description..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Hierarchy Level (1-10)"}),e.jsx(n,{type:"number",min:"1",max:"10",value:a.hierarchy_level,onChange:s=>t({...a,hierarchy_level:parseInt(s.target.value)})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(d,{type:"submit",disabled:C.isPending,children:C.isPending?"Creating...":"Create Role"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(o,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Total Roles"}),e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:f?"...":(i==null?void 0:i.total_roles)||0})})]}),e.jsxs(o,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"System Roles"}),e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:f?"...":(i==null?void 0:i.system_roles)||0})})]}),e.jsxs(o,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Custom Roles"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:f?"...":(i==null?void 0:i.custom_roles)||0})})]}),e.jsxs(o,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Users with Roles"}),e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:f?"...":(i==null?void 0:i.users_with_roles)||0})})]})]}),e.jsxs(o,{children:[e.jsx(g,{children:e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(n,{placeholder:"Search clinical roles...",value:u,onChange:s=>K(s.target.value),className:"pl-10"})]})})}),e.jsxs(m,{children:[T?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading clinical roles..."})]}):e.jsxs(he,{children:[e.jsx(ue,{children:e.jsxs(z,{children:[e.jsx(x,{children:"Role"}),e.jsx(x,{children:"Description"}),e.jsx(x,{children:"Hierarchy"}),e.jsx(x,{children:"Permissions"}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(je,{children:k.map(s=>{var l,r,E,q,H,O;return e.jsxs(z,{children:[e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.display_name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.name})]})}),e.jsx(h,{children:e.jsx("div",{className:"max-w-xs truncate",title:s.description,children:s.description||"No description"})}),e.jsx(h,{children:e.jsxs(I,{className:Z(s.hierarchy_level),children:["Level ",s.hierarchy_level]})}),e.jsx(h,{children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:["View: ",((r=(l=s.permissions)==null?void 0:l.view)==null?void 0:r.length)||0]}),e.jsxs("div",{children:["Edit: ",(((q=(E=s.permissions)==null?void 0:E.add)==null?void 0:q.length)||0)+(((O=(H=s.permissions)==null?void 0:H.update)==null?void 0:O.length)||0)]})]})}),e.jsx(h,{children:e.jsx(I,{variant:s.is_system_role?"secondary":"default",children:s.is_system_role?"System":"Custom"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>X(s),children:e.jsx(ie,{className:"h-4 w-4"})}),!s.is_system_role&&e.jsx(d,{variant:"outline",size:"sm",onClick:()=>Y(s),disabled:L.isPending,children:e.jsx(re,{className:"h-4 w-4"})})]})})]},s.id)})})]}),!T&&k.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Clinical Roles Found"}),e.jsx("p",{className:"text-gray-600",children:u?"No roles match your search criteria.":"Get started by creating your first clinical role."})]})]})]}),e.jsx(A,{open:V,onOpenChange:y,children:e.jsxs(M,{className:"max-w-2xl",children:[e.jsx(U,{children:e.jsx(W,{children:"Edit Clinical Role"})}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Role Name"}),e.jsx(n,{value:a.name,onChange:s=>t({...a,name:s.target.value}),placeholder:"e.g., clinical_research_coordinator",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Display Name"}),e.jsx(n,{value:a.display_name,onChange:s=>t({...a,display_name:s.target.value}),placeholder:"e.g., Clinical Research Coordinator",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx(n,{value:a.description,onChange:s=>t({...a,description:s.target.value}),placeholder:"Role description..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Hierarchy Level (1-10)"}),e.jsx(n,{type:"number",min:"1",max:"10",value:a.hierarchy_level,onChange:s=>t({...a,hierarchy_level:parseInt(s.target.value)})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx(d,{type:"submit",disabled:w.isPending,children:w.isPending?"Updating...":"Update Role"})]})]})]})})]})};export{De as default};
//# sourceMappingURL=ClinicalRoles-CdJj-Je3.js.map
