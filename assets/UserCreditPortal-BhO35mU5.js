import{j as e,bo as M,al as B,bn as O,ak as K,Z as I,F as H,b5 as Y,au as V,D as U,co as A,cb as W,C as X,aR as Z,aW as q,aV as z}from"./ui-C7wuVsKo.js";import{r as c}from"./vendor-DG599jyl.js";import{C as i,a as l,b as u,c as p}from"./card-aEf8HYk2.js";import{B as $}from"./button-DAfv1lEn.js";import{B as k}from"./badge-DTmq5TA0.js";import{T as G,a as J,b as T,c as F}from"./tabs-B365V6_b.js";import{d as N,t as L}from"./index-CUjvNcD6.js";import{C as Q}from"./CreditBalance-EXXXcXdO.js";import{P as ee}from"./PurchaseCreditsModal-CjhuoYUk.js";import{R as D,C as se,X as ae,Y as te,T as R,P as re,a as ie,b as le}from"./PieChart-Crjokm1Y.js";import{L as ce,a as ne}from"./LineChart-CSP7nNEg.js";import{u as de}from"./router-BavLd_S0.js";import"./query-BI4h7QWD.js";import"./dialog-D2hWIkvB.js";import"./react-stripe.esm-DpsyRb7I.js";import"./index-BET1hbAS.js";const E=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8"],oe=({days:g=30})=>{const[d,o]=c.useState(null),[y,x]=c.useState(!0),[m,b]=c.useState(g);c.useEffect(()=>{v()},[m]);const v=async()=>{try{x(!0);const a=await N.get(`/api/credits/usage/analytics?days=${m}`);o(a.data.data)}catch(a){console.error("Error fetching usage analytics:",a),L.error("Failed to load usage analytics")}finally{x(!1)}},w=a=>{switch(a){case"vapi_call":return e.jsx(V,{className:"h-4 w-4"});case"message":return e.jsx(Y,{className:"h-4 w-4"});case"file_upload":return e.jsx(H,{className:"h-4 w-4"});case"workflow_execution":return e.jsx(I,{className:"h-4 w-4"});default:return e.jsx(B,{className:"h-4 w-4"})}},h=a=>a.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ");if(y)return e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[...Array(4)].map((a,r)=>e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})})},r))})});if(!d)return e.jsx(i,{children:e.jsx(l,{className:"p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No usage data available"})})});const{summary:t,dailyTransactions:C,operationSummary:j,peakHours:P}=d,_=C.reduce((a,r)=>{const s=r.date,n=a.find(S=>S.date===s);return n?n[r.type]=(n[r.type]||0)+parseFloat(r.total_amount):a.push({date:s,[r.type]:parseFloat(r.total_amount)}),a},[]),f=j.map(a=>({name:h(a.operation_type),credits:parseFloat(a.total_credits),operations:parseInt(a.operation_count)}));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Usage Analytics"}),e.jsx("div",{className:"flex space-x-2",children:[7,30,90].map(a=>e.jsxs($,{variant:m===a?"default":"outline",size:"sm",onClick:()=>b(a),children:[a," days"]},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Credits Used"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:parseFloat((t==null?void 0:t.total_credits_consumed)||0).toLocaleString()})]}),e.jsx(M,{className:"h-8 w-8 text-red-600"})]})})}),e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Operations"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:parseInt((t==null?void 0:t.total_operations)||0).toLocaleString()})]}),e.jsx(B,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Credits/Operation"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:parseFloat((t==null?void 0:t.avg_credits_per_operation)||0).toFixed(2)})]}),e.jsx(O,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[(t==null?void 0:t.total_operations)>0?(t.successful_operations/t.total_operations*100).toFixed(1):0,"%"]})]}),e.jsxs(k,{variant:"default",className:"bg-green-100 text-green-800",children:[(t==null?void 0:t.successful_operations)||0,"/",(t==null?void 0:t.total_operations)||0]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsx(u,{children:e.jsxs(p,{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-5 w-5"}),e.jsx("span",{children:"Daily Credit Usage"})]})}),e.jsx(l,{children:e.jsx(D,{width:"100%",height:300,children:e.jsxs(ce,{data:_,children:[e.jsx(se,{strokeDasharray:"3 3"}),e.jsx(ae,{dataKey:"date"}),e.jsx(te,{}),e.jsx(R,{}),e.jsx(ne,{type:"monotone",dataKey:"usage",stroke:"#8884d8",strokeWidth:2})]})})})]}),e.jsxs(i,{children:[e.jsx(u,{children:e.jsx(p,{children:"Usage by Operation Type"})}),e.jsx(l,{children:e.jsx(D,{width:"100%",height:300,children:e.jsxs(re,{children:[e.jsx(ie,{data:f,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:r})=>`${a} ${(r*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"credits",children:f.map((a,r)=>e.jsx(le,{fill:E[r%E.length]},`cell-${r}`))}),e.jsx(R,{})]})})})]})]}),e.jsxs(i,{children:[e.jsx(u,{children:e.jsx(p,{children:"Operation Details"})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:j.map((a,r)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[w(a.operation_type),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:h(a.operation_type)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[parseInt(a.operation_count).toLocaleString()," operations"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium text-red-600",children:[parseFloat(a.total_credits).toLocaleString()," credits"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Avg: ",parseFloat(a.avg_credits_per_operation).toFixed(2)," per operation"]})]})]},r))})})]})]})},Te=()=>{var r;de();const[g,d]=c.useState(!1),[o,y]=c.useState(null),[x,m]=c.useState([]),[b,v]=c.useState([]),[w,h]=c.useState(!0),[t,C]=c.useState(0),j=async()=>{try{h(!0);const[s,n,S]=await Promise.all([N.get("/api/credits/balance"),N.get("/api/credits/transactions?limit=10"),N.get("/api/credits/packages")]);y(s.data.data),m(n.data.data.transactions||[]),v(S.data.data||[])}catch(s){console.error("Error fetching credit data:",s),L.error("Failed to load credit information")}finally{h(!1)}};c.useEffect(()=>{j();const s=()=>{j()};return window.addEventListener("creditBalanceUpdate",s),()=>{window.removeEventListener("creditBalanceUpdate",s)}},[t]);const P=s=>{L.success("ðŸŽ‰ Purchase successful! Credits added to your account."),C(n=>n+1),d(!1),window.dispatchEvent(new CustomEvent("creditBalanceUpdate"))},_=s=>{switch(s){case"purchase":return e.jsx(U,{className:"h-4 w-4 text-green-500"});case"usage":return e.jsx(I,{className:"h-4 w-4 text-blue-500"});case"refund":return e.jsx(z,{className:"h-4 w-4 text-purple-500"});case"adjustment":return e.jsx(q,{className:"h-4 w-4 text-orange-500"});default:return e.jsx(Z,{className:"h-4 w-4 text-gray-500"})}},f=s=>{switch(s){case"purchase":return"text-green-600 bg-green-50 border-green-200";case"usage":return"text-blue-600 bg-blue-50 border-blue-200";case"refund":return"text-purple-600 bg-purple-50 border-purple-200";case"adjustment":return"text-orange-600 bg-orange-50 border-orange-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},a=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return w?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Credit Portal"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your credits and track usage"})]}),e.jsxs($,{onClick:()=>window.location.href="/purchase-credits",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Buy Credits"]})]}),e.jsx(i,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Current Balance"}),e.jsx(Q,{variant:"full"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Total Used"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:((r=o==null?void 0:o.total_credits_used)==null?void 0:r.toLocaleString())||"0"})]})]})})}),e.jsxs(G,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(J,{className:"grid w-full grid-cols-3",children:[e.jsxs(T,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Overview"]}),e.jsxs(T,{value:"transactions",className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Transactions"]}),e.jsxs(T,{value:"packages",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Packages"]})]}),e.jsx(F,{value:"overview",className:"space-y-6",children:e.jsx(oe,{},t)}),e.jsx(F,{value:"transactions",className:"space-y-6",children:e.jsxs(i,{children:[e.jsx(u,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Recent Transactions"]})}),e.jsx(l,{children:x.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(X,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No transactions yet"}),e.jsx("p",{className:"text-sm",children:"Your credit transactions will appear here"})]}):e.jsx("div",{className:"space-y-3",children:x.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[_(s.transaction_type),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.description||`${s.transaction_type} transaction`}),e.jsx("div",{className:"text-sm text-gray-500",children:a(s.created_at)})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs(k,{variant:"outline",className:f(s.transaction_type),children:[s.transaction_type==="usage"?"-":"+",Math.abs(s.credit_amount).toLocaleString()," credits"]})})]},s.id))})})]})}),e.jsx(F,{value:"packages",className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(s=>e.jsxs(i,{className:"relative hover:shadow-lg transition-shadow",children:[(s.bonus_credits||0)>0&&e.jsxs("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:["+",s.bonus_credits," Bonus"]}),e.jsxs(u,{children:[e.jsx(p,{className:"text-lg",children:s.name}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:["$",s.price_dollars||(s.price_cents/100).toFixed(2)]})]}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Base Credits:"}),e.jsx("span",{className:"font-medium",children:(s.credits_amount||0).toLocaleString()})]}),(s.bonus_credits||0)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bonus Credits:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["+",(s.bonus_credits||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-3",children:[e.jsx("span",{className:"font-semibold",children:"Total Credits:"}),e.jsx("span",{className:"font-bold text-blue-600",children:(s.total_credits||0).toLocaleString()})]}),e.jsxs("div",{className:"text-sm text-gray-500 text-center",children:["$",((s.price_dollars||s.price_cents/100)/(s.total_credits||1)).toFixed(4)," per credit"]})]})})]},s.id||s.package_id))})})]}),g&&e.jsx(ee,{isOpen:g,onClose:()=>d(!1),onSuccess:P})]})};export{Te as default};
//# sourceMappingURL=UserCreditPortal-BhO35mU5.js.map
