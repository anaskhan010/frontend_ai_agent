import{j as e,ar as Oe,aT as Ue,aV as Na,aW as Zt,ao as ka,cq as Dt,a7 as Aa,b5 as Sa,av as Ca,bp as Fa,cr as Xe,k as Ea,b as Je,l as Gt,N as Ps,D as ns,ad as Ia,T as $t,K as La,J as Ta,am as Pa,al as Oa,y as Wt,O as Ua}from"./ui-BZ34e_bG.js";import{r as l,b as Os}from"./vendor-DG599jyl.js";import{c as ea}from"./router-BavLd_S0.js";import{P as Ra}from"./Page-RlnDfmDi.js";import{B as W}from"./button-Cm3qqFtR.js";import{I as $}from"./input-DmGou_SQ.js";import{B as is}from"./badge-CiNZHaLO.js";import{T as Da,a as Ga,b as Mt,c as _e,d as Wa,e as Be}from"./table-C6M1Val8.js";import{D as sa,a as ta,b as aa,e as ls}from"./dropdown-menu-DvTkgNmQ.js";import{D as oa,b as ra,c as na,d as la,e as Ma,f as _a}from"./dialog-Dr0dXxlM.js";import{d as z,t as h,e as _t,u as Ba}from"./index-DWPNxztX.js";import{S as we,a as ve,b as He,c as je,d as te}from"./select-DZgTcSvR.js";import{L as q}from"./label-C6Ng9AKs.js";import{u as Qa}from"./usePermissions-Bihy-2qQ.js";import{c as Bt,d as Qt,f as Ht,S as Xt}from"./sheet-Di2b-amD.js";import{d as Ha,c as Xa}from"./contactService-ALigg3kZ.js";import{g as Ya}from"./phoneNumberService-DUWl0Q64.js";import{f as Va}from"./agentService-DYqi_QtR.js";import{a as za}from"./workflowService-2QJ9g4RH.js";import{R as Ja,a as Yt}from"./radio-group-BjZKjN5g.js";import{T as Ka}from"./textarea-CkpLCUXs.js";import{C as Es,b as Is,c as Ls,d as Vt,a as Ts}from"./card-BYrCuzD5.js";import"./scroll-area-sAMvAiol.js";import"./index-3J7IwK8P.js";import"./index-DwBQLlhe.js";import"./query-BwaCLewj.js";import"./index-HDeFwIcs.js";async function qa(){var o,i,d;const s=await z.get("/api/auth/facebook/oauth-url");if((o=s.data)!=null&&o.success&&((i=s.data.data)!=null&&i.authUrl))return s.data.data.authUrl;throw new Error(((d=s.data)==null?void 0:d.message)||"Failed to start Facebook OAuth")}async function Za(s,o){var i,d;try{const v=await z.post("/api/auth/facebook/connect",{code:s,state:o});if(v.data.success)return h.success("Facebook account connected successfully!"),v.data.data;throw new Error(v.data.message||"Failed to connect Facebook account")}catch(v){console.error("Error connecting Facebook account:",v);const m=((d=(i=v.response)==null?void 0:i.data)==null?void 0:d.message)||"Failed to connect Facebook account";throw h.error(m),v}}async function ca(s){var o,i;try{let d,v=3e4;if(typeof s=="string"?d=s:typeof s=="number"&&(v=s),d){console.log("ðŸ” Checking webhook-specific connection for:",d);const m=localStorage.getItem(`facebook_connected_${d}`)==="true",R=localStorage.getItem(`facebook_user_${d}`);if(console.log("ðŸ” localStorage check:",{isConnected:m,hasUserStr:!!R}),m&&R)try{const O=JSON.parse(R);return console.log("âœ… Found Facebook connection in localStorage"),{isConnected:!0,facebookUser:O,connectedAt:new Date().toISOString()}}catch(O){console.log("âŒ Invalid localStorage data:",O)}const r=sessionStorage.getItem("temp_facebook_connected")==="true",S=sessionStorage.getItem("temp_facebook_user");if(console.log("ðŸ” sessionStorage check:",{tempConnected:r,hasTempUserStr:!!S}),r&&S)try{const O=JSON.parse(S);return console.log("âœ… Found Facebook connection in sessionStorage"),{isConnected:!0,facebookUser:O,connectedAt:new Date().toISOString()}}catch(O){return console.log("âŒ Invalid sessionStorage data:",O),{isConnected:!1}}console.log("ðŸ” Checking backend webhook metadata for Facebook connection...");try{const O=await z.get(`/api/facebook/connection-status/${d}`,{timeout:v});if(O.data.success&&O.data.data.isConnected)return console.log("âœ… Found Facebook connection in backend webhook metadata:",O.data.data),localStorage.setItem(`facebook_connected_${d}`,"true"),O.data.data.facebookUser&&localStorage.setItem(`facebook_user_${d}`,JSON.stringify(O.data.data.facebookUser)),{isConnected:!0,facebookUser:O.data.data.facebookUser,pages:O.data.data.pages||[],selectedPageId:O.data.data.selectedPageId||"",selectedLeadFormId:O.data.data.selectedLeadFormId||"",leadForms:O.data.data.leadForms||[],connectedAt:new Date().toISOString()};console.log("âŒ No Facebook connection found in backend webhook metadata")}catch(O){console.log("âŒ Error checking backend webhook metadata:",O)}return console.log("âŒ No Facebook connection found for webhook"),{isConnected:!1}}return console.log("ðŸ†• No webhookId provided - new webhook flow, returning not connected"),{isConnected:!1}}catch(d){return console.error("Error getting Facebook connection status:",d),d.name==="AbortError"?h.error("Connection status check timed out"):h.error(((i=(o=d.response)==null?void 0:o.data)==null?void 0:i.message)||"Failed to get connection status"),{isConnected:!1}}}async function Qe(){var s,o;try{const i=await z.get("/api/facebook/pages");if(i.data.success)return i.data.data;throw new Error(i.data.message||"Failed to fetch Facebook pages")}catch(i){console.error("Error fetching Facebook pages:",i);const d=((o=(s=i.response)==null?void 0:s.data)==null?void 0:o.message)||"Failed to fetch Facebook pages";throw h.error(d),i}}async function Ke(){try{const s=await z.get("/api/facebook/pages/stored");return s.data.success?s.data.data:[]}catch(s){return console.error("Error fetching stored Facebook pages:",s),[]}}async function cs(s){var o,i;try{const d=await z.get(`/api/facebook/pages/${s}/forms`);if(d.data.success)return d.data.data;throw new Error(d.data.message||"Failed to fetch lead forms")}catch(d){console.error("Error fetching lead forms:",d);const v=((i=(o=d.response)==null?void 0:o.data)==null?void 0:i.message)||"Failed to fetch lead forms";throw h.error(v),d}}async function $a(s){var o,i;try{const d=await z.post("/api/gmail/emails/send",s);if(d.data.success)return h.success("Email sent successfully!"),d.data.data;throw new Error(d.data.message||"Failed to send email")}catch(d){console.error("Error sending Gmail email:",d);const v=((i=(o=d.response)==null?void 0:o.data)==null?void 0:i.message)||"Failed to send email";throw h.error(v),d}}const eo=({isOpen:s,onClose:o,onSuccess:i,userId:d,redirectPath:v})=>{const[m,R]=l.useState("idle"),[r,S]=l.useState(""),O=l.useRef(null),U=async()=>{R("loading"),S("Opening Gmail authentication...");try{const j=await z.get("/api/gmail/auth/url",{params:{redirectPath:"popup"}});if(!j.data.success)throw new Error(j.data.message||"Failed to generate Gmail auth URL");console.log("ðŸ”„ Opening Gmail OAuth in popup window");const p=window.open(j.data.data.authUrl,"gmail-oauth","width=600,height=700,scrollbars=yes,resizable=yes,status=yes,location=yes,toolbar=no,menubar=no");if(!p)throw new Error("Popup blocked. Please allow popups for this site.");const _=setInterval(()=>{p.closed&&(clearInterval(_),m==="loading"&&(R("error"),S("Authentication was cancelled. Please try again.")))},1e3);setTimeout(()=>{p.closed||(p.close(),clearInterval(_),m==="loading"&&(R("error"),S("Authentication timeout. Please try again.")))},3e5)}catch(j){console.error("Gmail OAuth error:",j),R("error"),S(j.message||"Failed to initiate Gmail OAuth")}};l.useEffect(()=>{const j=p=>{p.origin===window.location.origin&&(console.log("ðŸ” Received message from popup:",p.data),p.data.type==="GMAIL_AUTH_SUCCESS"?(console.log("ðŸŽ‰ Received Gmail OAuth success from popup:",p.data),R("success"),S("Gmail connected successfully!"),h.success(`Gmail connected successfully! (${p.data.data.email})`),i(p.data.data),setTimeout(()=>{o()},1500)):p.data.type==="GMAIL_AUTH_ERROR"&&(console.log("âŒ Received Gmail OAuth error from popup:",p.data),R("error"),S(p.data.message||"Failed to connect Gmail"),h.error(p.data.message||"Failed to connect Gmail"),setTimeout(()=>{o()},3e3)))};return window.addEventListener("message",j),()=>{window.removeEventListener("message",j)}},[i,o,m]),l.useEffect(()=>{s&&(R("idle"),S(""))},[s]);const Y=()=>{R("idle"),S(""),O.current&&(O.current.src="about:blank"),o()};return e.jsx(oa,{open:s,onOpenChange:Y,children:e.jsxs(ra,{className:"max-w-2xl max-h-[80vh]",children:[e.jsxs(na,{children:[e.jsxs(la,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5 text-blue-600"}),"Connect Gmail Account"]}),e.jsx(Ma,{children:"Connect your Gmail account to enable email automation in your workflows"})]}),e.jsxs("div",{className:"space-y-4",children:[m==="idle"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"p-6 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx(Oe,{className:"h-12 w-12 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Gmail Integration"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"By connecting your Gmail account, you'll be able to:"}),e.jsxs("ul",{className:"text-sm text-gray-600 text-left space-y-1 mb-4",children:[e.jsx("li",{children:"â€¢ Read and send emails automatically"}),e.jsx("li",{children:"â€¢ Create email-based workflow triggers"}),e.jsx("li",{children:"â€¢ Access Gmail data in your automations"})]})]}),e.jsxs(W,{onClick:U,className:"w-full h-12 bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Connect With Gmail"]}),e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["Please authenticate your Gmail account to allow access to AI CRUITMENT.",e.jsx("a",{href:"#",className:"text-blue-600 underline ml-1",children:"View privacy policy"})]})]}),m==="loading"&&e.jsx("div",{className:"text-center space-y-6 py-8",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Oe,{className:"h-10 w-10 text-blue-600"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(Ue,{className:"h-3 w-3 text-white animate-spin"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Redirecting to Gmail"}),e.jsx("p",{className:"text-sm text-gray-600 max-w-md",children:r})]}),e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200 max-w-md",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})})}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Secure Authentication"}),e.jsx("p",{children:"You will be redirected to Gmail's secure authentication page. After completing authentication, you'll be returned to your workflow."})]})]})})]})}),m==="success"&&e.jsx("div",{className:"text-center space-y-4",children:e.jsxs("div",{className:"p-6 bg-green-50 rounded-lg border border-green-200",children:[e.jsx(Na,{className:"h-12 w-12 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-green-900 mb-2",children:"Successfully Connected!"}),e.jsx("p",{className:"text-sm text-green-700",children:"Your Gmail account has been connected successfully. You can now use Gmail in your workflows."})]})}),m==="error"&&e.jsx("div",{className:"text-center space-y-4",children:e.jsxs("div",{className:"p-6 bg-red-50 rounded-lg border border-red-200",children:[e.jsx(Zt,{className:"h-12 w-12 text-red-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Connection Failed"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:r}),e.jsx(W,{onClick:U,variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-50",children:"Try Again"})]})})]})]})})},so=({initialConfig:s,onSave:o,onCancel:i})=>{const[d,v]=l.useState((s==null?void 0:s.name)||""),[m,R]=l.useState((s==null?void 0:s.phoneNumberId)||""),[r,S]=l.useState(s==null?void 0:s.assistantId),[O,U]=l.useState(s==null?void 0:s.workflowId),[Y,j]=l.useState(!!(s!=null&&s.autoLaunch)),[p,_]=l.useState([]),[ae,J]=l.useState([]),[A,H]=l.useState([]),[de,K]=l.useState(!1);l.useEffect(()=>{let M=!0;return(async()=>{try{K(!0);const[V,x,y]=await Promise.all([Ya(void 0,""),Va(""),za(void 0,"",void 0)]);if(!M)return;const G=Array.isArray(V==null?void 0:V.data)?V.data:Array.isArray(V)?V:[];_((G||[]).map(w=>({id:w.id||w._id||w.phoneNumberId||"",number:w.number||w.phoneNumber||"",friendlyName:w.friendlyName})));const c=Array.isArray(x==null?void 0:x.data)?x.data:Array.isArray(x)?x:[];J((c||[]).map(w=>({id:w.id||w.assistant_id||"",name:w.name||"Unnamed Assistant"})));const N=Array.isArray(y==null?void 0:y.data)?y.data:Array.isArray(y)?y:[];H((N||[]).map(w=>({id:w.id||w.workflow_id||"",name:w.name||"Untitled Workflow"})))}catch(V){console.error("Failed to load campaign deps:",V),h.error("Failed to load campaign dependencies")}finally{M&&K(!1)}})(),()=>{M=!1}},[]);const Q=async()=>{if(console.log("ðŸ”§ Campaign handleSave called"),!d.trim()){h.error("Campaign name is required");return}if(!m){h.error("Please select a phone number");return}const M={name:d.trim(),phoneNumberId:m,assistantId:r,workflowId:O,autoLaunch:Y};console.log("ðŸ“‹ Campaign config to save:",M),await o(M),console.log("âœ… Campaign onSave completed")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-4 border-b",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center",children:e.jsx(ka,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Configure Outbound Campaign"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Set up a campaign to run when this webhook triggers."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"Campaign Name"}),e.jsx($,{value:d,onChange:M=>v(M.target.value),placeholder:"e.g. New Leads Outreach",className:"mt-1 h-12"})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"Phone Number"}),e.jsxs(we,{value:m,onValueChange:R,children:[e.jsx(ve,{className:"w-full h-12 mt-1",children:e.jsx(He,{placeholder:de?"Loading...":"Select a phone number"})}),e.jsx(je,{children:p.map(M=>e.jsx(te,{value:M.id,children:M.friendlyName?`${M.friendlyName} (${M.number})`:M.number},M.id))})]})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"Assistant (optional)"}),e.jsxs(we,{value:r||"",onValueChange:M=>S(M||void 0),children:[e.jsx(ve,{className:"w-full h-12 mt-1",children:e.jsx(He,{placeholder:de?"Loading...":"Select an assistant"})}),e.jsx(je,{children:ae.map(M=>e.jsx(te,{value:M.id,children:M.name},M.id))})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("input",{id:"autoLaunch",type:"checkbox",className:"h-4 w-4",checked:Y,onChange:M=>j(M.target.checked)}),e.jsx(q,{htmlFor:"autoLaunch",className:"text-sm text-gray-700",children:"Auto-launch campaign when triggered"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx(W,{variant:"outline",onClick:i,className:"flex-1 h-12 border border-gray-300 rounded-lg",children:"Cancel"}),e.jsx(W,{onClick:Q,className:"flex-1 h-12 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",disabled:de,children:de?e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"h-4 w-4 animate-spin mr-2"}),"Saving..."]}):"Save"})]})]})},Rs=s=>typeof s=="number"&&!isNaN(s),qe=s=>typeof s=="string",ia=s=>typeof s=="function",to=s=>l.isValidElement(s)||qe(s)||ia(s)||Rs(s);function ao(s,o,i){i===void 0&&(i=300);const{scrollHeight:d,style:v}=s;requestAnimationFrame(()=>{v.minHeight="initial",v.height=d+"px",v.transition=`all ${i}ms`,requestAnimationFrame(()=>{v.height="0",v.padding="0",v.margin="0",setTimeout(o,i)})})}function ms(s){let{enter:o,exit:i,appendPosition:d=!1,collapse:v=!0,collapseDuration:m=300}=s;return function(R){let{children:r,position:S,preventExitTransition:O,done:U,nodeRef:Y,isIn:j,playToast:p}=R;const _=d?`${o}--${S}`:o,ae=d?`${i}--${S}`:i,J=l.useRef(0);return l.useLayoutEffect(()=>{const A=Y.current,H=_.split(" "),de=K=>{K.target===Y.current&&(p(),A.removeEventListener("animationend",de),A.removeEventListener("animationcancel",de),J.current===0&&K.type!=="animationcancel"&&A.classList.remove(...H))};A.classList.add(...H),A.addEventListener("animationend",de),A.addEventListener("animationcancel",de)},[]),l.useEffect(()=>{const A=Y.current,H=()=>{A.removeEventListener("animationend",H),v?ao(A,U,m):U()};j||(O?H():(J.current=1,A.className+=` ${ae}`,A.addEventListener("animationend",H)))},[j]),Os.createElement(Os.Fragment,null,r)}}const Ne=new Map;let Us=[];const zt=new Set,da=()=>Ne.size>0;function oo(s,o){var i;if(o)return!((i=Ne.get(o))==null||!i.isToastActive(s));let d=!1;return Ne.forEach(v=>{v.isToastActive(s)&&(d=!0)}),d}function ro(s,o){to(s)&&(da()||Us.push({content:s,options:o}),Ne.forEach(i=>{i.buildToast(s,o)}))}function Jt(s,o){Ne.forEach(i=>{o!=null&&o!=null&&o.containerId?(o==null?void 0:o.containerId)===i.id&&i.toggle(s,o==null?void 0:o.id):i.toggle(s,o==null?void 0:o.id)})}let no=1;const ma=()=>""+no++;function lo(s){return s&&(qe(s.toastId)||Rs(s.toastId))?s.toastId:ma()}function Ze(s,o){return ro(s,o),o.toastId}function ds(s,o){return{...o,type:o&&o.type||s,toastId:lo(o)}}function rs(s){return(o,i)=>Ze(o,ds(s,i))}function E(s,o){return Ze(s,ds("default",o))}E.loading=(s,o)=>Ze(s,ds("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...o})),E.promise=function(s,o,i){let d,{pending:v,error:m,success:R}=o;v&&(d=qe(v)?E.loading(v,i):E.loading(v.render,{...i,...v}));const r={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},S=(U,Y,j)=>{if(Y==null)return void E.dismiss(d);const p={type:U,...r,...i,data:j},_=qe(Y)?{render:Y}:Y;return d?E.update(d,{...p,..._}):E(_.render,{...p,..._}),j},O=ia(s)?s():s;return O.then(U=>S("success",R,U)).catch(U=>S("error",m,U)),O},E.success=rs("success"),E.info=rs("info"),E.error=rs("error"),E.warning=rs("warning"),E.warn=E.warning,E.dark=(s,o)=>Ze(s,ds("default",{theme:"dark",...o})),E.dismiss=function(s){(function(o){var i;if(da()){if(o==null||qe(i=o)||Rs(i))Ne.forEach(d=>{d.removeToast(o)});else if(o&&("containerId"in o||"id"in o)){const d=Ne.get(o.containerId);d?d.removeToast(o.id):Ne.forEach(v=>{v.removeToast(o.id)})}}else Us=Us.filter(d=>o!=null&&d.options.toastId!==o)})(s)},E.clearWaitingQueue=function(s){s===void 0&&(s={}),Ne.forEach(o=>{!o.props.limit||s.containerId&&o.id!==s.containerId||o.clearQueue()})},E.isActive=oo,E.update=function(s,o){o===void 0&&(o={});const i=((d,v)=>{var m;let{containerId:R}=v;return(m=Ne.get(R||1))==null?void 0:m.toasts.get(d)})(s,o);if(i){const{props:d,content:v}=i,m={delay:100,...d,...o,toastId:o.toastId||s,updateId:ma()};m.toastId!==s&&(m.staleId=s);const R=m.render||v;delete m.render,Ze(R,m)}},E.done=s=>{E.update(s,{progress:1})},E.onChange=function(s){return zt.add(s),()=>{zt.delete(s)}},E.play=s=>Jt(!0,s),E.pause=s=>Jt(!1,s);const gs=function(s,o){return o===void 0&&(o=!1),{enter:`Toastify--animate Toastify__${s}-enter`,exit:`Toastify--animate Toastify__${s}-exit`,appendPosition:o}};ms(gs("bounce",!0));ms(gs("slide",!0));ms(gs("zoom"));ms(gs("flip"));const co=({webhookId:s,workflowEnabled:o,onConnectionChange:i})=>{const[d,v]=l.useState("new"),[m,R]=l.useState("Facebook Lead Ads #1"),[r,S]=l.useState({isConnected:!1}),[O,U]=l.useState([]),[Y,j]=l.useState([]),[p,_]=l.useState(""),[ae,J]=l.useState(""),[A,H]=l.useState(!1),[de,K]=l.useState(!1);console.log("ðŸ”„ [FacebookLeadAdsTrigger] Component render:",{webhookId:s,isConnected:r.isConnected,pagesCount:O.length,formsCount:Y.length,selectedPageId:p,selectedFormId:ae}),l.useEffect(()=>{console.log("ðŸ”„ Component mounted/webhookId changed, loading status...",{webhookId:s}),s!=null?setTimeout(()=>{Q()},100):console.log("âš ï¸ webhookId is undefined/null, skipping loadStatus")},[s]),l.useEffect(()=>{if(!s)return;const y=setInterval(async()=>{const G=sessionStorage.getItem("temp_facebook_connected")==="true",c=localStorage.getItem(`facebook_connected_${s}`)==="true";if((G||c)&&!r.isConnected){console.log("ðŸ”„ Detected Facebook connection in storage, reloading status"),Q();return}if(!r.isConnected&&s)try{const N=await ca(s);if(N.isConnected&&!r.isConnected){console.log("ðŸ”„ Detected Facebook connection via backend API, updating status"),S(N),i==null||i(!0);try{const w=await Qe();U(w)}catch(w){console.log("Failed to load pages:",w)}}}catch{}},3e3);return()=>clearInterval(y)},[s,r.isConnected]),l.useEffect(()=>{const x=()=>{s&&!r.isConnected&&(console.log("ðŸ”„ Window focused, checking for Facebook connection"),setTimeout(()=>{Q()},1e3))};return window.addEventListener("focus",x),()=>window.removeEventListener("focus",x)},[s,r.isConnected]),l.useEffect(()=>{console.log("ðŸ”„ [FacebookLeadAdsTrigger] Status changed:",r)},[r]),l.useEffect(()=>{const x=y=>{var G;(y.key==="temp_facebook_connected"||(G=y.key)!=null&&G.startsWith("facebook_connected_"))&&(console.log("ðŸ”„ Storage change detected, refreshing status...",y.key,y.newValue),setTimeout(()=>Q(),100))};return window.addEventListener("storage",x),()=>window.removeEventListener("storage",x)},[]),l.useEffect(()=>{console.log("ðŸ”§ [FacebookLeadAdsTrigger] Setting up global message listener for webhookId:",s);const x=y=>{var w,P;console.log("ðŸ”” [FacebookLeadAdsTrigger] Message received from origin:",y.origin,"data:",y.data),console.log("ðŸ”” [FacebookLeadAdsTrigger] Current webhookId:",s);const G=[window.location.origin,"https://ai.research-hero.com","http://localhost:5173","http://localhost:5174","https://ai.research-hero.com"],c=y.origin.includes("localhost")||y.origin==="null";if(!(G.includes(y.origin)||c)){console.warn("ðŸš« [FacebookLeadAdsTrigger] Ignoring message from unauthorized origin:",y.origin);return}if(console.log("ðŸ“¨ [FacebookLeadAdsTrigger] Received popup message:",y.data),console.log("ðŸ“¨ [FacebookLeadAdsTrigger] Message type:",(w=y.data)==null?void 0:w.type),y.data.type==="facebook_oauth_success"){console.log("ðŸŽ‰ [FacebookLeadAdsTrigger] Facebook OAuth success received from popup");const I=(P=y.data.data)==null?void 0:P.facebookUser;console.log("ðŸ‘¤ [FacebookLeadAdsTrigger] Facebook user data:",I),I?(console.log("ðŸ’¾ [FacebookLeadAdsTrigger] Storing connection data..."),console.log("ðŸ“ [FacebookLeadAdsTrigger] Storing in session storage for immediate use"),sessionStorage.setItem("temp_facebook_user",JSON.stringify(I)),sessionStorage.setItem("temp_facebook_connected","true"),console.log("âœ… [FacebookLeadAdsTrigger] Session storage updated:",{temp_facebook_connected:sessionStorage.getItem("temp_facebook_connected"),temp_facebook_user:!!sessionStorage.getItem("temp_facebook_user")}),s&&(console.log("ðŸ“ [FacebookLeadAdsTrigger] Also storing for webhook:",s),localStorage.setItem(`facebook_connected_${s}`,"true"),localStorage.setItem(`facebook_user_${s}`,JSON.stringify(I))),console.log("ðŸ”„ [FacebookLeadAdsTrigger] Setting status to connected with user:",I),S({isConnected:!0,facebookUser:I}),console.log("ðŸ”„ [FacebookLeadAdsTrigger] Status set, calling onConnectionChange"),i==null||i(!0),console.log("ðŸ”„ [FacebookLeadAdsTrigger] Loading pages after OAuth success"),setTimeout(async()=>{try{const D=await Qe();console.log("âœ… Pages loaded immediately after OAuth:",D.length),U(D)}catch(D){console.log("âŒ Failed to load pages immediately:",D)}},500),console.log("ðŸ”„ [FacebookLeadAdsTrigger] Loading Facebook pages after OAuth success..."),Qe().then(D=>{if(console.log("âœ… [FacebookLeadAdsTrigger] Facebook connected and pages loaded:",D.length,"pages"),U(D),D.length>0){const me=D[0].id;_(me),console.log("ðŸ”„ [FacebookLeadAdsTrigger] Auto-selecting first page and loading forms..."),cs(me).then(L=>{console.log("âœ… [FacebookLeadAdsTrigger] Forms loaded for first page:",L.length,"forms"),j(L),E.success(`âœ… Facebook Lead Ads connected! Found ${D.length} pages and ${L.length} forms.`)}).catch(L=>{console.log("âŒ [FacebookLeadAdsTrigger] Failed to load forms for first page:",L),E.success(`âœ… Facebook Lead Ads connected! Found ${D.length} pages.`)})}else E.success("âœ… Facebook Lead Ads connected successfully!")}).catch(D=>{console.error("Post-OAuth pages loading failed",D),E.success("âœ… Facebook Lead Ads connected successfully!")})):Q().then(()=>{E.success("Facebook Lead Ads connected successfully!")}).catch(D=>{console.error("Post-OAuth refresh failed",D),E.error("Failed to refresh Facebook connection status")})}else y.data.type==="facebook_oauth_error"&&(console.error("âŒ [FacebookLeadAdsTrigger] Facebook OAuth error received from popup:",y.data.message),E.error(`Facebook connection failed: ${y.data.message||"Unknown error"}`))};return window.addEventListener("message",x),()=>window.removeEventListener("message",x)},[s]),l.useEffect(()=>()=>{s||sessionStorage.getItem("temp_facebook_connected")&&(console.log("Clearing temporary Facebook connection on unmount"),sessionStorage.removeItem("temp_facebook_connected"),sessionStorage.removeItem("temp_facebook_user"))},[s]);const Q=async()=>{try{if(console.log("ðŸ” loadStatus called with webhookId:",s),!s){console.log("ðŸ†• New webhook flow - starting disconnected"),sessionStorage.removeItem("temp_facebook_connected"),sessionStorage.removeItem("temp_facebook_user"),S({isConnected:!1}),U([]),j([]),i==null||i(!1);return}console.log("ðŸ” Existing webhook - checking webhook-specific connection for:",s);const x=localStorage.getItem(`facebook_connected_${s}`)==="true",y=localStorage.getItem(`facebook_user_${s}`);if(console.log("ðŸ” localStorage check:",{isConnected:x,hasUserStr:!!y}),x&&y)try{const N=JSON.parse(y);console.log("âœ… Found webhook-specific Facebook connection in localStorage"),S({isConnected:!0,facebookUser:N});try{const w=await Ke();console.log("ðŸ“¦ Stored pages loaded:",w.length,"pages"),U(w)}catch(w){console.log("âŒ Failed to load pages:",w),U([])}i==null||i(!0);return}catch(N){console.error("âŒ Invalid webhook-specific data, clearing:",N),localStorage.removeItem(`facebook_connected_${s}`),localStorage.removeItem(`facebook_user_${s}`)}const G=sessionStorage.getItem("temp_facebook_connected")==="true",c=sessionStorage.getItem("temp_facebook_user");if(console.log("ðŸ” sessionStorage fallback check:",{tempConnected:G,hasTempUserStr:!!c}),G&&c)try{const N=JSON.parse(c);console.log("âœ… Found Facebook connection in sessionStorage, using as fallback"),S({isConnected:!0,facebookUser:N});try{const w=await Ke();console.log("ðŸ“¦ Stored pages loaded from sessionStorage fallback:",w.length,"pages"),U(w)}catch(w){console.log("âŒ Failed to load pages from sessionStorage fallback:",w),U([])}i==null||i(!0);return}catch(N){console.error("âŒ Invalid sessionStorage data:",N)}console.log("âŒ No Facebook connection found in localStorage or sessionStorage"),S({isConnected:!1}),U([]),j([]),i==null||i(!1)}catch(x){console.error("âŒ Error in loadStatus:",x),S({isConnected:!1}),U([]),j([]),i==null||i(!1)}},M=async()=>{try{console.log("ðŸ” Performing demo login...");const x=await fetch("https://ai.research-hero.com/api/auth/demo-login",{method:"POST",headers:{"Content-Type":"application/json"}});if(x.ok){const y=await x.json();if(y.success&&y.data.token)return _t.setItem("token",y.data.token),localStorage.setItem("token",y.data.token),console.log("âœ… Demo login successful"),y.data.token}throw new Error("Demo login failed")}catch(x){throw console.error("âŒ Demo login error:",x),x}},V=async()=>{if(console.log("ðŸš€ handleConnect called"),console.log("ðŸ” Webhook toggle check:",{workflowEnabled:o}),!o){E.error("First ON the Toggle");return}H(!0);try{if(console.log("ðŸ” Current status:",r),r.isConnected){console.log("âœ… Already connected, loading pages...");const L=await Qe();U(L);return}console.log("ðŸ”§ Debug Info:",{baseUrl:"https://ai.research-hero.com",currentOrigin:window.location.origin,webhookId:s}),console.log("ðŸ” Checking backend availability...");let x=!0,y=!1;try{const L=_t.getItem("token")||localStorage.getItem("token");console.log("ðŸ”‘ Using token:",!!L);const F=await fetch("https://ai.research-hero.com/api/auth/facebook/status",{method:"GET",headers:{Authorization:`Bearer ${L}`,"Content-Type":"application/json"}});console.log("ðŸ¥ Health check response:",F.status,F.ok),x=F.ok,F.status===401&&(console.log("ðŸ” Authentication required"),y=!0,x=!0)}catch(L){console.error("âŒ Backend check failed:",L),x=!1}if(!x)throw new Error(`âŒ Backend server is not running!

Please start the backend server:
1. Open terminal in backend folder
2. Run: npm start
3. Wait for "Server is running on port 5001"
4. Try connecting again`);y&&(console.log("ðŸ” Authentication required, performing demo login..."),await M(),E.success("âœ… Authenticated successfully")),console.log("ðŸ”„ Generating Facebook OAuth URL...");let G;try{if(G=await qa(),console.log("âœ… Facebook OAuth URL generated:",G),!G||typeof G!="string")throw new Error("Invalid OAuth URL received: "+G);G.startsWith("https://www.facebook.com/")||console.log("âš ï¸ Unexpected OAuth URL format:",G)}catch(L){throw console.error("âŒ Error generating OAuth URL:",L),new Error("Failed to generate Facebook OAuth URL: "+((L==null?void 0:L.message)||L))}const c=600,N=700,w=window.screenX+(window.outerWidth-c)/2,P=window.screenY+(window.outerHeight-N)/2;console.log("ðŸ”„ Opening Facebook OAuth popup..."),console.log("ðŸ”— OAuth URL:",G);const I=window.open(G,"fb_oauth",`width=${c},height=${N},left=${w},top=${P},toolbar=0,location=0,status=0,menubar=0`);if(console.log("ðŸ“± Popup opened:",!!I),I){const L=setInterval(()=>{I.closed&&(console.log("ðŸ”’ Popup was closed - checking if OAuth completed"),clearInterval(L),setTimeout(async()=>{console.log("ðŸ”„ Popup closed, attempting auto force connect...");try{const F=await Qe();console.log("âœ… OAuth successful! Pages found:",F.length);const B={id:"4098579607137444",name:"Facebook User",email:""};if(console.log("ðŸš€ Auto applying force connect..."),S({isConnected:!0,facebookUser:B}),i==null||i(!0),U(F),E.success(`âœ… Facebook Lead Ads connected! Found ${F.length} pages.`),F.length>0){const ee=F[0].id;_(ee);try{const ue=await cs(ee);j(ue),console.log("âœ… Auto-loaded forms for first page:",ue.length)}catch(ue){console.log("âŒ Failed to auto-load forms:",ue)}}}catch(F){console.log("âŒ OAuth may have failed or been cancelled:",F),E.info("Facebook connection was cancelled or failed")}},2e3))},1e3);setTimeout(()=>{I.closed&&console.log("âš ï¸ Popup was closed immediately - might be blocked")},100)}if(!I){console.error("âŒ Popup was blocked by browser");const L=new Error("Popup was blocked. Please allow popups for this site and try again.");throw L.isPopupBlocked=!0,L}let D="";const me=setInterval(()=>{try{if(I&&!I.closed){const L=I.location.href;L!==D&&(console.log("ðŸ”„ Popup URL changed:",L),D=L)}else I&&I.closed&&(clearInterval(me),console.log("ðŸ”’ Popup closed, stopping URL monitoring"))}catch{D===""&&(console.log("ðŸŒ Popup navigated to external domain (Facebook)"),D="external")}},500);await new Promise((L,F)=>{let B=!1,ee=!1;const ue=[window.location.origin];try{const C=new URL(G),Re=C.searchParams.get("redirect_uri");if(Re)try{const pe=decodeURIComponent(Re),Ee=new URL(pe).origin;ue.includes(Ee)||ue.push(Ee)}catch{}else{const pe=C.origin;ue.includes(pe)||ue.push(pe)}}catch{}let Ge;setTimeout(()=>{Ge=setInterval(()=>{I&&I.closed&&!B&&!ee&&setTimeout(()=>{if(!B&&!ee){B=!0,clearInterval(Ge),clearInterval(me),window.removeEventListener("message",oe);const C=new Error("Authentication was cancelled by user");C.isUserCancellation=!0,F(C)}},3e3)},1e3)},2e3);const oe=C=>{var pe,Ee,hs,fs,We;if(B){console.log("âš ï¸ [FB OAuth Listener] Message received but already resolved, ignoring");return}if(console.log("ðŸ“¨ [FB OAuth Listener] message received from",C.origin,C.data),console.log("ðŸ” [FB OAuth Listener] allowed origins:",ue),!(ue.includes(C.origin)||C.origin==="null"||C.origin==="*"||C.origin===window.location.origin||C.origin.includes("localhost")||C.origin.includes("ai.research-hero.com"))){console.log("âš ï¸ [FB OAuth Listener] Message from disallowed origin, ignoring:",C.origin),console.log("ðŸ” [FB OAuth Listener] Current window origin:",window.location.origin),console.log("ðŸ” [FB OAuth Listener] Allowed origins:",ue);return}if(console.log("âœ… [FB OAuth Listener] Origin validation passed for:",C.origin),!((pe=C.data)!=null&&pe.type)||!C.data.type.includes("facebook_oauth")){console.log("âš ï¸ [FB OAuth Listener] Not a Facebook OAuth message, ignoring:",(Ee=C.data)==null?void 0:Ee.type);return}console.log("âœ… [FB OAuth] Valid Facebook OAuth message received, processing..."),B=!0,clearInterval(Ge),clearInterval(me),window.removeEventListener("message",oe);try{I&&!I.closed&&(I.close(),console.log("Popup closed by frontend after message"))}catch(Z){console.log("Failed to close popup from frontend:",Z)}if(((hs=C.data)==null?void 0:hs.type)==="facebook_oauth_success"){console.log("ðŸŽ‰ [FB OAuth] Success message received!"),ee=!0;const Z=(fs=C.data.data)==null?void 0:fs.facebookUser;console.log("ðŸ‘¤ [FB OAuth] Facebook user data:",Z),console.log("âœ… [FB OAuth] Authentication completed successfully"),Z?(console.log("ðŸ’¾ [FB OAuth] Storing connection data..."),console.log("ðŸ“ [FB OAuth] Storing in session storage for immediate use"),sessionStorage.setItem("temp_facebook_user",JSON.stringify(Z)),sessionStorage.setItem("temp_facebook_connected","true"),console.log("âœ… [FB OAuth] Session storage updated:",{temp_facebook_connected:sessionStorage.getItem("temp_facebook_connected"),temp_facebook_user:!!sessionStorage.getItem("temp_facebook_user")}),s&&(console.log("ðŸ“ [FB OAuth] Also storing permanently for webhook:",s),localStorage.setItem(`facebook_connected_${s}`,"true"),localStorage.setItem(`facebook_user_${s}`,JSON.stringify(Z))),console.log("ðŸ”„ [FB OAuth] Setting status to connected..."),S({isConnected:!0,facebookUser:Z}),i==null||i(!0),console.log("ðŸ”„ Loading Facebook pages after OAuth success..."),Qe().then(se=>{if(console.log("âœ… Facebook connected and pages loaded:",se.length,"pages"),console.log("ðŸ“„ Pages data:",se),U(se),se.length>0){const xe=se[0].id;_(xe),console.log("ðŸ”„ Auto-selecting first page and loading forms..."),cs(xe).then(Ie=>{console.log("âœ… Forms loaded for first page:",Ie.length,"forms"),j(Ie),E.success(`âœ… Facebook Lead Ads connected! Found ${se.length} pages and ${Ie.length} forms.`)}).catch(Ie=>{console.log("âŒ Failed to load forms for first page:",Ie),E.success(`âœ… Facebook Lead Ads connected! Found ${se.length} pages.`)})}else E.success("âœ… Facebook Lead Ads connected successfully!");setTimeout(()=>{console.log("ðŸ”„ Refreshing status after OAuth success..."),Q()},100),setTimeout(()=>{const xe=document.getElementById("facebook-form-section");xe?(console.log("ðŸ“ Scrolling to form section"),xe.scrollIntoView({behavior:"smooth"})):console.log("âš ï¸ Form section not found")},500),L()}).catch(se=>{console.error("Error loading pages, trying fallback:",se),Ke().then(xe=>{console.log("âœ… Facebook connected, using stored pages:",xe.length,"pages"),U(xe),E.success("âœ… Facebook Lead Ads connected successfully!"),L()}).catch(xe=>{console.error("Error loading stored pages:",xe),E.success("âœ… Facebook Lead Ads connected! Please refresh to load pages."),L()})})):F(new Error("No user data received from Facebook"))}else if(((We=C.data)==null?void 0:We.type)==="facebook_oauth_error"){const Z=C.data.error||C.data.message||"Failed to connect to Facebook";if(console.error("âŒ Facebook OAuth error:",Z),Z.toLowerCase().includes("denied")||Z.toLowerCase().includes("cancelled")||Z.toLowerCase().includes("access_denied")){console.log("â„¹ï¸ Facebook authentication denied by user");const se=new Error(Z);se.isUserCancellation=!0,F(se)}else E.error("âŒ "+Z),F(new Error(Z))}};window.addEventListener("message",oe);const Fe=setTimeout(()=>{if(!B){B=!0,clearInterval(Ge),clearInterval(me),window.removeEventListener("message",oe),I&&!I.closed&&I.close(),console.log("â° Facebook OAuth timeout - closing popup");const C=new Error("Facebook authentication timed out");C.isTimeout=!0,F(C)}},3e5),Ds=L,$e=F;L=(...C)=>{clearTimeout(Fe),Ds(...C)},F=(...C)=>{clearTimeout(Fe),$e(...C)}})}catch(x){const y=(x==null?void 0:x.isUserCancellation)===!0,G=(x==null?void 0:x.isTimeout)===!0,c=(x==null?void 0:x.isPopupBlocked)===!0;if(y)return;G?(console.error("â° Facebook authentication timed out"),E.error("Facebook authentication timed out. Please try again.")):c?(console.error("ðŸš« Popup blocked by browser"),E.error("Popup was blocked. Please allow popups for this site and try again.")):(console.error("âŒ Error in Facebook connection:",x),console.error("âŒ Error details:",{message:x instanceof Error?x.message:"Unknown error",stack:x instanceof Error?x.stack:void 0,type:typeof x,error:x}),E.error(x instanceof Error?x.message:"Failed to connect to Facebook"))}finally{H(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-4 border-b",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Dt,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Connect Facebook Lead Ads Account"}),e.jsx("p",{className:"text-sm text-gray-500",children:"All connections are fully encrypted and secure. Comply with SOC Type 2 and GDPR."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Dt,{className:"h-5 w-5 text-white"})}),e.jsx("span",{className:"text-lg font-medium",children:"Facebook Lead Ads"})]}),e.jsxs(Ja,{value:d,onValueChange:x=>v(x),className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Yt,{value:"new",id:"fb-new-connection"}),e.jsx(q,{htmlFor:"fb-new-connection",className:"text-sm font-medium",children:"Add New Connection"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Yt,{value:"existing",id:"fb-existing-connection"}),e.jsx(q,{htmlFor:"fb-existing-connection",className:"text-sm font-medium",children:"Select Existing Connection"})]})]}),d==="new"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"New Connection Name"}),e.jsx($,{value:m,onChange:x=>R(x.target.value),placeholder:"Facebook Lead Ads #1",className:"w-full h-12 border border-gray-300 rounded-lg"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Name your connection with Facebook Lead Ads account."})]}),e.jsxs("div",{className:"pt-4 space-y-2",children:[e.jsx("div",{className:"flex items-center gap-3",children:r.isConnected?e.jsxs(e.Fragment,{children:[e.jsxs(W,{onClick:V,disabled:A,className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“˜"}),"Connect With Facebook Lead Ads"]}),e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-green-100 rounded-lg",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}):e.jsxs(W,{onClick:V,disabled:A,className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center gap-2",children:[A?e.jsx(Ue,{className:"h-4 w-4 animate-spin"}):e.jsx("span",{className:"text-lg",children:"ðŸ“˜"}),"Connect With Facebook Lead Ads"]})}),r.isConnected&&e.jsx("div",{className:"flex justify-end",children:e.jsx(W,{onClick:()=>{s?(localStorage.removeItem(`facebook_connected_${s}`),localStorage.removeItem(`facebook_user_${s}`)):(sessionStorage.removeItem("temp_facebook_connected"),sessionStorage.removeItem("temp_facebook_user")),S({isConnected:!1}),U([]),j([]),_(""),J(""),i==null||i(!1),E.success("Facebook disconnected successfully")},variant:"outline",size:"sm",className:"text-xs text-red-600 hover:text-red-700 hover:bg-red-50",children:"Disconnect"})})]})]})]})},io=({initialConfig:s,onCancel:o,onSave:i})=>{const[d,v]=l.useState({messageTemplate:(s==null?void 0:s.messageTemplate)||"New lead received from {name} ({email}) at {timestamp}",fromPhoneNumber:(s==null?void 0:s.fromPhoneNumber)||"+13462331126",testPhoneNumber:(s==null?void 0:s.testPhoneNumber)||"",enableNotifications:(s==null?void 0:s.enableNotifications)??!0}),[m,R]=l.useState(!1),[r,S]=l.useState(!1),O=()=>{if(!d.messageTemplate.trim()){h.error("Message template is required");return}if(!d.fromPhoneNumber.trim()){h.error("From phone number is required");return}i(d)},U=async()=>{var j;if(!((j=d.testPhoneNumber)!=null&&j.trim())){h.error("Please enter a test phone number");return}S(!0);try{const _=await(await fetch("/api/text-webhook/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({toPhoneNumber:d.testPhoneNumber,message:d.messageTemplate,fromPhoneNumber:d.fromPhoneNumber})})).json();_.success?h.success("Test SMS sent successfully!"):h.error(`Failed to send test SMS: ${_.error}`)}catch(p){console.error("Error testing SMS:",p),h.error("Failed to send test SMS. Please try again.")}finally{S(!1)}},Y=[{placeholder:"{name}",description:"Contact name"},{placeholder:"{email}",description:"Contact email"},{placeholder:"{phone}",description:"Contact phone"},{placeholder:"{company}",description:"Company name"},{placeholder:"{message}",description:"Message content"},{placeholder:"{timestamp}",description:"Current timestamp"},{placeholder:"{webhook_id}",description:"Webhook ID"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-blue-100 rounded-lg",children:e.jsx(Aa,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Text Webhook Configuration"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure SMS notifications for your webhook"})]})]}),e.jsxs(Es,{children:[e.jsxs(Is,{children:[e.jsxs(Ls,{className:"flex items-center gap-2",children:[e.jsx(Sa,{className:"h-5 w-5"}),"Message Template"]}),e.jsx(Vt,{children:"Customize the SMS message that will be sent. Use placeholders to include dynamic data."})]}),e.jsxs(Ts,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"messageTemplate",children:"Message Template"}),e.jsx(Ka,{id:"messageTemplate",placeholder:"Enter your message template...",value:d.messageTemplate,onChange:j=>v({...d,messageTemplate:j.target.value}),rows:4,className:"font-mono text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Available Placeholders"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Y.map(j=>e.jsxs(is,{variant:"outline",className:"cursor-pointer hover:bg-gray-100",onClick:()=>{const p=document.getElementById("messageTemplate");if(p){const _=p.selectionStart,ae=p.selectionEnd,J=p.value,A=J.substring(0,_),H=J.substring(ae);p.value=A+j.placeholder+H,p.focus(),p.setSelectionRange(_+j.placeholder.length,_+j.placeholder.length),v({...d,messageTemplate:p.value})}},children:[j.placeholder,e.jsxs("span",{className:"ml-1 text-xs text-gray-500",children:["(",j.description,")"]})]},j.placeholder))})]})]})]}),e.jsxs(Es,{children:[e.jsxs(Is,{children:[e.jsxs(Ls,{className:"flex items-center gap-2",children:[e.jsx(Ca,{className:"h-5 w-5"}),"Phone Number Configuration"]}),e.jsx(Vt,{children:"Configure the phone numbers for sending and testing SMS messages."})]}),e.jsxs(Ts,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"fromPhoneNumber",children:"From Phone Number"}),e.jsx($,{id:"fromPhoneNumber",type:"tel",placeholder:"+1234567890",value:d.fromPhoneNumber,onChange:j=>v({...d,fromPhoneNumber:j.target.value})}),e.jsx("p",{className:"text-xs text-gray-500",children:"This is the Twilio phone number that will send the SMS messages."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"testPhoneNumber",children:"Test Phone Number (Optional)"}),e.jsx($,{id:"testPhoneNumber",type:"tel",placeholder:"+1234567890",value:d.testPhoneNumber,onChange:j=>v({...d,testPhoneNumber:j.target.value})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enter a phone number to test your SMS configuration."})]}),d.testPhoneNumber&&e.jsx(W,{onClick:U,disabled:r,variant:"outline",className:"w-full",children:r?"Sending...":"Send Test SMS"})]})]}),e.jsxs(Es,{children:[e.jsx(Is,{children:e.jsxs(Ls,{className:"flex items-center gap-2",children:[e.jsx(Fa,{className:"h-5 w-5"}),"How It Works"]})}),e.jsx(Ts,{children:e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{children:"When webhook data is received, the system will automatically extract phone numbers from the payload."})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{children:"Your message template will be processed, replacing placeholders with actual data from the webhook."})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{children:"An SMS will be sent to the extracted phone number using your configured Twilio account."})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(Zt,{className:"h-5 w-5 text-yellow-600 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium",children:"Important Note"}),e.jsx("p",{children:"Make sure your webhook data contains phone number fields (phone, mobile, cell, etc.) for this action to work properly."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(W,{variant:"outline",onClick:o,children:"Cancel"}),e.jsx(W,{onClick:O,disabled:m,children:m?"Saving...":"Save Configuration"})]})]})},mo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACu0lEQVR4nO2UT2jTYByG48F5c4ieFcdogqaVNkmXuJ7KDkILrcPN4y4y2KFnPYjebMCbc4JXT85Bq0IPWm1zsLVoFZFdNjfULV93kVHBuZJoP/lmo1lNmj/9K3wvvLfw6/skDyUIHBwcHBwcXcoez7ECRd0pkmSlQJI7BZIsFT2eaaLH+SHR06pEl5Q8vaPkvRU1T9+GWeqo9XiSXC1SFDToUnlkZLjbw2GWGVYkekmVvPCf5umVlhB7b954vNa1EkUx3Rqv5LyMKnnXDMf/7bw5AEluWQCg1gDPJTo9HvBcQpG8NYvxUMnTwByAouo2ACAQOCjz3MPPodCRdod/CQYPA4G7j25ajf8N4K2bHrMzXgNoQHzaHA/ybscDngkAgfug3bMDgNoxgEYVIHCXIUEccDK+IrCzgOdq+lv9AnCklF4Z0NS2AeYnZt65BbCjVLMywAXAq+zYa1OA4yKAk3OLap4+U3MD0EopI2WAA4DvOd/uzUy4Gk3HYUsA1MDVt/BeKP7TJcA+pVopA2wCrD8L1C49ikA03hYA6skbG/DKhWt1o79WO2MaEOuodp9XDcZnnozD8+nYn/G2AbROzi3WpdO+XTcATqvqhn/L+RQxM7FvuCsATak0G97qFcDmc/+2Xpm2ATSlkpHEClKqmwAvnvIfm5XpCIDW2ZmF90Dgql0AqC48Di+3Gt4RANSK4D8BePZlp8bLAvdmg/eP2hnfEQD0bJlhDso8K8oC15ZSMs/dXT03egjd7CmAFnCWiQGe3Xb+1tmv8hh7UX+rLwAoTpXSlCGa0jcAJ0rplRkoACuljJQZSAAjpcyUGVgAFKSJLLC3UM2UGWgAN4liABEDtJUoBkgCMPAAqbhsDiDK4qADRNKxpOmBU9eXh/YgLL5EPwAiqTiIpuLi1IOpoW79Pg4ODg4O8d/lF8QKnDLBCDeUAAAAAElFTkSuQmCC",Kt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAADLElEQVR4nO2Zz08TQRTHNzM0MQHixaMnI2jE4Mmr/4A/okej3r0oAn+AiYke9IYkpDNFDAkRqokHL4bEEzFelIqAJP5IDPvetrXQAhXSsrRjplYMboGdnd0th/0m79TN7Pcz8+bN7KthRIoUKZJUbNg8Qxj0UYZJwnCGcsxTjpv1yBOGH2u/cbNXPmscCCVy7YRDP2XwmXIUSsFgXgIbg9m28I3fFS1yJinDZWXjDhBcIgzvyDHDMR/Hk4RjStv4f0EYThsJOBGodxqHS5RD0W/z9F9arVEOFwMxTxLWDcrBDsw8/xtgE25dD2LmQzCP2xCUwQV/3A+ZHX+WVs9U24glOiey4uzLn6LreVZ0jGfE4afWXhBFud98qDbeN2wLR3H1TV5Mpctis1IVjXR5cnn3jc3hg1Z1qpVKj+YPDVti4vuG2E9X9gCoQcSxx5v70XQr5ZDzCvBwpriveTcA8pyQB6aH2Yd+r+aPjmVEeZeUUQbg8oyAPmUAT9eDevS+W2lotlCuiPupNXFzqrAdx55l9h+TwbySeXnZ0qk4498a5/65VznPY8YS6dOhpI+Mt5myw/zs8qbn8ajqZpbXXp2XzeVtB8DY1w0tAMpwXGEF8JPOyxYKToDHc7/0VoBjSmUFlvwGGNAEoBxyKgDlgweApUAA7k2viXypsiO2GhwBpa2q47l8qSK6X2QDAXCdQo9cnriNVBVCtI9Y/qeQyibWAfhR3ApsEyfDAJiEUkBlVLZHQgAYUNjYhONt1wAxbnarfKgcGU3viC8rzirEFtYdz7U+cZv/KGIs3eUaoL4KswolLtgyyhQvc6ppFDQA4WZvqB80vgIwXPLcvZMds2YDEIa3DK2PeobTzQIgHN4bSUENLfHF45TBavgA4ENbpS7Z7lNpbOkDgE0T5nnDT8l2n1sIPQCwCcNrRhCS7T43XTrPAAxWfZ95hxh0yo6Z3wBEbtghs8MIRbI6xbFnt2u3GgDkaqVSu9p40WC2TZ7YhMOcKoC8qhB5wjblL6YGirF0V21VOE68NkuFxaJdWberQoZZtCsPUquWvBLX2iPD1qlm+40UKZJxMPQbpCHHxg1rFUAAAAAASUVORK5CYII=",go="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADUAAAA1CAYAAADh5qNwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF40lEQVR4nO3XWUwUdxwH8C2HKLAaDdHYpCatLz703aRpH/paExTxQCwEla6gxjNKbEWOINVqLElrrXdbY4yAgLcIuIigy9llFSMgSABh5/5Pd7WtBb7N/MdddnFZF9hDjJN8s9mZ/8z8Pjv/Y1ajeb+9vpk6zHPMwnOdP8Lw1iSOe/6hxpeb8Un/bFMba2IEK/wVM2+V+qW/P/Yl6EFzGzPkTxSjJs1nIFM7i8CgLDk+A70TKOMI0KRHGV2AJjXK1GGeY2pjH44ETVqUUX1CLkFKHjxheyYVyvgGkKmdEbv65bpJherjrXueMXL3KOnp5y0D/gdZJ4ZSTg5M0e9R3kPxF4shbdsMKTkJkm4dpG1bIJz+jR7jyvQgqTqIWZkuz5WyMuhxrlyv7uvlIH6fCylVp14vRQdpdxq45kf+Q3HleshxyyBt3gjxhwM00rdpEA/sp8eFQwchr4gBWR4DvqbW+ceoqQVZEUOPC4cOqci9e0BWLYeYvoeeK+bsg7R9K/iKKv+hxNx9IElfg+02u7ypcPAg5MR4kHVJEDOdn5aYmQGSvAZywioVxf1F20mZGYHtfsLRo5CXLYaUnQne0EALc4US078DWZsIpptRj/WwIOsSIe5NH0YJVpCNqSC6tRB+/wNsZ0+AxlS/QAsjq1equBQdxOxsMK2dTiiu2gASFwv+xEl1/8mTkFfGgqu654Ti9VWQUr4BWRoNkhAHacc2CKfPgOEt/p/92NZOCMeOQ9q9CyR+BaQN68EyxI5iu/og7dwOsmUTLZAoE8vOHXS/I4qGlcHdroK4PxfSplTIsdEQjv7qfxTjOFZ++pk+NdbY4oQSzufTiUE8dQZkZQz4C/muUY4/FkMgbdoAKW2Xd1HQa0LkR6frXY6p8xfotMwXXARX1wT+WimdCcmaRDp5OKJYswiyPpl2VZKSTL87oVgCKSMD4uHD4CoqwdU2Qjh+AiRhFcTsLJcoueXEnzimCR0b6JxmJvI/KLc2up6R+LPn6BiQl0ZDXvIV5CWLICWvAX+hUH1qR45ATloNpo9Xv/+YBxIbDTEvT71GH09nT/HIL/SpkN1pIImrIS9WryUvX0KndLaz1+X9rY0ZQEHQXZzTRHkGOq+Zj4KgRygIoieP2uVYGWyTCfyNUnAVd+gCau8+ZglsS5tz28Zm+mlv87CVtrN/73pGJxbhynW17aiThNWGUtKOQs0C96ASzULkB/GvTnCPCmCswyjQeks0C0dH1Wr3oTq8GkXB7KRAXQwWUDntjlK3O1QuarWAIdIK/bRKS2N6gP5auI+lMX0QZQomUqb11mpz34x6lYGGeYR0FwccwThE6r2BgfpPRMc6x4Sy5V/TIgj9TQHF8OaH+Kcl/rXaxo2iqZuFF4+3guX6/YpheRbW9iwM1UWNBpoA6lUGG+bB0pEHhh+enn0TC+SuMxhsmO+2Hq+gbPnP+BnE3tseFSc+vQ255RTEp8qfwtHXH1uEvhq8bP7SozrgTZSa6bSf80yr63HQ24KXZZ8PrykFQXhZ9gXd76o9xzzBi8cbgNoZYwHByyg1Q3Wzab9neX741+6ux+Dlj5xAtgxemguh694wiJdolx6qnzvme8NXKPsS0LiAjgOluw2WRLkE2TJUPBNiRylIdxEGmj4d9z3haxRNZThQGOoWZE9hCKAPnygIvkVVTPMMMzLKeW8lqmzq+EC2lIa9ZaibYRMD2XJzCmAINMqgBa57OH48zdXQ8cByvYMyRAJXvAyy5XIIcD/Sz6h7kcClEN+AbCkJUe/jF1RNBFDsY5Atyn2qI3yMuhuu/Nv0D8gW5X53w32EqorwP8iWwmB1UfcqSln1CwOAcYIFuXv7GCOqfGrgQQUOUeoZE8qgzXZqfMtLi6q3c3PE24dBm+3mSU2Ptze8MSXwxbvLdYe3j/sRcW6e1KzpuK/toat6oIv2/O2jDw0zZ4yKorBboQkoCh4IeMGepCh4QKnXLcgO00dG4VpYDq5NOfv2JixHqdMj0Luw/Q9IJfBDf/BOigAAAABJRU5ErkJggg==",uo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE1UlEQVR4nO2afWwTZRzHf7zGPySRRBT+MRGjJoJRsyjGYbYOo70r82Vy3QYap251w+wFdOktRgpMtvgCZrtjuwdYlszwz2IEEyEhbZiwiGwrOrwWicERbCHBP3TiRtjW7WtuuGYvLezYruvLfZJvLk3au+f3uefuea73EJmYmJiYmMQtra1YIKs4JKkopFSEebFIUqFKPmyjeMJWiYetVdjAi1iT4cJCShXSHFjEOXGAF4GxcE6csX6IhygV4EW4xhcfjhOdgoAFlOzwIi5GFKD1hCqkUzLjcmE+L+JGNAE2J16jZIdz4nTEsy8ilP0RHtSzL+ksHpdVDMh+vEKJgrUKGVqxUwQ48bnefck+LJdVHNREUCJhdWItJ6KDc2KAc6KHF1GmXR6xOj46i1fDW7QbXkcZfMJiSiXQXXwfvI5eeB34PxKlEvBw5eOK13KBUgEwegCMDuPQqlMTBRT9Ee03zRdxl6Siou4nLKNEBa20GIzKwehfMIIeAfV+PC/7ANmHIt0Hlv1YJfvw1VzZGy28kd6FQj2jhY9FhwCNvSqe054odTdAUvG65MNgvYonKIaA0QowqoJCgQmF36GAGSH7cDfFADTRMjB6Ewp9C0ZDEQufCwFGABctRAOtxj7aBEafgdFpMBqOVvBII6H/g5vbuBUAr8M1aWiKnu+zT9zyDE/KsEToLSAM15sCEFcC0Ez3gFEeFHLiZE6T1phQVzGamo9FTN+PFckjAArlglFvuKGeF9q0xgx0vB/xMVnLnydFXQIGawmhL28vYNj73mV3EH+5A/C7g9jVdtXgGzcYZUCh0IQGGyCgr4xwY9v0BHiCQDgBnGqDgf9RgtHxKQ2eJQFDnxL6towT8PEdCAgC7gC2GFM8aB4UGjBKwEA14VrJLAgI4rgxAlw0H4wG412AJ4B2QwRogFF7AgjYSUYBRi9OmbnNkoCRvYTQFzMT4A7iQixGgkIw6jdyFLheSRj8RJeAG54gDh69EqOnV2hPbQoVg1EtTrzaojVmqHMzdtR1R8w/P2w1bCLUfglLDR36bkdKToXHYwr4pWRpy57S7IqK0p5oEStLv0ZnyUocefoRKJQDRtuh0DdgdPVWAkbkmwK0bdwK0BDeLlubW1COaLEXlHso2tyikZ6BQjvAyB+tF4Q/J5uAyWAfPQtG+8HoesReEa8CXn6ncon9rYp0LqegPIvPPT+Wl9bnd3Vv3H7+9/ydfuTVHMbG2rTp7A/76f7REUahawkhYIwsW65g4e0Yyzrefhn5tQgnr/YKXK5pv0aDTMvBiIUnX0kgYBiCS/dMDY2UDoV+TnwB+TV7ZvSu4JhlV0IJyOKFgHbdj+aNal3rByKBM4VpkwS0USyQfKiWVEh6BVh4YdbPELqKtF7Qjy7HOXQUPkmxQPKhRfLhu3gQENdkmQJyU1tAhlXYMF5AJme/FOs2AJinvRJvOItHY31syrIKj1l4+0hYAC8cifZd7fX7dG6semHnsELyISSr2E1zQSZv32zh7L9ZOMG9zpazcqYCtAVYggu6FkPV+fHUgV+xhBIdmwgHL6JXW5HGi2iI5Wq0OUdbgD15TaJVxCZKFawi+AiLsmsoVVi/FfdyTvw9TsCIzYlMSiV4EWt4EUd5Ee0p1f1NTExMTMh4/gNwIeTsDQJL/QAAAABJRU5ErkJggg==",ho="data:image/png;base64,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",qt=({webhook:s,workflowName:o,onBack:i,onSave:d})=>{var Vs,zs,Js,Ks,qs,Zs,$s,et,st;console.log("ðŸ” WebhookCreator rendered with props:",{webhook:!!s,workflowName:o});const{isSuperAdmin:v}=Qa(),[m,R]=l.useState(null),[r,S]=l.useState(null),[O,U]=l.useState(""),[Y,j]=l.useState(!1),[p,_]=l.useState(""),[ae,J]=l.useState(!1),[A,H]=l.useState([]),[de,K]=l.useState(!1),[Q,M]=l.useState(null),[V,x]=ea(),[y,G]=l.useState(!1),[c,N]=l.useState(null),[w,P]=l.useState("disconnected"),[I,D]=l.useState(!1),[me,L]=l.useState(null),[F,B]=l.useState(o||"Untitled Workflow"),[ee,ue]=l.useState(null),[Ge,us]=l.useState(!1);l.useEffect(()=>{o&&o!==F&&(console.log("ðŸ”„ Updating workflow title from prop:",o),B(o))},[o]),l.useEffect(()=>{if(F&&F!=="Untitled Workflow"){const t={workflowTitle:F,selectedTrigger:m,selectedApp:r,actionCards:A.length>0?A:void 0,timestamp:Date.now()};localStorage.setItem("webhook_creator_state",JSON.stringify(t))}},[F,m,r,A]),l.useEffect(()=>{const t=localStorage.getItem("webhook_creator_state");if(t&&!s)try{const a=JSON.parse(t);Date.now()-a.timestamp<30*60*1e3?(console.log("ðŸ”„ Restoring workflow state from localStorage:",a),a.selectedTrigger&&!m&&R(a.selectedTrigger),a.selectedApp&&!r&&S(a.selectedApp),a.actionCards&&A.length===0&&H(a.actionCards)):localStorage.removeItem("webhook_creator_state")}catch(a){console.error("Error restoring workflow state:",a),localStorage.removeItem("webhook_creator_state")}},[]);const[oe,Fe]=l.useState(!1),[Ds,$e]=l.useState(!1),[C,Re]=l.useState(!1),[pe,Ee]=l.useState([]),[hs,fs]=l.useState(null),[We,Z]=l.useState(!1),[se,xe]=l.useState(null),[Ie,ps]=l.useState(null),[Gs,xs]=l.useState(!1),[ga,Ws]=l.useState(!1),[fo,po]=l.useState("new"),[xo,bo]=l.useState("Facebook Lead Ads #1"),[Le,ke]=l.useState({isConnected:!1}),[es,De]=l.useState([]),[ss,Ye]=l.useState([]),[ts,bs]=l.useState(""),[Ms,ws]=l.useState(""),[wo,vo]=l.useState(!1),[Me,_s]=l.useState(""),[vs,js]=l.useState(!1),[Te,Ve]=l.useState({listName:"",description:"",type:"General"}),ge=[{id:"webhook",name:"Webhook",icon:()=>e.jsx(Xe,{className:"h-10 w-1o text-purple-600"}),description:"Receive HTTP requests from external services"},{id:"email-parser",name:"Email Parser (AI Cruitment)",icon:()=>e.jsx(Oe,{className:"h-8 w-8 text-pink-600"}),description:"Parse emails sent to a unique email address"},{id:"facebook-lead-ads",name:"Facebook Lead Ads",icon:()=>e.jsx("img",{src:Kt,alt:"Facebook",className:"h-10 w-10"}),description:"Trigger when new leads are submitted on your Facebook Lead Ads forms"}],Bs=[{id:"catch-webhook",name:"Catch Webhook (Preferred)",description:"Triggers when a new POST, PUT or GET request is sent to the webhook URL."}],ys=[{id:"new-email-received",name:"New Email Received",description:"Triggers when a new email is sent to your unique email parser address."}],Ns=[{id:"facebook-lead-ads-new-lead",name:"New Lead Instant",description:"Triggers when a new lead is submitted to your selected Facebook Lead Ads form."}],Qs=()=>(r==null?void 0:r.id)==="email-parser"?ys:(r==null?void 0:r.id)==="facebook-lead-ads"?Ns:Bs,ua=[{id:"outbound-campaign",name:"Campaign",icon:()=>e.jsx("img",{src:uo,alt:"Gmail",className:"h-10 w-10"}),color:"bg-indigo-600",description:"Create or launch an outbound calling campaign",events:[{id:"create-campaign",name:"Create Campaign",description:"Create a new outbound campaign"}]},{id:"gmail-service",name:"Gmail Service",icon:()=>e.jsx("img",{src:mo,alt:"Gmail",className:"h-10 w-10"}),color:"bg-white",description:"Send emails and manage Gmail account",events:[{id:"send-email",name:"Send Email",description:"Send an email using Gmail."},{id:"create-draft",name:"Create Draft",description:"Create a draft email in Gmail."},{id:"reply-to-email",name:"Reply to Email",description:"Reply to an existing email."},{id:"star-email",name:"Star Email",description:"Star an email in Gmail."},{id:"trash-email",name:"Move to Trash",description:"Move an email to trash in Gmail."},{id:"forward-email",name:"Forward Email",description:"Forward an email to another recipient."},{id:"add-label",name:"Add Label to Email",description:"Add a label to an email in Gmail."},{id:"mark-as-read",name:"Mark Email as Read",description:"Mark an email as read in Gmail."},{id:"mark-as-unread",name:"Mark Email as Unread",description:"Mark an email as unread in Gmail."},{id:"archive-email",name:"Archive Email",description:"Archive an email in Gmail."},{id:"delete-email",name:"Delete Email",description:"Delete an email from Gmail."},{id:"search-emails",name:"Search Emails",description:"Search for emails in Gmail."}]},{id:"lists",name:"Lists",icon:()=>e.jsx("img",{src:ho,alt:"Gmail",className:"h-10 w-10"}),color:"bg-white",description:"Manage contact lists and data",events:[{id:"add-to-list",name:"Add Contact to List",description:"Add a new contact to a specific list."},{id:"create-list",name:"Create New List",description:"Create a new contact list."},{id:"update-contact",name:"Update Contact",description:"Update existing contact information."},{id:"remove-from-list",name:"Remove from List",description:"Remove a contact from a list."}]},{id:"text-webhook",name:"Text Webhook",icon:()=>e.jsx("img",{src:go,alt:"Gmail",className:"h-10 w-10"}),color:"bg-white",description:"Send SMS notifications when webhook data is received",events:[{id:"send-sms",name:"Send SMS",description:"Send an SMS notification to extracted phone numbers."}]}];l.useEffect(()=>{As(),console.log("WebhookCreator initialized with workflow name:",o)},[o]);const ks=async()=>{try{const t=await Ha();t.success&&Ee(t.data||[])}catch(t){console.error("Error loading lists:",t),Ee([])}},ha=async()=>{try{if(!Te.listName.trim()||!Te.description.trim()){h.error("Please fill in all required fields");return}const t=await Xa({listName:Te.listName,description:Te.description,type:Te.type});t.success&&(await ks(),_s(t.data.id.toString()),Ve({listName:"",description:"",type:"General"}),js(!1),h.success("List created successfully!"))}catch(t){console.error("Error creating list:",t),h.error("Failed to create list")}},As=async()=>{try{if(console.log("ðŸ” Loading Facebook connection status...",{currentWebhookId:re,isConnected:Le.isConnected,hasWebhook:!!s}),!re&&!Le.isConnected&&!s){console.log("ðŸ†• New webhook flow - not loading Facebook connection status"),ke({isConnected:!1}),De([]);return}const t=re||s&&(s.webhook_id||s.id);if(t){console.log("ðŸ“‹ Loading Facebook status for webhook:",t);const a=await ca(t);if(ke(a),a.isConnected){const g=await Ke();De(g),console.log("âœ… Facebook connection loaded:",{status:a,pagesCount:g.length})}}}catch(t){console.error("Error loading Facebook connection status:",t),ke({isConnected:!1}),De([])}},fa=async t=>{try{const a=await cs(t);Ye(a)}catch(a){console.error("Error loading lead forms:",a),Ye([])}},pa=t=>{bs(t),t?fa(t):Ye([]),be()},Hs=t=>{S(t),$e(!0)},as=()=>{if(A.length>=5){h.error("Maximum 5 action cards allowed per workflow");return}const t={id:Date.now(),isExpanded:!0,selectedApp:null,selectedEvent:null,searchQuery:"",isConnected:!1};H(a=>[...a,t]),be(),console.log(`âž• Added new action card. Total cards: ${A.length+1}`)},xa=t=>{H(a=>{const g=a.filter(f=>f.id!==t);return console.log(`ðŸ—‘ï¸ Removed action card ${t}. Remaining cards: ${g.length}`),be(),g})},ba=()=>{H(t=>{const a=t.filter((g,f,u)=>f===u.findIndex(b=>{var k,T,ne,X,le,Pe;return((k=b.selectedApp)==null?void 0:k.id)===((T=g.selectedApp)==null?void 0:T.id)&&((ne=b.selectedEvent)==null?void 0:ne.id)===((X=g.selectedEvent)==null?void 0:X.id)&&((le=b.selectedApp)==null?void 0:le.id)&&((Pe=b.selectedEvent)==null?void 0:Pe.id)}));return a.length!==t.length&&(console.log(`ðŸ§¹ Removed ${t.length-a.length} duplicate cards`),h.success(`Removed ${t.length-a.length} duplicate action cards`),be()),a})},Ae=(t,a)=>{console.log("ðŸ”„ updateActionCard called:",{cardId:t,updates:a}),H(g=>{const f=g.map(u=>u.id===t?{...u,...a}:u);return console.log("ðŸ“‹ Updated action cards:",f),f}),be()},he=(t,a,g)=>{const f=A.find(b=>b.id===t),u=(f==null?void 0:f.gmailConfig)||{action:"send",fromEmail:"",to:"",cc:"",bcc:"",subject:"",body:"",isHtml:!1,attachments:[],template:"default",messageId:"",signature:"",labelId:"",replyToMessageId:""};Ae(t,{gmailConfig:{...u,[a]:g}})},wa=async t=>{R(t),j(!0);try{if((r==null?void 0:r.id)==="email-parser"){const g=`${Math.random().toString(36).substring(2,8)}@aicruitment.com`;_(g),h.success("Email Parser address generated! Forward emails to this address to trigger the workflow.")}else if((r==null?void 0:r.id)==="webhook"){const a="https://ai.research-hero.com",g=Math.random().toString(36).substring(2,15),f=`${a}/api/webhook-data/capture/${g}`;_(f),h.success("Webhook URL generated! Toggle ON to activate and save to database.")}else(r==null?void 0:r.id)==="facebook-lead-ads"&&(_(""),h.info("Select event, then connect your Facebook Lead Ads."),F&&F.trim()?(console.log("ðŸ”§ Creating webhook record for Facebook Lead Ads with title:",F),await Fs()):console.log("ðŸ”§ No workflow title yet, webhook record will be created when title is entered"));A.length===0?(console.log("ðŸŽ¯ Auto-adding first action card since none exist"),as()):console.log(`ðŸŽ¯ Skipping auto-add, ${A.length} cards already exist`),console.log("ðŸ”„ Trigger selected, starting auto-save functionality"),xs(!0),ya(),h.success("ðŸ”„ Auto-save started! Changes will be saved every second.")}catch(a){console.error("Error handling trigger selection:",a),h.error("Failed to setup trigger")}finally{j(!1)}},va=async()=>{if(!p)return;if(y){G(!1),me&&(clearInterval(me),L(null)),h.info("Stopped capturing webhook responses");return}G(!0),N(null),h.info("Listening for webhook responses...");const t=p.split("/").pop(),a=setInterval(async()=>{try{const g=await z.get(`/api/webhook-data/capture/${t}/history?limit=1`);if(g.data.success&&g.data.data&&g.data.data.webhookData&&g.data.data.webhookData.length>0){const f=g.data.data.webhookData[0],u=new Date(f.created_at);if((new Date().getTime()-u.getTime())/1e3<=60){let T=f.data;if(typeof T=="string")try{T=JSON.parse(T)}catch{}N(T),G(!1),clearInterval(a),L(null),h.success("Webhook data captured successfully!")}}}catch(g){console.error("Error fetching webhook data:",g)}},2e3);L(a),setTimeout(()=>{y&&(G(!1),clearInterval(a),L(null),h.warning("Capture timeout - no webhook response received"))},6e4)},Ss=async t=>{var a,g;if(C)try{const f=(s==null?void 0:s.webhook_id)||(s==null?void 0:s.id)||re||(p?p.split("/").pop():"");if(!f)throw new Error("Webhook ID not found");const u={name:F,description:(m==null?void 0:m.description)||"",trigger_event:m==null?void 0:m.id,trigger_app:(r==null?void 0:r.id)||"webhook",url:p,isActive:t,actionCards:A.map(k=>({id:k.id,selectedApp:k.selectedApp,selectedEvent:k.selectedEvent,isConnected:k.isConnected,selectedListId:k.selectedListId,campaignConfig:k.campaignConfig,textConfig:k.textConfig,gmailConfig:k.gmailConfig}))},b=await z.put(`/api/webhooks/${f}`,u);if(b.data.success)console.log(`Webhook ${t?"activated":"deactivated"} successfully`);else throw new Error(b.data.message||"Failed to update webhook")}catch(f){console.error("Error saving webhook toggle state:",f),h.error(((g=(a=f.response)==null?void 0:a.data)==null?void 0:g.message)||"Failed to save webhook state")}},ja=async t=>{var g,f;const a=(r==null?void 0:r.id)==="facebook-lead-ads";if(t&&!C&&m&&(p||a)){if(re){Fe(!0),await Ss(!0),h.success("Webhook activated!");return}if(!F||!F.trim()){h.error("Please enter a workflow name");return}if(!m.id){h.error("Please select a trigger event");return}if(!v)try{const b=(await z.get("/api/credits/balance")).data.data;if(!b||parseFloat(b.available_credits)<1){h.error("Insufficient credits to create webhook. Please purchase credits to continue.");return}}catch(u){console.error("Error checking credit balance:",u),h.error("Unable to verify credit balance. Please try again.");return}j(!0);try{console.log("ðŸ”§ Creating webhook with data:",{name:F,trigger_event:m.id,trigger_app:(r==null?void 0:r.id)||"webhook",description:m.description,url:p});const u=await z.post("/api/webhooks/create",{name:F||`Webhook - ${m.name}`,trigger_event:m.id,trigger_app:(r==null?void 0:r.id)||"webhook",description:m.description,url:p,is_active:!0});if(u.data.success){const b=u.data.data.webhook_id;Ys(b),Re(!0),Fe(!0),u.data.data&&(console.log("âœ… Webhook created successfully:",u.data.data),console.log("âœ… Webhook ID from response:",b)),h.success("Webhook activated and saved to database!")}else throw new Error(u.data.message||"Failed to create webhook")}catch(u){console.error("Error creating webhook:",u);const b=((f=(g=u.response)==null?void 0:g.data)==null?void 0:f.message)||u.message||"Failed to activate webhook";h.error(b);return}finally{j(!1)}}else t&&C?(Fe(!0),await Ss(!0),h.success("Webhook activated!")):(Fe(!1),await Ss(!1),h.info("Webhook deactivated"))},Cs=async()=>{var t,a,g,f;if(Gs){us(!0);try{!s&&!re&&await Fs();const u=s&&(s.webhook_id||s.id)||re;if(!u){console.error("âŒ No webhook ID available for auto-save");return}console.log("ðŸ’¾ Auto-saving webhook:",u);const b={name:F,description:(m==null?void 0:m.description)||"",trigger_event:m==null?void 0:m.id,trigger_app:(r==null?void 0:r.id)||"webhook",url:p,isActive:oe,actionCards:A.map(T=>({id:T.id,selectedApp:T.selectedApp,selectedEvent:T.selectedEvent,isConnected:T.isConnected,selectedListId:T.selectedListId,campaignConfig:T.campaignConfig,textConfig:T.textConfig,gmailConfig:T.gmailConfig})),facebookConnection:{isConnected:Le.isConnected,facebookUser:Le.facebookUser,pages:es,selectedPageId:ts,selectedLeadFormId:Ms,leadForms:ss}};console.log("ðŸ“¤ Sending auto-save data:",{webhookId:u,hasActionCards:((t=b.actionCards)==null?void 0:t.length)||0,hasFacebookConnection:!!b.facebookConnection,facebookConnected:(a=b.facebookConnection)==null?void 0:a.isConnected,facebookPagesCount:((f=(g=b.facebookConnection)==null?void 0:g.pages)==null?void 0:f.length)||0});const k=await z.put(`/api/webhooks/${u}`,b);if(k.data.success)xs(!1),ps(new Date),Z(!0),console.log("âœ… Webhook auto-saved successfully");else throw console.error("âŒ Auto-save failed - server returned error:",k.data),new Error(k.data.message||"Auto-save failed")}catch(u){console.error("âŒ Auto-save failed:",u),setTimeout(()=>{Gs&&(console.log("ðŸ”„ Retrying auto-save..."),Cs())},5e3)}finally{us(!1)}}},ya=()=>{console.log("ðŸ”„ Starting auto-save every 1 second"),ee&&clearInterval(ee);const t=setInterval(()=>{Cs()},1e3);ue(t)};l.useEffect(()=>()=>{ee&&clearInterval(ee)},[ee]);const be=async()=>{if(console.log("ðŸ”„ triggerAutoSave called",{hasWebhook:!!s,currentWebhookId:re,facebookConnected:Le.isConnected,facebookPagesCount:es.length,actionCardsCount:A.length,campaignCards:A.filter(a=>{var g;return((g=a.selectedApp)==null?void 0:g.id)==="outbound-campaign"})}),!s&&!re)try{console.log("ðŸ”§ Creating webhook record before auto-save..."),await Fs()}catch(a){console.error("âŒ Failed to ensure webhook record:",a);return}xs(!0),se&&clearTimeout(se);const t=setTimeout(()=>{Cs()},2e3);xe(t)};l.useEffect(()=>{if(s){console.log("Loading existing webhook data:",s),Z(!0);const t=s.triggerType||s.trigger_type||s.events;let a=null;if(t)if(typeof t=="string"&&t.startsWith("["))try{a=JSON.parse(t)[0]}catch{a=t}else a=t;const g=a&&ys.some(u=>u.id===a),f=a&&Ns.some(u=>u.id===a);if(g){S(ge.find(b=>b.id==="email-parser")||ge[1]);const u=ys.find(b=>b.id===a);console.log("Setting Email Parser trigger for existing webhook:",u||{id:a,name:a,description:""}),R(u||{id:a,name:a,description:""})}else if(f){S(ge.find(b=>b.id==="facebook-lead-ads")||ge[2]);const u=Ns.find(b=>b.id===a);console.log("Setting Facebook Lead Ads trigger for existing webhook:",u||{id:a,name:a,description:""}),R(u||{id:a,name:a,description:""})}else{S(ge[0]);const u=Bs.find(b=>b.id===a);console.log("Setting webhook trigger for existing webhook:",u||{id:a,name:a,description:""}),R(u||{id:a,name:a,description:""})}if($e(!0),J(!0),_(s.url||""),Re(!0),Fe(s.status==="active"||s.is_active||s.isActive),B(s.name||"Untitled Workflow"),s.metadata)try{const u=typeof s.metadata=="string"?JSON.parse(s.metadata):s.metadata;u.actionCards&&u.actionCards.length>0&&H(u.actionCards),u.facebookConnection&&(console.log("ðŸ”„ Restoring Facebook connection data from metadata:",u.facebookConnection),setTimeout(()=>{ke({isConnected:u.facebookConnection.isConnected||!1,facebookUser:u.facebookConnection.facebookUser}),u.facebookConnection.pages&&(De(u.facebookConnection.pages),console.log("âœ… Restored Facebook pages:",u.facebookConnection.pages.length)),u.facebookConnection.selectedPageId&&(bs(u.facebookConnection.selectedPageId),console.log("âœ… Restored selected page:",u.facebookConnection.selectedPageId)),u.facebookConnection.selectedLeadFormId&&(ws(u.facebookConnection.selectedLeadFormId),console.log("âœ… Restored selected lead form:",u.facebookConnection.selectedLeadFormId)),u.facebookConnection.leadForms&&(Ye(u.facebookConnection.leadForms),console.log("âœ… Restored lead forms:",u.facebookConnection.leadForms.length)),console.log("ðŸŽ‰ Facebook connection restoration completed")},100))}catch(u){console.error("Error parsing webhook metadata:",u)}ps(new Date(s.updated_at||s.created_at))}else Z(!1),J(!1)},[s]),l.useEffect(()=>{(async()=>{try{console.log("ðŸ” Checking Gmail connection status...");const a=await z.get("/api/gmail/auth/status");console.log("ðŸ“§ Gmail status response:",a.data),a.data.success&&a.data.data.isConnected?(console.log("âœ… Gmail account exists for user (global status)"),P("connected")):(console.log("âŒ Gmail is not connected"),P("disconnected"))}catch(a){console.error("Error checking Gmail status:",a),P("disconnected")}})()},[]),l.useEffect(()=>{const t=a=>{var b;const g=[window.location.origin,"https://ai.research-hero.com","http://localhost:5173","http://localhost:5174","https://ai.research-hero.com"],f=a.origin.includes("localhost")||a.origin==="null";if(!(g.includes(a.origin)||f)){console.warn("ðŸš« Ignoring message from unauthorized origin:",a.origin);return}if(console.log("ðŸ“¨ Received popup message:",a.data),a.data.type==="GMAIL_AUTH_SUCCESS")console.log("ðŸŽ‰ Gmail OAuth success received from popup"),Xs(a.data.data),D(!1),h.success("Gmail connected successfully!");else if(a.data.type==="GMAIL_AUTH_ERROR")console.error("âŒ Gmail OAuth error received from popup:",a.data.message),P("disconnected"),D(!1),h.error(`Gmail connection failed: ${a.data.message}`);else if(a.data.type==="facebook_oauth_success"){console.log("ðŸŽ‰ Facebook OAuth success received from popup");const k=(b=a.data.data)==null?void 0:b.facebookUser;console.log("ðŸ‘¤ [WebhookCreator] Facebook user data:",k),k&&(console.log("ðŸ“ [WebhookCreator] Storing in session storage for webhook creation"),sessionStorage.setItem("temp_facebook_user",JSON.stringify(k)),sessionStorage.setItem("temp_facebook_connected","true"),console.log("âœ… [WebhookCreator] Session storage updated:",{temp_facebook_connected:sessionStorage.getItem("temp_facebook_connected"),temp_facebook_user:!!sessionStorage.getItem("temp_facebook_user")})),ke({isConnected:!0,facebookUser:k}),console.log("âœ… Facebook connection status updated:",{isConnected:!0,facebookUser:k}),As().then(async()=>{h.success("Facebook Lead Ads connected successfully!"),console.log("ðŸ”„ Triggering auto-save after Facebook connection..."),await be(),console.log("âœ… Auto-save triggered after Facebook connection"),setTimeout(async()=>{try{(re||s&&(s.webhook_id||s.id))&&(console.log("ðŸ” Verifying Facebook connection was saved..."),await As())}catch(T){console.error("Failed to verify Facebook connection persistence:",T)}},3e3)}).catch(T=>{console.error("Post-OAuth refresh failed",T),h.error("Failed to refresh Facebook connection status")})}else a.data.type==="facebook_oauth_error"&&(console.error("âŒ Facebook OAuth error received from popup:",a.data.message),h.error(`Facebook connection failed: ${a.data.message||"Unknown error"}`))};return window.addEventListener("message",t),()=>window.removeEventListener("message",t)},[]),l.useEffect(()=>{const t=V.get("gmail_success"),a=V.get("gmail_error"),g=V.get("email"),f=V.get("card_id"),u=V.get("tempId"),b=V.get("return_to_workflow");if(console.log("ðŸ” Gmail OAuth callback parameters:",{gmailSuccess:t,gmailError:a,email:g,cardId:f,tempId:u,returnToWorkflow:b,webhook:(s==null?void 0:s.id)||(s==null?void 0:s.webhook_id),actionCards:A.length}),t==="true"&&g){if(P("connected"),h.success(`Gmail account connected successfully! (${decodeURIComponent(g)})`),f){const T=parseInt(f);console.log("Updating specific Gmail card with ID:",T),H(ne=>ne.map(X=>{var le;return X.id===T&&((le=X.selectedApp)==null?void 0:le.id)==="gmail-service"?{...X,isConnected:!0}:X})),D(!1)}else console.log("No card ID found; leaving action cards unchanged"),D(!1);if(Q&&K(!1),s&&(s.webhook_id||s.id)){const T=s.webhook_id||s.id;console.log("Updating webhook in database with Gmail connection status:",T);const ne={name:F,description:(m==null?void 0:m.description)||"",trigger_event:m==null?void 0:m.id,trigger_app:(r==null?void 0:r.id)||"webhook",isActive:oe,metadata:JSON.stringify({actionCards:A.map(X=>{var le;return{id:X.id,selectedApp:X.selectedApp,selectedEvent:X.selectedEvent,isConnected:((le=X.selectedApp)==null?void 0:le.id)==="gmail-service"?!0:X.isConnected,selectedListId:X.selectedListId,campaignConfig:X.campaignConfig,textConfig:X.textConfig,gmailConfig:X.gmailConfig}})})};z.put(`/api/webhooks/${T}`,ne).then(X=>{console.log("âœ… Updated webhook with Gmail connection status:",X.data)}).catch(X=>{console.error("âŒ Failed to update webhook with Gmail connection status:",X)})}const k=new URLSearchParams(V);k.delete("gmail_success"),k.delete("gmail_error"),k.delete("email"),x(k)}else if(a){const k=decodeURIComponent(a);if(P("disconnected"),h.error(`Gmail connection failed: ${k}`),f){const ne=parseInt(f);console.log("Updating specific Gmail card with ID:",ne),H(X=>X.map(le=>{var Pe;return le.id===ne&&((Pe=le.selectedApp)==null?void 0:Pe.id)==="gmail-service"?{...le,isConnected:!1}:le}))}else console.log("No card ID found; leaving action cards unchanged");const T=new URLSearchParams(V);T.delete("gmail_success"),T.delete("gmail_error"),T.delete("email"),x(T)}},[V,x,Q]),l.useEffect(()=>{if(s&&We&&A.length===0){let t=!1;if(s.metadata)try{const a=typeof s.metadata=="string"?JSON.parse(s.metadata):s.metadata;t=a.actionCards&&a.actionCards.length>0}catch{t=!1}if(!t){const a={id:Date.now(),isExpanded:!0,selectedApp:null,selectedEvent:null,searchQuery:"",isConnected:!1};H([a])}}},[s,We]),l.useEffect(()=>()=>{se&&clearTimeout(se),me&&clearInterval(me)},[se,me]);const Xs=async t=>{console.log("ðŸŽ‰ Gmail OAuth success in WebhookCreator:",t),P("connected");try{const a=await z.get("/api/gmail/auth/status");a.data.success&&a.data.data.isConnected&&(console.log("âœ… Gmail status confirmed from backend:",a.data.data),Q&&H(g=>g.map(f=>{var u;return f.id===Q&&((u=f.selectedApp)==null?void 0:u.id)==="gmail-service"?{...f,isConnected:!0}:f})),We&&be())}catch(a){console.error("Error re-checking Gmail status:",a)}console.log("âœ… Gmail connection status updated successfully")},[re,Ys]=l.useState(null),Fs=async()=>{var t,a,g;try{if(console.log("ðŸ”§ ensureWebhookRecord called with:",{webhookCreated:C,currentWebhookId:re,workflowTitle:F,selectedTrigger:m==null?void 0:m.id,selectedApp:r==null?void 0:r.id,webhookUrl:p}),C||re){console.log("ðŸ”§ Webhook already exists, skipping creation");return}if(!F||!F.trim()){console.log("ðŸ”§ No workflow title, skipping webhook creation");return}if(!(m!=null&&m.id)){console.log("ðŸ”§ No trigger selected, skipping webhook creation");return}const f=(r==null?void 0:r.id)==="facebook-lead-ads";if(!p&&!f){console.log("ðŸ”§ No webhook URL and not Facebook Lead Ads, skipping webhook creation");return}const u={name:F,trigger_event:m.id,trigger_app:(r==null?void 0:r.id)||"webhook",description:m.description,url:p||"",is_active:!1};console.log("ðŸ”§ Creating webhook with payload:",u);const b=await z.post("/api/webhooks",u);if(console.log("ðŸ”§ Webhook creation response:",b.data),(t=b.data)!=null&&t.success){const k=((a=b.data.data)==null?void 0:a.id)||((g=b.data.data)==null?void 0:g.webhook_id);if(k&&(console.log("âœ… Webhook created successfully with ID:",k),Ys(k),Re(!0),Z(!0),ps(new Date),console.log("âœ… Draft webhook created for autosave:",k),(r==null?void 0:r.id)==="facebook-lead-ads")){const T=sessionStorage.getItem("temp_facebook_connected"),ne=sessionStorage.getItem("temp_facebook_user");T==="true"&&ne&&(localStorage.setItem(`facebook_connected_${k}`,"true"),localStorage.setItem(`facebook_user_${k}`,ne),console.log("âœ… Transferred temporary Facebook connection to webhook:",k))}}}catch(f){console.error("Failed to ensure webhook record (draft):",f)}};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(W,{variant:"ghost",onClick:()=>{localStorage.removeItem("webhook_creator_state"),i()},className:"h-10 px-3 rounded-lg hover:bg-white/50",children:[e.jsx(Ea,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{value:F,onChange:t=>{B(t.target.value),be()},className:"text-xl font-semibold border-none bg-transparent p-0 h-auto focus-visible:ring-0"}),e.jsx("div",{className:"flex items-center gap-2",children:Ge?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-600",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Saving..."})]}):ee?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Auto-save ON"})]}):Ie?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-500 rounded-full"}),e.jsxs("span",{children:["Saved ",Ie.toLocaleTimeString()]})]}):null}),e.jsx(Je,{className:"h-5 w-5 text-gray-400"})]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"OFF"}),e.jsx("div",{className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors cursor-pointer ${oe?"bg-blue-600":"bg-gray-300"} ${Y?"opacity-50 cursor-not-allowed":""}`,onClick:()=>{if(!Y){if(!m&&!oe){h.error("Please select a trigger event first");return}if(!F.trim()&&!oe){h.error("Please enter a workflow name first");return}ja(!oe)}},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${oe?"translate-x-6":"translate-x-1"}`})}),e.jsx("span",{className:"text-sm text-blue-600 font-medium",children:"ON"})]}),A.length>1&&e.jsx(W,{onClick:ba,variant:"outline",size:"sm",className:"ml-4 text-xs px-3 py-1 h-8 border-orange-200 text-orange-600 hover:bg-orange-50",children:"ðŸ§¹ Clean Duplicates"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm",children:[e.jsx("div",{className:`p-6 cursor-pointer transition-all duration-200 ${ae?"border-b border-gray-200":""}`,onClick:()=>J(!ae),children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-purple-100 rounded-xl",children:e.jsx(Xe,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-sm text-gray-500",children:"Trigger : When this happens ..."})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"1. Choose Your First Application : Trigger"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(is,{variant:"secondary",className:"bg-green-100 text-green-700 hover:bg-green-100",children:"Free Task"}),e.jsx("div",{className:"h-5 w-5 text-gray-300 cursor-not-allowed",title:"Trigger card cannot be deleted",children:e.jsx(Je,{className:"h-5 w-5"})}),e.jsx(Gt,{className:`h-5 w-5 text-gray-400 transition-transform ${ae?"rotate-180":""}`})]})]})}),ae&&e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Choose App"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ps,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx($,{placeholder:"Search apps or type / and describe your task...",value:O,onChange:t=>U(t.target.value),className:"pl-12 h-12 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-4",children:[e.jsxs("div",{className:`flex flex-col items-center p-4 border rounded-lg cursor-pointer transition-all ${(r==null?void 0:r.id)==="webhook"?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-purple-300 hover:bg-purple-50"}`,onClick:()=>Hs(ge[0]),children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-2",children:typeof((Vs=ge[0])==null?void 0:Vs.icon)=="string"?e.jsx("span",{className:"text-lg",children:ge[0].icon}):typeof((zs=ge[0])==null?void 0:zs.icon)=="function"?ge[0].icon():e.jsx(Xe,{className:"h-6 w-6 text-purple-600"})}),e.jsx("span",{className:"text-sm font-medium text-center",children:"Webhook"})]}),e.jsxs("div",{className:`flex flex-col items-center p-4 border rounded-lg cursor-pointer transition-all ${(r==null?void 0:r.id)==="facebook-lead-ads"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300 hover:bg-blue-50"}`,onClick:()=>Hs(ge[2]),children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-2",children:typeof((Js=ge[2])==null?void 0:Js.icon)=="string"?e.jsx("span",{className:"text-lg",children:ge[2].icon}):typeof((Ks=ge[2])==null?void 0:Ks.icon)=="function"?ge[2].icon():e.jsx("img",{src:Kt,alt:"Facebook",className:"h-6 w-6"})}),e.jsx("span",{className:"text-sm font-medium text-center",children:"Facebook Lead Ads"})]})]})]}),r&&(r.id==="webhook"||r.id==="facebook-lead-ads")&&e.jsx("div",{className:"space-y-4 border-t pt-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Trigger Event"}),e.jsxs(we,{value:m==null?void 0:m.id,onValueChange:t=>{const a=Qs().find(g=>g.id===t);a&&(R(a),wa(a))},children:[e.jsx(ve,{className:"w-full h-12 px-4 rounded-md border border-gray-300 bg-white text-sm text-gray-900 font-medium shadow-sm hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition",children:e.jsx(He,{placeholder:"Select a trigger event"})}),e.jsx(je,{className:"rounded-md border border-gray-200 bg-white shadow-lg max-h-72 overflow-y-auto",children:Qs().map(t=>e.jsx(te,{value:t.id,className:"p-3 cursor-pointer hover:bg-blue-50 focus:bg-blue-50 rounded-sm transition",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.name}),e.jsx("span",{className:"text-xs text-gray-500",children:t.description})]})},t.id))})]})]})}),m&&(r==null?void 0:r.id)==="facebook-lead-ads"&&e.jsxs("div",{className:"space-y-4 border-t pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-sm text-blue-800",children:"Select event then connect your Facebook Lead Ads account to complete setup."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{onClick:()=>{if(console.log("ðŸ” Main Connect button - Webhook toggle check:",{workflowEnabled:oe}),!oe){h.error("First ON the Toggle");return}Ws(!0)},className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:"Connect"}),Le.isConnected&&e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-green-100 rounded-lg",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}),Le.isConnected&&e.jsxs("div",{className:"space-y-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsxs("span",{className:"text-sm font-medium text-green-800",children:["Connected as ",((qs=Le.facebookUser)==null?void 0:qs.name)||"Facebook User"]})]}),es.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"text-sm font-medium text-gray-700",children:"Select Facebook Page"}),e.jsxs("select",{value:ts,onChange:t=>pa(t.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Choose a page..."}),es.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),ts&&ss.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"text-sm font-medium text-gray-700",children:"Select Lead Form"}),e.jsxs("select",{value:Ms,onChange:t=>{ws(t.target.value),be()},className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Choose a lead form..."}),ss.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),ts&&ss.length===0&&e.jsx("div",{className:"text-sm text-gray-600",children:"No lead forms found for this page."})]})]}),m&&(r==null?void 0:r.id)==="email-parser"&&e.jsx("div",{className:"space-y-4 border-t pt-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900",children:"Email Parser Address"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${C?"bg-green-500":"bg-yellow-500"}`}),e.jsx("span",{className:`text-xs font-medium ${C?"text-green-700":"text-yellow-700"}`,children:C?"Active":"Toggle ON to Activate"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{value:p||"Select a trigger event to generate email address...",readOnly:!0,className:"flex-1 h-12 border border-gray-300 rounded-lg bg-gray-50 font-mono text-sm"}),e.jsx(W,{variant:"outline",size:"sm",onClick:()=>{p?(navigator.clipboard.writeText(p),h.success("Email address copied to clipboard!")):h.error("Please select a trigger event first")},className:"h-12 px-4 bg-blue-600 text-white hover:bg-blue-700",children:"Copy"})]}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"You need to send or forward the email to the above-mentioned email parser address and we will fetch all the details from that email."}),e.jsxs("div",{className:"bg-blue-100 border-l-4 border-blue-500 p-3 mt-3",children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Important Note:"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Please note that we can fetch attachments up to 5MB, and each workflow has a unique Email Parser address. Attachments will be stored for 48 hours. You can also use the Text Formatter > Text Parser Module to extract specific text from the email body."})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Simple Response"}),e.jsxs("div",{className:"relative inline-block w-12 h-6",children:[e.jsx("input",{type:"checkbox",className:"sr-only",checked:!0,readOnly:!0}),e.jsx("div",{className:"block bg-blue-600 w-12 h-6 rounded-full"}),e.jsx("div",{className:"dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition transform translate-x-6"})]})]}),e.jsx(W,{variant:"outline",className:"mt-4 w-full h-12 border-2 border-blue-600 text-blue-600 hover:bg-blue-50",children:"Capture Email Parser Response"})]})}),m&&(r==null?void 0:r.id)==="webhook"&&e.jsxs("div",{className:"space-y-4 border-t pt-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900",children:"Webhook URL"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${C?"bg-green-500":"bg-yellow-500"}`}),e.jsx("span",{className:`text-xs font-medium ${C?"text-green-700":"text-yellow-700"}`,children:C?"Active in Database":"Not Saved - Toggle ON to Activate"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{value:p||"Select a trigger event to generate webhook URL...",readOnly:!0,className:"flex-1 h-12 border border-gray-300 rounded-lg bg-gray-50 font-mono text-sm"}),e.jsx(W,{variant:"outline",size:"sm",onClick:()=>{p?(navigator.clipboard.writeText(p),h.success("Webhook URL copied to clipboard!")):h.error("Please select a trigger event first")},disabled:!p,className:"h-12 px-4 bg-blue-600 text-white hover:bg-blue-700 border-blue-600 disabled:bg-gray-400",children:"Copy"}),e.jsx(W,{variant:"outline",size:"sm",onClick:async()=>{var t,a;if(!p){h.error("Please select a trigger event first");return}try{const g=p.split("/").pop();(await z.post(`/api/webhook-data/test/${g}`)).data.success?h.success("Test webhook sent successfully! Check your Gmail for the test email."):h.error("Failed to send test webhook")}catch(g){console.error("Test webhook error:",g),h.error(((a=(t=g.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to send test webhook")}},disabled:!p||!C,className:"h-12 px-4 bg-green-600 text-white hover:bg-green-700 border-green-600 disabled:bg-gray-400",children:"Test"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Follow the steps below:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600",children:[e.jsx("li",{children:"â€¢ Log in to the application where you want to enter the webhook URL."}),e.jsx("li",{children:"â€¢ Copy the webhook URL and add it under the webhook section of the application."}),e.jsx("li",{children:'â€¢ Click on the below "Capture Webhook Response" button and do a test record so that the webhook response can be captured here.'})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 font-medium",children:"Important Note:"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"The webhook URL is unique for every workflow. Toggle the workflow ON to activate and save it to the database. Only active webhooks will receive and process incoming requests."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Simple Response"}),e.jsx("div",{className:"relative inline-flex h-6 w-11 items-center rounded-full bg-blue-600",children:e.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white translate-x-6"})})]}),e.jsxs(W,{onClick:va,disabled:!p,className:"w-full h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:bg-gray-400",children:[y?e.jsx(Ue,{className:"h-4 w-4 animate-spin mr-2"}):null,y?"Stop Capturing":"Capture Webhook Response"]}),c&&e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Captured Webhook Data"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Data received at ",new Date().toLocaleString()]})]}),e.jsx(is,{variant:"secondary",className:"bg-green-100 text-green-800",children:"âœ“ Captured"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-100 px-4 py-2 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm font-medium text-gray-700",children:[e.jsx("span",{children:"Label"}),e.jsx("span",{children:"Value"})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:Object.entries(c).map(([t,a])=>e.jsxs("div",{className:"grid grid-cols-2 gap-4 px-4 py-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 bg-gray-100 px-3 py-2 rounded border",children:t}),e.jsx("div",{className:"text-sm text-gray-700 bg-gray-100 px-3 py-2 rounded border min-h-[40px] flex items-center",children:typeof a=="object"?JSON.stringify(a,null,2):String(a)})]},t))})]})]})]})]}),!1]})]}),m&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-px h-8 bg-gray-300"}),e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-700 transition-colors shadow-lg",onClick:as,children:e.jsx(ns,{className:"h-6 w-6 text-white"})}),e.jsx("div",{className:"w-px h-8 bg-gray-300"})]})}),A.map((t,a)=>{var g,f,u,b,k,T,ne,X,le,Pe,tt,at,ot,rt,nt,lt,ct,it,dt,mt,gt,ut,ht,ft,pt,xt;return e.jsxs(Os.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm",children:[e.jsx("div",{className:`p-6 cursor-pointer transition-all duration-200 ${t.isExpanded?"border-b border-gray-200":""}`,onClick:()=>Ae(t.id,{isExpanded:!t.isExpanded}),children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-green-100 rounded-xl",children:e.jsx(Ia,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-sm text-gray-500",children:"Action : Do this ..."})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.selectedApp?`${a+2}. ${t.selectedApp.name} : ${((g=t.selectedEvent)==null?void 0:g.name)||"Action"}`:`${a+2}. Choose Your Next Application : Action`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(sa,{children:[e.jsx(ta,{asChild:!0,children:e.jsx("button",{className:"h-5 w-5 text-gray-400 hover:text-gray-600 transition-colors",onClick:n=>n.stopPropagation(),children:e.jsx(Je,{className:"h-5 w-5"})})}),e.jsx(aa,{align:"end",className:"w-48",children:e.jsxs(ls,{onClick:n=>{n.stopPropagation(),xa(t.id),h.success("Action card removed successfully")},className:"flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:text-red-700 hover:bg-red-50 cursor-pointer",children:[e.jsx($t,{className:"h-4 w-4"}),"Delete Action"]})})]}),e.jsx(Gt,{className:`h-5 w-5 text-gray-400 transition-transform ${t.isExpanded?"rotate-180":""}`})]})]})}),t.isExpanded&&e.jsx("div",{className:"p-6 space-y-6",children:t.selectedApp?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`w-8 h-8 ${t.selectedApp.color} rounded-lg flex items-center justify-center`,children:typeof((f=t.selectedApp)==null?void 0:f.icon)=="string"?e.jsx("span",{className:"text-lg",children:t.selectedApp.icon}):typeof((u=t.selectedApp)==null?void 0:u.icon)=="function"?t.selectedApp.icon():e.jsx("div",{className:"h-5 w-5 bg-gray-400 rounded"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900",children:[a+2,". ",t.selectedApp.name," :"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Action : Do this ..."})]}),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:e.jsx(Je,{className:"h-5 w-5 text-gray-400"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Selected App"}),e.jsxs("div",{className:"w-full h-14 border border-gray-300 rounded-lg px-4 flex items-center gap-3 shadow-sm bg-white",children:[e.jsx("div",{className:`w-9 h-9 ${t.selectedApp.color} rounded-md flex items-center justify-center text-white text-sm font-medium shadow`,children:typeof((b=t.selectedApp)==null?void 0:b.icon)=="string"?e.jsx("span",{children:t.selectedApp.icon}):typeof((k=t.selectedApp)==null?void 0:k.icon)=="function"?t.selectedApp.icon():e.jsx("div",{className:"h-4 w-4 bg-gray-400 rounded"})}),e.jsx("span",{className:"text-gray-900 font-medium truncate",children:t.selectedApp.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Action Event"}),e.jsxs(we,{value:(T=t.selectedEvent)==null?void 0:T.id,onValueChange:n=>{var fe,ye,Se;const ce=(ye=(fe=t.selectedApp)==null?void 0:fe.events)==null?void 0:ye.find(ie=>ie.id===n);if(ce&&(Ae(t.id,{selectedEvent:ce}),((Se=t.selectedApp)==null?void 0:Se.id)==="gmail-service")){let ie="send";switch(n){case"send-email":ie="send";break;case"create-draft":ie="draft";break;case"reply-to-email":ie="reply";break;case"star-email":ie="star";break;case"trash-email":ie="trash";break;case"forward-email":case"add-label":case"mark-as-read":case"mark-as-unread":case"archive-email":case"delete-email":case"search-emails":default:ie="send"}he(t.id,"action",ie)}},children:[e.jsx(ve,{className:"w-full h-12 px-4 rounded-md border border-gray-300 bg-white text-sm text-gray-900 font-medium shadow-sm hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition",children:e.jsx(He,{placeholder:"Select an action event"})}),e.jsx(je,{className:"rounded-md border border-gray-200 bg-white shadow-lg max-h-72 overflow-y-auto",children:(ne=t.selectedApp.events)==null?void 0:ne.map(n=>e.jsx(te,{value:n.id,className:"p-3 cursor-pointer hover:bg-blue-50 focus:bg-blue-50 rounded-sm transition",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.name}),e.jsx("span",{className:"text-xs text-gray-500",children:n.description})]})},n.id))})]})]}),t.selectedEvent&&e.jsxs("div",{className:"pt-4",children:[t.isConnected?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium text-green-800",children:"Connected"})]}),e.jsx(W,{onClick:async()=>{var n;((n=t.selectedApp)==null?void 0:n.id)==="lists"&&await ks(),K(!0),M(t.id)},variant:"outline",className:"w-full h-12 border border-gray-300 rounded-lg",children:"Reconfigure"})]}):e.jsx(W,{onClick:async()=>{var n,ce,fe,ye,Se,ie;if(((n=t.selectedApp)==null?void 0:n.id)==="lists"&&await ks(),((ce=t.selectedApp)==null?void 0:ce.id)==="gmail-service"){if(t.isConnected){h.success("Gmail already connected for this action");return}try{const Ce=await z.get("/api/gmail/auth/url",{params:{redirectPath:"popup"}});if(!((fe=Ce.data)!=null&&fe.success)||!((Se=(ye=Ce.data)==null?void 0:ye.data)!=null&&Se.authUrl))throw new Error(((ie=Ce.data)==null?void 0:ie.message)||"Failed to generate Gmail OAuth URL");if(!window.open(Ce.data.data.authUrl,"gmail-oauth","width=600,height=700,scrollbars=yes,resizable=yes,status=yes,location=yes,toolbar=no,menubar=no")){h.error("Popup blocked. Please allow popups and try again.");return}P("connecting");const os=setInterval(async()=>{var wt,vt,jt,yt,Nt,kt,At,St,Ct,Ft,Et,It,Lt,Tt,Pt,Ot,Ut;try{const ze=await z.get("/api/gmail/auth/status");if((wt=ze.data)!=null&&wt.success&&((jt=(vt=ze.data)==null?void 0:vt.data)!=null&&jt.isConnected)){clearInterval(os),P("connected");const Rt=((kt=(Nt=(yt=ze.data)==null?void 0:yt.data)==null?void 0:Nt.profile)==null?void 0:kt.email)||((St=(At=ze.data)==null?void 0:At.data)==null?void 0:St.email)||"";Ae(t.id,{isConnected:!0,gmailConfig:{action:((Ct=t.gmailConfig)==null?void 0:Ct.action)||"send",fromEmail:Rt,to:((Ft=t.gmailConfig)==null?void 0:Ft.to)||"",cc:((Et=t.gmailConfig)==null?void 0:Et.cc)||"",bcc:((It=t.gmailConfig)==null?void 0:It.bcc)||"",subject:((Lt=t.gmailConfig)==null?void 0:Lt.subject)||"",body:((Tt=t.gmailConfig)==null?void 0:Tt.body)||"",isHtml:((Pt=t.gmailConfig)==null?void 0:Pt.isHtml)||!1,attachments:((Ot=t.gmailConfig)==null?void 0:Ot.attachments)||[],template:((Ut=t.gmailConfig)==null?void 0:Ut.template)||"default"}}),h.success(`Gmail connected successfully! From: ${Rt}`)}}catch{}},2e3);setTimeout(()=>{clearInterval(os),P("disconnected")},6e4)}catch(Ce){console.error("Error starting Gmail OAuth:",Ce),h.error("Failed to initiate Gmail OAuth")}return}K(!0),M(t.id)},disabled:((X=t.selectedApp)==null?void 0:X.id)==="gmail-service"&&w==="connecting",className:`w-full h-12 text-white rounded-lg ${((le=t.selectedApp)==null?void 0:le.id)==="gmail-service"&&t.isConnected?"bg-green-600 hover:bg-green-700":((Pe=t.selectedApp)==null?void 0:Pe.id)==="gmail-service"&&w==="connecting"?"bg-blue-400":"bg-blue-600 hover:bg-blue-700"}`,children:((tt=t.selectedApp)==null?void 0:tt.id)==="gmail-service"?e.jsx(e.Fragment,{children:w==="connecting"?e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"h-4 w-4 animate-spin mr-2"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),t.isConnected?"Gmail Connected âœ“":"Connect Gmail"]})}):"Connect"}),((at=t.selectedApp)==null?void 0:at.id)==="gmail-service"&&t.isConnected&&e.jsxs("div",{className:"mt-6 space-y-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Oe,{className:"h-5 w-5 text-red-600"}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Email Configuration"})]}),c&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-800 font-medium",children:"âœ“ Webhook Data Captured"}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Available fields: ",Object.keys(c).map(n=>`{{${n}}}`).join(", ")]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Click the [+] button next to any field to insert dynamic values."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"From (Connected Gmail)"}),e.jsx($,{value:((ot=t.gmailConfig)==null?void 0:ot.fromEmail)||"Connect Gmail first",readOnly:!0,className:"w-full h-10 mt-1 bg-gray-50 text-gray-600",placeholder:"Gmail will be set after connection"})]}),(((rt=t.gmailConfig)==null?void 0:rt.action)==="reply"||((nt=t.gmailConfig)==null?void 0:nt.action)==="star"||((lt=t.gmailConfig)==null?void 0:lt.action)==="trash")&&e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"Message ID"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{value:((ct=t.gmailConfig)==null?void 0:ct.messageId)||"",onChange:n=>he(t.id,"messageId",n.target.value),placeholder:"Message ID or {{messageId}}",className:"w-full h-10 mt-1"}),c&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsxs(we,{onValueChange:n=>he(t.id,"messageId",n),children:[e.jsx(ve,{className:"w-8 h-8 p-0 border-0 bg-transparent",children:e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-blue-600",children:"+"})})}),e.jsx(je,{children:Object.entries(c).map(([n,ce])=>e.jsxs(te,{value:`{{${n}}}`,children:[n,": ",String(ce).substring(0,30),"..."]},n))})]})})]})]}),(((it=t.gmailConfig)==null?void 0:it.action)==="send"||((dt=t.gmailConfig)==null?void 0:dt.action)==="draft"||((mt=t.gmailConfig)==null?void 0:mt.action)==="reply")&&e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"To"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{value:((gt=t.gmailConfig)==null?void 0:gt.to)||"",onChange:n=>he(t.id,"to",n.target.value),placeholder:"recipient@example.com or {{email}}",className:"w-full h-10 mt-1"}),c&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsxs(we,{onValueChange:n=>he(t.id,"to",n),children:[e.jsx(ve,{className:"w-8 h-8 p-0 border-0 bg-transparent",children:e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-blue-600",children:"+"})})}),e.jsx(je,{children:Object.keys(c).map(n=>e.jsxs(te,{value:`{{${n}}}`,children:[n,": ",String(c[n]).substring(0,30),"..."]},n))})]})})]})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"CC (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{value:((ut=t.gmailConfig)==null?void 0:ut.cc)||"",onChange:n=>he(t.id,"cc",n.target.value),placeholder:"cc@example.com or {{email}}",className:"w-full h-10 mt-1"}),c&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsxs(we,{onValueChange:n=>he(t.id,"cc",n),children:[e.jsx(ve,{className:"w-8 h-8 p-0 border-0 bg-transparent",children:e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-blue-600",children:"+"})})}),e.jsx(je,{children:Object.keys(c).map(n=>e.jsxs(te,{value:`{{${n}}}`,children:[n,": ",String(c[n]).substring(0,30),"..."]},n))})]})})]})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"BCC (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{value:((ht=t.gmailConfig)==null?void 0:ht.bcc)||"",onChange:n=>he(t.id,"bcc",n.target.value),placeholder:"bcc@example.com or {{email}}",className:"w-full h-10 mt-1"}),c&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsxs(we,{onValueChange:n=>he(t.id,"bcc",n),children:[e.jsx(ve,{className:"w-8 h-8 p-0 border-0 bg-transparent",children:e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-blue-600",children:"+"})})}),e.jsx(je,{children:Object.keys(c).map(n=>e.jsxs(te,{value:`{{${n}}}`,children:[n,": ",String(c[n]).substring(0,30),"..."]},n))})]})})]})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"Subject"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{value:((ft=t.gmailConfig)==null?void 0:ft.subject)||"",onChange:n=>he(t.id,"subject",n.target.value),placeholder:"Email subject or {{subject}}",className:"w-full h-10 mt-1"}),c&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsxs(we,{onValueChange:n=>he(t.id,"subject",n),children:[e.jsx(ve,{className:"w-8 h-8 p-0 border-0 bg-transparent",children:e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-blue-600",children:"+"})})}),e.jsx(je,{children:Object.keys(c).map(n=>e.jsxs(te,{value:`{{${n}}}`,children:[n,": ",String(c[n]).substring(0,30),"..."]},n))})]})})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"Body"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:((pt=t.gmailConfig)==null?void 0:pt.body)||"",onChange:n=>he(t.id,"body",n.target.value),placeholder:"Email body content or use dynamic fields like {{message}}",className:"w-full h-24 mt-1 px-3 py-2 border border-gray-300 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),c&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsxs(we,{onValueChange:n=>{var ce;return he(t.id,"body",(((ce=t.gmailConfig)==null?void 0:ce.body)||"")+n)},children:[e.jsx(ve,{className:"w-8 h-8 p-0 border-0 bg-transparent",children:e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-blue-600",children:"+"})})}),e.jsx(je,{children:Object.keys(c).map(n=>e.jsxs(te,{value:`{{${n}}}`,children:[n,": ",String(c[n]).substring(0,30),"..."]},n))})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`isHtml-${t.id}`,checked:((xt=t.gmailConfig)==null?void 0:xt.isHtml)||!1,onChange:n=>he(t.id,"isHtml",n.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx(q,{htmlFor:`isHtml-${t.id}`,className:"text-sm font-medium text-gray-900",children:"Send as HTML"})]}),e.jsx(W,{variant:"outline",size:"sm",onClick:async()=>{const n=t.gmailConfig;if(!(n!=null&&n.to)||!(n!=null&&n.subject)||!(n!=null&&n.body)){h.error("Please fill in To, Subject, and Body fields");return}h.promise(async()=>{const ce=(ye,Se)=>{if(!ye||typeof ye!="string")return ye;let ie=ye;return Se&&Object.keys(Se).forEach(Ce=>{const bt=`{{${Ce}}}`,os=Se[Ce];ie=ie.replace(new RegExp(bt.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),String(os))}),ie},fe={to:ce(n.to,c)||"",cc:ce(n.cc,c)||"",bcc:ce(n.bcc,c)||"",subject:ce(n.subject,c)||"",body:ce(n.body,c)||"",isHtml:n.isHtml||!1};if(!fe.to||fe.to.includes("{{")||fe.to.includes("}}"))throw c?new Error("To field contains unresolved placeholders. Check that the field names match your webhook data."):new Error("To field contains placeholders but no webhook data captured. Please capture webhook data first or use a static email address.");if(!fe.to||!fe.subject||!fe.body)throw new Error("To, Subject, and Body fields are required.");return await $a(fe)},{loading:"Sending test email...",success:"Test email sent successfully via Gmail!",error:"Failed to send test email"})},children:"Send Test Email"})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(W,{onClick:()=>{h.success("Gmail configuration saved successfully!"),be()},className:"w-full h-12 bg-green-600 hover:bg-green-700 text-white",children:"Save Gmail Configuration"})})]})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Choose App"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ps,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx($,{placeholder:"Search apps or type / and describe your task...",value:t.searchQuery,onChange:n=>Ae(t.id,{searchQuery:n.target.value}),className:"pl-12 h-12 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-4",children:ua.map(n=>e.jsxs("div",{className:"flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 cursor-pointer transition-all",onClick:()=>Ae(t.id,{selectedApp:n,isExpanded:!0}),children:[e.jsx("div",{className:`w-12 h-12 ${n.color} rounded-lg flex items-center justify-center mb-2`,children:typeof n.icon=="string"?e.jsx("span",{className:"text-lg",children:n.icon}):typeof n.icon=="function"?n.icon():e.jsx("div",{className:"h-6 w-6 bg-gray-400 rounded"})}),e.jsx("span",{className:"text-sm font-medium text-center",children:n.name})]},n.id))})]})})]}),a<A.length-1&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-px h-8 bg-gray-300"}),e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-700 transition-colors shadow-lg",onClick:as,children:e.jsx(ns,{className:"h-6 w-6 text-white"})}),e.jsx("div",{className:"w-px h-8 bg-gray-300"})]})})]},t.id)}),A.length>0&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-px h-8 bg-gray-300"}),e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-700 transition-colors shadow-lg",onClick:as,children:e.jsx(ns,{className:"h-6 w-6 text-white"})})]})})]}),e.jsx(Bt,{open:de,onOpenChange:K,children:e.jsxs(Qt,{side:"right",className:"sheet-half-width max-w-none p-6",style:{width:"50vw",maxWidth:"none",minWidth:"50vw"},children:[e.jsx(Ht,{children:e.jsx(Xt,{children:Q&&(($s=(Zs=A.find(t=>t.id===Q))==null?void 0:Zs.selectedApp)!=null&&$s.name)?`Configure ${(st=(et=A.find(t=>t.id===Q))==null?void 0:et.selectedApp)==null?void 0:st.name}`:"Configure Action"})}),e.jsx("div",{className:"mt-6 h-full overflow-y-auto",children:Q&&(()=>{const t=A.find(g=>g.id===Q),a=t==null?void 0:t.selectedApp;return(a==null?void 0:a.id)==="facebook-lead-ads"?null:(a==null?void 0:a.id)==="lists"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Lists Configuration"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Configure how webhook data will be stored in your contact lists."})]}),e.jsxs("div",{className:"space-y-4",children:[vs?e.jsxs("div",{className:"space-y-4 p-4 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Create New List"}),e.jsx(W,{variant:"ghost",size:"sm",onClick:()=>{js(!1),Ve({listName:"",description:"",type:"General"})},children:"Cancel"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"List Name *"}),e.jsx($,{value:Te.listName,onChange:g=>Ve(f=>({...f,listName:g.target.value})),placeholder:"Enter list name",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),e.jsx($,{value:Te.description,onChange:g=>Ve(f=>({...f,description:g.target.value})),placeholder:"Enter list description",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),e.jsxs(we,{value:Te.type,onValueChange:g=>Ve(f=>({...f,type:g})),children:[e.jsx(ve,{className:"w-full",children:e.jsx(He,{})}),e.jsxs(je,{children:[e.jsx(te,{value:"General",children:"General"}),e.jsx(te,{value:"Marketing",children:"Marketing"}),e.jsx(te,{value:"Sales",children:"Sales"}),e.jsx(te,{value:"Event",children:"Event"}),e.jsx(te,{value:"Customer",children:"Customer"})]})]})]}),e.jsx(W,{onClick:ha,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:"Create List"})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Select List"}),e.jsxs(we,{value:Me,onValueChange:g=>{g==="create-new"?js(!0):_s(g)},children:[e.jsx(ve,{className:"w-full h-12 border border-gray-300 rounded-lg",children:e.jsx(He,{placeholder:"Choose a list or create new..."})}),e.jsxs(je,{children:[pe&&pe.length>0?pe.map(g=>e.jsx(te,{value:g.id.toString(),className:"p-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:g.list_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[g.contactCount||0," contacts"]})]})},g.id)):e.jsx(te,{value:"no-lists",disabled:!0,className:"p-3",children:e.jsx("div",{className:"text-sm text-gray-500",children:"No lists available"})}),e.jsx(te,{value:"create-new",className:"p-3 border-t",children:e.jsx("div",{className:"font-medium text-blue-600",children:"+ Create New List"})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 mb-2",children:"Field Mapping"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Email"}),e.jsx("span",{className:"text-sm text-gray-500",children:"â†’ email"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Phone"}),e.jsx("span",{className:"text-sm text-gray-500",children:"â†’ phoneNumber"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Name"}),e.jsx("span",{className:"text-sm text-gray-500",children:"â†’ fullName"})]})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(W,{onClick:async()=>{var g,f,u;if(!Me&&!vs){h.error("Please select a list first");return}try{if(!C||!oe){h.error("Please activate the webhook first before configuring lists");return}if(p){const b=p.split("/").pop();if(!b)throw new Error("Invalid webhook URL - cannot extract webhook ID");console.log("ðŸ”§ Saving webhook configuration:",{webhookId:b,listId:Me,appType:"lists"});try{const k=await z.put(`/api/webhooks/${b}/config`,{listId:Me,appType:"lists"});console.log("âœ… Configuration save response:",k.data)}catch(k){if(((g=k.response)==null?void 0:g.status)===404){h.error("Webhook not found. Please toggle the webhook ON first to create it in the database.");return}throw k}}else throw new Error("No webhook URL available");Q&&Ae(Q,{isConnected:!0,selectedListId:Me}),h.success("Lists configuration saved!"),K(!1)}catch(b){console.error("Error saving webhook configuration:",b);const k=((u=(f=b.response)==null?void 0:f.data)==null?void 0:u.message)||b.message||"Failed to save configuration";h.error(k)}},className:"w-full h-12 bg-green-600 hover:bg-green-700 text-white rounded-lg",disabled:!Me&&!vs,children:"Save Configuration"})})]})]}):(a==null?void 0:a.id)==="facebook-lead-ads"?null:(a==null?void 0:a.id)==="text-webhook"?e.jsx(io,{initialConfig:t==null?void 0:t.textConfig,onCancel:()=>K(!1),onSave:async g=>{Q&&(Ae(Q,{isConnected:!0,textConfig:g}),be(),h.success("Text webhook configured"),K(!1))}}):(a==null?void 0:a.id)==="gmail-service"?e.jsxs("div",{className:"text-gray-600 text-center py-8",children:[e.jsx(Oe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"Gmail Configuration"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Gmail configuration is now available directly in the action card below the Connect Gmail button."})]}):(a==null?void 0:a.id)==="outbound-campaign"?e.jsx(so,{initialConfig:t==null?void 0:t.campaignConfig,onCancel:()=>K(!1),onSave:async g=>{var b,k;if(!Q)return;console.log("ðŸ”§ Saving campaign config:",g),console.log("ðŸ”§ Selected card for sidebar:",Q);const f=A.find(T=>T.id===Q),u=(k=(b=f==null?void 0:f.selectedApp)==null?void 0:b.events)==null?void 0:k.find(T=>T.id==="create-campaign");Ae(Q,{isConnected:!0,campaignConfig:g,selectedEvent:u||(f==null?void 0:f.selectedEvent)}),console.log("âœ… Campaign action card updated"),be(),h.success("Campaign action configured"),K(!1)}}):e.jsx("div",{className:"text-gray-600",children:"Select an app to configure."})})()})]})}),e.jsx(Bt,{open:ga,onOpenChange:Ws,children:e.jsxs(Qt,{side:"right",className:"sheet-half-width max-w-none p-6",style:{width:"50vw",maxWidth:"none",minWidth:"50vw"},children:[e.jsx(Ht,{children:e.jsx(Xt,{children:r!=null&&r.name?`Configure ${r.name}`:"Configure Trigger"})}),e.jsx("div",{className:"mt-6 h-full overflow-y-auto",children:(r==null?void 0:r.id)==="facebook-lead-ads"&&e.jsx(co,{webhookId:(s==null?void 0:s.webhook_id)||(s==null?void 0:s.id)||re,workflowEnabled:oe,onConnectionChange:async t=>{if(console.log("ðŸ”§ Facebook connection changed:",t),console.log("ðŸ”§ Current webhook IDs:",{"webhook?.webhook_id":s==null?void 0:s.webhook_id,"webhook?.id":s==null?void 0:s.id,currentWebhookId:re,final_webhookId:(s==null?void 0:s.webhook_id)||(s==null?void 0:s.id)||re}),t){const a=(s==null?void 0:s.webhook_id)||(s==null?void 0:s.id)||re;console.log("ðŸ”§ Loading Facebook connection status with webhookId:",a);const g=sessionStorage.getItem("temp_facebook_user");if(g)try{const f=JSON.parse(g);console.log("ðŸ“¦ Using temp Facebook user for main trigger area:",f),ke({isConnected:!0,facebookUser:f})}catch(f){console.error("âŒ Failed to parse temp Facebook user:",f),ke({isConnected:!0})}else ke({isConnected:!0});try{const f=await Ke();console.log("ðŸ“¦ Loaded pages for main trigger area:",f.length,"pages"),De(f)}catch(f){console.error("âŒ Failed to load pages for main trigger area:",f),De([])}}else ke({isConnected:!1}),De([]),Ye([]),bs(""),ws("")}})})]})}),e.jsx(eo,{isOpen:I,onClose:()=>D(!1),onSuccess:Xs})]})})},zo=()=>{const[s,o]=ea(),{user:i}=Ba(),d=(i==null?void 0:i.isSuperAdmin)||!1,[v,m]=l.useState("list"),[R,r]=l.useState(null),[S,O]=l.useState(""),[U,Y]=l.useState(!1),[j,p]=l.useState([]),[_,ae]=l.useState(!1),[J,A]=l.useState(""),[H,de]=l.useState(!1);l.useEffect(()=>{const c=s.get("view"),N=s.get("workflow"),w=s.get("tempId"),P=s.get("workflowId"),I=s.get("gmail_success"),D=s.get("gmail_error"),me=s.get("email"),L=s.get("card_id");if(console.log("ðŸ” URL State Check:",{view:c,workflow:N,tempId:w,workflowId:P,gmailSuccess:I,gmailError:D,email:me,cardId:L}),c==="creator"){N&&A(decodeURIComponent(N));const F=localStorage.getItem("current_workflow_state");if(F&&w)try{const B=JSON.parse(F);if(B.tempId===w){if(A(B.name),B.webhookId){const ee=new URLSearchParams(s);ee.set("id",B.webhookId.toString()),o(ee)}console.log("ðŸ”„ Restored workflow state:",B)}}catch(B){console.error("Error restoring workflow state:",B)}if(m("create"),I||D){const B=new URLSearchParams(s);B.delete("gmail_success"),B.delete("gmail_error"),B.delete("email"),o(B)}else if(P){const B=j.find(ee=>ee.id===parseInt(P));B&&(r(B),m("view"))}}},[s,o,j]),l.useEffect(()=>{const c=s.get("code"),N=s.get("state");c&&(async()=>{try{await Za(c,N||void 0);const w=new URLSearchParams(s);w.delete("code"),w.delete("state"),o(w)}catch{const P=new URLSearchParams(s);P.delete("code"),P.delete("state"),o(P)}})()},[s,o]),l.useEffect(()=>{if(!!s.get("view"))return;const N=w=>{const P=localStorage.getItem(w);if(!P)return!1;try{const I=JSON.parse(P);if(!I||!I.tempId)return!1;const D=new URLSearchParams(s);return D.set("view","creator"),I.name&&D.set("workflow",encodeURIComponent(I.name)),D.set("tempId",I.tempId),o(D),!0}catch{return!1}};N("current_workflow_state")||N("webhook_creator_state")},[]);const K=async(c=!1)=>{try{c&&Y(!0);const N=await z.get("/api/webhooks");N.data.success&&(console.log("Loaded webhooks:",N.data.data),N.data.data.length>0&&console.log("Sample webhook structure:",N.data.data[0]),p(N.data.data))}catch(N){console.error("Error loading webhooks:",N)}finally{c&&Y(!1)}},Q=async c=>{var N,w;try{Y(!0),console.log("Attempting to delete webhook with ID:",c);const P=await z.delete(`/api/webhooks/${c}`);if(P.data.success)h.success("Webhook deleted successfully!"),K(!0);else throw new Error(P.data.message||"Failed to delete webhook")}catch(P){console.error("Error deleting webhook:",P),console.error("Full error response:",P.response),h.error(((w=(N=P.response)==null?void 0:N.data)==null?void 0:w.message)||"Failed to delete webhook"),Y(!1)}},M=c=>{console.log("Viewing webhook:",c),r(c),m("view");const N=new URLSearchParams(s);N.set("workflowId",String(c.id)),N.set("view","view"),c.name&&N.set("workflow",encodeURIComponent(c.name)),o(N)},V=()=>{A(""),ae(!0)},x=async()=>{if(!J.trim()){h.error("Please enter a workflow name");return}de(!0);try{console.log("ðŸš€ Creating new workflow with name:",J);const c=`temp_${Date.now()}`;ae(!1),m("create"),o({view:"creator",workflow:encodeURIComponent(J),tempId:c}),localStorage.setItem("current_workflow_state",JSON.stringify({name:J,tempId:c,created:Date.now(),status:"creating"})),h.success(`Workflow "${J}" ready for configuration!`)}catch(c){console.error("Error creating workflow:",c),h.error("Failed to create workflow")}finally{de(!1)}};l.useEffect(()=>{const c=s.get("gmail_success"),N=s.get("gmail_error"),w=s.get("email");if(c==="true"&&w){h.success(`Gmail account connected successfully! (${decodeURIComponent(w)})`);const P=new URLSearchParams(s);P.delete("gmail_success"),P.delete("gmail_error"),P.delete("email"),o(P)}else if(N){const P=decodeURIComponent(N);h.error(`Gmail connection failed: ${P}`);const I=new URLSearchParams(s);I.delete("gmail_success"),I.delete("gmail_error"),I.delete("email"),o(I)}},[s,o]),l.useEffect(()=>{K(!0)},[]);const y=j.filter(c=>{var N,w;return((N=c.name)==null?void 0:N.toLowerCase().includes(S.toLowerCase()))||((w=c.trigger_type)==null?void 0:w.toLowerCase().includes(S.toLowerCase()))}),G=()=>{m("list"),o({}),localStorage.removeItem("current_workflow_state"),localStorage.removeItem("webhook_creator_state"),K(!0)};return v==="create"?e.jsx(qt,{workflowName:J,onBack:G,onSave:()=>{m("list"),K(!0)}}):v==="view"&&R?e.jsx(qt,{webhook:R,onBack:G,onSave:()=>{m("list"),K(!0)}}):e.jsxs(Ra,{children:[e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-blue-600 rounded-xl",children:e.jsx(Xe,{className:"h-6 w-6 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Webhook Workflows"})]}),e.jsx("p",{className:"text-gray-600 ml-16",children:"Manage your webhook automations and integrations"})]}),e.jsxs(W,{onClick:V,className:"h-12 px-6 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium",children:[e.jsx(ns,{className:"h-5 w-5 mr-2"}),"Create Workflow"]})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ps,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx($,{placeholder:"Search webhook workflows...",value:S,onChange:c=>O(c.target.value),className:"pl-10 h-10 w-80 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(W,{variant:"outline",size:"sm",className:"h-10 px-3 border-gray-300",children:[e.jsx(La,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs(W,{variant:"outline",size:"sm",className:"h-10 px-3 border-gray-300",children:[e.jsx(Ta,{className:"h-4 w-4 mr-2"}),"Export"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[U?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Ue,{className:"h-8 w-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading webhooks..."})]}):y.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gray-100 rounded-xl mb-4",children:e.jsx(Xe,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Webhook Workflows"}),e.jsx("p",{className:"text-gray-600 mb-6",children:S?"No workflows match your search criteria.":"Get started by creating your first webhook workflow."})]}):e.jsxs(Da,{children:[e.jsx(Ga,{children:e.jsxs(Mt,{className:"border-b border-gray-200",children:[e.jsx(_e,{className:"h-12 px-6 text-left text-sm font-semibold text-gray-900",children:"Workflow Name"}),e.jsx(_e,{className:"h-12 px-6 text-left text-sm font-semibold text-gray-900",children:"Trigger"}),d&&e.jsx(_e,{className:"h-12 px-6 text-left text-sm font-semibold text-gray-900",children:"User"}),e.jsx(_e,{className:"h-12 px-6 text-left text-sm font-semibold text-gray-900",children:"Status"}),e.jsx(_e,{className:"h-12 px-6 text-left text-sm font-semibold text-gray-900",children:"Created"}),e.jsx(_e,{className:"h-12 px-6 text-right text-sm font-semibold text-gray-900",children:"Actions"})]})}),e.jsx(Wa,{children:y.map(c=>e.jsxs(Mt,{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx(Be,{className:"h-16 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-blue-100 rounded-lg",children:e.jsx(Xe,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:c.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1"})]})]})}),e.jsx(Be,{className:"h-16 px-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-700",children:c.trigger_type||"Unknown trigger"})]})}),d&&e.jsx(Be,{className:"h-16 px-6",children:e.jsxs("div",{className:"text-sm text-gray-700",children:[c.username||c.email||`User ${c.user_id}`,c.first_name&&c.last_name&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[c.first_name," ",c.last_name]})]})}),e.jsx(Be,{className:"h-16 px-6",children:e.jsx(is,{variant:c.is_active?"default":"secondary",className:"px-3 py-1 text-xs font-medium",children:c.is_active?"active":"inactive"})}),e.jsx(Be,{className:"h-16 px-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Oa,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:new Date(c.created_at).toLocaleDateString()})]})}),e.jsx(Be,{className:"h-16 px-6",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(W,{variant:"ghost",size:"sm",onClick:()=>M(c),className:"h-8 px-3 text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-md",children:[e.jsx(Wt,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsxs(sa,{children:[e.jsx(ta,{asChild:!0,children:e.jsx(W,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-md",children:e.jsx(Je,{className:"h-4 w-4"})})}),e.jsxs(aa,{align:"end",className:"w-48",children:[e.jsxs(ls,{onClick:()=>M(c),className:"flex items-center gap-2 px-3 py-2 text-sm",children:[e.jsx(Wt,{className:"h-4 w-4"}),"View Details"]}),e.jsxs(ls,{onClick:()=>{c.url&&(navigator.clipboard.writeText(c.url),h.success("Webhook URL copied to clipboard!"))},className:"flex items-center gap-2 px-3 py-2 text-sm",children:[e.jsx(Ua,{className:"h-4 w-4"}),"Copy URL"]}),e.jsxs(ls,{onClick:()=>Q(c.webhook_id||c.id),disabled:U,className:"flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:text-red-700 hover:bg-red-50",children:[U?e.jsx(Ue,{className:"h-4 w-4 animate-spin"}):e.jsx($t,{className:"h-4 w-4"}),"Delete"]})]})]})]})})]},c.id))})]}),!U&&y.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",y.length," of ",j.length," webhook",j.length!==1?"s":""]}),e.jsx("div",{className:"text-sm text-gray-500",children:S&&`Filtered by: "${S}"`})]})]})]})}),e.jsx(oa,{open:_,onOpenChange:ae,children:e.jsxs(ra,{className:"sm:max-w-md",children:[e.jsx(na,{children:e.jsx(la,{className:"text-xl font-semibold text-gray-900",children:"Create New Workflow"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Workflow Name"}),e.jsx($,{value:J,onChange:c=>A(c.target.value),placeholder:"Enter workflow name...",className:"w-full h-12 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500",onKeyDown:c=>{c.key==="Enter"&&x()}})]})}),e.jsxs(_a,{className:"flex gap-3",children:[e.jsx(W,{variant:"outline",onClick:()=>ae(!1),className:"flex-1 h-12 border border-gray-300 rounded-lg",children:"Cancel"}),e.jsxs(W,{onClick:x,disabled:H||!J.trim(),className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:bg-gray-400",children:[H?e.jsx(Ue,{className:"h-4 w-4 animate-spin mr-2"}):null,"Save"]})]})]})})]})};export{zo as default};
//# sourceMappingURL=Webhooks-DlrVYH6n.js.map
