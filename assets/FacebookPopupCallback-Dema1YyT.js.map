{"version":3,"file":"FacebookPopupCallback-Dema1YyT.js","sources":["../../src/pages/auth/FacebookPopupCallback.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport { toast } from 'sonner';\r\n\r\nconst FacebookPopupCallback: React.FC = () => {\r\n  const [searchParams] = useSearchParams();\r\n  const [status, setStatus] = useState<'loading' | 'success' | 'error'>('loading');\r\n  const [message, setMessage] = useState('Processing Facebook authentication...');\r\n\r\n  useEffect(() => {\r\n    const handleCallback = async () => {\r\n      try {\r\n        console.log('üöÄ FacebookPopupCallback component loaded!');\r\n        console.log('üîç Current URL:', window.location.href);\r\n        console.log('üîç Search params:', window.location.search);\r\n        console.log('üîç Hash:', window.location.hash);\r\n\r\n        // Add visual indicator that callback was reached\r\n        document.title = 'Facebook OAuth Callback - Processing...';\r\n\r\n        const success = searchParams.get('success');\r\n        const name = searchParams.get('name');\r\n        const email = searchParams.get('email');\r\n        const id = searchParams.get('id');\r\n        const error = searchParams.get('error');\r\n\r\n        console.log('üîç Facebook popup callback parameters:', { success, name, email, id, error });\r\n        console.log('üîç All search params:', Object.fromEntries(searchParams.entries()));\r\n\r\n        if (success === 'true' && (name || email)) {\r\n          setStatus('success');\r\n          setMessage('Facebook Lead Ads connected successfully!');\r\n\r\n          console.log('üéâ Facebook OAuth success in popup, notifying parent window');\r\n\r\n          // Notify parent window of success\r\n          console.log('üîç Checking parent window...', {\r\n            hasOpener: !!window.opener,\r\n            openerClosed: window.opener?.closed,\r\n            origin: window.location.origin\r\n          });\r\n\r\n          if (window.opener && !window.opener.closed) {\r\n            console.log('üì§ Sending Facebook success message to parent window');\r\n            const message = {\r\n              type: 'facebook_oauth_success',\r\n              data: {\r\n                isConnected: true,\r\n                facebookUser: {\r\n                  name: decodeURIComponent(name || 'Facebook User'),\r\n                  email: decodeURIComponent(email || ''),\r\n                  id: decodeURIComponent(id || 'facebook_user') // Use real Facebook user ID\r\n                }\r\n              }\r\n            };\r\n            console.log('üì§ Message being sent:', message);\r\n\r\n            try {\r\n              // Try sending to multiple possible origins\r\n              const possibleOrigins = [\r\n                window.location.origin,\r\n                'http://localhost:5173',\r\n                'http://localhost:5174',\r\n                'https://ai.research-hero.com',\r\n                '*' // Fallback - less secure but works for development\r\n              ];\r\n\r\n              for (const origin of possibleOrigins) {\r\n                try {\r\n                  window.opener.postMessage(message, origin);\r\n                  console.log(`‚úÖ Message sent successfully to parent window with origin: ${origin}`);\r\n                } catch (originError) {\r\n                  console.log(`‚ö†Ô∏è Failed to send message with origin ${origin}:`, originError);\r\n                }\r\n              }\r\n            } catch (error) {\r\n              console.error('‚ùå Error sending message to parent:', error);\r\n            }\r\n\r\n            // Close popup after a short delay to allow parent to process\r\n            setTimeout(() => {\r\n              console.log('üîí Closing Facebook popup window');\r\n              window.close();\r\n            }, 1500);\r\n          } else {\r\n            console.log('‚ö†Ô∏è No parent window found, closing popup');\r\n            console.log('üîç Window opener details:', {\r\n              opener: window.opener,\r\n              openerClosed: window.opener?.closed,\r\n              openerOrigin: window.opener?.location?.origin\r\n            });\r\n            // If no opener, try to close anyway\r\n            setTimeout(() => {\r\n              window.close();\r\n            }, 2000);\r\n          }\r\n        } else if (error) {\r\n          setStatus('error');\r\n          setMessage(`Authentication failed: ${decodeURIComponent(error)}`);\r\n          // Notify parent window of error\r\n          if (window.opener && !window.opener.closed) {\r\n            window.opener.postMessage({\r\n              type: 'facebook_oauth_error',\r\n              message: decodeURIComponent(error)\r\n            }, window.location.origin);\r\n            setTimeout(() => {\r\n              window.close();\r\n            }, 3000);\r\n          } else {\r\n            setTimeout(() => {\r\n              window.close();\r\n            }, 3000);\r\n          }\r\n        } else {\r\n          setStatus('error');\r\n          setMessage('Invalid callback parameters');\r\n          setTimeout(() => {\r\n            window.close();\r\n          }, 3000);\r\n        }\r\n      } catch (error) {\r\n        setStatus('error');\r\n        setMessage('An unexpected error occurred');\r\n        setTimeout(() => {\r\n          window.close();\r\n        }, 3000);\r\n      }\r\n    };\r\n    handleCallback();\r\n  }, [searchParams]);\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\r\n      <div className=\"max-w-md w-full bg-white rounded-lg shadow-lg p-6\">\r\n        {status === 'loading' && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2\">\r\n              <span role=\"img\" aria-label=\"Facebook\">üìò</span>\r\n            </div>\r\n            <div className=\"text-lg font-semibold text-blue-900\">Connecting Facebook...</div>\r\n            <div className=\"text-sm text-gray-500\">{message}</div>\r\n          </div>\r\n        )}\r\n        {status === 'success' && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2\">\r\n              <span role=\"img\" aria-label=\"Success\">‚úÖ</span>\r\n            </div>\r\n            <div className=\"text-lg font-semibold text-green-900\">Successfully Connected!</div>\r\n            <div className=\"text-sm text-green-700\">{message}</div>\r\n            <div className=\"text-xs text-gray-500\">This window will close automatically...</div>\r\n          </div>\r\n        )}\r\n        {status === 'error' && (\r\n          <div className=\"text-center space-y-4\">\r\n            <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-2\">\r\n              <span role=\"img\" aria-label=\"Error\">‚ùå</span>\r\n            </div>\r\n            <div className=\"text-lg font-semibold text-red-900\">Connection Failed</div>\r\n            <div className=\"text-sm text-red-700\">{message}</div>\r\n            <div className=\"text-xs text-gray-500\">This window will close automatically...</div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default FacebookPopupCallback;\r\n"],"names":["FacebookPopupCallback","searchParams","useSearchParams","status","setStatus","useState","message","setMessage","useEffect","success","name","email","id","error","_a","possibleOrigins","origin","originError","_b","_d","_c","jsxs","jsx"],"mappings":"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"}