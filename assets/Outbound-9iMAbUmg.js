import{j as e,aT as g,aV as q,bb as K,C as Y,az as Z,am as _,au as M,y as ee,J as ie,aX as le,D as re,aW as ce,ba as de,f as oe,T as me}from"./ui-C7wuVsKo.js";import{r as z}from"./vendor-DG599jyl.js";import{b as O,u as xe,c as S}from"./query-BI4h7QWD.js";import{C as c,b as u,c as h,a as d,d as se}from"./card-aEf8HYk2.js";import{B as r}from"./button-DAfv1lEn.js";import{B as U}from"./badge-DTmq5TA0.js";import{T as ae,a as ne,b as N,c as i,d as te,e as t}from"./table-D230vnLP.js";import{b as R,c as I,d as ue,D as he,a as je}from"./dialog-D2hWIkvB.js";import{t as L}from"./index-DMttttgJ.js";import{P as G}from"./Page-CldTp-5P.js";import{T as ge,a as pe,b as Q,c as B}from"./tabs-B365V6_b.js";import{g as Ne,a as fe,b as Ce,l as ve,p as be,r as ye,c as we,d as Se}from"./campaignService-CkzeNBcy.js";import{u as De}from"./router-BavLd_S0.js";import"./scroll-area-DnO9GNsc.js";import"./index-DUGBtJKR.js";import"./index-CyKAHSi_.js";function Pe({campaignId:p,onClose:V}){var E,T;const[f,D]=z.useState("overview"),{data:C,isLoading:o}=O({queryKey:["campaign",p],queryFn:()=>Ne(p),retry:1}),{data:j,isLoading:F}=O({queryKey:["campaignCalls",p],queryFn:()=>fe(p),retry:1}),a=C==null?void 0:C.data,v=(j==null?void 0:j.data)||{},m=Object.values(v),b=n=>{const x={scheduled:{variant:"outline",icon:e.jsx(Y,{className:"h-3 w-3 mr-1"})},"in-progress":{variant:"default",icon:e.jsx(K,{className:"h-3 w-3 mr-1"})},ended:{variant:"secondary",icon:e.jsx(q,{className:"h-3 w-3 mr-1"})}}[n]||{variant:"outline",icon:null};return e.jsxs(U,{variant:x.variant,className:"flex items-center",children:[x.icon,n==="in-progress"?"Running":n.charAt(0).toUpperCase()+n.slice(1)]})},y=n=>{const l={queued:"outline",ringing:"secondary","in-progress":"default",ended:"secondary",failed:"destructive"};return e.jsx(U,{variant:l[n]||"outline",children:n})},P=n=>{if(!n)return"0:00";const l=Math.floor(n/60),x=n%60;return`${l}:${x.toString().padStart(2,"0")}`};return o?e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsx(I,{children:"Campaign Details"})}),e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(g,{className:"h-8 w-8 animate-spin"})})]}):a?e.jsxs(e.Fragment,{children:[e.jsxs(R,{children:[e.jsxs(I,{className:"flex items-center gap-2",children:[a.name,b(a.status)]}),e.jsxs(ue,{children:["Created on ",new Date(a.createdAt).toLocaleDateString()]})]}),e.jsxs(ge,{value:f,onValueChange:D,className:"w-full",children:[e.jsxs(pe,{className:"grid w-full grid-cols-3",children:[e.jsx(Q,{value:"overview",children:"Overview"}),e.jsx(Q,{value:"calls",children:"Calls"}),e.jsx(Q,{value:"analytics",children:"Analytics"})]}),e.jsxs(B,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(c,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(h,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"Total Calls"]})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:((E=a.customers)==null?void 0:E.length)||0})})]}),e.jsxs(c,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(h,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Completed"]})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:a.callsCounterEnded||0})})]}),e.jsxs(c,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(h,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Pick Up"]})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:a.callsCounterEnded>0?`${Math.round((a.callsCounterEnded-a.callsCounterEndedVoicemail)/a.callsCounterEnded*100)}%`:"0%"})})]}),e.jsxs(c,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(h,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Voicemail"]})}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold",children:a.callsCounterEndedVoicemail||0})})]})]}),e.jsxs(c,{children:[e.jsx(u,{children:e.jsx(h,{children:"Campaign Information"})}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone Number ID"}),e.jsx("p",{className:"text-sm",children:a.phoneNumberId})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Assistant ID"}),e.jsx("p",{className:"text-sm",children:a.assistantId||a.workflowId||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Created"}),e.jsx("p",{className:"text-sm",children:new Date(a.createdAt).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Last Updated"}),e.jsx("p",{className:"text-sm",children:new Date(a.updatedAt).toLocaleString()})]})]})})]})]}),e.jsx(B,{value:"calls",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(u,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Campaign Calls"]}),e.jsx(se,{children:"Individual call details and outcomes"})]}),e.jsx(d,{children:F?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(g,{className:"h-8 w-8 animate-spin"})}):e.jsxs(ae,{children:[e.jsx(ne,{children:e.jsxs(N,{children:[e.jsx(i,{children:"Customer"}),e.jsx(i,{children:"Phone Number"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Duration"}),e.jsx(i,{children:"Started"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(te,{children:m.length===0?e.jsx(N,{children:e.jsx(t,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No calls found for this campaign"})}):m.map(n=>{var l,x,A;return e.jsxs(N,{children:[e.jsx(t,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((l=n.customer)==null?void 0:l.name)||"Unknown"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:((x=n.customer)==null?void 0:x.email)||"-"})]})}),e.jsx(t,{className:"font-mono",children:((A=n.customer)==null?void 0:A.number)||"-"}),e.jsx(t,{children:y(n.status)}),e.jsx(t,{children:P(n.duration)}),e.jsx(t,{children:n.startedAt?new Date(n.startedAt).toLocaleString():"-"}),e.jsx(t,{children:e.jsxs("div",{className:"flex gap-2",children:[n.transcript&&e.jsx(r,{size:"sm",variant:"outline",title:"View Transcript",children:e.jsx(ee,{className:"h-3 w-3"})}),n.recording&&e.jsx(r,{size:"sm",variant:"outline",title:"Download Recording",children:e.jsx(ie,{className:"h-3 w-3"})})]})})]},n.id)})})]})})]})}),e.jsx(B,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(c,{children:[e.jsx(u,{children:e.jsx(h,{children:"Call Status Distribution"})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Scheduled"}),e.jsx("span",{className:"text-sm font-medium",children:a.callsCounterScheduled||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Queued"}),e.jsx("span",{className:"text-sm font-medium",children:a.callsCounterQueued||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"In Progress"}),e.jsx("span",{className:"text-sm font-medium",children:a.callsCounterInProgress||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Completed"}),e.jsx("span",{className:"text-sm font-medium",children:a.callsCounterEnded||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Voicemail"}),e.jsx("span",{className:"text-sm font-medium",children:a.callsCounterEndedVoicemail||0})]})]})})]}),e.jsxs(c,{children:[e.jsx(u,{children:e.jsx(h,{children:"Performance Metrics"})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Success Rate"}),e.jsx("span",{className:"text-sm font-medium",children:a.callsCounterEnded>0?`${Math.round((a.callsCounterEnded-a.callsCounterEndedVoicemail)/a.callsCounterEnded*100)}%`:"0%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Completion Rate"}),e.jsx("span",{className:"text-sm font-medium",children:((T=a.customers)==null?void 0:T.length)>0?`${Math.round(a.callsCounterEnded/a.customers.length*100)}%`:"0%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Avg Duration"}),e.jsx("span",{className:"text-sm font-medium",children:m.length>0?P(Math.round(m.reduce((n,l)=>n+(l.duration||0),0)/m.length)):"0:00"})]})]})})]})]})})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsx(r,{onClick:V,children:"Close"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsx(I,{children:"Campaign Details"})}),e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Campaign not found"})})]})}const Ue=()=>{const p=De(),[V,f]=z.useState(!1),[D,C]=z.useState(null),o=xe(),{data:j,isLoading:F,error:a}=O({queryKey:["outboundCampaigns"],queryFn:()=>Ce(),retry:1}),v=S({mutationFn:ve,onSuccess:()=>{o.invalidateQueries({queryKey:["outboundCampaigns"]}),L.success("Campaign launched successfully")},onError:s=>{var H,J,W,X;const w=((J=(H=s.response)==null?void 0:H.data)==null?void 0:J.message)||"Failed to launch campaign";((X=(W=s.response)==null?void 0:W.data)==null?void 0:X.currentStatus)==="in-progress"?L.info("Campaign is already running"):L.error(w),o.invalidateQueries({queryKey:["outboundCampaigns"]})}}),m=S({mutationFn:be,onSuccess:()=>{o.invalidateQueries({queryKey:["outboundCampaigns"]})}});S({mutationFn:ye,onSuccess:()=>{o.invalidateQueries({queryKey:["outboundCampaigns"]})}});const b=S({mutationFn:we,onSuccess:()=>{o.invalidateQueries({queryKey:["outboundCampaigns"]})}}),y=S({mutationFn:Se,onSuccess:()=>{o.invalidateQueries({queryKey:["outboundCampaigns"]})}}),P=s=>{v.mutate(s)},E=s=>{m.mutate(s)},T=s=>{confirm("Are you sure you want to cancel this campaign?")&&b.mutate(s)},n=s=>{confirm("Are you sure you want to delete this campaign? This action cannot be undone.")&&y.mutate(s)},l=s=>{C(s),f(!0)},x=()=>{o.invalidateQueries({queryKey:["outboundCampaigns"]}),L.success("Campaigns refreshed")},A=s=>{const k={scheduled:{variant:"outline",icon:e.jsx(Y,{className:"h-3 w-3 mr-1"}),label:"Scheduled"},"in-progress":{variant:"default",icon:e.jsx(K,{className:"h-3 w-3 mr-1"}),label:"Running"},ended:{variant:"secondary",icon:e.jsx(q,{className:"h-3 w-3 mr-1"}),label:"Ended"}}[s]||{variant:"outline",icon:e.jsx(ce,{className:"h-3 w-3 mr-1"}),label:s.charAt(0).toUpperCase()+s.slice(1)};return e.jsxs(U,{variant:k.variant,className:"flex items-center",children:[k.icon,k.label]})},$=Array.isArray(j==null?void 0:j.data)?j.data:[];return a?e.jsx(G,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Outbound"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage outbound campaigns"})]}),e.jsx(c,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Unable to connect to the backend API. Please ensure the backend server is running."}),e.jsx(r,{onClick:()=>window.location.reload(),children:"Retry Connection"})]})})})]})}):e.jsx(G,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Outbound"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage outbound campaigns"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{variant:"outline",onClick:x,title:"Refresh Campaigns",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(r,{className:"bg-teal-600 hover:bg-teal-700 text-white",onClick:()=>p("/outbound/create-campaign"),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Create Campaign"]})]})]}),e.jsxs(c,{children:[e.jsxs(u,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Campaigns"]}),e.jsx(se,{children:"Manage your outbound call campaigns"})]}),e.jsx(d,{children:F?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(g,{className:"h-8 w-8 animate-spin"})}):e.jsxs(ae,{children:[e.jsx(ne,{children:e.jsxs(N,{children:[e.jsx(i,{children:"Campaign Name"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Total Calls"}),e.jsx(i,{children:"Completed"}),e.jsx(i,{children:"Pick Up"}),e.jsx(i,{children:"Voicemail"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(te,{children:$.length===0?e.jsx(N,{children:e.jsx(t,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No campaigns found. Create your first campaign to get started."})}):$.map(s=>{var w;return e.jsxs(N,{children:[e.jsx(t,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Created on ",new Date(s.createdAt).toLocaleDateString()]})]})}),e.jsx(t,{children:A(s.status)}),e.jsx(t,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),((w=s.customers)==null?void 0:w.length)||0,s.status==="in-progress"&&e.jsxs("span",{className:"ml-2 text-xs text-green-600 font-medium",children:["(",s.callsCounterInProgress||0," active)"]})]})}),e.jsx(t,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),s.callsCounterEnded||0]})}),e.jsx(t,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"h-3 w-3"}),s.callsCounterEnded>0?`${Math.round((s.callsCounterEnded-s.callsCounterEndedVoicemail)/s.callsCounterEnded*100)}%`:"0%"]})}),e.jsx(t,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"h-3 w-3"}),s.callsCounterEndedVoicemail||0]})}),e.jsx(t,{children:e.jsxs("div",{className:"flex gap-2",children:[s.status==="scheduled"&&e.jsx(r,{size:"sm",variant:"outline",onClick:()=>P(s.id),disabled:v.isPending,title:"Launch Campaign",children:v.isPending?e.jsx(g,{className:"h-3 w-3 animate-spin"}):e.jsx(K,{className:"h-3 w-3"})}),s.status==="in-progress"&&e.jsx(r,{size:"sm",variant:"outline",onClick:()=>E(s.id),disabled:m.isPending,title:"Pause Campaign",children:m.isPending?e.jsx(g,{className:"h-3 w-3 animate-spin"}):e.jsx(de,{className:"h-3 w-3"})}),(s.status==="scheduled"||s.status==="in-progress")&&e.jsx(r,{size:"sm",variant:"outline",onClick:()=>T(s.id),disabled:b.isPending,title:"Cancel Campaign",children:b.isPending?e.jsx(g,{className:"h-3 w-3 animate-spin"}):e.jsx(oe,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>l(s),title:"View Details",children:e.jsx(ee,{className:"h-3 w-3"})}),s.status==="ended"&&e.jsx(r,{size:"sm",variant:"outline",onClick:()=>n(s.id),disabled:y.isPending,title:"Delete Campaign",children:y.isPending?e.jsx(g,{className:"h-3 w-3 animate-spin"}):e.jsx(me,{className:"h-3 w-3"})})]})})]},s.id)})})]})})]}),D&&e.jsx(he,{open:V,onOpenChange:f,children:e.jsx(je,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:e.jsx(Pe,{campaignId:D.id,onClose:()=>f(!1)})})})]})})};export{Ue as default};
//# sourceMappingURL=Outbound-9iMAbUmg.js.map
