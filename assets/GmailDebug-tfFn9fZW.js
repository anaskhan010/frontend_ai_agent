import{j as s,aT as g,aX as G,ac as U,aP as f,aq as I}from"./ui-C7wuVsKo.js";import{r as n}from"./vendor-DG599jyl.js";import{C as N,b as y,c as v,a as C}from"./card-aEf8HYk2.js";import{B as b}from"./button-DAfv1lEn.js";import{B as c}from"./badge-DTmq5TA0.js";import{d as D,t as i}from"./index-CUjvNcD6.js";import"./router-BavLd_S0.js";import"./query-BI4h7QWD.js";const $=()=>{const[r,w]=n.useState(null),[t,S]=n.useState(null),[x,h]=n.useState(!1),[u,j]=n.useState(!1),E=async()=>{var e,l;h(!0);try{const a=await D.get("/api/gmail/debug/connections");a.data.success?(w(a.data.data),i.success(`Found ${a.data.data.totalConnections} Gmail connections`)):i.error(a.data.message||"Failed to fetch debug data")}catch(a){console.error("Error fetching debug data:",a);const m=((l=(e=a.response)==null?void 0:e.data)==null?void 0:l.message)||"Failed to fetch debug data";i.error(m)}finally{h(!1)}},p=async()=>{var e,l;j(!0);try{const a=await D.get("/api/gmail/auth/status");a.data.success?(S(a.data.data),i.success("Current user Gmail status fetched")):i.error(a.data.message||"Failed to fetch current user status")}catch(a){console.error("Error fetching current user status:",a);const m=((l=(e=a.response)==null?void 0:e.data)==null?void 0:l.message)||"Failed to fetch current user status";i.error(m)}finally{j(!1)}};n.useEffect(()=>{p()},[]);const d=e=>new Date(e).toLocaleString(),o=e=>e?new Date(e)<new Date:!1;return s.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Gmail Debug Dashboard"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(b,{onClick:p,disabled:u,variant:"outline",children:[u?s.jsx(g,{className:"h-4 w-4 animate-spin mr-2"}):s.jsx(G,{className:"h-4 w-4 mr-2"}),"Refresh Status"]}),s.jsxs(b,{onClick:E,disabled:x,children:[x?s.jsx(g,{className:"h-4 w-4 animate-spin mr-2"}):s.jsx(U,{className:"h-4 w-4 mr-2"}),"Load All Connections"]})]})]}),s.jsxs(N,{children:[s.jsx(y,{children:s.jsxs(v,{className:"flex items-center gap-2",children:[s.jsx(f,{className:"h-5 w-5"}),"Current User Gmail Status"]})}),s.jsx(C,{children:t?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"User ID"}),s.jsx("p",{className:"font-mono",children:t.userId})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Requesting User"}),s.jsx("p",{className:"font-mono",children:t.requestingUser})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Connection Status"}),s.jsx(c,{variant:t.isConnected?"default":"secondary",children:t.isConnected?"Connected":"Not Connected"})]}),t.profile&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Connected Gmail"}),s.jsx("p",{className:"font-mono",children:t.profile.email})]})]}),t.profile&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Messages Total"}),s.jsx("p",{className:"font-mono",children:t.profile.messagesTotal})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Threads Total"}),s.jsx("p",{className:"font-mono",children:t.profile.threadsTotal})]})]})]}):s.jsx("p",{className:"text-gray-500",children:'Click "Refresh Status" to load current user status'})})]}),s.jsxs(N,{children:[s.jsx(y,{children:s.jsxs(v,{className:"flex items-center gap-2",children:[s.jsx(I,{className:"h-5 w-5"}),"All Gmail Connections",r&&s.jsxs(c,{variant:"outline",children:[r.totalConnections," total"]})]})}),s.jsx(C,{children:r?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:["Requested by: ",r.requestedBy.userEmail," (ID: ",r.requestedBy.userId,")"]}),r.connections.length===0?s.jsx("p",{className:"text-gray-500",children:"No Gmail connections found"}):s.jsx("div",{className:"space-y-3",children:r.connections.map((e,l)=>s.jsxs("div",{className:"border rounded-lg p-4 space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:e.userName}),s.jsxs(c,{variant:"outline",children:["ID: ",e.userId]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(c,{variant:o(e.expiryDate)?"destructive":"default",children:e.tokenType}),o(e.expiryDate)&&s.jsx(c,{variant:"destructive",children:"Expired"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Email: "}),s.jsx("span",{className:"font-mono",children:e.userEmail})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Created: "}),s.jsx("span",{className:"font-mono",children:d(e.createdAt)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Updated: "}),s.jsx("span",{className:"font-mono",children:d(e.updatedAt)})]})]}),e.expiryDate&&s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Expires: "}),s.jsx("span",{className:`font-mono ${o(e.expiryDate)?"text-red-600":"text-green-600"}`,children:d(e.expiryDate)})]})]},`${e.userId}-${l}`))})]}):s.jsx("p",{className:"text-gray-500",children:'Click "Load All Connections" to see all Gmail connections in the database'})})]})]})};export{$ as default};
//# sourceMappingURL=GmailDebug-tfFn9fZW.js.map
