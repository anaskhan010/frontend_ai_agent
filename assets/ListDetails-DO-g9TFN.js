var me=Object.defineProperty;var ue=(n,l,p)=>l in n?me(n,l,{enumerable:!0,configurable:!0,writable:!0,value:p}):n[l]=p;var I=(n,l,p)=>ue(n,typeof l!="symbol"?l+"":l,p);import{j as e,bz as he,m as X,bA as xe,aI as fe,K as H,bI as pe,N as ge,bF as Ne,ax as je,aC as be,aq as ye}from"./ui-CZ40mCLE.js";import{r as o}from"./vendor-DG599jyl.js";import{M as we}from"./ModernTable-CgFnnchI.js";import{P as B}from"./Page-BeutzHE5.js";import{B as f,E as J,t as r,X as Ce,K as W,n as Z,I as F,L as M,O as ve,N as Pe,Y as Se}from"./index-gfvc66g_.js";import{c as Ae,e as Ee,d as ke,S as Te,a as De}from"./sheet-BCYUVIvb.js";import{u as Le}from"./usePermissions-BgIk0RMx.js";import{u as Ie}from"./resolvers-BzctgYTE.js";import{o as Fe,c as Ue,a as _}from"./index.esm-C7RSptL2.js";import{b as Re,u as qe}from"./router-BnJytTjr.js";import"./table-UuQdjaS_.js";import"./query-Dkjx6fBT.js";class Oe extends o.Component{constructor(){super(...arguments);I(this,"state",{hasError:!1});I(this,"handleReset",()=>{this.setState({hasError:!1,error:void 0})});I(this,"handleReload",()=>{window.location.reload()})}static getDerivedStateFromError(p){return{hasError:!0,error:p}}componentDidCatch(p,j){console.error("ErrorBoundary caught an error:",p,j)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[400px] p-8 bg-white rounded-lg border border-red-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"‚ö†Ô∏è"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md",children:"An unexpected error occurred. This might be due to a temporary issue."}),e.jsxs("div",{className:"space-x-4",children:[e.jsx(f,{onClick:this.handleReset,variant:"outline",children:"Try Again"}),e.jsx(f,{onClick:this.handleReload,variant:"default",children:"Reload Page"})]}),!1]})}):this.props.children}}const Be=Ue().shape({email:_().required("Email is required").email("Email is invalid"),phoneNumber:_().required("Phone number is required"),fullName:_().required("Full name is required")}),Ze=()=>{const{id:n}=Re(),l=qe(),{isSuperAdmin:p}=Le(),[j,U]=o.useState(null),[ee,b]=o.useState([]),[E,$]=o.useState(!0),[v,y]=o.useState(!1),[z,V]=o.useState(0),[g,Y]=o.useState(1),[k,T]=o.useState(0),[R,P]=o.useState(0),[w,te]=o.useState(""),[m,D]=o.useState(null),[G,A]=o.useState(!1);o.useEffect(()=>{(()=>{const i=J.getItem("authToken")||J.getItem("token");if(console.log("üîê Auth check - Token exists:",!!i),!i){console.log("‚ùå No authentication token found"),r.error("Please log in to view list details"),l("/login");return}})()},[l]);const{register:q,handleSubmit:se,formState:{errors:S,isSubmitting:K},reset:L,setValue:O}=Ie({resolver:Fe(Be),defaultValues:{email:"",phoneNumber:"",fullName:""}}),Q=o.useCallback(async()=>{var t,i,c,u,a;if(n)try{$(!0);const s=new Promise((C,de)=>setTimeout(()=>de(new Error("Request timeout")),1e4)),x=Promise.all([Ce(n),W(n,g,w)]),d=await Promise.race([x,s]),[h,N]=d;if(h&&h.success){const C=h.data;if(C.is_deleted&&!p){r.error("This list has been disabled and is not accessible."),l("/lists");return}U(C)}else console.log("List API failed, creating minimal list info for ID:",n),U({id:parseInt(n),listName:`List ${n}`,description:"List details could not be loaded",type:"General",contactCount:0,createdAt:new Date().toISOString()});N&&N.success?(b(N.data.contacts||[]),P(((t=N.data.pagination)==null?void 0:t.totalContacts)||0),T(((i=N.data.pagination)==null?void 0:i.totalPages)||1)):(console.log("Contacts API failed, showing empty state"),b([]),P(0),T(1))}catch(s){if(console.error("Error fetching list data:",s),(s==null?void 0:s.message)==="Request timeout")r.error("Request timed out. Please try again.");else if(((c=s==null?void 0:s.response)==null?void 0:c.status)===401){r.error("Authentication failed. Please log in again."),l("/login");return}else if(((u=s==null?void 0:s.response)==null?void 0:u.status)===403){r.error("This list has been disabled and is not accessible."),l("/lists");return}else((a=s==null?void 0:s.response)==null?void 0:a.status)>=500?r.error("Server error. Please try again later."):console.error("Failed to fetch list details");console.log("API error, creating fallback list info for ID:",n),U({id:parseInt(n),listName:`List ${n}`,description:"Unable to load list details",type:"General",contactCount:0,createdAt:new Date().toISOString()}),b([]),P(0),T(1)}finally{$(!1)}},[n,g,w,l]);o.useCallback(async()=>{var t,i;if(n)try{const c=new Promise((s,x)=>setTimeout(()=>x(new Error("Refresh timeout")),5e3)),u=W(n,g,w),a=await Promise.race([u,c]);a&&a.success&&(b(a.data.contacts||[]),P(((t=a.data.pagination)==null?void 0:t.totalContacts)||0),T(((i=a.data.pagination)==null?void 0:i.totalPages)||1))}catch(c){console.error("Error refreshing contacts data:",c)}},[n,g,w]),o.useEffect(()=>{Q()},[Q]);const ae=async t=>{var i,c,u;if(!(!n||v))try{y(!0);const a=Pe(n,{email:t.email,contact_number:t.phoneNumber,phoneNumber:t.phoneNumber,fullName:t.fullName}),s=new Promise((d,h)=>setTimeout(()=>h(new Error("Add timeout")),15e3));await Promise.race([a,s]),L(),A(!1);const x={id:Date.now(),email:t.email,phoneNumber:t.phoneNumber,fullName:t.fullName,createdAt:new Date().toISOString()};b(d=>[...d,x]),P(d=>d+1),r.success("Contact added successfully")}catch(a){console.error("Error adding contact:",a),(a==null?void 0:a.message)==="Add timeout"?r.error("Add timed out. Please check if the contact was added and try again."):((i=a==null?void 0:a.response)==null?void 0:i.status)===401?r.error("Authentication failed. Please log in again."):(u=(c=a==null?void 0:a.response)==null?void 0:c.data)!=null&&u.error?r.error(`Add failed: ${a.response.data.error}`):r.error("Failed to add contact")}finally{y(!1)}},re=t=>{console.log("üîÑ handleEditContact called",{contact:t}),setTimeout(()=>{D(t),O("email",t.email),O("phoneNumber",t.phoneNumber),O("fullName",t.fullName||"")},100)},ne=async t=>{var c,u,a;if(console.log("üîÑ handleUpdateContact called",{editingContact:m,data:t,operationLoading:v}),!m||v){console.log("‚ùå Update blocked:",{editingContact:!!m,operationLoading:v});return}const i=Date.now();if(i-z<1e3){r.error("Please wait a moment before performing another operation");return}V(i);try{console.log("‚úÖ Starting update operation for contact:",m.id),y(!0);const s=ve(m.id.toString(),{email:t.email,phoneNumber:t.phoneNumber,fullName:t.fullName}),x=new Promise((h,N)=>setTimeout(()=>N(new Error("Update timeout")),15e3));await Promise.race([s,x]),console.log("‚úÖ Update API call successful");const d=m.id;console.log("üîÑ Updating local state for contact:",d),b(h=>{const N=h.map(C=>C.id===d?{...C,...t}:C);return console.log("‚úÖ Local state updated successfully"),N}),L(),D(null),console.log("‚úÖ Form reset and editing contact cleared"),r.success("Contact updated successfully")}catch(s){console.error("Error updating contact:",s),(s==null?void 0:s.message)==="Update timeout"?r.error("Update timed out. Please check if the contact was updated and try again."):((c=s==null?void 0:s.response)==null?void 0:c.status)===401?r.error("Authentication failed. Please log in again."):(a=(u=s==null?void 0:s.response)==null?void 0:u.data)!=null&&a.error?r.error(`Update failed: ${s.response.data.error}`):r.error("Failed to update contact");try{y(!1)}catch(x){console.error("Error resetting operation state:",x),window.location.reload()}}finally{try{y(!1)}catch(s){console.error("Critical error in finally block:",s)}}},ie=async t=>{var c,u,a;if(!confirm("Are you sure you want to delete this contact?")||v)return;const i=Date.now();if(i-z<1e3){r.error("Please wait a moment before performing another operation");return}V(i);try{y(!0);const s=Se(t.toString()),x=new Promise((d,h)=>setTimeout(()=>h(new Error("Delete timeout")),15e3));await Promise.race([s,x]),b(d=>d.filter(h=>h.id!==t)),P(d=>Math.max(0,d-1)),r.success("Contact deleted successfully")}catch(s){console.error("Error deleting contact:",s),(s==null?void 0:s.message)==="Delete timeout"?r.error("Delete timed out. Please check if the contact was deleted and try again."):((c=s==null?void 0:s.response)==null?void 0:c.status)===401?r.error("Authentication failed. Please log in again."):(a=(u=s==null?void 0:s.response)==null?void 0:u.data)!=null&&a.error?r.error(`Delete failed: ${s.response.data.error}`):r.error("Failed to delete contact")}finally{y(!1)}},le=t=>{const i=new Date(t);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(i)},oe=t=>{switch(t){case"Marketing":return"default";case"Sales":return"secondary";case"Event":return"outline";case"Customer":return"destructive";default:return"default"}},ce=[{label:"Edit Contact",icon:e.jsx(ge,{className:"h-4 w-4"}),onClick:re},{label:"Delete Contact",icon:e.jsx(Ne,{className:"h-4 w-4"}),onClick:t=>ie(t.id)}];return E&&!j?e.jsx(B,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading list details..."})]})})}):j?e.jsx(Oe,{children:e.jsxs(B,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>l("/lists"),className:"flex items-center space-x-2",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:"Back to Lists"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:j.listName}),e.jsx("p",{className:"text-gray-600",children:j.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[v&&e.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm",children:"Processing..."})]}),e.jsx(Z,{variant:oe(j.type),className:"capitalize",children:j.type}),e.jsxs(Z,{variant:"secondary",children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),R," Contacts"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(F,{placeholder:"Search contacts...",value:w,onChange:t=>te(t.target.value),className:"w-full"})}),e.jsxs(Ae,{open:G||!!m,onOpenChange:t=>{console.log("üîÑ Sheet onOpenChange",{open:t,isAddingContact:G,editingContact:!!m}),t||(A(!1),D(null),L())},children:[e.jsx(Ee,{asChild:!0,children:e.jsxs(f,{onClick:()=>A(!0),className:"flex items-center space-x-2",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Contact"})]})}),e.jsxs(ke,{size:"md",onOpenAutoFocus:t=>{t.preventDefault()},onCloseAutoFocus:t=>{t.preventDefault()},children:[e.jsx(Te,{children:m?"Edit Contact":"Add New Contact"}),e.jsx(De,{children:m?"Update the contact information below.":"Add a new contact to this list."}),e.jsxs("form",{onSubmit:se(m?ne:ae),className:"space-y-4 mt-6",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"fullName",children:"Full Name *"}),e.jsx(F,{id:"fullName",placeholder:"Enter full name",...q("fullName")}),S.fullName&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:S.fullName.message})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"email",children:"Email *"}),e.jsx(F,{id:"email",type:"email",placeholder:"Enter email address",...q("email")}),S.email&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:S.email.message})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"phoneNumber",children:"Phone Number *"}),e.jsx(F,{id:"phoneNumber",placeholder:"Enter phone number",...q("phoneNumber")}),S.phoneNumber&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:S.phoneNumber.message})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>{A(!1),D(null),L()},children:"Cancel"}),e.jsx(f,{type:"submit",disabled:K,children:K?m?"Updating...":"Adding...":m?"Update Contact":"Add Contact"})]})]})]})]})]}),e.jsx(we,{data:ee,isSelectable:!0,showColumnSelection:!0,columns:[{header:"Contact",accessor:"email",className:"min-w-[250px]",cell:(t,i)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-9 w-9 bg-gradient-to-br from-primary/20 to-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(je,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:i.fullName?`${i.fullName}`:"No Name"}),e.jsx("div",{className:"text-sm text-gray-500",children:String(t)})]})]}),sortable:!0},{header:"Phone Number",accessor:"phoneNumber",className:"min-w-[150px]",cell:t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:String(t)})]}),sortable:!0},{header:"Added",accessor:"createdAt",className:"min-w-[150px]",cell:t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:le(String(t))})]}),sortable:!0}],actions:ce,emptyState:e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"h-20 w-20 bg-gradient-to-br from-primary/20 to-primary/10 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(pe,{className:"h-10 w-10 text-primary"})}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:E?"Loading contacts...":"No contacts"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:E?"Please wait while we fetch the contacts":w?"No contacts match your search criteria.":"This list is empty. Add your first contact to get started."}),!E&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(f,{onClick:()=>A(!0),className:"flex items-center space-x-2 px-6 py-3",size:"lg",children:[e.jsx(H,{className:"h-5 w-5"}),e.jsx("span",{children:"Add Contact"})]}),!w&&e.jsx("p",{className:"text-xs text-gray-400",children:"You can add contacts manually or import them from a CSV file"})]})]})}),k>1&&e.jsx("div",{className:"mt-8 border-t border-gray-200 pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(g-1)*10+1," to ",Math.min(g*10,R)," of ",R," contacts"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>Y(t=>Math.max(1,t-1)),disabled:g===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",g," of ",k]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>Y(t=>Math.min(k,t+1)),disabled:g===k,children:"Next"})]})]})})]})}):e.jsx(B,{children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"h-16 w-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(he,{className:"h-8 w-8 text-red-500"})}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"List not found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"The requested list could not be found. This might be due to:"}),e.jsxs("ul",{className:"text-sm text-gray-500 mb-6 text-left max-w-md mx-auto",children:[e.jsx("li",{children:"‚Ä¢ The list may have been deleted"}),e.jsx("li",{children:"‚Ä¢ You may not have permission to view this list"}),e.jsx("li",{children:"‚Ä¢ There may be a connection issue"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(f,{onClick:()=>l("/lists"),variant:"outline",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Back to Lists"]}),e.jsxs(f,{onClick:()=>window.location.reload(),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Retry"]})]})]})})};export{Ze as default};
//# sourceMappingURL=ListDetails-DO-g9TFN.js.map
