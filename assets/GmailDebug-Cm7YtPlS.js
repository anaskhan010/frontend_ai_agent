import{j as s,bu as g,bx as G,aS as U,bq as f,b4 as I}from"./ui-D0JisYOU.js";import{r as i}from"./vendor-D6QveUxv.js";import{j as N,t as n,B as y,C as v,l as C,n as b,k as D,v as c}from"./index-9NRFi5uV.js";import"./router-jXXg-8rg.js";import"./query-CXvbhbrr.js";const A=()=>{const[r,w]=i.useState(null),[t,S]=i.useState(null),[x,h]=i.useState(!1),[u,j]=i.useState(!1),E=async()=>{var e,l;h(!0);try{const a=await N.get("/api/gmail/debug/connections");a.data.success?(w(a.data.data),n.success(`Found ${a.data.data.totalConnections} Gmail connections`)):n.error(a.data.message||"Failed to fetch debug data")}catch(a){console.error("Error fetching debug data:",a);const m=((l=(e=a.response)==null?void 0:e.data)==null?void 0:l.message)||"Failed to fetch debug data";n.error(m)}finally{h(!1)}},p=async()=>{var e,l;j(!0);try{const a=await N.get("/api/gmail/auth/status");a.data.success?(S(a.data.data),n.success("Current user Gmail status fetched")):n.error(a.data.message||"Failed to fetch current user status")}catch(a){console.error("Error fetching current user status:",a);const m=((l=(e=a.response)==null?void 0:e.data)==null?void 0:l.message)||"Failed to fetch current user status";n.error(m)}finally{j(!1)}};i.useEffect(()=>{p()},[]);const d=e=>new Date(e).toLocaleString(),o=e=>e?new Date(e)<new Date:!1;return s.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Gmail Debug Dashboard"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(y,{onClick:p,disabled:u,variant:"outline",children:[u?s.jsx(g,{className:"h-4 w-4 animate-spin mr-2"}):s.jsx(G,{className:"h-4 w-4 mr-2"}),"Refresh Status"]}),s.jsxs(y,{onClick:E,disabled:x,children:[x?s.jsx(g,{className:"h-4 w-4 animate-spin mr-2"}):s.jsx(U,{className:"h-4 w-4 mr-2"}),"Load All Connections"]})]})]}),s.jsxs(v,{children:[s.jsx(C,{children:s.jsxs(b,{className:"flex items-center gap-2",children:[s.jsx(f,{className:"h-5 w-5"}),"Current User Gmail Status"]})}),s.jsx(D,{children:t?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"User ID"}),s.jsx("p",{className:"font-mono",children:t.userId})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Requesting User"}),s.jsx("p",{className:"font-mono",children:t.requestingUser})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Connection Status"}),s.jsx(c,{variant:t.isConnected?"default":"secondary",children:t.isConnected?"Connected":"Not Connected"})]}),t.profile&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Connected Gmail"}),s.jsx("p",{className:"font-mono",children:t.profile.email})]})]}),t.profile&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Messages Total"}),s.jsx("p",{className:"font-mono",children:t.profile.messagesTotal})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Threads Total"}),s.jsx("p",{className:"font-mono",children:t.profile.threadsTotal})]})]})]}):s.jsx("p",{className:"text-gray-500",children:'Click "Refresh Status" to load current user status'})})]}),s.jsxs(v,{children:[s.jsx(C,{children:s.jsxs(b,{className:"flex items-center gap-2",children:[s.jsx(I,{className:"h-5 w-5"}),"All Gmail Connections",r&&s.jsxs(c,{variant:"outline",children:[r.totalConnections," total"]})]})}),s.jsx(D,{children:r?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:["Requested by: ",r.requestedBy.userEmail," (ID: ",r.requestedBy.userId,")"]}),r.connections.length===0?s.jsx("p",{className:"text-gray-500",children:"No Gmail connections found"}):s.jsx("div",{className:"space-y-3",children:r.connections.map((e,l)=>s.jsxs("div",{className:"border rounded-lg p-4 space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:e.userName}),s.jsxs(c,{variant:"outline",children:["ID: ",e.userId]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(c,{variant:o(e.expiryDate)?"destructive":"default",children:e.tokenType}),o(e.expiryDate)&&s.jsx(c,{variant:"destructive",children:"Expired"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Email: "}),s.jsx("span",{className:"font-mono",children:e.userEmail})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Created: "}),s.jsx("span",{className:"font-mono",children:d(e.createdAt)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Updated: "}),s.jsx("span",{className:"font-mono",children:d(e.updatedAt)})]})]}),e.expiryDate&&s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Expires: "}),s.jsx("span",{className:`font-mono ${o(e.expiryDate)?"text-red-600":"text-green-600"}`,children:d(e.expiryDate)})]})]},`${e.userId}-${l}`))})]}):s.jsx("p",{className:"text-gray-500",children:'Click "Load All Connections" to see all Gmail connections in the database'})})]})]})};export{A as default};
//# sourceMappingURL=GmailDebug-Cm7YtPlS.js.map
