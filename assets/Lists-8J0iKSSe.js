import{j as e,bg as Da,aB as rs,T as Ia,as as Z,aw as W,D as ls,N as Ms,b as La,b5 as Ts,H as Ma,b2 as Ta,ar as _s,F as _a,aU as xe,bh as $a,aX as $s,C as Ua,aQ as Ha,bi as Ra,M as qa,bj as za,bk as Oa,bl as Ba,aI as Va,bm as Wa,b8 as Xa}from"./ui-S570Xcny.js";import{r as t}from"./vendor-DG599jyl.js";import{P as Ya}from"./Page-BJWqKr2O.js";import{c as Qa,b as Ja,d as Ka,e as Za,f as et,u as st,r as at}from"./contactService-DhoIrjN3.js";import{createOutboundCall as tt,unmuteCall as rt,muteCall as lt,endCallViaControl as nt}from"./outboundService-DARkxUz2.js";import{f as ct}from"./agentService-BC3vXPZD.js";import{g as it}from"./phoneNumberService-B1wjBO9K.js";import{d as $,t as l,u as qs,a as ot,e as dt,j as mt}from"./index-Dlzy9K_J.js";import{g as ut,f as xt,h as Us,a as ht,b as gt,c as ft,C as pt}from"./CallRecordingPlayer-R5DvdOmK.js";import{c as bt,u as jt}from"./router-BavLd_S0.js";import{u as Nt,a as yt}from"./resolvers-BzctgYTE.js";import{o as vt,c as Hs,b as Ct,a as K}from"./index.esm-C7RSptL2.js";import{B as h}from"./button-BSd9MMPp.js";import{I as v}from"./input-jxB46izN.js";import{L as E}from"./label-C1-UM1F-.js";import{S as wt,a as St,b as Et,c as kt,d as At}from"./sheet-C7DsuPAk.js";import{S as Ft,a as Gt,b as Pt,c as Dt,d as he}from"./select-D0_OqHwT.js";import{T as It}from"./textarea-Cw4zrZDH.js";import{D as ns,a as cs,b as is,c as os,d as Lt,f as Mt}from"./dialog-Cc2g-8Kh.js";import{B as Ke}from"./badge-ij7fArnn.js";import{A as Ze,a as es}from"./avatar-Cwu0Oo_-.js";import{T as Tt,a as _t,b as ss,c as as}from"./tabs-CbOWgAXT.js";import{u as $t}from"./usePermissions-D2ajeAM7.js";import{D as Ut,a as Ht,b as Rt,e as ts,d as Rs}from"./dropdown-menu-Bxst4dXB.js";import{A as qt,a as zt,b as Ot,c as Bt,d as Vt,e as Wt,f as Xt,g as Yt}from"./alert-dialog-CmVht1cJ.js";import{C as Qt}from"./ChatSidebar-DrEG2QfA.js";import"./scroll-area-C-pzVjaj.js";import"./index-BHBJ6RT-.js";import"./index-CWMUKvWL.js";import"./query-Cab5P5bd.js";import"./slider-DHO3HMwz.js";import"./index-HDeFwIcs.js";import"./messagingService-BXpzguzD.js";import"./CreatePhoneNumberForm-DkHs5gbb.js";import"./card-DMfGhRm1.js";import"./CreditGuard-3wMcOQxa.js";async function zs(){try{const d=await $.get("/api/contact-gmail/auth/status");if(d.data.success)return d.data.data;throw new Error(d.data.message||"Failed to get Contact Gmail status")}catch(d){return console.error("Error getting Contact Gmail status:",d),{isConnected:!1,email:null}}}async function Jt(){var d,f;try{const c=await $.get("/api/contact-gmail/auth/url");if(c.data.success){const n=window.open(c.data.data.authUrl,"contact_gmail_oauth","width=500,height=600,scrollbars=yes,resizable=yes");if(!n){l.error("Popup blocked. Please allow popups and try again.");return}return new Promise((r,T)=>{let b=!1;const G=i=>{if(console.log("ðŸ“¨ Received postMessage:",i.data,"from origin:",i.origin),!i.data||!i.data.type||!i.data.type.startsWith("CONTACT_GMAIL_")){console.log("âŒ Ignoring non-Contact Gmail message");return}b||(i.data.type==="CONTACT_GMAIL_SUCCESS"?(console.log("âœ… Contact Gmail success received"),b=!0,window.removeEventListener("message",G),l.success(`Contact Gmail connected successfully! (${i.data.email})`),r()):i.data.type==="CONTACT_GMAIL_ERROR"&&(console.log("âŒ Contact Gmail error received:",i.data.error),b=!0,window.removeEventListener("message",G),l.error(`Failed to connect Contact Gmail: ${i.data.error}`),T(new Error(i.data.error))))};window.addEventListener("message",G);const o=setInterval(()=>{if(n.closed){if(clearInterval(o),console.log("ðŸ”’ OAuth tab was closed"),b)return;window.removeEventListener("message",G),setTimeout(async()=>{if(!b){console.log("ðŸ” Checking Contact Gmail status after tab close...");try{(await zs()).isConnected?(console.log("âœ… Contact Gmail is connected despite no postMessage"),b=!0,l.success("Contact Gmail connected successfully!"),r()):(console.log("âŒ Contact Gmail is not connected"),b=!0,T(new Error("Contact Gmail connection was cancelled")))}catch(i){console.log("âŒ Error checking Contact Gmail status:",i),b=!0,T(new Error("Contact Gmail connection was cancelled"))}}},2e3)}},1e3);setTimeout(()=>{b||(clearInterval(o),window.removeEventListener("message",G),n.closed||n.close(),b=!0,T(new Error("Contact Gmail connection timeout")))},3e5)})}else throw new Error(c.data.message||"Failed to generate Contact Gmail auth URL")}catch(c){console.error("Error connecting Contact Gmail:",c);const n=((f=(d=c.response)==null?void 0:d.data)==null?void 0:f.message)||"Failed to connect Contact Gmail";throw l.error(n),c}}async function Kt(){var d,f;try{const c=await $.delete("/api/contact-gmail/auth/disconnect");if(c.data.success){l.success("Contact Gmail disconnected successfully!");return}throw new Error(c.data.message||"Failed to disconnect Contact Gmail")}catch(c){console.error("Error disconnecting Contact Gmail:",c);const n=((f=(d=c.response)==null?void 0:d.data)==null?void 0:f.message)||"Failed to disconnect Contact Gmail";throw l.error(n),c}}async function Zt(d){var f,c;try{const n=await $.post("/api/contact-gmail/send",d);if(n.data.success)return l.success("Email sent successfully via Contact Gmail!"),n.data.data;throw new Error(n.data.message||"Failed to send email via Contact Gmail")}catch(n){console.error("Error sending Contact Gmail email:",n);const r=((c=(f=n.response)==null?void 0:f.data)==null?void 0:c.message)||"Failed to send email via Contact Gmail";throw l.error(r),n}}async function er(d){var f,c;try{const n=await $.post("/api/email/send",d);if(n.data.success){const r=n.data.data;return r.testMode?l.success("Email logged successfully (Test Mode)"):l.success(`Email sent successfully via ${r.provider}!`),n.data.data}throw new Error(n.data.message||"Failed to send email")}catch(n){console.error("Error sending email:",n);const r=((c=(f=n.response)==null?void 0:f.data)==null?void 0:c.message)||"Failed to send email";throw l.error(r),n}}async function sr(){var d,f;try{const c=await $.get("/api/email/status");if(c.data.success)return c.data.data;throw new Error(c.data.message||"Failed to get email service status")}catch(c){console.error("Error getting email service status:",c);const n=((f=(d=c.response)==null?void 0:d.data)==null?void 0:f.message)||"Failed to get email service status";throw l.error(n),c}}const ar=Hs().shape({listName:K().required("List Name is required").min(2,"List Name must be at least 2 characters"),description:K().required("Description is required"),type:K().required("Type is required"),contacts:Ct().of(Hs().shape({fullName:K().required("Full Name is required").min(2,"Full Name must be at least 2 characters"),email:K().required("Email is required").email("Email is invalid"),phoneNumber:K().required("Phone Number is required").matches(/^\+1[0-9]{10}$/,"Phone Number must start with +1 followed by 10 digits (e.g., +1234567890)")})).required("Contacts are required").min(1,"At least one contact is required")});function tr(){t.useRef(null);const[d,f]=t.useState(!1),[c,n]=t.useState(0),{user:r}=qs(),{isSuperAdmin:T}=ot(),{register:b,control:G,handleSubmit:o,formState:{errors:i,isSubmitting:ge},reset:fe,watch:De,setValue:pe}=Nt({resolver:vt(ar),defaultValues:{listName:"",description:"",type:"General",contacts:[{fullName:"",email:"",phoneNumber:""}]}}),{fields:U,append:Ie,remove:H}=yt({control:G,name:"contacts"}),Le=()=>{var m,k;const C=dt.getItem("token");if(!C)return console.log("No token found in storage"),null;try{const u=mt(C);console.log("Decoded token:",u);let w=null;return(m=u.user)!=null&&m.id?w=u.user.id:(k=u.user)!=null&&k.user_id?w=u.user.user_id:u.id?w=u.id:u.user_id&&(w=u.user_id),console.log("Extracted userId:",w),w}catch(u){return console.error("Error decoding token:",u),null}},ds=async C=>{if(!T)try{const u=(await $.get("/api/credits/balance")).data.data;if(!u||parseFloat(u.available_credits)<1){n((u==null?void 0:u.available_credits)||0),f(!0);return}}catch(k){console.error("Error checking credit balance:",k),l.error("Unable to verify credit balance. Please try again.");return}const m=Le();if(!m){l.error("User ID not found. Please log in again.");return}try{const k=await Qa({listName:C.listName,description:C.description,type:C.type}),u=C.contacts.map(R=>({email:R.email,contact_number:R.phoneNumber,first_name:R.fullName})),w={user_id:m,list_name:C.listName,list_description:C.description,contacts:u};await Ja(w),fe({listName:"",description:"",type:"General",contacts:[{fullName:"",email:"",phoneNumber:""}]}),l.success("Contact List created successfully!"),typeof window<"u"&&window.location.reload()}catch(k){console.error("Error submitting form:",k),l.error("Failed to create contact list. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(wt,{className:"text-xl font-semibold jakarta bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent mb-1",children:"Create Contact List"}),e.jsx(St,{className:"text-muted-foreground mb-6",children:"Create a new contact list for your voice AI agents to use for campaigns."}),e.jsxs("form",{onSubmit:o(ds),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Da,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-sm font-medium",children:"List Information"})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"listName",className:"text-sm font-medium text-foreground mb-1.5 block",children:["List Name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(v,{id:"listName",placeholder:"Enter contact list name",className:"w-full border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20",...b("listName")}),i.listName&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.listName.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"description",className:"text-sm font-medium text-foreground mb-1.5 block",children:["Description",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(It,{id:"description",placeholder:"Enter contact list description",className:"w-full min-h-[80px] border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20",...b("description")}),i.description&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.description.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"type",className:"text-sm font-medium text-foreground mb-1.5 block",children:["Type",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(Ft,{value:De("type"),onValueChange:C=>pe("type",C),children:[e.jsx(Gt,{className:"w-full border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20",children:e.jsx(Pt,{placeholder:"Select list type"})}),e.jsxs(Dt,{children:[e.jsx(he,{value:"General",children:"General"}),e.jsx(he,{value:"Marketing",children:"Marketing"}),e.jsx(he,{value:"Sales",children:"Sales"}),e.jsx(he,{value:"Event",children:"Event"}),e.jsx(he,{value:"Customer",children:"Customer"})]})]}),i.type&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.type.message})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(rs,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-sm font-medium",children:"Contacts"}),e.jsx("span",{className:"text-xs text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-4",children:[U.map((C,m)=>{var k,u,w,R,be,je,X,Ne,q;return e.jsxs("div",{className:"border border-border/50 rounded-lg p-4 mb-4 relative bg-card/50",children:[U.length>1&&e.jsx("button",{type:"button",onClick:()=>H(m),className:"absolute top-3 right-3 text-muted-foreground hover:text-red-500 transition-colors",title:"Remove Contact",children:e.jsx(Ia,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx("div",{className:"h-6 w-6 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-primary",children:m+1})}),e.jsxs("h4",{className:"text-sm font-medium",children:["Contact ",m+1]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs(E,{htmlFor:`contacts.${m}.fullName`,className:"text-sm font-medium text-foreground mb-1.5 block",children:["Full Name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"relative",children:e.jsx(v,{id:`contacts.${m}.fullName`,type:"text",placeholder:"Enter full name",className:"w-full border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20",...b(`contacts.${m}.fullName`)})}),((u=(k=i.contacts)==null?void 0:k[m])==null?void 0:u.fullName)&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:(w=i.contacts[m].fullName)==null?void 0:w.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:`contacts.${m}.email`,className:"text-sm font-medium text-foreground mb-1.5 block",children:["Email",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(v,{id:`contacts.${m}.email`,type:"email",placeholder:"Enter contact email",className:"w-full pl-10 border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20",...b(`contacts.${m}.email`)})]}),((be=(R=i.contacts)==null?void 0:R[m])==null?void 0:be.email)&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:(je=i.contacts[m].email)==null?void 0:je.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:`contacts.${m}.phoneNumber`,className:"text-sm font-medium text-foreground mb-1.5 block",children:["Phone Number",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(v,{id:`contacts.${m}.phoneNumber`,type:"tel",placeholder:"Enter phone number with +1 (e.g., +1234567890)",className:"w-full pl-10 border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20",...b(`contacts.${m}.phoneNumber`)})]}),((Ne=(X=i.contacts)==null?void 0:X[m])==null?void 0:Ne.phoneNumber)&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:(q=i.contacts[m].phoneNumber)==null?void 0:q.message})]})]})]},C.id)}),e.jsxs(h,{type:"button",variant:"outline",className:"w-full border-dashed border-border/50 hover:bg-muted/20 flex items-center justify-center gap-2 py-6",onClick:()=>Ie({fullName:"",email:"",phoneNumber:""}),children:[e.jsx(ls,{className:"w-4 h-4"}),"Add Another Contact"]})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-3",children:[e.jsx(Et,{asChild:!0,children:e.jsx(h,{type:"button",variant:"outline",className:"border-border/50 text-foreground hover:bg-muted/20",children:"Cancel"})}),e.jsx(h,{type:"submit",className:"btn-gradient text-white",disabled:ge,children:ge?"Creating...":"Create List"})]})]}),e.jsx(ns,{open:d,onOpenChange:f,children:e.jsxs(cs,{className:"sm:max-w-md",children:[e.jsx(is,{children:e.jsxs(os,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Insufficient Credits"}),e.jsx("p",{className:"text-sm text-gray-500 font-normal",children:"You need credits to create contact lists"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Current Balance:"}),e.jsxs("span",{className:"font-semibold",children:[c," credits"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Required:"}),e.jsx("span",{className:"font-semibold text-red-600",children:"1 credit minimum"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{variant:"outline",onClick:()=>f(!1),className:"flex-1",children:"Cancel"}),e.jsx(h,{onClick:()=>{f(!1),window.location.href="/credits"},className:"flex-1 bg-primary hover:bg-primary/90",children:"Buy Credits"})]})]})]})})]})}const qr=()=>{bt(),jt();const{isSuperAdmin:d}=$t(),{user:f}=qs(),[c,n]=t.useState([]),[r,T]=t.useState(null),[b,G]=t.useState([]),[o,i]=t.useState(null),[ge,fe]=t.useState(!0),[De,pe]=t.useState(!1),[U,Ie]=t.useState(""),[H,Le]=t.useState(""),[ds,C]=t.useState("list"),[m,k]=t.useState("list"),[u,w]=t.useState(1),[R,be]=t.useState(0),[je,X]=t.useState(!1),[Ne,q]=t.useState(!1),[Os,Bs]=t.useState(0),[ye,ee]=t.useState(!1),[A,se]=t.useState({fullName:"",email:"",phoneNumber:""}),[Vs,ve]=t.useState(!1),[P,Y]=t.useState({fullName:"",email:"",phoneNumber:""}),[Ws,ae]=t.useState(!1),[S,Xs]=t.useState(null),[z,Ys]=t.useState([]),[ms,Qs]=t.useState([]),[O,Me]=t.useState(""),[Q,Te]=t.useState(""),[us,xs]=t.useState(!1),[D,_e]=t.useState(null),[_,$e]=t.useState(!1),[te,Ce]=t.useState(!1),[B,Ue]=t.useState(!1),[I,He]=t.useState(null),[Js,we]=t.useState(0),[Se,Re]=t.useState(null),[L,qe]=t.useState(null),[hs,ze]=t.useState(null),[Oe,Be]=t.useState([]),[Ks,gs]=t.useState(!1),[fs,ps]=t.useState(1),[bs,Ve]=t.useState(0),[Zs,js]=t.useState(null),[ea,Ns]=t.useState(!1),[sa,ys]=t.useState(!1),[Ee,vs]=t.useState(null),[aa,ke]=t.useState(!1),[J,ta]=t.useState(null),[g,V]=t.useState({to:"",cc:"",bcc:"",subject:"",body:"",attachments:[]}),[We,Cs]=t.useState(!1),[Ae,ws]=t.useState(!1),[rr,Ss]=t.useState(!1),[Xe,Es]=t.useState(!1),[ra,ks]=t.useState(!1),[la,Ye]=t.useState(""),[As,Fs]=t.useState(!1),[Gs,Ps]=t.useState(!1),re=async()=>{ks(!0);try{Ss(!0);try{const s=await zs();ws(s.isConnected),s.isConnected&&s.email?Ye(s.email):Ye("")}catch(s){console.error("Error checking Contact Gmail status:",s),ws(!1),Ye("")}finally{Ss(!1)}try{const s=await sr();Es(s.isConfigured)}catch(s){console.error("Error checking SMTP status:",s),Es(!1)}return{gmailConnected:Ae,smtpAvailable:Xe}}finally{ks(!1)}},na=async()=>{Fs(!0);try{await Jt(),await re()}catch(s){console.error("Error connecting Contact Gmail:",s)}finally{Fs(!1)}},ca=async()=>{Ps(!0);try{await Kt(),await re()}catch(s){console.error("Error unlinking Contact Gmail:",s)}finally{Ps(!1)}},ia=async()=>{if(d){X(!0);return}try{const a=(await $.get("/api/credits/balance")).data.data;if(!a||parseFloat(a.available_credits)<1){Bs((a==null?void 0:a.available_credits)||0),q(!0);return}X(!0)}catch(s){console.error("Error checking credit balance:",s),l.error("Unable to verify credit balance. Please try again.")}},Ds=async()=>{try{fe(!0);const s=await Ka(1,U,d);if(s.success){const a=Array.isArray(s.data)?s.data:[];n(a)}else n([])}catch(s){console.error("Error fetching lists:",s),n([])}finally{fe(!1)}};t.useEffect(()=>{re()},[]),t.useEffect(()=>{const s=()=>{re()};return window.addEventListener("focus",s),()=>window.removeEventListener("focus",s)},[]);const Fe=async s=>{var a,N,p,F,le,ne,ce,ie,oe,j,y,de,me,Pe;try{pe(!0);const x=await Za(s.toString(),u,H);if(console.log("Full API response:",x),x.success){const ue=Array.isArray((a=x.data)==null?void 0:a.contacts)?x.data.contacts:[];console.log("Extracted contacts:",ue),G(ue),be(((p=(N=x.data)==null?void 0:N.pagination)==null?void 0:p.totalPages)||1)}else console.log("Response not successful:",x),G([])}catch(x){console.error("Error fetching contacts:",x);const ue=M=>typeof M=="object"&&M!==null,Pa=M=>typeof M=="object"&&M!==null&&"message"in M&&typeof M.message=="string";if(ue(x)&&(((F=x.response)==null?void 0:F.status)===404||((ce=(ne=(le=x.response)==null?void 0:le.data)==null?void 0:ne.message)==null?void 0:ce.toLowerCase().includes("not found"))||((j=(oe=(ie=x.response)==null?void 0:ie.data)==null?void 0:oe.error)==null?void 0:j.toLowerCase().includes("not found"))))console.error("Error details:",((Pe=x.response)==null?void 0:Pe.data)||x.message);else if(ue(x)){console.error("Error details:",((y=x.response)==null?void 0:y.data)||x.message);const M=((me=(de=x.response)==null?void 0:de.data)==null?void 0:me.error)||x.message||"Unknown error occurred";l.error(`Failed to fetch contacts: ${M}`)}else Pa(x)?(console.error("Error details:",x.message),l.error(`Failed to fetch contacts: ${x.message}`)):(console.error("Error details:",String(x)),l.error("Failed to fetch contacts: Unknown error occurred"));G([])}finally{pe(!1)}};t.useEffect(()=>{Ds()},[U,d]),t.useEffect(()=>{r&&Fe(r.id)},[r,u,H]),t.useEffect(()=>{o&&o.phoneNumber&&ma(o)},[o,fs]);const oa=s=>{if(s.is_deleted&&!d){l.error("This list has been disabled and is not accessible.");return}console.log("Selected list:",s),T(s),i(null),ee(!1),ve(!1),w(1)},da=s=>{i(s),Be([]),ps(1),Ve(0)},ma=async s=>{if(s.phoneNumber)try{gs(!0);const a=await ut(s.phoneNumber,fs,10);Be(a.calls),Ve(a.totalCalls)}catch(a){console.error("Error fetching call history:",a),Be([]),Ve(0)}finally{gs(!1)}},ua=async s=>{if(Us(s))try{js(s),Ns(!0)}catch(a){console.error("Error playing recording:",a),l.error("Failed to play recording")}},xa=s=>{se({fullName:s.fullName||"",email:s.email||"",phoneNumber:s.phoneNumber||""}),ee(!0)},ha=async()=>{if(!o)return;const s=/^\+1[0-9]{10}$/;if(A.phoneNumber&&!s.test(A.phoneNumber)){l.error("Phone Number must start with +1 followed by 10 digits (e.g., +1234567890)");return}try{await st(o.id.toString(),A),l.success("Contact updated successfully"),ee(!1),r&&Fe(r.id),i({...o,...A})}catch(a){console.error("Error updating contact:",a)}},ga=()=>{ee(!1),se({fullName:"",email:"",phoneNumber:""})},fa=async()=>{if(!r||!P.fullName||!P.email||!P.phoneNumber){l.error("Please fill in all required fields");return}if(!/^\+1[0-9]{10}$/.test(P.phoneNumber)){l.error("Phone Number must start with +1 followed by 10 digits (e.g., +1234567890)");return}try{await et(r.id.toString(),{fullName:P.fullName,email:P.email,contact_number:P.phoneNumber,phoneNumber:P.phoneNumber}),l.success("Contact added successfully"),Fe(r.id),n(a=>a.map(N=>N.id===r.id?{...N,contactCount:N.contactCount+1}:N)),ve(!1),Y({fullName:"",email:"",phoneNumber:""})}catch(a){console.error("Error adding contact:",a)}},pa=()=>{ve(!1),Y({fullName:"",email:"",phoneNumber:""})},ba=async()=>{var s,a,N;try{const[p,F]=await Promise.all([ct(""),it()]);console.log("ðŸ” Debug - Loaded dialer data:",{agentsCount:((s=p==null?void 0:p.data)==null?void 0:s.length)||0,phoneNumbersCount:((a=F==null?void 0:F.data)==null?void 0:a.length)||0,sampleAgent:(N=p==null?void 0:p.data)!=null&&N[0]?{id:p.data[0].id,assistant_id:p.data[0].assistant_id,name:p.data[0].name}:null}),Ys((p==null?void 0:p.data)||[]),Qs((F==null?void 0:F.data)||[])}catch(p){console.error("Error loading dialer data:",p)}},Is=async s=>{if(!s.phoneNumber){l.error("Contact has no phone number");return}Xs(s),ae(!0),(z.length===0||ms.length===0)&&await ba()},ja=s=>{if(!s.phoneNumber){l.error("Contact has no phone number for messaging");return}vs(s),ys(!0)},Na=s=>{if(!s.email){l.error("Contact has no email address");return}ta(s),V({to:s.email,cc:"",bcc:"",subject:"",body:"",attachments:[]}),ke(!0)},ya=async()=>{if(!g.to||!g.subject||!g.body){l.error("Please fill in To, Subject, and Body fields");return}const s=await re();if(!s.gmailConnected&&!s.smtpAvailable){l.error("No email service available. Please connect Gmail or configure SMTP.");return}Cs(!0);try{s.gmailConnected?await Zt({to:g.to,cc:g.cc||void 0,bcc:g.bcc||void 0,subject:g.subject,body:g.body,isHtml:!1}):s.smtpAvailable&&await er({to:g.to,cc:g.cc||void 0,bcc:g.bcc||void 0,subject:g.subject,body:g.body,isHtml:!1}),ke(!1),V({to:"",cc:"",bcc:"",subject:"",body:"",attachments:[]})}catch(a){console.error("Error sending email:",a)}finally{Cs(!1)}},va=s=>{let a=s.replace(/\D/g,"");if(a.length===10)a="1"+a;else if(!(a.length===11&&a.startsWith("1"))){if(a.length<10)throw new Error("Phone number is too short")}return"+"+a},Ca=async()=>{var N,p,F,le,ne,ce,ie,oe;if(!S||!O||!Q){l.error("Please select an agent and from number");return}console.log("ðŸ” Debug - Making call with:",{selectedAgent:O,availableAgents:z.map(j=>({id:j.id,assistant_id:j.assistant_id,name:j.name})),dialerContact:S.fullName,selectedFromNumber:Q});let s=z.find(j=>j.id===O);if(s||(s=z.find(j=>j.assistant_id===O)),!s){console.error("âŒ Selected agent not found in agents array:",{selectedAgent:O,availableAgentIds:z.map(j=>j.id),availableAssistantIds:z.map(j=>j.assistant_id)}),l.error("Selected agent not found");return}const a=s.assistant_id||s.id;console.log("Making call with:",{selectedAgentData:s,assistantUUID:a,originalPhoneNumber:S.phoneNumber,selectedFromNumber:Q}),xs(!0);try{const j=va(S.phoneNumber);console.log("Formatted phone number:",j);const y=await tt({assistantId:a,phoneNumber:j,phoneNumberId:Q,metadata:{contactId:S.id,contactName:S.fullName,listId:r==null?void 0:r.id,listName:r==null?void 0:r.list_name}});console.log("ðŸ“ž Call response:",y),console.log("ðŸ“ž Call response structure:",{id:y.id,callId:y.callId,data:y.data,monitor:y.monitor,dataMonitor:(N=y.data)==null?void 0:N.monitor,controlUrl:((p=y.monitor)==null?void 0:p.controlUrl)||((le=(F=y.data)==null?void 0:F.monitor)==null?void 0:le.controlUrl)}),l.success(`Call initiated to ${S.fullName}`),ze(y);const de=y.id||y.callId||((ne=y.data)==null?void 0:ne.id),me=((ce=y.monitor)==null?void 0:ce.controlUrl)||((oe=(ie=y.data)==null?void 0:ie.monitor)==null?void 0:oe.controlUrl);console.log("ðŸ“ž Extracted call control data:",{callId:de,controlUrl:me}),He(de),qe(me),$e(!0),we(0);const Pe=setInterval(()=>{we(x=>x+1)},1e3);Re(Pe)}catch(j){console.error("Error making call:",j)}finally{xs(!1)}},wa=async()=>{if(console.log("ðŸ”‡ Mute toggle - Call control data:",{currentCallId:I,callControlUrl:L,isMuted:te,callData:hs}),!I||!L){console.error("âŒ Call control not available:",{currentCallId:I,callControlUrl:L}),l.error("Call control not available - missing call ID or control URL");return}try{te?(await rt(I,L),Ce(!1)):(await lt(I,L),Ce(!0))}catch(s){console.error("Error toggling mute:",s)}},Sa=()=>{Ue(!B),l.success(B?"Call resumed":"Call on hold")},Ea=async()=>{if(console.log("ðŸ“ž End call - Call control data:",{currentCallId:I,callControlUrl:L,callData:hs}),!I||!L){console.error("âŒ Call control not available:",{currentCallId:I,callControlUrl:L}),Se&&(clearInterval(Se),Re(null)),$e(!1),Ce(!1),Ue(!1),He(null),qe(null),ze(null),we(0),ae(!1),Me(""),Te("");return}Se&&(clearInterval(Se),Re(null)),$e(!1),Ce(!1),Ue(!1),He(null),qe(null),ze(null),we(0),ae(!1),Me(""),Te("");try{nt(I,L).catch(s=>{console.error("Background call ending failed:",s)})}catch(s){console.error("Error initiating call end:",s)}},ka=s=>{const a=Math.floor(s/60),N=s%60;return`${a.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`},Aa=()=>{r&&(i(null),ee(!1),ve(!0),Y({fullName:"",email:"",phoneNumber:""}))},Fa=s=>{_e(s)},Ga=async()=>{if(!(!r||!D))try{await at(r.id.toString(),D.id.toString()),l.success("Contact removed from list successfully"),Fe(r.id),n(s=>s.map(a=>a.id===r.id?{...a,contactCount:Math.max(0,a.contactCount-1)}:a)),(o==null?void 0:o.id)===D.id&&i(null),_e(null)}catch(s){console.error("Error removing contact:",s)}},Ls=s=>s.substring(0,2).toUpperCase(),Qe=s=>s?s.replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3"):"N/A",Ge=Array.isArray(c)?c.filter(s=>s.list_name.toLowerCase().includes(U.toLowerCase())):[],Je=Array.isArray(b)?b.filter(s=>{var a;return s.email.toLowerCase().includes(H.toLowerCase())||((a=s.fullName)==null?void 0:a.toLowerCase().includes(H.toLowerCase()))}):[];return e.jsxs(Ya,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Contacts"}),e.jsx(Ke,{variant:"secondary",className:"px-3 py-1 bg-red-100 text-red-600",children:e.jsx("span",{children:Ge.length})}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Total Contact groups: ",Ge.length]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(h,{onClick:ia,className:"bg-red-500 hover:bg-red-600",children:[e.jsx(ls,{className:"h-4 w-8 mr-2"}),"Add"]})})]}),e.jsxs("div",{className:"flex h-[calc(100vh-200px)] gap-4",children:[e.jsxs("div",{className:"w-80 bg-white border border-gray-300 rounded-lg flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Contact Groups"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(v,{placeholder:"Search",value:U,onChange:s=>Ie(s.target.value),className:"pl-10"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:ge?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Loading..."}):Ge.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No groups found"}):e.jsx("div",{className:"p-2",children:Ge.map(s=>e.jsx("div",{onClick:()=>oa(s),className:`flex items-center p-3 rounded-lg cursor-pointer mb-1 transition-colors ${(r==null?void 0:r.id)===s.id?"bg-gray-900 text-white":"hover:bg-gray-100"} ${s.is_deleted?"opacity-50":""}`,children:e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx(Ze,{className:"h-8 w-8",children:e.jsx(es,{className:(r==null?void 0:r.id)===s.id?"bg-gray-700":"bg-gray-200",children:s.list_name.substring(0,2).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:s.list_name}),e.jsxs("div",{className:`text-xs ${(r==null?void 0:r.id)===s.id?"text-gray-300":"text-gray-500"}`,children:[s.contactCount," contacts"]})]}),e.jsx(Ke,{variant:"secondary",className:"text-xs",children:s.contactCount})]})},s.id))})})]}),e.jsxs("div",{className:"flex-1 bg-white border border-gray-300 rounded-lg flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:r?r.list_name:"Default"}),r&&e.jsxs("p",{className:"text-sm text-gray-500",children:[Je.length," contacts"]})]}),e.jsxs(Ut,{modal:!1,children:[e.jsx(Ht,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm","aria-label":"Contact options",children:e.jsx(La,{className:"h-4 w-4"})})}),e.jsxs(Rt,{align:"end",side:"bottom",sideOffset:5,children:[e.jsxs(ts,{onClick:()=>Aa(),children:[e.jsx(Ts,{className:"h-4 w-4 mr-2"}),"Add Contacts"]}),e.jsx(Rs,{}),e.jsxs(ts,{onClick:()=>o&&xa(o),disabled:!o,children:[e.jsx(Ma,{className:"h-4 w-4 mr-2"}),"Edit Contact"]}),e.jsx(Rs,{}),e.jsxs(ts,{onClick:()=>o&&Fa(o),className:"text-red-600 focus:text-red-600",disabled:!o,children:[e.jsx(Ta,{className:"h-4 w-4 mr-2"}),"Remove from List"]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ms,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(v,{placeholder:"Search",value:H,onChange:s=>Le(s.target.value),className:"pl-10"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:r?De?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Loading contacts..."}):Je.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Z,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No contacts found in this group"})]})}):e.jsx("div",{className:"p-2",children:Je.map(s=>e.jsx("div",{onClick:()=>da(s),className:`flex items-center p-3 rounded-lg cursor-pointer mb-1 transition-colors ${(o==null?void 0:o.id)===s.id?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx(Ze,{className:"h-10 w-10",children:e.jsx(es,{className:"bg-green-100 text-green-600",children:Ls(s.email)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.fullName||"No Name"}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:s.email})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{size:"sm",className:"rounded-full bg-green-600 hover:bg-green-700 text-white shadow-md p-2",onClick:a=>{a.stopPropagation(),Is(s)},children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(h,{size:"sm",className:"rounded-full bg-orange-600 hover:bg-orange-700 text-white shadow-md p-2",onClick:a=>{a.stopPropagation(),Na(s)},children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(h,{size:"sm",className:"rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-md p-2",onClick:a=>{a.stopPropagation(),ja(s)},children:e.jsx(_s,{className:"h-4 w-4"})})]})]})},s.id))}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(rs,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Select a contact group to view contacts"})]})})})]}),e.jsx("div",{className:"w-96 bg-white border border-gray-300 rounded-lg flex flex-col",children:Vs?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-16 w-16 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Ts,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Add New Contact"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Add contact to ",r==null?void 0:r.list_name]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:pa,children:"Cancel"}),e.jsx(h,{size:"sm",onClick:fa,children:"Save"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Contact Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),e.jsx(v,{value:P.fullName,onChange:s=>Y(a=>({...a,fullName:s.target.value})),placeholder:"Enter full name",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),e.jsx(v,{type:"email",value:P.email,onChange:s=>Y(a=>({...a,email:s.target.value})),placeholder:"Enter email address",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number *"}),e.jsx(v,{type:"tel",value:P.phoneNumber,onChange:s=>Y(a=>({...a,phoneNumber:s.target.value})),placeholder:"Enter phone number with +1 (e.g., +1234567890)",className:"w-full"})]})]})]})})})]}):o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(Ze,{className:"h-16 w-16",children:e.jsx(es,{className:"bg-green-100 text-green-600 text-xl",children:Ls(o.email)})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(h,{size:"sm",className:"rounded-full bg-green-600 hover:bg-green-700 text-white shadow-md p-2",onClick:()=>o&&Is(o),children:e.jsx(W,{className:"h-4 w-4"})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-1",children:ye?A.fullName||"No Name":o.fullName||"No Name"}),e.jsx("p",{className:"text-sm text-gray-500",children:Qe(ye?A.phoneNumber:o.phoneNumber)})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"General Info"}),ye&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:ga,children:"Cancel"}),e.jsx(h,{size:"sm",onClick:ha,children:"Save"})]})]}),ye?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-900 block mb-1",children:"Full Name"}),e.jsx(v,{value:A.fullName,onChange:s=>se({...A,fullName:s.target.value}),placeholder:"Enter full name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-900 block mb-1",children:"Phone Number"}),e.jsx(v,{value:A.phoneNumber,onChange:s=>se({...A,phoneNumber:s.target.value}),placeholder:"Enter phone number with +1 (e.g., +1234567890)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-900 block mb-1",children:"Email Address"}),e.jsx(v,{value:A.email,onChange:s=>se({...A,email:s.target.value}),placeholder:"Enter email address",type:"email"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(W,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Phone Number"}),e.jsx("p",{className:"text-sm text-gray-500",children:Qe(o.phoneNumber)})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Z,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Email Address"}),e.jsx("p",{className:"text-sm text-gray-500",children:o.email})]})]})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Labels"}),e.jsx(h,{variant:"ghost",size:"sm",children:e.jsx(ls,{className:"h-4 w-4"})})]})}),e.jsx("div",{children:e.jsxs(Tt,{defaultValue:"notes",className:"w-full",children:[e.jsxs(_t,{className:"grid w-full grid-cols-3",children:[e.jsx(ss,{value:"notes",className:"text-xs",children:"Notes"}),e.jsx(ss,{value:"calls",className:"text-xs",children:"Call History"}),e.jsx(ss,{value:"chats",className:"text-xs",children:"Chat History"})]}),e.jsx(as,{value:"notes",className:"mt-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_a,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"No notes yet"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Add your first note using the text area above"})]})}),e.jsx(as,{value:"calls",className:"mt-4",children:Ks?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(xe,{className:"h-8 w-8 mx-auto mb-4 text-gray-400 animate-spin"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading call history..."})]}):Oe.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No call history"})]}):e.jsxs("div",{className:"space-y-3",children:[Oe.map(s=>{const a=xt(s.status),N=Us(s);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:ht(s.created_at)}),e.jsx(Ke,{variant:"secondary",className:`text-xs ${a.color}`,children:a.text})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[N&&e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>ua(s),className:"h-6 w-6 p-0",children:e.jsx($a,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs text-gray-500",children:gt(s.duration)})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:s.assistant_name||"Unknown Assistant"}),e.jsx("span",{children:ft(s.cost)})]})]},s.call_id)}),bs>10&&e.jsx("div",{className:"text-center pt-4",children:e.jsx(h,{variant:"outline",size:"sm",onClick:()=>ps(s=>s+1),disabled:Oe.length>=bs,children:"Load More"})})]})}),e.jsx(as,{value:"chats",className:"mt-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_s,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No chat history"})]})})]})})]})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(rs,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Select a contact to view details"})]})})})]}),e.jsx(ns,{open:Ne,onOpenChange:q,children:e.jsxs(cs,{className:"sm:max-w-md",children:[e.jsx(is,{children:e.jsxs(os,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx($s,{className:"w-4 h-4 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Insufficient Credits"}),e.jsx("p",{className:"text-sm text-gray-500 font-normal",children:"You need credits to create contact lists"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Current Balance:"}),e.jsxs("span",{className:"font-semibold",children:[Os," credits"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Required:"}),e.jsx("span",{className:"font-semibold text-red-600",children:"1 credit minimum"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{variant:"outline",onClick:()=>q(!1),className:"flex-1",children:"Cancel"}),e.jsx(h,{onClick:()=>{q(!1),window.location.href="/credits"},className:"flex-1 bg-primary hover:bg-primary/90",children:"Buy Credits"})]})]})]})}),e.jsx(kt,{open:je,onOpenChange:s=>{X(s),s||Ds()},children:e.jsx(At,{size:"half",children:e.jsx(tr,{})})}),e.jsx(qt,{open:!!D,onOpenChange:()=>_e(null),children:e.jsxs(zt,{children:[e.jsxs(Ot,{children:[e.jsx(Bt,{children:"Remove Contact from List"}),e.jsxs(Vt,{children:['Are you sure you want to remove "',(D==null?void 0:D.fullName)||(D==null?void 0:D.email),'" from this list? This action cannot be undone.']})]}),e.jsxs(Wt,{children:[e.jsx(Xt,{children:"Cancel"}),e.jsx(Yt,{onClick:Ga,className:"bg-red-600 hover:bg-red-700",children:"Remove Contact"})]})]})}),Ws&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-sm mx-auto overflow-hidden",children:[e.jsx("div",{className:`px-6 py-4 text-white ${_?"bg-green-600":"bg-primary"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),_?"Active Call":"Make Call"]}),!_&&e.jsx("button",{onClick:()=>ae(!1),className:"text-white hover:text-gray-200 transition-colors text-2xl leading-none",children:"Ã—"}),_&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ua,{className:"h-4 w-4"}),ka(Js)]})]})}),e.jsx("div",{className:"px-6 py-6 bg-white",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-16 h-16 border-2 border-gray-300 rounded-full flex items-center justify-center shadow-sm ${_?"bg-green-500 animate-pulse":"bg-green-500"}`,children:e.jsx(Ha,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"rounded px-3 mb-2 bg-gray-50 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Name"}),e.jsx("p",{className:"font-medium text-gray-900",children:S==null?void 0:S.fullName})]}),e.jsxs("div",{className:"rounded px-3 bg-gray-50 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Number"}),e.jsx("p",{className:"font-medium text-gray-900",children:S==null?void 0:S.phoneNumber})]}),_&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${B?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:B?"On Hold":"Connected"})})]})]})}),!_&&e.jsxs("div",{className:"px-6 py-4 space-y-4 bg-white border-t border-gray-200",children:[e.jsx("div",{className:"border border-gray-300 rounded-lg bg-gray-50",children:e.jsxs("select",{value:O,onChange:s=>Me(s.target.value),className:"w-full bg-transparent text-gray-900 px-4 py-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent appearance-none",children:[e.jsx("option",{value:"",children:"Agent"}),z.map(s=>e.jsx("option",{value:s.assistant_id||s.id,children:s.name||s.id},s.id))]})}),e.jsx("div",{className:"border border-gray-300 rounded-lg bg-gray-50",children:e.jsxs("select",{value:Q,onChange:s=>Te(s.target.value),className:"w-full bg-transparent text-gray-900 px-4 py-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent appearance-none",children:[e.jsx("option",{value:"",children:"From Number"}),ms.map(s=>e.jsx("option",{value:s.id,children:s.number||s.friendlyName},s.id))]})})]}),e.jsx("div",{className:"px-6 py-6 bg-white border-t border-gray-200",children:_?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-6",children:[e.jsx("button",{onClick:wa,className:`w-16 h-16 rounded-full flex items-center justify-center transition-all ${te?"bg-red-500 hover:bg-red-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:te?e.jsx(Ra,{className:"h-6 w-6"}):e.jsx(qa,{className:"h-6 w-6"})}),e.jsx("button",{onClick:Ea,className:"w-20 h-20 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-colors shadow-lg",children:e.jsx(za,{className:"h-8 w-8"})}),e.jsx("button",{onClick:Sa,className:`w-16 h-16 rounded-full flex items-center justify-center transition-all ${B?"bg-yellow-500 hover:bg-yellow-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:B?e.jsx(Oa,{className:"h-6 w-6"}):e.jsx(Ba,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-6 text-xs text-gray-500",children:[e.jsx("span",{className:"w-16 text-center",children:te?"Unmute":"Mute"}),e.jsx("span",{className:"w-20 text-center",children:"End Call"}),e.jsx("span",{className:"w-16 text-center",children:B?"Resume":"Hold"})]})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsx("button",{onClick:()=>ae(!1),className:"flex-1 py-3 px-6 bg-red-700 text-white hover:bg-red-800 rounded-full font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Ca,disabled:!O||!Q||us,className:"flex-1 py-3 bg-green-700 hover:bg-green-800 text-white px-6 rounded-full font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:us?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin mr-2"}),"Calling..."]}):"Call"})]})})]})}),e.jsx(pt,{call:Zs,isOpen:ea,onClose:()=>{Ns(!1),js(null)}}),Ee&&e.jsx(Qt,{isOpen:sa,contact:{id:Ee.id.toString(),email:Ee.email,contact_number:Ee.phoneNumber,list_name:r==null?void 0:r.list_name},onClose:()=>{ys(!1),vs(null)}}),e.jsx(ns,{open:aa,onOpenChange:ke,children:e.jsxs(cs,{className:"max-w-7xl max-h-[80vh] flex flex-col",children:[e.jsxs(is,{children:[e.jsxs(os,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5 text-orange-600"}),"Compose Email"]}),e.jsxs(Lt,{children:["Send an email to ",(J==null?void 0:J.fullName)||(J==null?void 0:J.email)]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"from",className:"text-sm font-medium text-gray-700 mb-1 block",children:"From"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{id:"from",value:la||"",disabled:!0,className:"bg-gray-50",placeholder:"Connect Gmail to send emails"}),e.jsx("div",{className:"flex items-center gap-3",children:Ae?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full"}),"Gmail Connected"]}),e.jsx(h,{variant:"outline",size:"sm",onClick:ca,disabled:Gs,className:"text-red-600 border-red-600 hover:bg-red-50",children:Gs?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-2 animate-spin"}),"Unlinking..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Va,{className:"h-4 w-4 mr-2"}),"Unlink Gmail"]})})]}):e.jsx(h,{variant:"outline",size:"sm",onClick:na,disabled:As,className:"text-blue-600 border-blue-600 hover:bg-blue-50",children:As?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-2 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Link Gmail"]})})})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"to",className:"text-sm font-medium text-gray-700 mb-1 block",children:"To *"}),e.jsx(v,{id:"to",value:g.to,onChange:s=>V(a=>({...a,to:s.target.value})),placeholder:"Enter recipient email"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"cc",className:"text-sm font-medium text-gray-700 mb-1 block",children:"CC"}),e.jsx(v,{id:"cc",value:g.cc,onChange:s=>V(a=>({...a,cc:s.target.value})),placeholder:"Enter CC emails (comma separated)"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"bcc",className:"text-sm font-medium text-gray-700 mb-1 block",children:"BCC"}),e.jsx(v,{id:"bcc",value:g.bcc,onChange:s=>V(a=>({...a,bcc:s.target.value})),placeholder:"Enter BCC emails (comma separated)"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"subject",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Subject *"}),e.jsx(v,{id:"subject",value:g.subject,onChange:s=>V(a=>({...a,subject:s.target.value})),placeholder:"Enter email subject"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"body",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Message *"}),e.jsx("textarea",{id:"body",value:g.body,onChange:s=>V(a=>({...a,body:s.target.value})),placeholder:"Enter your message...",className:"w-full min-h-[200px] p-3 border border-gray-300 rounded-md resize-y focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Attachments"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx(Wa,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Attachment support coming soon"})]})]})]}),e.jsxs(Mt,{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{variant:"outline",onClick:()=>ke(!1),disabled:We,children:"Cancel"}),e.jsx("div",{className:"flex items-center gap-2",children:ra?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(xe,{className:"h-4 w-4 animate-spin"}),"Checking email services..."]}):Ae?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full"}),"Ready to send via Gmail"]}):Xe?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"}),"Ready to send via SMTP"]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx($s,{className:"h-4 w-4"}),"No email service available"]})})]}),e.jsx(h,{onClick:ya,disabled:We||!g.to||!g.subject||!g.body||!Ae&&!Xe,className:"bg-orange-600 hover:bg-orange-700",children:We?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xa,{className:"h-4 w-4 mr-2"}),"Send Email"]})})]})]})})]})};export{qr as default};
//# sourceMappingURL=Lists-8J0iKSSe.js.map
