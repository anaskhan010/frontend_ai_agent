import{j as e,ck as tt,cl as ne,ah as st,G as $e,cm as De,O as We,T as Re,aH as Ze,bq as Ke,bA as Fe,av as qe,aT as ke,bg as at,bf as ot,M as rt,bh as nt,bi as lt,as as it,b5 as ue,aP as ct,a5 as dt,k as Ue,D as ut,cn as mt,co as gt,cp as pt,aY as ht,Z as xt}from"./ui-BZ34e_bG.js";import{r as o}from"./vendor-DG599jyl.js";import{u as ft,b as bt,c as Se}from"./query-BwaCLewj.js";import{B as D}from"./button-Cm3qqFtR.js";import{I as Ve}from"./input-DmGou_SQ.js";import{L as K}from"./label-C6Ng9AKs.js";import{T as _e}from"./textarea-CkpLCUXs.js";import{S as yt,a as vt,b as wt,c as Nt,d as jt}from"./select-DZgTcSvR.js";import{S as Ct}from"./switch-LNIGomjM.js";import{_ as kt}from"./vapi-CWmUDqtF.js";import{C as Pe,b as Ie,c as Me,a as Te}from"./card-BYrCuzD5.js";import{D as Je,a as Qe,b as St,c as Pt,d as It}from"./dialog-Dr0dXxlM.js";import{B as me}from"./badge-CiNZHaLO.js";import{t as k,e as ze}from"./index-glgaGrA-.js";import{T as Le,a as Ye,b as He,c as Be}from"./tooltip-DPhV29at.js";import{b as Mt,t as Tt}from"./workflowService-DP2bABw5.js";import{V as Xe}from"./vapiService-CiKxGyQU.js";import{d as Et,u as At}from"./router-BavLd_S0.js";import"./index-3J7IwK8P.js";import"./index-HDeFwIcs.js";import"./index-DwBQLlhe.js";import"./index-3sQo4lQ_.js";const Ge=({children:n,variant:x,size:d,className:S,onClick:P,...j})=>e.jsx("button",{className:`inline-flex items-center justify-center font-medium transition-colors ${S||""}`,onClick:P,...j,children:n}),Ee=({children:n,variant:x,className:d,...S})=>e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${d||""}`,...S,children:n}),$t=({data:n,selected:x,nodeId:d})=>{var T,m;const[S,P]=o.useState(!1),[j,R]=o.useState(n);o.useEffect(()=>{R(n)},[n]);const M=()=>{switch(n.type){case"conversation":return e.jsx(ne,{className:"h-4 w-4 text-blue-600"});case"apiRequest":return e.jsx("div",{className:"h-4 w-4 bg-purple-600 rounded"});case"transferCall":return e.jsx("div",{className:"h-4 w-4 bg-green-600 rounded"});case"endCall":return e.jsx("div",{className:"h-4 w-4 bg-red-600 rounded"});case"tool":return e.jsx("div",{className:"h-4 w-4 bg-orange-600 rounded"});default:return e.jsx(ne,{className:"h-4 w-4 text-blue-600"})}},C=()=>n.isStart?"border-green-500 bg-green-50":x?"border-blue-500 shadow-lg":"border-gray-300 hover:border-gray-400";return e.jsxs("div",{className:`group relative w-[280px] bg-gradient-to-br from-white via-gray-50/30 to-white border-2 rounded-2xl shadow-lg transition-all duration-300 cursor-move hover:shadow-xl hover:shadow-teal-500/10 hover:scale-102 ${C()}`,style:{filter:x?"drop-shadow(0 12px 28px rgba(20, 184, 166, 0.2))":"drop-shadow(0 6px 16px rgba(0, 0, 0, 0.08))",backdropFilter:"blur(8px)",background:x?"linear-gradient(135deg, #ffffff 0%, #f0fdfa 30%, #ffffff 100%)":"linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #ffffff 100%)"},draggable:!1,onMouseDown:f=>{const A=f.target;(A.closest("button")||A.closest('[role="button"]')||A.closest("[data-connection-point]"))&&(f.stopPropagation(),f.preventDefault())},title:"Click and drag to move this node",children:[e.jsx("div",{className:"absolute -top-1.5 left-1/2 transform -translate-x-1/2 w-3 h-3 bg-white border-2 border-teal-500 rounded-full cursor-crosshair transition-all duration-200 hover:scale-125 hover:border-teal-600 z-40",title:"Input connection point - drag from another node's output to connect here","data-connection-point":"input","data-node-id":d,style:{boxShadow:"0 0 0 1px rgba(255, 255, 255, 0.9), 0 2px 4px rgba(20, 184, 166, 0.3)"}}),e.jsx("div",{className:"p-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"h-4 w-4 text-gray-400 cursor-move"}),e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:M()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:j.name||"Conversation"}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[j.isStart&&e.jsxs(Ee,{variant:"secondary",className:"text-xs bg-green-100 text-green-700",children:[e.jsx(st,{className:"h-3 w-3 mr-1"}),"Start"]}),((T=j.globalNodePlan)==null?void 0:T.enabled)&&e.jsxs(Ee,{variant:"outline",className:"text-xs border-orange-200 text-orange-700",children:[e.jsx($e,{className:"h-3 w-3 mr-1"}),"Global"]}),j.variables&&j.variables.length>0&&e.jsxs(Ee,{variant:"outline",className:"text-xs border-purple-200 text-purple-700",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),j.variables.length]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-gray-100 rounded-md",onClick:f=>{f.stopPropagation(),f.preventDefault(),n.onConfigure?n.onConfigure():P(!0)},children:e.jsx(We,{className:"h-4 w-4 text-gray-500"})}),!j.isStart&&e.jsx(Ge,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-red-100 text-red-500 hover:text-red-700 rounded-md",onClick:f=>{f.stopPropagation(),f.preventDefault(),confirm("Are you sure you want to delete this node?")&&n.onDelete()},children:e.jsx(Re,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"p-3 space-y-2",children:e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-medium text-gray-900 mb-1",children:"Prompt"}),e.jsx("div",{className:"text-gray-600 leading-relaxed",children:((m=j.prompt)==null?void 0:m.length)>80?`${j.prompt.substring(0,80)}...`:j.prompt||"No prompt configured"})]})}),j.type!=="endCall"&&e.jsx("div",{className:"absolute -bottom-1.5 left-1/2 transform -translate-x-1/2 w-3 h-3 bg-white border-2 border-teal-500 rounded-full cursor-crosshair transition-all duration-200 hover:scale-125 hover:border-teal-600 z-40",title:"Output connection point - drag to another node's input to connect","data-connection-point":"output","data-node-id":d,onMouseDown:f=>{var A;if(f.stopPropagation(),f.preventDefault(),console.log("🔗 Starting manual connection from node:",d),n.onManualConnectionStart&&d){const O=f.currentTarget.getBoundingClientRect(),L=(A=f.currentTarget.closest("[data-canvas]"))==null?void 0:A.getBoundingClientRect();if(L){const B=O.left+O.width/2-L.left,Y=O.top+O.height/2-L.top;n.onManualConnectionStart(d,{x:B,y:Y})}}},style:{boxShadow:"0 0 0 1px rgba(255, 255, 255, 0.9), 0 2px 4px rgba(20, 184, 166, 0.3)"}}),j.type!=="endCall"&&e.jsx("div",{className:"absolute -bottom-12 left-1/2 transform -translate-x-1/2 z-30 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("button",{className:"w-8 h-8 bg-teal-500 hover:bg-teal-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl border-2 border-white hover:scale-110 active:scale-95",title:"Add new connected node",onClick:f=>{f.stopPropagation(),console.log("➕ Quick add node for:",d),n.onConnectionStart&&d&&n.onConnectionStart(d,{x:0,y:0})},style:{boxShadow:"0 0 0 2px rgba(255, 255, 255, 0.9), 0 4px 12px rgba(20, 184, 166, 0.3)"},children:e.jsx("span",{className:"text-lg font-bold leading-none",children:"+"})})})]})},Dt=({nodes:n,edges:x,onNodesChange:d,onEdgesChange:S,onNodeClick:P,selectedNode:j,nodeTypes:R,onEdgeLabelClick:M})=>{const[C,T]=o.useState(!1),[m,f]=o.useState(null),[A,O]=o.useState({x:0,y:0}),[L,B]=o.useState(0),[Y,i]=o.useState(!1),[b,F]=o.useState(1),[y,X]=o.useState({x:0,y:0}),[H,te]=o.useState(!1),[_,se]=o.useState({x:0,y:0}),[G,le]=o.useState({x:0,y:0}),[E,Z]=o.useState(!1),[s,N]=o.useState(null),[I,$]=o.useState({x:0,y:0}),U=o.useRef(null),z=o.useRef(n),J=o.useRef(d),ge=o.useRef(P);z.current=n,J.current=d,ge.current=P;const ae=o.useCallback(t=>{var h;t.preventDefault();const c=(h=U.current)==null?void 0:h.getBoundingClientRect();if(!c)return;const l=t.clientX-c.left,u=t.clientY-c.top,g=t.deltaY>0?.9:1.1,p=Math.min(Math.max(b*g,.1),3),v=p/b,w=l-(l-y.x)*v,a=u-(u-y.y)*v;F(p),X({x:w,y:a})},[b,y]),oe=o.useCallback(t=>{const c=t.target;c.closest("[data-node]")||c.closest("button")||c.closest("[data-connection-point]")||t.button===0&&(t.preventDefault(),te(!0),se({x:t.clientX,y:t.clientY}),le({...y}),document.body.style.cursor="grabbing")},[y]),Q=o.useCallback(t=>{if(H){t.preventDefault();const c=t.clientX-_.x,l=t.clientY-_.y;X({x:G.x+c,y:G.y+l})}},[H,_,G]),pe=o.useCallback(()=>{H&&(te(!1),document.body.style.cursor="default")},[H]),be=o.useCallback((t,c)=>{console.log("🔗 Starting manual connection from:",t,"at position:",c);const l=n.find(p=>p.id===t);if(!l){console.error("❌ Source node not found:",t);return}const u=l.position.x+140,g=l.position.y+180;Z(!0),N({nodeId:t,x:u,y:g}),document.body.style.cursor="crosshair",console.log("✅ Manual connection started from:",t,{x:u,y:g})},[n]),he=o.useCallback(t=>{var c;if(E){const l=(c=U.current)==null?void 0:c.getBoundingClientRect();if(l){const u=t.clientX-l.left,g=t.clientY-l.top,p=(u-y.x)/b,v=(g-y.y)/b;$({x:p,y:v})}}},[E,b,y]),xe=o.useCallback(t=>{var w;if(!E||!s)return;const c=(w=U.current)==null?void 0:w.getBoundingClientRect();if(!c)return;const l=t.clientX-c.left,u=t.clientY-c.top,g=(l-y.x)/b,p=(u-y.y)/b;console.log("🎯 Trying to complete connection at:",{mouseX:g,mouseY:p});const v=n.find(a=>{const h=a.position.x,V=a.position.x+280,W=a.position.y,q=a.position.y+180,ee=g>=h&&g<=V&&p>=W&&p<=q&&a.id!==s.nodeId;return ee&&console.log("🎯 Found target node:",a.id,{nodeBounds:{left:h,right:V,top:W,bottom:q},mousePos:{mouseX:g,mouseY:p}}),ee});if(v&&S)if(x.find(h=>h.source===s.nodeId&&h.target===v.id))console.log("⚠️ Connection already exists between these nodes");else{const h={id:`edge-${s.nodeId}-${v.id}-${Date.now()}`,source:s.nodeId,target:v.id,label:"Manual Connection",type:"default"},V=[...x,h];S(V),console.log("✅ Created manual connection:",s.nodeId,"->",v.id)}else console.log("❌ No valid target node found for connection");Z(!1),N(null),document.body.style.cursor="default"},[E,s,n,x,S]),ye=o.useCallback(t=>{console.log("➕ Adding new node after:",t);const c=n.find(w=>w.id===t);if(!c)return;const l=`node-${Date.now()}`,u={id:l,type:"conversation",position:{x:c.position.x,y:c.position.y+300},data:{type:"conversation",name:"New Conversation",prompt:"Enter your prompt here...",firstMessage:"",isStart:!1,variables:[],globalNodePlan:{enabled:!1}}},g={id:`edge-${t}-${l}`,source:t,target:l,label:"Auto Connection"},p=[...n,u],v=[...x,g];J.current(p),S&&S(v)},[n,x,S]),ve=o.useCallback((t,c)=>{var h;const l=t.target;if(l.closest("button")||l.closest('[role="button"]')||l.closest("[data-connection-point]"))return;t.preventDefault(),t.stopPropagation();const u=(h=U.current)==null?void 0:h.getBoundingClientRect();if(!u)return;const g=t.clientX-u.left,p=t.clientY-u.top,v=(g-y.x)/b,w=(p-y.y)/b,a={x:v-c.position.x,y:w-c.position.y};T(!0),f(c.id),O(a),i(!1)},[b,y]),we=o.useCallback(t=>{var c;if(Q(t),C&&m){t.preventDefault();const l=(c=U.current)==null?void 0:c.getBoundingClientRect();if(!l)return;const u=t.clientX-l.left,g=t.clientY-l.top,p=(u-y.x)/b,v=(g-y.y)/b,w=p-A.x,a=v-A.y,h=z.current.find(W=>W.id===m);if(h){const W=Math.abs(w-h.position.x),q=Math.abs(a-h.position.y);(W>2||q>2)&&i(!0)}const V=z.current.map(W=>W.id===m?{...W,position:{x:w,y:a}}:W);z.current=V,B(W=>W+1),J.current(V)}he(t)},[C,m,A,he,b,y,Q]),fe=o.useCallback(t=>{pe(),C&&(t.preventDefault(),T(!1),f(null),O({x:0,y:0})),xe(t)},[C,xe,pe]),ie=o.useCallback(t=>{Y||ge.current(t),i(!1)},[Y]),r=o.useCallback(()=>!x||x.length===0?null:x.map((t,c)=>{const l=z.current,u=l.find(ce=>ce.id===t.source),g=l.find(ce=>ce.id===t.target);if(!u||!g)return null;const p=u.position.x+140,v=u.position.y+160,w=g.position.x+140,a=g.position.y-8,h=p+(w-p)/2,V=v+(a-v)/2,W=Math.sqrt(Math.pow(w-p,2)+Math.pow(a-v,2)),q=Math.min(W*.4,100),ee=p,re=v+q,Ne=w,je=a-q,Ce=`M ${p} ${v} C ${ee} ${re}, ${Ne} ${je}, ${w} ${a}`;return e.jsxs("g",{children:[e.jsx("defs",{children:e.jsx("marker",{id:`arrowhead-${c}`,markerWidth:"8",markerHeight:"6",refX:"7",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:e.jsx("polygon",{points:"0 0, 8 3, 0 6",fill:"#6b7280"})})}),e.jsx("path",{d:Ce,stroke:"#6b7280",strokeWidth:"2",fill:"none",strokeLinecap:"round",markerEnd:`url(#arrowhead-${c})`,className:"transition-all duration-300 hover:stroke-teal-500"}),e.jsx("foreignObject",{x:h-60,y:V-12,width:"120",height:"24",className:"pointer-events-auto",children:e.jsx("div",{className:"bg-white text-gray-800 text-xs font-medium px-3 py-1 rounded-full text-center shadow-md border border-gray-200 cursor-pointer hover:shadow-lg transition-shadow",onClick:ce=>{ce.stopPropagation(),M&&M(t)},children:t.label||"Connection"})})]},`edge-${c}`)}),[x,L,M]);return e.jsxs("div",{className:"relative w-full h-full bg-gradient-to-br from-slate-50 via-white to-gray-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.12]",style:{backgroundImage:`
            linear-gradient(rgba(99, 102, 241, 0.15) 1px, transparent 1px),
            linear-gradient(90deg, rgba(99, 102, 241, 0.15) 1px, transparent 1px)
          `,backgroundSize:"24px 24px"}}),e.jsxs("div",{ref:U,"data-canvas":"true",className:"relative w-full h-full",onMouseDown:oe,onMouseMove:we,onMouseUp:fe,onMouseLeave:fe,onWheel:ae,style:{cursor:H?"grabbing":"grab"},children:[e.jsxs("div",{className:"absolute inset-0",style:{transform:`translate(${y.x}px, ${y.y}px) scale(${b})`,transformOrigin:"0 0"},children:[n.map(t=>{var c,l,u,g,p,v;return e.jsx("div",{"data-node":"true",className:"absolute",style:{left:t.position.x,top:t.position.y,zIndex:10},onMouseDown:w=>ve(w,t),onClick:()=>ie(t),children:e.jsx($t,{data:{name:((c=t.data)==null?void 0:c.name)||t.type,type:t.type,prompt:((l=t.data)==null?void 0:l.prompt)||"",firstMessage:((u=t.data)==null?void 0:u.firstMessage)||"",isStart:((g=t.data)==null?void 0:g.isStart)||!1,variables:((p=t.data)==null?void 0:p.variables)||[],globalNodePlan:((v=t.data)==null?void 0:v.globalNodePlan)||{enabled:!1},onUpdate:w=>{const a=z.current.map(h=>h.id===t.id?{...h,data:{...h.data,...w}}:h);J.current(a)},onDelete:()=>{const w=z.current.filter(h=>h.id!==t.id),a=x.filter(h=>h.source!==t.id&&h.target!==t.id);J.current(w),S&&S(a)},onConfigure:()=>ie(t),onConnectionStart:()=>ye(t.id),onManualConnectionStart:be},selected:(j==null?void 0:j.id)===t.id,nodeId:t.id})},t.id)}),e.jsxs("svg",{className:"absolute inset-0 pointer-events-none",style:{zIndex:5},width:"100%",height:"100%",children:[r(),E&&s&&e.jsxs("g",{children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"connectionPreview",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#14b8a6",stopOpacity:"1.0"}),e.jsx("stop",{offset:"100%",stopColor:"#06b6d4",stopOpacity:"0.8"})]})}),e.jsx("path",{d:`M ${s.x} ${s.y} Q ${s.x+(I.x-s.x)/2} ${s.y+50}, ${I.x} ${I.y}`,stroke:"url(#connectionPreview)",strokeWidth:"3",fill:"none",strokeLinecap:"round",strokeDasharray:"8,4",className:"animate-pulse"}),e.jsx("circle",{cx:I.x,cy:I.y,r:"6",fill:"#14b8a6",stroke:"white",strokeWidth:"2",className:"animate-pulse"})]})]})]}),e.jsxs("div",{className:"absolute bottom-4 right-4 bg-white rounded-lg shadow-sm border border-gray-200 z-50 flex items-center gap-1 px-2 py-1",children:[e.jsx("button",{className:"w-7 h-7 hover:bg-gray-100 rounded flex items-center justify-center text-gray-600 hover:text-gray-800 transition-colors",onClick:()=>{const t=Math.max(b*.8,.1);F(t)},title:"Zoom Out",children:e.jsx("span",{className:"text-sm font-bold leading-none",children:"−"})}),e.jsxs("div",{className:"text-xs text-gray-500 font-medium px-2 min-w-[40px] text-center",children:[Math.round(b*100),"%"]}),e.jsx("button",{className:"w-7 h-7 hover:bg-gray-100 rounded flex items-center justify-center text-gray-600 hover:text-gray-800 transition-colors",onClick:()=>{const t=Math.min(b*1.2,3);F(t)},title:"Zoom In",children:e.jsx("span",{className:"text-sm font-bold leading-none",children:"+"})})]})]})]})},de=({data:n,selected:x,nodeId:d})=>{const[S,P]=o.useState(!1),j=M=>{switch(M){case"conversation":return{icon:e.jsx(ne,{className:"h-4 w-4 text-white"}),bgColor:"bg-teal-500"};case"apiRequest":return{icon:e.jsx($e,{className:"h-4 w-4 text-white"}),bgColor:"bg-blue-500"};case"transferCall":return{icon:e.jsx(De,{className:"h-4 w-4 text-white"}),bgColor:"bg-green-500"};case"endCall":return{icon:e.jsx(Re,{className:"h-4 w-4 text-white"}),bgColor:"bg-red-500"};case"tool":return{icon:e.jsx(We,{className:"h-4 w-4 text-white"}),bgColor:"bg-orange-500"};default:return{icon:e.jsx(ne,{className:"h-4 w-4 text-white"}),bgColor:"bg-teal-500"}}},R=M=>{switch(M){case"conversation":return"Conversation";case"apiRequest":return"API Request";case"transferCall":return"Transfer Call";case"endCall":return"End Call";case"tool":return"Tool";default:return"Node"}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`
          relative rounded-2xl border-2 shadow-xl transition-all duration-300 min-w-[300px] max-w-[340px] bg-gradient-to-br from-white via-slate-50 to-white backdrop-blur-sm
          ${x?"border-indigo-500 shadow-2xl ring-4 ring-indigo-100":"border-gray-200 hover:border-indigo-300 hover:shadow-lg"}
          ${n.isStart?"ring-4 ring-blue-100 border-blue-400 shadow-blue-100":""}
        `,style:{minHeight:"140px",boxShadow:x?"0 25px 50px -12px rgba(79, 70, 229, 0.25), 0 0 0 1px rgba(79, 70, 229, 0.05)":"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(0, 0, 0, 0.05)",transform:x?"scale(1.02)":"scale(1)"},onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-gray-100 bg-gradient-to-r from-slate-50 to-gray-50 rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`
              w-10 h-10 rounded-xl flex items-center justify-center shadow-lg transition-all duration-300 hover:scale-110
              ${j(n.type).bgColor}
            `,style:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:j(n.type).icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-base text-gray-900 tracking-tight",children:n.name||R(n.type)}),e.jsxs("div",{className:"text-xs text-gray-500 font-medium mt-0.5",children:[n.type.charAt(0).toUpperCase()+n.type.slice(1)," Node"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-indigo-50 text-gray-500 hover:text-indigo-600 rounded-lg transition-all duration-200",children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-indigo-50 text-gray-500 hover:text-indigo-600 rounded-lg transition-all duration-200",children:e.jsx(De,{className:"h-4 w-4"})}),!n.isStart&&e.jsx(D,{variant:"ghost",size:"sm",onClick:M=>{M.stopPropagation(),window.confirm("Are you sure you want to delete this node?")&&n.onDelete()},className:"h-8 w-8 p-0 hover:bg-red-50 text-gray-500 hover:text-red-600 rounded-lg transition-all duration-200",title:"Delete node",children:e.jsx(Re,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 bg-gradient-to-b from-indigo-500 to-purple-500 rounded-full"}),"Prompt Configuration"]}),e.jsx("div",{className:"text-gray-600 leading-relaxed bg-gray-50 p-3 rounded-lg border border-gray-100",children:n.prompt&&n.prompt.length>100?`${n.prompt.substring(0,100)}...`:n.prompt||"No Prompt Specified"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs bg-gradient-to-r from-indigo-50 to-purple-50 p-3 rounded-lg border border-indigo-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Cost: $0.09/min"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Latency: 1.1s"})]})]})]}),e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 w-4 h-4 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full z-20 border-3 border-white cursor-pointer hover:scale-150 hover:from-indigo-500 hover:to-indigo-700 transition-all duration-300 shadow-lg","data-connection-point":"input","data-node-id":d,title:"Input connection point",style:{top:"-8px",boxShadow:"0 4px 12px rgba(79, 70, 229, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3)"}}),e.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 w-4 h-4 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full z-20 border-3 border-white cursor-pointer hover:scale-150 hover:from-purple-500 hover:to-purple-700 transition-all duration-300 shadow-lg","data-connection-point":"output","data-node-id":d,title:"Output connection point - drag to connect",onMouseDown:M=>{M.stopPropagation(),M.preventDefault(),console.log("🔗 Starting connection from node:",d),n.onConnectionStart&&d&&n.onConnectionStart(d,{x:0,y:0})},style:{bottom:"-8px",boxShadow:"0 4px 12px rgba(139, 92, 246, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3)"}}),S&&n.type!=="endCall"&&e.jsx("div",{className:"absolute -bottom-16 left-1/2 transform -translate-x-1/2 z-30",children:e.jsxs("button",{className:"w-12 h-12 bg-gradient-to-br from-indigo-500 via-indigo-600 to-purple-600 hover:from-indigo-600 hover:via-indigo-700 hover:to-purple-700 text-white rounded-full flex items-center justify-center transition-all duration-300 shadow-2xl hover:shadow-3xl hover:scale-110 border-2 border-white",style:{boxShadow:"0 8px 25px rgba(79, 70, 229, 0.4), 0 0 0 4px rgba(255, 255, 255, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},onClick:M=>{M.stopPropagation(),n.onConnectionStart&&d&&n.onConnectionStart(d,{x:0,y:0})},title:"Add new node",children:[e.jsx("span",{className:"text-xl font-bold leading-none drop-shadow-sm",children:"+"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-indigo-400 animate-ping opacity-30"})]})})]})})},Rt=[{type:"conversation",label:"Conversation",description:"AI conversation with users",icon:"MessageCircle",color:"bg-blue-100 text-blue-600",category:"core",configuration:{fields:[{name:"name",type:"text",label:"Node Name",description:"Name for this conversation node",required:!0,defaultValue:"Conversation"},{name:"firstMessage",type:"text",label:"First Message",description:"Initial message to send to the user",required:!1,defaultValue:"Hello! How can I help you today?"},{name:"prompt",type:"textarea",label:"System Prompt",description:"Instructions for the AI assistant",required:!0,defaultValue:"You are a helpful AI assistant. Respond naturally and helpfully to user queries."},{name:"model",type:"select",label:"AI Model",description:"Choose the AI model to use",required:!0,options:[{label:"GPT-4",value:"gpt-4"},{label:"GPT-3.5 Turbo",value:"gpt-3.5-turbo"},{label:"Claude 3",value:"claude-3"}],defaultValue:"gpt-4"},{name:"temperature",type:"number",label:"Temperature",description:"Controls randomness (0.0 to 1.0)",required:!1,defaultValue:.7}]}},{type:"apiRequest",label:"API Request",description:"Make HTTP requests",icon:"Zap",color:"bg-purple-100 text-purple-600",category:"integration",configuration:{fields:[{name:"name",type:"text",label:"Node Name",required:!0,defaultValue:"API Request"},{name:"method",type:"select",label:"HTTP Method",required:!0,options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"}],defaultValue:"GET"},{name:"url",type:"text",label:"URL",description:"API endpoint URL",required:!0,defaultValue:""},{name:"headers",type:"textarea",label:"Headers (JSON)",description:"HTTP headers as JSON object",required:!1,defaultValue:"{}"},{name:"body",type:"textarea",label:"Request Body (JSON)",description:"Request body for POST/PUT requests",required:!1,defaultValue:"{}"}]}},{type:"transferCall",label:"Transfer Call",description:"Transfer to another number",icon:"PhoneCall",color:"bg-green-100 text-green-600",category:"telephony",configuration:{fields:[{name:"name",type:"text",label:"Node Name",required:!0,defaultValue:"Transfer Call"},{name:"destination",type:"text",label:"Destination Number",description:"Phone number to transfer to",required:!0,defaultValue:""},{name:"transferMessage",type:"text",label:"Transfer Message",description:"Message to play before transfer",required:!1,defaultValue:"Please hold while I transfer you."},{name:"summary",type:"textarea",label:"Call Summary",description:"Summary to provide to the receiving party",required:!1,defaultValue:""}]}},{type:"endCall",label:"End Call",description:"Terminate the call",icon:"StopCircle",color:"bg-red-100 text-red-600",category:"telephony",configuration:{fields:[{name:"name",type:"text",label:"Node Name",required:!0,defaultValue:"End Call"},{name:"endMessage",type:"text",label:"End Message",description:"Final message before ending call",required:!1,defaultValue:"Thank you for calling. Have a great day!"}]}},{type:"tool",label:"Tool",description:"Use external tools",icon:"Wrench",color:"bg-orange-100 text-orange-600",category:"integration",configuration:{fields:[{name:"name",type:"text",label:"Node Name",required:!0,defaultValue:"Tool"},{name:"toolType",type:"select",label:"Tool Type",required:!0,options:[{label:"Web Search",value:"web_search"},{label:"Calculator",value:"calculator"},{label:"Weather",value:"weather"},{label:"Custom Function",value:"custom"}],defaultValue:"web_search"},{name:"configuration",type:"textarea",label:"Tool Configuration (JSON)",description:"Tool-specific configuration",required:!1,defaultValue:"{}"}]}}],et=async()=>{try{return new Promise(n=>{setTimeout(()=>n(Rt),500)})}catch(n){throw console.error("Error fetching VAPI node types:",n),n}},Vt=async n=>{try{return(await et()).find(d=>d.type===n)||null}catch(x){throw console.error("Error fetching node type configuration:",x),x}},Ot=({isOpen:n,onClose:x,node:d,onSave:S})=>{const[P,j]=o.useState(null),[R,M]=o.useState({}),[C,T]=o.useState(!1);o.useEffect(()=>{d&&n&&(console.log("Side panel opened for node:",d),m())},[d,n]);const m=async()=>{if(d){T(!0);try{const i=await Vt(d.type);j(i);const b={...d.data};M(b),console.log("Loaded node config:",i),console.log("Initial form data:",b)}catch(i){console.error("Failed to load node configuration:",i)}finally{T(!1)}}},f=o.useCallback((i,b)=>{console.log("Field change:",i,b),M(F=>{const y={...F,[i]:b};return console.log("Updated form data:",y),y})},[]),A=o.useCallback(()=>{console.log("Saving node configuration:",R),S(R)},[R,S]),O=o.useCallback(()=>{console.log("Closing side panel"),x()},[x]),L=()=>{switch(d==null?void 0:d.type){case"conversation":return e.jsx(ne,{className:"h-5 w-5 text-blue-600"});case"apiRequest":return e.jsx("div",{className:"h-5 w-5 bg-purple-600 rounded"});case"transferCall":return e.jsx("div",{className:"h-5 w-5 bg-green-600 rounded"});case"endCall":return e.jsx("div",{className:"h-5 w-5 bg-red-600 rounded"});case"tool":return e.jsx("div",{className:"h-5 w-5 bg-orange-600 rounded"});default:return e.jsx(ne,{className:"h-5 w-5 text-blue-600"})}},B=()=>{switch(d==null?void 0:d.type){case"conversation":return"Conversation Node";case"apiRequest":return"API Request Node";case"transferCall":return"Transfer Call Node";case"endCall":return"End Call Node";case"tool":return"Tool Node";default:return"Node"}},Y=i=>{var F;const b=R[i.name]||"";switch(i.type){case"text":return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(K,{htmlFor:i.name,className:"text-sm font-medium text-gray-700",children:[i.label,i.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(Ve,{id:i.name,value:b,onChange:y=>f(i.name,y.target.value),placeholder:i.description,className:"w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),i.description&&e.jsx("p",{className:"text-xs text-gray-500",children:i.description})]},i.name);case"textarea":return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(K,{htmlFor:i.name,className:"text-sm font-medium text-gray-700",children:[i.label,i.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(_e,{id:i.name,value:b,onChange:y=>f(i.name,y.target.value),placeholder:i.description,className:"w-full min-h-[120px] border-gray-300 focus:border-blue-500 focus:ring-blue-500 resize-none"}),i.description&&e.jsx("p",{className:"text-xs text-gray-500",children:i.description})]},i.name);case"select":return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(K,{htmlFor:i.name,className:"text-sm font-medium text-gray-700",children:[i.label,i.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs(yt,{value:b,onValueChange:y=>f(i.name,y),children:[e.jsx(vt,{className:"w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(wt,{placeholder:i.description})}),e.jsx(Nt,{children:(F=i.options)==null?void 0:F.map(y=>e.jsx(jt,{value:y.value,children:y.label},y.value))})]}),i.description&&e.jsx("p",{className:"text-xs text-gray-500",children:i.description})]},i.name);case"boolean":return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(K,{htmlFor:i.name,className:"text-sm font-medium text-gray-700",children:i.label}),i.description&&e.jsx("p",{className:"text-xs text-gray-500",children:i.description})]}),e.jsx(Ct,{id:i.name,checked:b,onCheckedChange:y=>f(i.name,y)})]},i.name);case"number":return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(K,{htmlFor:i.name,className:"text-sm font-medium text-gray-700",children:[i.label,i.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(Ve,{id:i.name,type:"number",value:b,onChange:y=>f(i.name,parseFloat(y.target.value)||0),placeholder:i.description,className:"w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),i.description&&e.jsx("p",{className:"text-xs text-gray-500",children:i.description})]},i.name);default:return null}};return n?e.jsx("div",{className:"fixed inset-y-0 right-0 z-50 w-96 bg-white border-l border-gray-200 shadow-xl",onMouseDown:i=>i.stopPropagation(),onMouseMove:i=>i.stopPropagation(),onMouseUp:i=>i.stopPropagation(),onClick:i=>i.stopPropagation(),children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[L(),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:B()}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configure node settings"})]})]}),e.jsx(D,{variant:"ghost",size:"sm",onClick:O,className:"h-8 w-8 p-0",children:e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:C?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):P?e.jsx("div",{className:"space-y-6",children:P.configuration.fields.map(Y)}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No configuration available for this node type."})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(D,{variant:"outline",onClick:O,className:"flex-1",children:"Cancel"}),e.jsx(D,{onClick:A,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:"Save Changes"})]})})]})}):null},Wt=({isOpen:n,onClose:x,edge:d,onSave:S})=>{const[P,j]=o.useState(""),[R,M]=o.useState("");o.useEffect(()=>{d&&(j(d.label||""),M(""))},[d]);const C=()=>{d&&P.trim()&&(S(d.id,P.trim()),x())},T=m=>{m.key==="Escape"?x():m.key==="Enter"&&(m.ctrlKey||m.metaKey)&&C()};return!n||!d?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:x}),e.jsxs("div",{className:"fixed right-0 top-0 h-full w-96 bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out",onKeyDown:T,tabIndex:-1,children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-teal-50 to-emerald-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Connection Label"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Customize the condition text for this workflow connection"})]}),e.jsx(D,{variant:"ghost",size:"sm",onClick:x,className:"h-8 w-8 p-0 hover:bg-gray-100",children:e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Connection Details"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{children:["From: ",e.jsx("span",{className:"font-medium",children:d.source})]}),e.jsxs("div",{children:["To: ",e.jsx("span",{className:"font-medium",children:d.target})]}),e.jsxs("div",{children:["ID: ",e.jsx("span",{className:"font-mono",children:d.id})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"edge-label",className:"text-sm font-medium text-gray-900",children:"Condition Label"}),e.jsx(Ve,{id:"edge-label",value:P,onChange:m=>j(m.target.value),placeholder:"e.g., if the user said yes",className:"w-full",autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"This text will appear on the connection line between nodes"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"edge-description",className:"text-sm font-medium text-gray-900",children:"Description (Optional)"}),e.jsx(_e,{id:"edge-description",value:R,onChange:m=>M(m.target.value),placeholder:"Add additional details about this condition...",className:"w-full h-20 resize-none"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Internal notes about this connection condition"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{className:"text-sm font-medium text-gray-900",children:"Quick Templates"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:["if the user said yes","if the user said no","if user needs help","if call should transfer","if information collected","default path"].map(m=>e.jsx("button",{onClick:()=>j(m),className:"text-left px-3 py-2 text-xs bg-gray-50 hover:bg-teal-50 rounded border border-gray-200 hover:border-teal-200 transition-colors",children:m},m))})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Press Ctrl+Enter to save, Esc to cancel"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(D,{variant:"outline",onClick:x,className:"px-4",children:"Cancel"}),e.jsxs(D,{onClick:C,disabled:!P.trim(),className:"px-4 bg-teal-600 hover:bg-teal-700",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]})]})})]})]})},Ft=({workflowId:n,workflowData:x,workflowName:d="Unnamed Workflow",workflowDescription:S="",onCallStart:P,onCallEnd:j,onError:R})=>{const M="eb3b26e3-7dbb-4fd6-a545-a954756a43aa",C=o.useRef(null),T=o.useRef(null),[m,f]=o.useState({isConnected:!1,isConnecting:!1,isMuted:!1,isOnHold:!1,volumeLevel:0,callDuration:0,status:"idle",callId:void 0}),[A,O]=o.useState([]),[L,B]=o.useState(null),[Y,i]=o.useState(!1),b=o.useRef(null);o.useEffect(()=>{console.log("🔧 Initializing VAPI with key:",`${M.substring(0,8)}...`);try{C.current=new kt(M),console.log("✅ VAPI instance created successfully"),F()}catch(s){console.error("❌ Failed to initialize VAPI:",s),k.error("Failed to initialize VAPI. Please check your API key.")}return()=>{C.current&&C.current.stop(),b.current&&clearInterval(b.current),T.current&&(T.current.getTracks().forEach(s=>s.stop()),T.current=null)}},[M]);const F=()=>{C.current&&(C.current.on("call-start",()=>{console.log("🎙️ VAPI call started"),f(s=>({...s,isConnected:!0,isConnecting:!1,status:"connected"})),y(),k.success("Call connected! You can now speak."),P==null||P()}),C.current.on("call-end",()=>{console.log("📞 VAPI call ended successfully"),f(s=>({...s,isConnected:!1,isConnecting:!1,isMuted:!1,isOnHold:!1,status:"ended",callId:void 0})),b.current&&(clearInterval(b.current),b.current=null),T.current&&(T.current.getTracks().forEach(s=>s.stop()),T.current=null),k.success("Call ended successfully"),j==null||j()}),C.current.on("error",s=>{console.error("❌ VAPI call error:",s),f(N=>({...N,isConnected:!1,isConnecting:!1,isMuted:!1,isOnHold:!1,status:"error",callId:void 0})),b.current&&(clearInterval(b.current),b.current=null),k.error(`Call error: ${s.message||"Unknown error"}`),R==null||R(s)}),C.current.on("speech-start",()=>{console.log("🗣️ Speech started")}),C.current.on("speech-end",()=>{console.log("🤐 Speech ended")}),C.current.on("volume-level",s=>{f(N=>({...N,volumeLevel:s}))}),C.current.on("message",s=>{if(console.log("📨 VAPI message:",s),s.type==="transcript"&&s.transcript){const N={role:s.role||"assistant",content:s.transcript,timestamp:new Date,type:"transcript"};O(I=>[...I,N])}}),C.current.on("error",s=>{console.error("❌ VAPI error:",s),f(N=>({...N,isConnected:!1,isConnecting:!1,status:"error"})),k.error(`Call error: ${s.message||"Unknown error"}`),R==null||R(s)}))},y=()=>{b.current=setInterval(()=>{f(s=>({...s,callDuration:s.callDuration+1}))},1e3)},X=s=>{const N=Math.floor(s/60),I=s%60;return`${N}:${I.toString().padStart(2,"0")}`},H=async()=>{try{console.log("🔐 Performing demo login...");const s=await fetch("https://ai.research-hero.com/api/auth/demo-login",{method:"POST",headers:{"Content-Type":"application/json"}});if(s.ok){const N=await s.json();if(N.success&&N.data.token)return ze.setItem("token",N.data.token),console.log("✅ Demo login successful"),k.success("Demo login successful"),N.data.token}throw new Error("Demo login failed")}catch(s){return console.error("❌ Demo login error:",s),k.error("Demo login failed"),null}},te=async()=>{try{i(!0),console.log("🔄 Creating/syncing VAPI workflow...");let s=ze.getItem("token");if(console.log("🔑 Auth token:",s?`${s.substring(0,20)}...`:"NOT FOUND"),!s&&(console.log("🔐 No token found, attempting demo login..."),s=await H(),!s))throw new Error("Authentication failed. Please log in.");const N={name:d,description:S,workflowId:n,nodes:(x==null?void 0:x.nodes)||[],edges:(x==null?void 0:x.edges)||[]};console.log("📤 Sending workflow to VAPI:","https://ai.research-hero.com/api/workflows/vapi/sync"),console.log("📋 Workflow data:",N);const I=await fetch("https://ai.research-hero.com/api/workflows/vapi/sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(N)});if(console.log("📥 Response status:",I.status,I.statusText),!I.ok){const U=await I.text();throw console.error("❌ API Error Response:",U),I.status===401?new Error("Authentication failed. Please log in again."):I.status===403?new Error("Access denied. You may not have permission to create workflows."):new Error(`Failed to sync workflow: ${I.status} ${I.statusText}`)}const $=await I.json();if(console.log("📥 API Response:",$),$.success&&$.workflowId)return console.log("✅ VAPI workflow synced:",$.workflowId),$.workflowId;throw new Error($.error||"Failed to sync workflow")}catch(s){return console.error("❌ Error syncing VAPI workflow:",s),k.error(`Failed to sync workflow: ${(s==null?void 0:s.message)||"Unknown error"}`),null}finally{i(!1)}},_=async()=>{if(console.log("🚀 Starting VAPI web call..."),!C.current){k.error("VAPI not initialized. Please check your API key configuration.");return}try{f(I=>({...I,isConnecting:!0,status:"connecting",callDuration:0})),O([]),console.log("🔄 Syncing workflow to VAPI...");const s=await te();if(!s)throw new Error("Failed to sync workflow to VAPI");console.log("📞 Starting workflow call with ID:",s);const N={workflowId:s,metadata:{portalWorkflowId:n,workflowName:d,initiatedFrom:"portal"}};await C.current.start(N)}catch(s){console.error("❌ Error starting web call:",s),f(N=>({...N,isConnecting:!1,status:"error"})),k.error(`Failed to start call: ${(s==null?void 0:s.message)||"Unknown error"}`)}},se=()=>{console.log("🛑 Stopping VAPI web call...");try{C.current?(console.log("📞 VAPI instance found, stopping call..."),C.current.stop(),f(s=>({...s,isConnecting:!1})),console.log("✅ VAPI stop method called successfully")):(console.warn("⚠️ No VAPI instance found to stop"),k.warning("No active call to end"))}catch(s){console.error("❌ Error stopping call:",s),k.error(`Failed to end call: ${(s==null?void 0:s.message)||"Unknown error"}`),f(N=>({...N,isConnected:!1,isConnecting:!1,isMuted:!1,isOnHold:!1,status:"ended",callId:void 0})),T.current&&(T.current.getTracks().forEach(N=>N.stop()),T.current=null)}},G=async()=>{try{if(!T.current){const s=await navigator.mediaDevices.getUserMedia({audio:!0});T.current=s}return T.current}catch(s){throw console.error("Error initializing media stream:",s),s}},le=()=>{try{if(!m.isConnected||!C.current){k.warning("No active call to mute");return}const s=!m.isMuted;C.current.setMuted(s),f(N=>({...N,isMuted:s})),k.info(s?"Microphone muted":"Microphone unmuted"),console.log(`🎤 Mute toggled: ${s}`)}catch(s){console.error("Error toggling mute:",s),k.error(`Failed to toggle mute: ${(s==null?void 0:s.message)||"Unknown error"}`),E()}},E=async()=>{try{console.log("🔄 Using fallback mute method...");const N=(await G()).getAudioTracks();if(N.length>0){const I=!m.isMuted;N.forEach($=>{$.enabled=!I}),f($=>({...$,isMuted:I})),k.info(I?"Microphone muted (fallback)":"Microphone unmuted (fallback)")}else k.error("No audio tracks found")}catch(s){console.error("Fallback mute also failed:",s),k.error("Failed to toggle mute. Please check microphone permissions.")}},Z=async()=>{try{if(!m.isConnected){k.warning("No active call to hold");return}const s=!m.isOnHold;(await G()).getAudioTracks().forEach($=>{$.enabled=!s}),f($=>({...$,isOnHold:s,isMuted:s})),k.info(s?"Call on hold":"Call resumed")}catch(s){console.error("Error toggling hold:",s),k.error("Failed to toggle hold. Please check microphone permissions.")}};return e.jsxs(Je,{children:[e.jsx(Qe,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",className:"bg-gradient-to-r from-teal-500 to-cyan-600 hover:from-teal-600 hover:to-cyan-700 text-white border-none shadow-lg hover:shadow-xl transition-all duration-300 relative group overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx(Fe,{className:"h-4 w-4 mr-2 relative z-10"}),e.jsx("span",{className:"relative z-10",children:"Web Call"}),m.isConnected&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse"})]})}),e.jsxs(St,{className:"max-w-4xl max-h-[90vh] overflow-hidden","aria-describedby":"vapi-web-call-description",children:[e.jsxs(Pt,{children:[e.jsxs(It,{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5 text-teal-600"}),e.jsx("span",{children:"VAPI Web Call"})]}),e.jsx(me,{variant:m.status==="connected"?"default":"secondary",children:m.status==="idle"?"Ready":m.status==="connecting"?"Connecting...":m.status==="connected"?"Connected":m.status==="ended"?"Ended":"Error"})]}),e.jsx("div",{id:"vapi-web-call-description",className:"sr-only",children:"VAPI Web Call interface for making voice calls with AI assistants"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-[600px]",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Pe,{children:[e.jsx(Ie,{children:e.jsxs(Me,{className:"text-lg flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5 text-teal-600"}),"Call Controls"]})}),e.jsxs(Te,{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:!m.isConnected&&!m.isConnecting?e.jsx(D,{onClick:_,size:"lg",className:"w-20 h-20 rounded-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-2xl transition-all duration-300 hover:shadow-3xl hover:scale-110",disabled:Y,children:Y?e.jsx(ke,{className:"h-8 w-8 animate-spin"}):e.jsx(qe,{className:"h-8 w-8"})}):m.isConnecting?e.jsx(D,{size:"lg",className:"w-20 h-20 rounded-full bg-yellow-500 text-white shadow-2xl",disabled:!0,children:e.jsx(ke,{className:"h-8 w-8 animate-spin"})}):e.jsx(D,{onClick:se,size:"lg",className:"w-20 h-20 rounded-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white shadow-2xl transition-all duration-300 hover:shadow-3xl hover:scale-110",children:e.jsx(at,{className:"h-8 w-8"})})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[m.status==="idle"&&"Ready to start call",m.status==="connecting"&&"Connecting to assistant...",m.status==="connected"&&"Call in progress",m.status==="ended"&&"Call ended",m.status==="error"&&"Call error occurred"]}),m.isConnected&&e.jsx("div",{className:"text-2xl font-mono font-bold text-teal-600",children:X(m.callDuration)})]}),m.isConnected&&e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsxs(D,{onClick:le,variant:"outline",size:"sm",className:m.isMuted?"bg-red-100 border-red-300 text-red-700":"",title:m.isMuted?"Unmute microphone":"Mute microphone",children:[m.isMuted?e.jsx(ot,{className:"h-4 w-4 mr-2"}):e.jsx(rt,{className:"h-4 w-4 mr-2"}),m.isMuted?"Unmute":"Mute"]}),e.jsxs(D,{onClick:Z,variant:"outline",size:"sm",className:m.isOnHold?"bg-yellow-100 border-yellow-300 text-yellow-700":"",title:m.isOnHold?"Resume call":"Hold call",children:[m.isOnHold?e.jsx(nt,{className:"h-4 w-4 mr-2"}):e.jsx(lt,{className:"h-4 w-4 mr-2"}),m.isOnHold?"Resume":"Hold"]}),e.jsxs(D,{variant:"outline",size:"sm",title:"Volume control",children:[e.jsx(it,{className:"h-4 w-4 mr-2"}),"Volume"]})]})]})]}),e.jsxs(Pe,{children:[e.jsx(Ie,{children:e.jsxs(Me,{className:"text-lg flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5 text-blue-600"}),"Call Information"]})}),e.jsx(Te,{children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Workflow:"}),e.jsx("div",{className:"font-medium",children:d})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Workflow ID:"}),e.jsx("div",{className:"font-mono text-xs bg-gray-100 p-1 rounded mt-1 break-all",children:n||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Assistant ID:"}),e.jsx("div",{className:"font-mono text-xs bg-gray-100 p-1 rounded mt-1 break-all",children:Y?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3 animate-spin"}),"Creating assistant..."]}):L||"Will be created on call start"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"API Status:"}),e.jsx("div",{className:"mt-1",children:e.jsx(me,{variant:"default",className:"bg-green-100 text-green-800",children:"✅ VAPI Configured"})})]})]})})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs(Pe,{className:"h-full",children:[e.jsx(Ie,{children:e.jsxs(Me,{className:"text-lg flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-purple-600"}),"Live Transcript"]})}),e.jsx(Te,{className:"h-[500px] overflow-y-auto",children:A.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Start a call to see the live transcript"})]})}):e.jsx("div",{className:"space-y-3",children:A.map((s,N)=>e.jsx("div",{className:`flex gap-3 ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] p-3 rounded-lg ${s.role==="user"?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.role==="user"?e.jsx(ct,{className:"h-4 w-4"}):e.jsx(dt,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs opacity-75",children:s.timestamp.toLocaleTimeString()})]}),e.jsx("p",{className:"text-sm",children:s.content})]})},N))})})]})})]})]})]})};let Oe=0;const Ae=()=>`node_${Oe++}`,is=()=>{var ie;const{id:n}=Et(),x=At();ft();const[d,S]=o.useState([]),[P,j]=o.useState([]),[R,M]=o.useState(null),[C,T]=o.useState(!1),[m,f]=o.useState(null),[A,O]=o.useState(!1),[L,B]=o.useState(!1),[Y,i]=o.useState(""),[b,F]=o.useState(!1),[y,X]=o.useState(null),[H,te]=o.useState([]),[_,se]=o.useState(!1),[G,le]=o.useState(null),{data:E,isLoading:Z,error:s}=bt({queryKey:["workflow",n],queryFn:()=>(console.log("Fetching workflow with ID:",n),Mt(n)),enabled:!!n,retry:1});o.useEffect(()=>{console.log("WorkflowBuilder - ID:",n),console.log("WorkflowBuilder - Loading:",Z),console.log("WorkflowBuilder - Error:",s),console.log("WorkflowBuilder - Data:",E)},[n,Z,s,E]);const N=Se({mutationFn:({id:r,data:t})=>Xe.autoSaveWorkflow(r,t),onSuccess:()=>{f(new Date),T(!1)},onError:()=>{T(!1)}}),I=Se({mutationFn:({id:r,data:t})=>Xe.updateWorkflow(r,t),onSuccess:()=>{f(new Date),k.success("Workflow saved successfully")},onError:r=>{console.error("Save error:",r),k.error("Failed to save workflow")}});Se({mutationFn:Tt,onSuccess:()=>{k.success("Workflow test initiated successfully")}});const $=o.useCallback((r,t)=>{S(c=>t.isStart===!0||t.start===!0?c.map(l=>l.id===r?{...l,data:{...l.data,...t,isStart:!0,start:!0}}:{...l,data:{...l.data,isStart:!1,start:!1}}):c.map(l=>l.id===r?{...l,data:{...l.data,...t}}:l))},[]),U=o.useCallback(r=>{S(t=>t.filter(c=>c.id!==r)),j(t=>t.filter(c=>c.source!==r&&c.target!==r))},[]),z=o.useCallback(r=>{S(t=>{const c=t.find(l=>l.id===r);return c&&(X(c),F(!0)),t})},[]),J=o.useCallback(r=>{y&&$(y.id,r)},[y]),ge=o.useCallback(()=>{F(!1),X(null)},[]),ae=o.useRef($),oe=o.useRef(U),Q=o.useRef(z);ae.current=$,oe.current=U,Q.current=z,o.useEffect(()=>{var r,t;if(E!=null&&E.data){const c=E.data,l=((r=c.nodes)==null?void 0:r.map((g,p)=>{const v=g.name||`node-${p}`;console.log(`🔍 Loading node ${p}:`,{originalType:g.type,name:g.name,nodeData:g});let w=g.type;const a=g.type;return a==="transfer"?w="transferCall":(a==="hangup"||a==="end")&&(w="endCall"),console.log(`🔄 Mapped node type: ${a} → ${w}`),{id:v,type:w,position:g.position||{x:p*250+100,y:p*150+100},draggable:!0,selectable:!0,data:{...g,type:w,onUpdate:h=>ae.current(v,h),onDelete:()=>oe.current(v),onConfigure:()=>Q.current(v)}}}))||[],u=((t=c.edges)==null?void 0:t.map((g,p)=>{var v,w;return{id:`edge-${p}`,source:g.from,target:g.to,label:((v=g.condition)==null?void 0:v.prompt)||((w=g.condition)==null?void 0:w.expression)||""}}))||[];if(S(l),j(u),Oe=Math.max(Oe,l.length),l.length===0){const g=Ae(),p=Ae(),v={id:g,type:"conversation",position:{x:250,y:150},data:{type:"conversation",name:"support-greeting",prompt:"Greet the customer and ask about their issue.",firstMessage:"Hello! How can I help you today?",isStart:!0,start:!0,onUpdate:h=>ae.current(g,h),onDelete:()=>oe.current(g),onConfigure:()=>Q.current(g)}},w={id:p,type:"conversation",position:{x:250,y:400},data:{type:"conversation",name:"New Conversation",prompt:"Enter your prompt here...",isStart:!1,onUpdate:h=>ae.current(p,h),onDelete:()=>oe.current(p),onConfigure:()=>Q.current(p)}},a={id:"edge-1",source:g,target:p,label:"if the user said yes"};S([v,w]),j([a])}}},[E]),o.useEffect(()=>{},[d,P,n,C]),o.useEffect(()=>{(async()=>{try{const t=await et();te(t)}catch(t){console.error("Failed to fetch VAPI node types:",t),k.error("Failed to load node types")}})()},[]),o.useEffect(()=>{const r=t=>{console.log("Page is about to reload/unload!"),console.trace("Reload triggered from:")};return window.addEventListener("beforeunload",r),()=>window.removeEventListener("beforeunload",r)},[]),o.useCallback(()=>{var l;if(console.log("⚡ AUTO-SAVE TRIGGERED - handleAutoSave function called"),!n||C)return;T(!0);const r=d.map((u,g)=>{var v;const p={type:u.type,name:u.id,isStart:g===0||u.data.isStart===!0};switch(u.type){case"conversation":const w={...p,prompt:u.data.prompt||"You are a helpful AI assistant."};return u.data.variables&&u.data.variables.length>0&&(w.variables=u.data.variables),(v=u.data.globalNodePlan)!=null&&v.enabled&&(w.globalNodePlan=u.data.globalNodePlan),w;case"apiRequest":return{...p,method:u.data.method||"GET",url:u.data.url||"",headers:u.data.headers||{},body:u.data.body||{},timeoutSeconds:u.data.timeoutSeconds||20};case"transferCall":return{...p,destination:u.data.destination||"",transferPlan:{destination:u.data.destination||"",message:u.data.transferMessage||"Please hold while I transfer you.",summary:u.data.summary||""}};case"endCall":return{...p};case"tool":return{...p,toolIds:u.data.toolIds||[],tools:u.data.tools||[]};default:return{...p,prompt:u.data.prompt||"Default prompt"}}}),t=P.map(u=>({from:u.source,to:u.target,condition:u.label?{type:"ai",prompt:u.label}:void 0})),c={name:((l=E==null?void 0:E.data)==null?void 0:l.name)||"Unnamed Workflow",nodes:r,edges:t};console.log("Sending to VAPI API:",c),N.mutate({id:n,data:c})},[n,d,P,C,N]),o.useCallback((r,t)=>{if(console.log("onConnect called with:",r,"->",t),P.find(u=>u.source===r&&u.target===t)){console.log("Connection already exists, skipping");return}const l={id:`edge-${Date.now()}`,source:r,target:t};console.log("Creating new edge:",l),j(u=>{const g=[...u,l];return console.log("Updated edges:",g),g}),k.success("Nodes connected successfully")},[P]);const pe=o.useCallback(r=>{console.log("Node clicked:",r.id,r.type),M(r),X(r),F(!0)},[]),be=o.useCallback(r=>{S(r)},[]),he=o.useCallback(r=>{j(r)},[]),xe=o.useCallback(r=>{console.log("🏷️ Edge label clicked:",r),le(r),se(!0)},[]),ye=o.useCallback((r,t)=>{console.log("💾 Saving edge label:",r,t),j(c=>c.map(l=>l.id===r?{...l,label:t}:l)),k.success("Connection label updated")},[]),ve=o.useCallback((r,t)=>{const c=Ae(),l=t||{x:Math.random()*400+100,y:Math.random()*300+100};console.log("Adding node:",c,"type:",r,"at position:",l);const u={id:c,type:r,position:l,data:{type:r,name:`${r.charAt(0).toUpperCase()+r.slice(1)} Node`,prompt:r==="conversation"?"You are a helpful AI assistant. Respond naturally and helpfully to user queries.":"",firstMessage:r==="conversation"?"Hello! How can I help you today?":"",isStart:d.length===0,start:d.length===0,onUpdate:g=>$(c,g),onDelete:()=>U(c),onConfigure:()=>z(c),...r==="apiRequest"&&{method:"GET",url:"",headers:{},body:{}},...r==="transferCall"&&{destination:"",transferPlan:{message:"",summary:""}},...r==="tool"&&{toolIds:[],tools:[]}}};S(g=>[...g,u])},[d.length,$,U,z]),we=()=>{var w;if(console.log("🔥 SAVE BUTTON CLICKED - handleSave function called"),!n||d.length===0){k.error("No workflow to save");return}const r=d.map((a,h)=>{console.log(`🔍 Processing node ${h}:`,{id:a.id,originalType:a.type,data:a.data});let V=a.type;a.type==="transferCall"?V="transfer":a.type==="endCall"&&(V="hangup"),["conversation","tool","assistant","start","say","gather","end","hangup","apiRequest","transfer"].includes(V)||(console.warn(`⚠️ Invalid node type "${V}" for node "${a.id}", defaulting to "conversation"`),V="conversation"),console.log(`🔄 Node type mapping: ${a.type} → ${V}`);const q={type:V,name:a.id,isStart:h===0||a.data.isStart===!0};switch(a.type){case"conversation":const ee={...q,prompt:a.data.prompt||"You are a helpful AI assistant."};return a.data.variables&&a.data.variables.length>0&&(ee.variables=a.data.variables),ee;case"apiRequest":let re=a.data.url||"";return(!re||!re.startsWith("https://"))&&(re="https://api.example.com/endpoint",console.warn(`⚠️ Using default URL for apiRequest node "${a.id}" - original URL: "${a.data.url}"`)),{...q,method:a.data.method||"GET",url:re,headers:a.data.headers||{},body:a.data.body||{}};case"transferCall":return{...q,destination:a.data.destination||"",transferPlan:{destination:a.data.destination||"",message:a.data.transferMessage||"Please hold while I transfer you.",summary:a.data.summary||""}};case"endCall":return{...q};case"tool":return{...q,toolIds:a.data.toolIds||[],tools:a.data.tools||[]};default:const Ne=["prompt","variables","globalNodePlan"],je=Object.fromEntries(Object.entries(a.data).filter(([Ce])=>Ne.includes(Ce)));return{...q,prompt:a.data.prompt||"Default prompt",...je}}}).filter(a=>a!==null),t=P.map(a=>({from:a.source,to:a.target,condition:a.label?{type:"ai",prompt:a.label}:void 0}));console.log("Saving workflow with data:",{nodes:r,edges:t}),console.log("🔍 DEBUGGING WORKFLOW SAVE:"),console.log("Total nodes to save:",r.length),r.forEach((a,h)=>{console.log(`Node ${h}: type="${a.type}", name="${a.name}", isStart=${a.isStart}`),console.log(`Node ${h} properties:`,Object.keys(a)),console.log(`Node ${h} full object:`,JSON.stringify(a,null,2))});const c=["conversation","tool","assistant","start","say","gather","end","hangup","apiRequest","transfer"],l=r.filter(a=>!c.includes(a.type));if(l.length>0){console.error("❌ Invalid node types found:",l.map(a=>({name:a.name,type:a.type}))),k.error(`Invalid node types: ${l.map(a=>a.type).join(", ")}`);return}console.log("✅ All node types are valid!");const u=["position","start","firstMessage"];if(r.some(a=>u.some(h=>h in a))){console.error("ERROR: Found forbidden properties in nodes!",r),k.error("Internal error: Forbidden properties found in nodes");return}const p=r.filter(a=>a.isStart===!0);if(p.length!==1){console.error("ERROR: Must have exactly one start node!",{startNodes:p,workflowNodes:r}),k.error("Workflow must have exactly one start node");return}console.log("Final workflow data being sent to VAPI:",JSON.stringify({nodes:r,edges:t},null,2)),r.forEach((a,h)=>{console.log(`Node ${h} (${a.name}):`,{type:a.type,isStart:a.isStart,hasStart:"start"in a,hasPosition:"position"in a,keys:Object.keys(a)})});const v={name:((w=E==null?void 0:E.data)==null?void 0:w.name)||"Unnamed Workflow",nodes:r,edges:t};I.mutate({id:n,data:v})},fe=o.useMemo(()=>({conversation:de,apiRequest:de,transferCall:de,endCall:de,tool:de}),[]);return Z?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Loading workflow..."})]})}):s?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-red-600 mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Error Loading Workflow"}),e.jsx("p",{className:"text-gray-600 mb-4",children:s instanceof Error?s.message:"Failed to load workflow"}),e.jsxs("p",{className:"text-sm text-gray-500 mb-4",children:["Workflow ID: ",n]})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsxs(D,{onClick:()=>x("/workflows"),variant:"outline",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Back to Workflows"]}),e.jsx(D,{onClick:()=>window.location.reload(),children:"Try Again"})]})]})}):e.jsxs("div",{className:"h-screen flex flex-col bg-white",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-3 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>x("/workflows"),className:"text-gray-600 hover:text-gray-900",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:((ie=E==null?void 0:E.data)==null?void 0:ie.name)||"Untitled Workflow"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500",children:[e.jsx("span",{className:"flex items-center gap-1",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),"Auto-saving..."]}):m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Saved ",m.toLocaleTimeString()]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"}),"Not saved"]})}),e.jsx("div",{className:"h-3 w-px bg-gray-300"}),e.jsxs(me,{variant:"secondary",className:"text-xs",children:[d.length," nodes"]}),e.jsxs(me,{variant:"secondary",className:"text-xs",children:[P.length," connections"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsx(Le,{children:e.jsxs(Ye,{children:[e.jsx(He,{asChild:!0,children:e.jsx(D,{variant:"outline",size:"sm",onClick:we,disabled:C||I.isPending,className:"text-gray-600",children:I.isPending?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):e.jsx(Ke,{className:"h-4 w-4"})})}),e.jsx(Be,{children:"Save Workflow"})]})}),e.jsx(Je,{open:L,onOpenChange:B,children:e.jsx(Qe,{asChild:!0})}),e.jsx(Ft,{workflowId:n,workflowData:E,onCallStart:()=>{console.log("🎙️ Web call started for workflow:",n),console.log("🎙️ Workflow data:",E),k.success("Web call started successfully!")},onCallEnd:()=>{console.log("🎙️ Web call ended for workflow:",n),k.info("Web call ended")},onError:r=>{console.error("🎙️ Web call error:",r),k.error(`Web call error: ${r.message||"Unknown error"}`)}})]})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:`${A?"w-16":"w-72"} bg-gray-50 border-r border-gray-200 flex-shrink-0 transition-all duration-200`,children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[!A&&e.jsx("h3",{className:"font-semibold text-gray-900",children:"Add Nodes"}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>O(!A),className:"text-gray-600 hover:text-gray-900",children:A?e.jsx(ut,{className:"h-4 w-4"}):e.jsx(mt,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"space-y-2",children:H.map(r=>{const c=(l=>{switch(l){case"MessageCircle":return ue;case"Zap":return xt;case"PhoneCall":return ht;case"StopCircle":return pt;case"Wrench":return gt;default:return ue}})(r.icon);return e.jsx(Le,{children:e.jsxs(Ye,{children:[e.jsx(He,{asChild:!0,children:e.jsxs("div",{className:`flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-white hover:shadow-sm transition-all duration-200 bg-white ${A?"justify-center":""}`,draggable:!0,onDragStart:l=>{l.dataTransfer.setData("application/reactflow",r.type),l.dataTransfer.effectAllowed="move"},onClick:()=>ve(r.type),children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${r.color}`,children:e.jsx(c,{className:"h-4 w-4"})}),!A&&e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.label}),e.jsx("div",{className:"text-xs text-gray-500",children:r.description})]})]})}),A&&e.jsx(Be,{side:"right",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.label}),e.jsx("div",{className:"text-xs text-gray-500",children:r.description})]})})]})},r.type)})})]})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Dt,{nodes:d,edges:P,onNodesChange:be,onEdgesChange:he,onNodeClick:pe,selectedNode:R,nodeTypes:fe,onEdgeLabelClick:xe}),d.length===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ue,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Start Building Your Workflow"}),e.jsx("p",{className:"text-gray-500 mb-4 max-w-sm",children:"Drag nodes from the sidebar or click on them to add to your workflow"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-400",children:[e.jsx("span",{children:"Tip: Start with a"}),e.jsx(me,{variant:"secondary",className:"text-xs",children:"Conversation"}),e.jsx("span",{children:"node"})]})]})})]})]}),e.jsx(Ot,{isOpen:b,onClose:ge,node:y,onSave:J}),e.jsx(Wt,{isOpen:_,onClose:()=>se(!1),edge:G,onSave:ye})]})};export{is as default};
//# sourceMappingURL=WorkflowBuilder-DAPEJQ9I.js.map
