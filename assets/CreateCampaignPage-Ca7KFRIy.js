import{j as e,m as ne,c0 as $,aS as u,bS as ie,aI as B,I as le}from"./ui-Tc0IGQ9z.js";import{r}from"./vendor-DG599jyl.js";import{u as ce,b as g,c as re}from"./query-DVe5-rsJ.js";import{u as de,J as me,K as oe,t as x,B as O,L as d,I as xe,S,f as F,g as I,h as A,i as m}from"./index-14XkMcJs.js";import{R as Q,a as G}from"./radio-group-Bj6A4n0a.js";import{e as he}from"./campaignService-C41r4E0u.js";import{h as ue}from"./agentService-Cgq0Giyx.js";import{g as pe}from"./phoneNumberService-D-27askh.js";import{u as je}from"./router-BnJytTjr.js";function Se(){var K,M,R,U;const P=je(),[N,z]=r.useState(""),[J,W]=r.useState("manual"),[f,H]=r.useState(""),[b,X]=r.useState(""),[h,j]=r.useState([]),[a,Y]=r.useState(""),[Z,D]=r.useState("now"),[q,ee]=r.useState(!1),se=ce(),{user:p}=de(),{data:w,isLoading:E}=g({queryKey:["assistants","vapi",p==null?void 0:p.id],queryFn:()=>ue(),retry:(s,t)=>{var c;return[404,204,402].includes((c=t==null?void 0:t.response)==null?void 0:c.status)?!1:s<1},enabled:!!(p!=null&&p.id)}),{data:v,isLoading:k}=g({queryKey:["phoneNumbers"],queryFn:()=>pe(),retry:1}),{data:y,isLoading:T}=g({queryKey:["contactLists"],queryFn:()=>me(),retry:1}),{data:n,isLoading:C}=g({queryKey:["listContacts",a],queryFn:()=>oe(a),enabled:!!a,retry:1});r.useEffect(()=>{var s,t;if(console.log("Contacts data received:",n),n!=null&&n.success&&((s=n==null?void 0:n.data)!=null&&s.contacts)){const i=n.data.contacts;console.log("Processing contacts array:",i);const c=i.map(l=>({name:`${l.firstName||l.first_name||""} ${l.lastName||l.last_name||""}`.trim()||l.fullName||l.email||"Unknown",number:l.contact_number||l.phoneNumber||l.phone,email:l.email||""}));console.log("Mapped contacts:",c),j(c)}else n&&!n.success?(console.log("API error response:",n),j([])):a&&n&&n.success&&(!((t=n.data)!=null&&t.contacts)||n.data.contacts.length===0)&&(console.log("Empty list detected"),j([]))},[n,a]);const L=re({mutationFn:he,onSuccess:s=>{se.invalidateQueries({queryKey:["outboundCampaigns"]});const t=(s==null?void 0:s.message)||"Campaign created successfully";x.success(t),P("/outbound")},onError:s=>{var t,i;x.error(((i=(t=s.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to create campaign")}}),te=s=>{Y(s),j([])},ae=()=>{if(!N.trim()){x.error("Campaign name is required");return}if(!f){x.error("Phone number is required");return}if(!b){x.error("Assistant is required");return}if(!a){x.error("Please select a contact list");return}if(h.length===0){x.error("Selected list has no contacts");return}const s=h.filter(i=>{const c=i.number;return!c||!c.startsWith("+")||!/^\+[1-9]\d{1,14}$/.test(c)});if(s.length>0){x.error(`Invalid phone numbers found. Please ensure all numbers are in E.164 format (e.g., +1234567890). Found ${s.length} invalid numbers.`);return}const t={name:N,phoneNumberId:f,assistantId:b,customers:h,autoLaunch:q};console.log("Creating campaign with data:",t),L.mutate(t)},V=(w==null?void 0:w.data)||[],_=(v==null?void 0:v.data)||[],o=(y==null?void 0:y.data)||[];return e.jsx("div",{className:"app-shell-bg min-h-screen w-full overflow-auto",children:e.jsxs("div",{className:"p-6 max-w-[1600px] mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(O,{variant:"ghost",size:"sm",onClick:()=>P("/outbound"),className:"flex items-center gap-2 text-white/65 hover:text-white neo-topbar-btn",children:[e.jsx(ne,{className:"h-4 w-4"}),"Back to Outbound"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-white",children:"Create Campaign"}),e.jsxs("p",{className:"text-white/65",children:["Create a new outbound campaign • Contacts loaded: ",h.length,a&&o.length>0&&e.jsxs("span",{className:"ml-2",children:['from "',((K=o.find(s=>s.id===a))==null?void 0:K.listName)||((M=o.find(s=>s.id===a))==null?void 0:M.list_name),'"']})]})]})]})}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-1/2",children:e.jsx("div",{className:"neo-card p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"campaign-name",className:"text-sm font-medium text-white/65",children:"Campaign Name"}),e.jsx(xe,{id:"campaign-name",placeholder:"Campaign Name",value:N,onChange:s=>z(s.target.value),className:"w-full bg-white/10 border-white/20 text-white placeholder:text-white/40"})]}),e.jsxs("div",{className:"flex flex flex-col space-y-3",children:[e.jsx(d,{className:"text-sm font-medium text-white/65",children:"Campaign Type"}),e.jsx(Q,{value:J,onValueChange:W,className:"flex items-start space-x-8 border-t border-white/10 pt-4",children:e.jsxs("div",{className:" flex items-start space-x-2",children:[e.jsx(G,{value:"manual",id:"manual",className:"mt-1 text-cyan-400"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"manual",className:"font-medium cursor-pointer text-white",children:"Manual"}),e.jsx("p",{className:"text-sm text-white/65",children:"Start campaign now or schedule for later"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{htmlFor:"phone-number",className:"text-sm font-medium text-white/65",children:"Phone Number"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-4 w-4 text-white/40"}),e.jsx("span",{className:"text-xs text-cyan-400 bg-cyan-500/10 px-2 py-1 rounded",children:"From AI CRUITMENT"})]})]}),e.jsxs(S,{value:f,onValueChange:H,children:[e.jsx(F,{className:"border-gray-300 text-white focus:border-blue-500 focus:ring-blue-500",children:e.jsx(I,{placeholder:k?"Loading...":"Select phone number"})}),e.jsx(A,{children:k?e.jsxs(m,{value:"loading",disabled:!0,children:[e.jsx(u,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):_.length===0?e.jsx(m,{value:"no-numbers",disabled:!0,children:"No phone numbers available"}):_.map(s=>e.jsx(m,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.number||s.twilioPhoneNumber}),s.name&&e.jsx("span",{className:"text-xs text-gray-500",children:s.name})]})},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{htmlFor:"contact-list",className:"text-sm font-medium text-white/65",children:"Contact List"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-4 w-4 text-white/40"}),e.jsx("span",{className:"text-xs text-cyan-400 bg-cyan-500/10 px-2 py-1 rounded",children:"From Lists"})]})]}),e.jsxs(S,{value:a,onValueChange:te,children:[e.jsx(F,{className:"border-gray-300 text-white  ",children:e.jsx(I,{placeholder:T?"Loading...":"Select contact list"})}),e.jsx(A,{children:T?e.jsxs(m,{value:"loading",disabled:!0,children:[e.jsx(u,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):o.length===0?e.jsx(m,{value:"no-lists",disabled:!0,children:"No contact lists available"}):o.map(s=>e.jsx(m,{value:s.id,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-6 w-6 bg-gradient-to-br from-primary/20 to-primary/10 rounded flex items-center justify-center",children:e.jsx(ie,{className:"h-3 w-3 text-primary"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.listName||s.list_name}),e.jsxs("span",{className:"text-xs text-white/65",children:[e.jsx(B,{className:"h-3 w-3 inline stroke-8  mr-1"}),s.contactCount||s.contacts_count||0," contacts"]})]})]})},s.id))})]}),a&&C&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-cyan-500/10 border border-cyan-500/20 rounded-md",children:[e.jsx(u,{className:"h-4 w-4 animate-spin text-cyan-400"}),e.jsx("span",{className:"text-sm text-white",children:"Loading contacts..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{htmlFor:"assistant",className:"text-sm font-medium text-white/65",children:"Assistant"}),e.jsx("span",{className:"text-xs text-cyan-400 bg-cyan-500/10 px-2 py-1 rounded",children:"From AI CRUITMENT"})]}),e.jsxs(S,{value:b,onValueChange:X,children:[e.jsx(F,{className:"border-gray-300 text-white  focus:border-blue-500 focus:ring-blue-500",children:e.jsx(I,{placeholder:E?"Loading...":"Select assistant"})}),e.jsx(A,{children:E?e.jsxs(m,{value:"loading",disabled:!0,children:[e.jsx(u,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):V.length===0?e.jsx(m,{value:"no-assistants",disabled:!0,children:"No assistants available"}):V.map(s=>{var t,i;return e.jsx(m,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),((t=s.model)==null?void 0:t.model)&&e.jsxs("span",{className:"text-xs text-gray-500",children:[s.model.model," • ",((i=s.voice)==null?void 0:i.voiceId)||"Default Voice"]})]})},s.id)})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{className:"text-sm font-medium text-white/65",children:"Choose when to send"}),e.jsx(Q,{value:Z,onValueChange:D,className:"flex items-center space-x-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"now",id:"send-now",className:"text-cyan-400"}),e.jsx(d,{htmlFor:"send-now",className:"cursor-pointer text-white",children:"Send Now"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4 border-t border-white/10",children:[e.jsx("input",{type:"checkbox",id:"auto-launch",checked:q,onChange:s=>ee(s.target.checked),className:"h-4 w-4 text-cyan-400 focus:ring-cyan-500 border-white/20 rounded bg-white/10"}),e.jsx(d,{htmlFor:"auto-launch",className:"text-sm text-white/65 cursor-pointer",children:"Automatically launch campaign after creation"})]}),e.jsxs(O,{onClick:ae,disabled:L.isPending,className:"w-full neo-btn py-3 text-base font-medium rounded-lg",children:[L.isPending&&e.jsx(u,{className:"h-4 w-4 mr-2 animate-spin"}),"Launch campaign"]})]})})}),e.jsx("div",{className:"w-1/2",children:e.jsxs("div",{className:"neo-card",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Contact Preview"}),e.jsx("p",{className:"text-sm text-white/65",children:a?C?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-4 w-4 animate-spin"}),"Loading contacts..."]}):e.jsxs(e.Fragment,{children:[h.length," contacts from selected list",a&&o.length>0&&e.jsxs("span",{className:"ml-1 font-medium",children:['"',((R=o.find(s=>s.id===a))==null?void 0:R.listName)||((U=o.find(s=>s.id===a))==null?void 0:U.list_name),'"']})]}):"Select a list to preview contacts"})]}),e.jsx("div",{className:"p-6",children:a?C?e.jsx("div",{className:"h-96 flex items-center justify-center border border-white/10 rounded-lg bg-white/5",children:e.jsxs("div",{className:"text-center",children:[e.jsx(u,{className:"h-8 w-8 animate-spin text-white/40 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-white/65",children:"Loading contacts..."})]})}):h.length===0?e.jsx("div",{className:"h-96 flex items-center justify-center border border-white/10 rounded-lg bg-white/5",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"h-8 w-8 text-white/40 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-white/65",children:"No contacts found in this list"})]})}):e.jsx("div",{className:"h-96 overflow-auto border border-white/10 rounded-lg neon-fire-scroll",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white/5 border-b border-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-white/65",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-white/65",children:"Phone Number"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-white/65",children:"Email"})]})}),e.jsx("tbody",{children:h.map((s,t)=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[e.jsx("td",{className:"px-4 py-3 text-white",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-white/65",children:s.number}),e.jsx("td",{className:"px-4 py-3 text-white/65",children:s.email})]},t))})]})}):e.jsx("div",{className:"h-96 flex items-center justify-center border border-white/10 rounded-lg bg-white/5",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{className:"h-8 w-8 text-white/40 mx-auto mb-3"}),e.jsx("p",{className:"text-lg font-medium text-white mb-2",children:"Select List for Preview Contacts"}),e.jsx("p",{className:"text-sm text-white/65",children:"Choose a contact list from the form to preview contacts here"})]})})})]})})]})]})})}export{Se as CreateCampaignPage};
//# sourceMappingURL=CreateCampaignPage-Ca7KFRIy.js.map
