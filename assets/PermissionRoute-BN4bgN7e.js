import{j as e,aQ as k}from"./ui-C7wuVsKo.js";import{u as S,d as L}from"./index-DMttttgJ.js";import{r as m}from"./vendor-DG599jyl.js";import{L as E}from"./Loading-ommwd2G2.js";import{C as T,b as F,c as I,d as q,a as $}from"./card-aEf8HYk2.js";import{a as B,N as D}from"./router-BavLd_S0.js";const G=()=>{const{user:s,isLoggedIn:t}=S(),[i,f]=m.useState([]),[r,c]=m.useState(null),[h,d]=m.useState([]),[p,j]=m.useState(!0),[A,g]=m.useState(null),y=async()=>{var a,n;if(!(s!=null&&s.role_id)||!t){f([]),c(null),d([]),j(!1);return}try{j(!0),g(null);const[u,w,o]=await Promise.all([L.get(`/api/roles/${s.role_id}`),L.get(`/api/permissions/user/${s.id}/detailed`),L.get("/api/page-permissions/accessible/me")]);u.data&&c(u.data),w.data.success&&f(w.data.data||[]),o.data.success&&d(o.data.data||[])}catch(u){console.error("Error fetching permissions:",u),g(((n=(a=u.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to load permissions")}finally{j(!1)}};m.useEffect(()=>{y()},[s==null?void 0:s.role_id,s==null?void 0:s.id,t]);const x=a=>!s||!t?!1:l?!0:i.some(n=>n.name===a),b=a=>!s||!t?!1:l?!0:a.some(n=>x(n)),N=a=>!s||!t?!1:l?!0:a.every(n=>x(n)),P=a=>r?r.name===a:!1,R=a=>r?a.includes(r.name):!1,l=(r==null?void 0:r.name)==="super_admin"||(s==null?void 0:s.role_id)===1;return{hasPermission:x,hasAnyPermission:b,hasAllPermissions:N,hasRole:P,hasAnyRole:R,isSuperAdmin:l,canAccessPage:a=>!s||!t?!1:l?!0:h.some(n=>n.page_path===a),permissions:i,role:r,accessiblePages:h,loading:p,error:A,refresh:async()=>{await y()}}},K=({children:s,permission:t,permissions:i,requireAll:f=!1,role:r,roles:c,requireAllRoles:h=!1,page:d,requireSuperAdmin:p=!1,redirectTo:j="/dashboard",loginRedirect:A="/login",accessDeniedComponent:g})=>{const{isLoggedIn:y,loading:x}=S(),b=B(),{hasPermission:N,hasAnyPermission:P,hasAllPermissions:R,hasRole:l,hasAnyRole:C,isSuperAdmin:v,canAccessPage:a,loading:n}=G();return x||n?e.jsx(E,{}):y?(p?v:v&&!t&&!i&&!r&&!c&&!d?!0:!(t&&!N(t)||i&&i.length>0&&!(f?R(i):P(i))||r&&!l(r)||c&&c.length>0&&!(h?c.every(_=>l(_)):C(c))||d&&!a(d)))?e.jsx(e.Fragment,{children:s}):g?e.jsx(e.Fragment,{children:g}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs(T,{className:"w-full max-w-md",children:[e.jsxs(F,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:e.jsx(k,{className:"h-6 w-6 text-red-600"})}),e.jsx(I,{className:"text-xl font-semibold text-gray-900",children:"Access Denied"}),e.jsx(q,{className:"text-gray-600",children:"You don't have permission to access this page."})]}),e.jsxs($,{className:"text-center",children:[e.jsxs("div",{className:"space-y-2 text-sm text-gray-500",children:[p&&e.jsx("p",{children:"This page requires super administrator privileges."}),t&&e.jsxs("p",{children:["Required permission: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:t})]}),i&&i.length>0&&e.jsxs("p",{children:["Required permissions (",f?"all":"any","): "," ",i.map(o=>e.jsx("code",{className:"bg-gray-100 px-1 rounded mr-1",children:o},o))]}),r&&e.jsxs("p",{children:["Required role: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:r})]}),c&&c.length>0&&e.jsxs("p",{children:["Required roles (",h?"all":"any","): "," ",c.map(o=>e.jsx("code",{className:"bg-gray-100 px-1 rounded mr-1",children:o},o))]})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>window.history.back(),className:"text-blue-600 hover:text-blue-500 font-medium",children:"Go Back"})})]})]})}):e.jsx(D,{to:A,state:{from:b},replace:!0})};export{K as P};
//# sourceMappingURL=PermissionRoute-BN4bgN7e.js.map
