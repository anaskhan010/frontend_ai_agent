import{j as e,by as H,am as P,bf as O,al as M,Z as k,F as K,ar as X,aw as Y,D as B,bh as U,b_ as W,C as Z,aS as q,aX as z,aW as G}from"./ui-S570Xcny.js";import{r as c}from"./vendor-DG599jyl.js";import{C as i,a as l,b as j,c as p}from"./card-DMfGhRm1.js";import{B as I}from"./button-BSd9MMPp.js";import{B as $}from"./badge-ij7fArnn.js";import{T as V,a as J,b as T,c as F}from"./tabs-CbOWgAXT.js";import{d as N,t as L}from"./index-YNP4OU4_.js";import{C as Q}from"./CreditBalance-BSyOEs15.js";import{P as ee}from"./PurchaseCreditsModal-mBD0OMID.js";import{R as D,C as se,X as ae,Y as te,T as E,P as re,a as ie,b as le}from"./PieChart-Sd_ZhJyQ.js";import{L as ce,a as ne}from"./LineChart-CnG1HRZO.js";import{u as de}from"./router-BavLd_S0.js";import"./query-Cab5P5bd.js";import"./dialog-Cc2g-8Kh.js";import"./react-stripe.esm-DpsyRb7I.js";import"./index-BET1hbAS.js";const R=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8"],oe=({days:g=30})=>{const[n,d]=c.useState(null),[y,m]=c.useState(!0),[x,b]=c.useState(g);c.useEffect(()=>{v()},[x]);const v=async()=>{try{m(!0);const t=(await N.get(`/api/credits/usage/analytics?days=${x}`)).data.data;if(!t){console.warn("No analytics data received from API"),d(null);return}const s={summary:t.summary||{},dailyTransactions:Array.isArray(t.dailyTransactions)?t.dailyTransactions:[],operationSummary:Array.isArray(t.operationSummary)?t.operationSummary:[],peakHours:Array.isArray(t.peakHours)?t.peakHours:[],period:t.period||`${x} days`};d(s)}catch(a){console.error("Error fetching usage analytics:",a),L.error("Failed to load usage analytics"),d(null)}finally{m(!1)}},w=a=>{switch(a){case"vapi_call":return e.jsx(Y,{className:"h-4 w-4"});case"message":return e.jsx(X,{className:"h-4 w-4"});case"file_upload":return e.jsx(K,{className:"h-4 w-4"});case"workflow_execution":return e.jsx(k,{className:"h-4 w-4"});default:return e.jsx(P,{className:"h-4 w-4"})}},h=a=>a?a.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "):"Unknown";if(y)return e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[...Array(4)].map((a,t)=>e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})})},t))})});if(!n)return e.jsx(i,{children:e.jsx(l,{className:"p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No usage data available"})})});if(!n.summary&&!n.dailyTransactions&&!n.operationSummary)return e.jsx(i,{children:e.jsx(l,{className:"p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No usage data available for the selected period"})})});const{summary:r,dailyTransactions:_,operationSummary:u,peakHours:A}=n,C=(_||[]).reduce((a,t)=>{const s=t.date,o=a.find(S=>S.date===s);return o?o[t.type]=(o[t.type]||0)+parseFloat(t.total_amount):a.push({date:s,[t.type]:parseFloat(t.total_amount)}),a},[]),f=(u||[]).map(a=>({name:h(a.operation_type),credits:parseFloat(a.total_credits),operations:parseInt(a.operation_count)}));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Usage Analytics"}),e.jsx("div",{className:"flex space-x-2",children:[7,30,90].map(a=>e.jsxs(I,{variant:x===a?"default":"outline",size:"sm",onClick:()=>b(a),children:[a," days"]},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Credits Used"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:parseFloat((r==null?void 0:r.total_credits_consumed)||0).toLocaleString()})]}),e.jsx(H,{className:"h-8 w-8 text-red-600"})]})})}),e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Operations"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:parseInt((r==null?void 0:r.total_operations)||0).toLocaleString()})]}),e.jsx(P,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Credits/Operation"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:parseFloat((r==null?void 0:r.avg_credits_per_operation)||0).toFixed(2)})]}),e.jsx(O,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[(r==null?void 0:r.total_operations)>0?(r.successful_operations/r.total_operations*100).toFixed(1):0,"%"]})]}),e.jsxs($,{variant:"default",className:"bg-green-100 text-green-800",children:[(r==null?void 0:r.successful_operations)||0,"/",(r==null?void 0:r.total_operations)||0]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsx(j,{children:e.jsxs(p,{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-5 w-5"}),e.jsx("span",{children:"Daily Credit Usage"})]})}),e.jsx(l,{children:e.jsx(D,{width:"100%",height:300,children:e.jsxs(ce,{data:C,children:[e.jsx(se,{strokeDasharray:"3 3"}),e.jsx(ae,{dataKey:"date"}),e.jsx(te,{}),e.jsx(E,{}),e.jsx(ne,{type:"monotone",dataKey:"usage",stroke:"#8884d8",strokeWidth:2})]})})})]}),e.jsxs(i,{children:[e.jsx(j,{children:e.jsx(p,{children:"Usage by Operation Type"})}),e.jsx(l,{children:e.jsx(D,{width:"100%",height:300,children:e.jsxs(re,{children:[e.jsx(ie,{data:f,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:t})=>`${a} ${(t*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"credits",children:f.map((a,t)=>e.jsx(le,{fill:R[t%R.length]},`cell-${t}`))}),e.jsx(E,{})]})})})]})]}),e.jsxs(i,{children:[e.jsx(j,{children:e.jsx(p,{children:"Operation Details"})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:(u||[]).map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[w(a.operation_type),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:h(a.operation_type)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[parseInt(a.operation_count).toLocaleString()," operations"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium text-red-600",children:[parseFloat(a.total_credits).toLocaleString()," credits"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Avg: ",parseFloat(a.avg_credits_per_operation).toFixed(2)," per operation"]})]})]},t))})})]})]})},Te=()=>{var t;de();const[g,n]=c.useState(!1),[d,y]=c.useState(null),[m,x]=c.useState([]),[b,v]=c.useState([]),[w,h]=c.useState(!0),[r,_]=c.useState(0),u=async()=>{try{h(!0);const[s,o,S]=await Promise.all([N.get("/api/credits/balance"),N.get("/api/credits/transactions?limit=10"),N.get("/api/credits/packages")]);y(s.data.data),x(o.data.data.transactions||[]),v(S.data.data||[])}catch(s){console.error("Error fetching credit data:",s),L.error("Failed to load credit information")}finally{h(!1)}};c.useEffect(()=>{u();const s=()=>{u()};return window.addEventListener("creditBalanceUpdate",s),()=>{window.removeEventListener("creditBalanceUpdate",s)}},[r]);const A=s=>{L.success("ðŸŽ‰ Purchase successful! Credits added to your account."),_(o=>o+1),n(!1),window.dispatchEvent(new CustomEvent("creditBalanceUpdate"))},C=s=>{switch(s){case"purchase":return e.jsx(B,{className:"h-4 w-4 text-green-500"});case"usage":return e.jsx(k,{className:"h-4 w-4 text-blue-500"});case"refund":return e.jsx(G,{className:"h-4 w-4 text-purple-500"});case"adjustment":return e.jsx(z,{className:"h-4 w-4 text-orange-500"});default:return e.jsx(q,{className:"h-4 w-4 text-gray-500"})}},f=s=>{switch(s){case"purchase":return"text-green-600 bg-green-50 border-green-200";case"usage":return"text-blue-600 bg-blue-50 border-blue-200";case"refund":return"text-purple-600 bg-purple-50 border-purple-200";case"adjustment":return"text-orange-600 bg-orange-50 border-orange-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},a=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return w?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Credit Portal"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your credits and track usage"})]}),e.jsxs(I,{onClick:()=>window.location.href="/purchase-credits",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Buy Credits"]})]}),e.jsx(i,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Current Balance"}),e.jsx(Q,{variant:"full"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Total Used"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:((t=d==null?void 0:d.total_credits_used)==null?void 0:t.toLocaleString())||"0"})]})]})})}),e.jsxs(V,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(J,{className:"grid w-full grid-cols-3",children:[e.jsxs(T,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Overview"]}),e.jsxs(T,{value:"transactions",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Transactions"]}),e.jsxs(T,{value:"packages",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Packages"]})]}),e.jsx(F,{value:"overview",className:"space-y-6",children:e.jsx(oe,{},r)}),e.jsx(F,{value:"transactions",className:"space-y-6",children:e.jsxs(i,{children:[e.jsx(j,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Recent Transactions"]})}),e.jsx(l,{children:m.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Z,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No transactions yet"}),e.jsx("p",{className:"text-sm",children:"Your credit transactions will appear here"})]}):e.jsx("div",{className:"space-y-3",children:m.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[C(s.transaction_type),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.description||`${s.transaction_type} transaction`}),e.jsx("div",{className:"text-sm text-gray-500",children:a(s.created_at)})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs($,{variant:"outline",className:f(s.transaction_type),children:[s.transaction_type==="usage"?"-":"+",Math.abs(s.credit_amount).toLocaleString()," credits"]})})]},s.id))})})]})}),e.jsx(F,{value:"packages",className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(s=>e.jsxs(i,{className:"relative hover:shadow-lg transition-shadow",children:[(s.bonus_credits||0)>0&&e.jsxs("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:["+",s.bonus_credits," Bonus"]}),e.jsxs(j,{children:[e.jsx(p,{className:"text-lg",children:s.name}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:["$",s.price_dollars||(s.price_cents/100).toFixed(2)]})]}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Base Credits:"}),e.jsx("span",{className:"font-medium",children:(s.credits_amount||0).toLocaleString()})]}),(s.bonus_credits||0)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bonus Credits:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["+",(s.bonus_credits||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-3",children:[e.jsx("span",{className:"font-semibold",children:"Total Credits:"}),e.jsx("span",{className:"font-bold text-blue-600",children:(s.total_credits||0).toLocaleString()})]}),e.jsxs("div",{className:"text-sm text-gray-500 text-center",children:["$",((s.price_dollars||s.price_cents/100)/(s.total_credits||1)).toFixed(4)," per credit"]})]})})]},s.id||s.package_id))})})]}),g&&e.jsx(ee,{isOpen:g,onClose:()=>n(!1),onSuccess:A})]})};export{Te as default};
//# sourceMappingURL=UserCreditPortal-B8CUci_6.js.map
