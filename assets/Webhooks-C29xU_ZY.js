import{j as e,at as ba,aS as Re,cr as Ds,ab as wa,aw as va,aC as ja,c0 as Na,bz as ka,cs as He,ax as ot,m as ya,d as ze,n as Ws,X as Pt,K as nt,ah as Aa,T as Zs,V as Sa,Q as Ca,ar as Fa,aq as Ea,I as Ms,Y as Ia}from"./ui-Tc0IGQ9z.js";import{r as l,b as Ot}from"./vendor-DG599jyl.js";import{d as $s}from"./router-BnJytTjr.js";import{P as La}from"./Page-C-WE_AJ8.js";import{a as K,t as g,L as q,I as $,S as we,f as ve,g as Qe,h as je,i as se,B as M,E as _s,C as Et,c as It,d as Lt,e as Gs,b as Tt,T as Ta,n as ct,D as ea,j as ta,k as sa,l as it,J as Pa,G as Oa,u as Ua,q as Ra,r as Da,s as Wa,v as Ma,W as _a}from"./index-14XkMcJs.js";import{T as Ga,a as Ba,b as Bs,c as _e,d as Qa,e as Ge}from"./table-CbW7ehNz.js";import{u as Ha}from"./usePermissions-BsviAcl3.js";import{c as Qs,d as Hs,f as Xs,S as Ys}from"./sheet-BK5F-LFu.js";import{G as Xa}from"./GmailOAuthModal-C684xC6t.js";import{g as Ya}from"./phoneNumberService-D-27askh.js";import{f as Va}from"./agentService-Cgq0Giyx.js";import{a as za}from"./workflowService-BwYI49Sg.js";import{R as Ja,a as Vs}from"./radio-group-Bj6A4n0a.js";import"./query-DVe5-rsJ.js";async function Ka(){var o,c,d;const t=await K.get("/api/auth/facebook/oauth-url");if((o=t.data)!=null&&o.success&&((c=t.data.data)!=null&&c.authUrl))return t.data.data.authUrl;throw new Error(((d=t.data)==null?void 0:d.message)||"Failed to start Facebook OAuth")}async function qa(t,o){var c,d;try{const v=await K.post("/api/auth/facebook/connect",{code:t,state:o});if(v.data.success)return g.success("Facebook account connected successfully!"),v.data.data;throw new Error(v.data.message||"Failed to connect Facebook account")}catch(v){console.error("Error connecting Facebook account:",v);const u=((d=(c=v.response)==null?void 0:c.data)==null?void 0:d.message)||"Failed to connect Facebook account";throw g.error(u),v}}async function aa(t){var o,c;try{let d,v=3e4;if(typeof t=="string"?d=t:typeof t=="number"&&(v=t),d){console.log("ðŸ” Checking webhook-specific connection for:",d);const u=localStorage.getItem(`facebook_connected_${d}`)==="true",Q=localStorage.getItem(`facebook_user_${d}`);if(console.log("ðŸ” localStorage check:",{isConnected:u,hasUserStr:!!Q}),u&&Q)try{const O=JSON.parse(Q);return console.log("âœ… Found Facebook connection in localStorage"),{isConnected:!0,facebookUser:O,connectedAt:new Date().toISOString()}}catch(O){console.log("âŒ Invalid localStorage data:",O)}const r=sessionStorage.getItem("temp_facebook_connected")==="true",P=sessionStorage.getItem("temp_facebook_user");if(console.log("ðŸ” sessionStorage check:",{tempConnected:r,hasTempUserStr:!!P}),r&&P)try{const O=JSON.parse(P);return console.log("âœ… Found Facebook connection in sessionStorage"),{isConnected:!0,facebookUser:O,connectedAt:new Date().toISOString()}}catch(O){return console.log("âŒ Invalid sessionStorage data:",O),{isConnected:!1}}console.log("ðŸ” Checking backend webhook metadata for Facebook connection...");try{const O=await K.get(`/api/facebook/connection-status/${d}`,{timeout:v});if(O.data.success&&O.data.data.isConnected)return console.log("âœ… Found Facebook connection in backend webhook metadata:",O.data.data),localStorage.setItem(`facebook_connected_${d}`,"true"),O.data.data.facebookUser&&localStorage.setItem(`facebook_user_${d}`,JSON.stringify(O.data.data.facebookUser)),{isConnected:!0,facebookUser:O.data.data.facebookUser,pages:O.data.data.pages||[],selectedPageId:O.data.data.selectedPageId||"",selectedLeadFormId:O.data.data.selectedLeadFormId||"",leadForms:O.data.data.leadForms||[],connectedAt:new Date().toISOString()};console.log("âŒ No Facebook connection found in backend webhook metadata")}catch(O){console.log("âŒ Error checking backend webhook metadata:",O)}return console.log("âŒ No Facebook connection found for webhook"),{isConnected:!1}}return console.log("ðŸ†• No webhookId provided - new webhook flow, returning not connected"),{isConnected:!1}}catch(d){return console.error("Error getting Facebook connection status:",d),d.name==="AbortError"?g.error("Connection status check timed out"):g.error(((c=(o=d.response)==null?void 0:o.data)==null?void 0:c.message)||"Failed to get connection status"),{isConnected:!1}}}async function Be(){var t,o;try{const c=await K.get("/api/facebook/pages");if(c.data.success)return c.data.data;throw new Error(c.data.message||"Failed to fetch Facebook pages")}catch(c){console.error("Error fetching Facebook pages:",c);const d=((o=(t=c.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to fetch Facebook pages";throw g.error(d),c}}async function Je(){try{const t=await K.get("/api/facebook/pages/stored");return t.data.success?t.data.data:[]}catch(t){return console.error("Error fetching stored Facebook pages:",t),[]}}async function lt(t){var o,c;try{const d=await K.get(`/api/facebook/pages/${t}/forms`);if(d.data.success)return d.data.data;throw new Error(d.data.message||"Failed to fetch lead forms")}catch(d){console.error("Error fetching lead forms:",d);const v=((c=(o=d.response)==null?void 0:o.data)==null?void 0:c.message)||"Failed to fetch lead forms";throw g.error(v),d}}async function Za(t){var o,c;try{const d=await K.post("/api/gmail/emails/send",t);if(d.data.success)return g.success("Email sent successfully!"),d.data.data;throw new Error(d.data.message||"Failed to send email")}catch(d){console.error("Error sending Gmail email:",d);const v=((c=(o=d.response)==null?void 0:o.data)==null?void 0:c.message)||"Failed to send email";throw g.error(v),d}}const $a=({initialConfig:t,onSave:o,onCancel:c})=>{const[d,v]=l.useState((t==null?void 0:t.name)||""),[u,Q]=l.useState((t==null?void 0:t.phoneNumberId)||""),[r,P]=l.useState(t==null?void 0:t.assistantId),[O,U]=l.useState(t==null?void 0:t.workflowId),[Y,F]=l.useState(!!(t!=null&&t.autoLaunch)),[k,H]=l.useState([]),[ae,z]=l.useState([]),[y,B]=l.useState([]),[de,J]=l.useState(!1);l.useEffect(()=>{let W=!0;return(async()=>{try{J(!0);const[V,p,w]=await Promise.all([Ya(void 0,""),Va(""),za(void 0,"",void 0)]);if(!W)return;const D=Array.isArray(V==null?void 0:V.data)?V.data:Array.isArray(V)?V:[];H((D||[]).map(b=>({id:b.id||b._id||b.phoneNumberId||"",number:b.number||b.phoneNumber||"",friendlyName:b.friendlyName})));const i=Array.isArray(p==null?void 0:p.data)?p.data:Array.isArray(p)?p:[];z((i||[]).map(b=>({id:b.id||b.assistant_id||"",name:b.name||"Unnamed Assistant"})));const j=Array.isArray(w==null?void 0:w.data)?w.data:Array.isArray(w)?w:[];B((j||[]).map(b=>({id:b.id||b.workflow_id||"",name:b.name||"Untitled Workflow"})))}catch(V){console.error("Failed to load campaign deps:",V),g.error("Failed to load campaign dependencies")}finally{W&&J(!1)}})(),()=>{W=!1}},[]);const G=async()=>{if(console.log("ðŸ”§ Campaign handleSave called"),!d.trim()){g.error("Campaign name is required");return}if(!u){g.error("Please select a phone number");return}const W={name:d.trim(),phoneNumberId:u,assistantId:r,workflowId:O,autoLaunch:Y};console.log("ðŸ“‹ Campaign config to save:",W),await o(W),console.log("âœ… Campaign onSave completed")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-4 border-b",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center",children:e.jsx(ba,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Configure Outbound Campaign"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Set up a campaign to run when this webhook triggers."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"Campaign Name"}),e.jsx($,{value:d,onChange:W=>v(W.target.value),placeholder:"e.g. New Leads Outreach",className:"mt-1 h-12"})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"Phone Number"}),e.jsxs(we,{value:u,onValueChange:Q,children:[e.jsx(ve,{className:"w-full h-12 mt-1",children:e.jsx(Qe,{placeholder:de?"Loading...":"Select a phone number"})}),e.jsx(je,{children:k.map(W=>e.jsx(se,{value:W.id,children:W.friendlyName?`${W.friendlyName} (${W.number})`:W.number},W.id))})]})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-gray-900",children:"Assistant (optional)"}),e.jsxs(we,{value:r||"",onValueChange:W=>P(W||void 0),children:[e.jsx(ve,{className:"w-full h-12 mt-1",children:e.jsx(Qe,{placeholder:de?"Loading...":"Select an assistant"})}),e.jsx(je,{children:ae.map(W=>e.jsx(se,{value:W.id,children:W.name},W.id))})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsx("input",{id:"autoLaunch",type:"checkbox",className:"h-4 w-4",checked:Y,onChange:W=>F(W.target.checked)}),e.jsx(q,{htmlFor:"autoLaunch",className:"text-sm text-gray-700",children:"Auto-launch campaign when triggered"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-6 border-t",children:[e.jsx(M,{variant:"outline",onClick:c,className:"flex-1 h-12 border border-gray-300 rounded-lg",children:"Cancel"}),e.jsx(M,{onClick:G,className:"flex-1 h-12 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",disabled:de,children:de?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 animate-spin mr-2"}),"Saving..."]}):"Save"})]})]})},Rt=t=>typeof t=="number"&&!isNaN(t),Ke=t=>typeof t=="string",oa=t=>typeof t=="function",eo=t=>l.isValidElement(t)||Ke(t)||oa(t)||Rt(t);function to(t,o,c){c===void 0&&(c=300);const{scrollHeight:d,style:v}=t;requestAnimationFrame(()=>{v.minHeight="initial",v.height=d+"px",v.transition=`all ${c}ms`,requestAnimationFrame(()=>{v.height="0",v.padding="0",v.margin="0",setTimeout(o,c)})})}function mt(t){let{enter:o,exit:c,appendPosition:d=!1,collapse:v=!0,collapseDuration:u=300}=t;return function(Q){let{children:r,position:P,preventExitTransition:O,done:U,nodeRef:Y,isIn:F,playToast:k}=Q;const H=d?`${o}--${P}`:o,ae=d?`${c}--${P}`:c,z=l.useRef(0);return l.useLayoutEffect(()=>{const y=Y.current,B=H.split(" "),de=J=>{J.target===Y.current&&(k(),y.removeEventListener("animationend",de),y.removeEventListener("animationcancel",de),z.current===0&&J.type!=="animationcancel"&&y.classList.remove(...B))};y.classList.add(...B),y.addEventListener("animationend",de),y.addEventListener("animationcancel",de)},[]),l.useEffect(()=>{const y=Y.current,B=()=>{y.removeEventListener("animationend",B),v?to(y,U,u):U()};F||(O?B():(z.current=1,y.className+=` ${ae}`,y.addEventListener("animationend",B)))},[F]),Ot.createElement(Ot.Fragment,null,r)}}const ke=new Map;let Ut=[];const zs=new Set,ra=()=>ke.size>0;function so(t,o){var c;if(o)return!((c=ke.get(o))==null||!c.isToastActive(t));let d=!1;return ke.forEach(v=>{v.isToastActive(t)&&(d=!0)}),d}function ao(t,o){eo(t)&&(ra()||Ut.push({content:t,options:o}),ke.forEach(c=>{c.buildToast(t,o)}))}function Js(t,o){ke.forEach(c=>{o!=null&&o!=null&&o.containerId?(o==null?void 0:o.containerId)===c.id&&c.toggle(t,o==null?void 0:o.id):c.toggle(t,o==null?void 0:o.id)})}let oo=1;const na=()=>""+oo++;function ro(t){return t&&(Ke(t.toastId)||Rt(t.toastId))?t.toastId:na()}function qe(t,o){return ao(t,o),o.toastId}function dt(t,o){return{...o,type:o&&o.type||t,toastId:ro(o)}}function rt(t){return(o,c)=>qe(o,dt(t,c))}function C(t,o){return qe(t,dt("default",o))}C.loading=(t,o)=>qe(t,dt("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...o})),C.promise=function(t,o,c){let d,{pending:v,error:u,success:Q}=o;v&&(d=Ke(v)?C.loading(v,c):C.loading(v.render,{...c,...v}));const r={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},P=(U,Y,F)=>{if(Y==null)return void C.dismiss(d);const k={type:U,...r,...c,data:F},H=Ke(Y)?{render:Y}:Y;return d?C.update(d,{...k,...H}):C(H.render,{...k,...H}),F},O=oa(t)?t():t;return O.then(U=>P("success",Q,U)).catch(U=>P("error",u,U)),O},C.success=rt("success"),C.info=rt("info"),C.error=rt("error"),C.warning=rt("warning"),C.warn=C.warning,C.dark=(t,o)=>qe(t,dt("default",{theme:"dark",...o})),C.dismiss=function(t){(function(o){var c;if(ra()){if(o==null||Ke(c=o)||Rt(c))ke.forEach(d=>{d.removeToast(o)});else if(o&&("containerId"in o||"id"in o)){const d=ke.get(o.containerId);d?d.removeToast(o.id):ke.forEach(v=>{v.removeToast(o.id)})}}else Ut=Ut.filter(d=>o!=null&&d.options.toastId!==o)})(t)},C.clearWaitingQueue=function(t){t===void 0&&(t={}),ke.forEach(o=>{!o.props.limit||t.containerId&&o.id!==t.containerId||o.clearQueue()})},C.isActive=so,C.update=function(t,o){o===void 0&&(o={});const c=((d,v)=>{var u;let{containerId:Q}=v;return(u=ke.get(Q||1))==null?void 0:u.toasts.get(d)})(t,o);if(c){const{props:d,content:v}=c,u={delay:100,...d,...o,toastId:o.toastId||t,updateId:na()};u.toastId!==t&&(u.staleId=t);const Q=u.render||v;delete u.render,qe(Q,u)}},C.done=t=>{C.update(t,{progress:1})},C.onChange=function(t){return zs.add(t),()=>{zs.delete(t)}},C.play=t=>Js(!0,t),C.pause=t=>Js(!1,t);const ht=function(t,o){return o===void 0&&(o=!1),{enter:`Toastify--animate Toastify__${t}-enter`,exit:`Toastify--animate Toastify__${t}-exit`,appendPosition:o}};mt(ht("bounce",!0));mt(ht("slide",!0));mt(ht("zoom"));mt(ht("flip"));const no=({webhookId:t,workflowEnabled:o,onConnectionChange:c})=>{const[d,v]=l.useState("new"),[u,Q]=l.useState("Facebook Lead Ads #1"),[r,P]=l.useState({isConnected:!1}),[O,U]=l.useState([]),[Y,F]=l.useState([]),[k,H]=l.useState(""),[ae,z]=l.useState(""),[y,B]=l.useState(!1),[de,J]=l.useState(!1);console.log("ðŸ”„ [FacebookLeadAdsTrigger] Component render:",{webhookId:t,isConnected:r.isConnected,pagesCount:O.length,formsCount:Y.length,selectedPageId:k,selectedFormId:ae}),l.useEffect(()=>{console.log("ðŸ”„ Component mounted/webhookId changed, loading status...",{webhookId:t}),t!=null?setTimeout(()=>{G()},100):console.log("âš ï¸ webhookId is undefined/null, skipping loadStatus")},[t]),l.useEffect(()=>{if(!t)return;const w=setInterval(async()=>{const D=sessionStorage.getItem("temp_facebook_connected")==="true",i=localStorage.getItem(`facebook_connected_${t}`)==="true";if((D||i)&&!r.isConnected){console.log("ðŸ”„ Detected Facebook connection in storage, reloading status"),G();return}if(!r.isConnected&&t)try{const j=await aa(t);if(j.isConnected&&!r.isConnected){console.log("ðŸ”„ Detected Facebook connection via backend API, updating status"),P(j),c==null||c(!0);try{const b=await Be();U(b)}catch(b){console.log("Failed to load pages:",b)}}}catch{}},3e3);return()=>clearInterval(w)},[t,r.isConnected]),l.useEffect(()=>{const p=()=>{t&&!r.isConnected&&(console.log("ðŸ”„ Window focused, checking for Facebook connection"),setTimeout(()=>{G()},1e3))};return window.addEventListener("focus",p),()=>window.removeEventListener("focus",p)},[t,r.isConnected]),l.useEffect(()=>{console.log("ðŸ”„ [FacebookLeadAdsTrigger] Status changed:",r)},[r]),l.useEffect(()=>{const p=w=>{var D;(w.key==="temp_facebook_connected"||(D=w.key)!=null&&D.startsWith("facebook_connected_"))&&(console.log("ðŸ”„ Storage change detected, refreshing status...",w.key,w.newValue),setTimeout(()=>G(),100))};return window.addEventListener("storage",p),()=>window.removeEventListener("storage",p)},[]),l.useEffect(()=>{console.log("ðŸ”§ [FacebookLeadAdsTrigger] Setting up global message listener for webhookId:",t);const p=w=>{var b,T;console.log("ðŸ”” [FacebookLeadAdsTrigger] Message received from origin:",w.origin,"data:",w.data),console.log("ðŸ”” [FacebookLeadAdsTrigger] Current webhookId:",t);const D=[window.location.origin,"http://localhost:5000","http://localhost:5173","http://localhost:5174","https://ai.research-hero.com"],i=w.origin.includes("localhost")||w.origin==="null";if(!(D.includes(w.origin)||i)){console.warn("ðŸš« [FacebookLeadAdsTrigger] Ignoring message from unauthorized origin:",w.origin);return}if(console.log("ðŸ“¨ [FacebookLeadAdsTrigger] Received popup message:",w.data),console.log("ðŸ“¨ [FacebookLeadAdsTrigger] Message type:",(b=w.data)==null?void 0:b.type),w.data.type==="facebook_oauth_success"){console.log("ðŸŽ‰ [FacebookLeadAdsTrigger] Facebook OAuth success received from popup");const E=(T=w.data.data)==null?void 0:T.facebookUser;console.log("ðŸ‘¤ [FacebookLeadAdsTrigger] Facebook user data:",E),E?(console.log("ðŸ’¾ [FacebookLeadAdsTrigger] Storing connection data..."),console.log("ðŸ“ [FacebookLeadAdsTrigger] Storing in session storage for immediate use"),sessionStorage.setItem("temp_facebook_user",JSON.stringify(E)),sessionStorage.setItem("temp_facebook_connected","true"),console.log("âœ… [FacebookLeadAdsTrigger] Session storage updated:",{temp_facebook_connected:sessionStorage.getItem("temp_facebook_connected"),temp_facebook_user:!!sessionStorage.getItem("temp_facebook_user")}),t&&(console.log("ðŸ“ [FacebookLeadAdsTrigger] Also storing for webhook:",t),localStorage.setItem(`facebook_connected_${t}`,"true"),localStorage.setItem(`facebook_user_${t}`,JSON.stringify(E))),console.log("ðŸ”„ [FacebookLeadAdsTrigger] Setting status to connected with user:",E),P({isConnected:!0,facebookUser:E}),console.log("ðŸ”„ [FacebookLeadAdsTrigger] Status set, calling onConnectionChange"),c==null||c(!0),console.log("ðŸ”„ [FacebookLeadAdsTrigger] Loading pages after OAuth success"),setTimeout(async()=>{try{const R=await Be();console.log("âœ… Pages loaded immediately after OAuth:",R.length),U(R)}catch(R){console.log("âŒ Failed to load pages immediately:",R)}},500),console.log("ðŸ”„ [FacebookLeadAdsTrigger] Loading Facebook pages after OAuth success..."),Be().then(R=>{if(console.log("âœ… [FacebookLeadAdsTrigger] Facebook connected and pages loaded:",R.length,"pages"),U(R),R.length>0){const me=R[0].id;H(me),console.log("ðŸ”„ [FacebookLeadAdsTrigger] Auto-selecting first page and loading forms..."),lt(me).then(I=>{console.log("âœ… [FacebookLeadAdsTrigger] Forms loaded for first page:",I.length,"forms"),F(I),C.success(`âœ… Facebook Lead Ads connected! Found ${R.length} pages and ${I.length} forms.`)}).catch(I=>{console.log("âŒ [FacebookLeadAdsTrigger] Failed to load forms for first page:",I),C.success(`âœ… Facebook Lead Ads connected! Found ${R.length} pages.`)})}else C.success("âœ… Facebook Lead Ads connected successfully!")}).catch(R=>{console.error("Post-OAuth pages loading failed",R),C.success("âœ… Facebook Lead Ads connected successfully!")})):G().then(()=>{C.success("Facebook Lead Ads connected successfully!")}).catch(R=>{console.error("Post-OAuth refresh failed",R),C.error("Failed to refresh Facebook connection status")})}else w.data.type==="facebook_oauth_error"&&(console.error("âŒ [FacebookLeadAdsTrigger] Facebook OAuth error received from popup:",w.data.message),C.error(`Facebook connection failed: ${w.data.message||"Unknown error"}`))};return window.addEventListener("message",p),()=>window.removeEventListener("message",p)},[t]),l.useEffect(()=>()=>{t||sessionStorage.getItem("temp_facebook_connected")&&(console.log("Clearing temporary Facebook connection on unmount"),sessionStorage.removeItem("temp_facebook_connected"),sessionStorage.removeItem("temp_facebook_user"))},[t]);const G=async()=>{try{if(console.log("ðŸ” loadStatus called with webhookId:",t),!t){console.log("ðŸ†• New webhook flow - starting disconnected"),sessionStorage.removeItem("temp_facebook_connected"),sessionStorage.removeItem("temp_facebook_user"),P({isConnected:!1}),U([]),F([]),c==null||c(!1);return}console.log("ðŸ” Existing webhook - checking webhook-specific connection for:",t);const p=localStorage.getItem(`facebook_connected_${t}`)==="true",w=localStorage.getItem(`facebook_user_${t}`);if(console.log("ðŸ” localStorage check:",{isConnected:p,hasUserStr:!!w}),p&&w)try{const j=JSON.parse(w);console.log("âœ… Found webhook-specific Facebook connection in localStorage"),P({isConnected:!0,facebookUser:j});try{const b=await Je();console.log("ðŸ“¦ Stored pages loaded:",b.length,"pages"),U(b)}catch(b){console.log("âŒ Failed to load pages:",b),U([])}c==null||c(!0);return}catch(j){console.error("âŒ Invalid webhook-specific data, clearing:",j),localStorage.removeItem(`facebook_connected_${t}`),localStorage.removeItem(`facebook_user_${t}`)}const D=sessionStorage.getItem("temp_facebook_connected")==="true",i=sessionStorage.getItem("temp_facebook_user");if(console.log("ðŸ” sessionStorage fallback check:",{tempConnected:D,hasTempUserStr:!!i}),D&&i)try{const j=JSON.parse(i);console.log("âœ… Found Facebook connection in sessionStorage, using as fallback"),P({isConnected:!0,facebookUser:j});try{const b=await Je();console.log("ðŸ“¦ Stored pages loaded from sessionStorage fallback:",b.length,"pages"),U(b)}catch(b){console.log("âŒ Failed to load pages from sessionStorage fallback:",b),U([])}c==null||c(!0);return}catch(j){console.error("âŒ Invalid sessionStorage data:",j)}console.log("âŒ No Facebook connection found in localStorage or sessionStorage"),P({isConnected:!1}),U([]),F([]),c==null||c(!1)}catch(p){console.error("âŒ Error in loadStatus:",p),P({isConnected:!1}),U([]),F([]),c==null||c(!1)}},W=async()=>{try{console.log("ðŸ” Performing demo login...");const p=await fetch("http://localhost:5000/api/auth/demo-login",{method:"POST",headers:{"Content-Type":"application/json"}});if(p.ok){const w=await p.json();if(w.success&&w.data.token)return _s.setItem("token",w.data.token),localStorage.setItem("token",w.data.token),console.log("âœ… Demo login successful"),w.data.token}throw new Error("Demo login failed")}catch(p){throw console.error("âŒ Demo login error:",p),p}},V=async()=>{if(console.log("ðŸš€ handleConnect called"),console.log("ðŸ” Webhook toggle check:",{workflowEnabled:o}),!o){C.error("First ON the Toggle");return}B(!0);try{if(console.log("ðŸ” Current status:",r),r.isConnected){console.log("âœ… Already connected, loading pages...");const I=await Be();U(I);return}console.log("ðŸ”§ Debug Info:",{baseUrl:"http://localhost:5000",currentOrigin:window.location.origin,webhookId:t}),console.log("ðŸ” Checking backend availability...");let p=!0,w=!1;try{const I=_s.getItem("token")||localStorage.getItem("token");console.log("ðŸ”‘ Using token:",!!I);const S=await fetch("http://localhost:5000/api/auth/facebook/status",{method:"GET",headers:{Authorization:`Bearer ${I}`,"Content-Type":"application/json"}});console.log("ðŸ¥ Health check response:",S.status,S.ok),p=S.ok,S.status===401&&(console.log("ðŸ” Authentication required"),w=!0,p=!0)}catch(I){console.error("âŒ Backend check failed:",I),p=!1}if(!p)throw new Error(`âŒ Backend server is not running!

Please start the backend server:
1. Open terminal in backend folder
2. Run: npm start
3. Wait for "Server is running on port 5001"
4. Try connecting again`);w&&(console.log("ðŸ” Authentication required, performing demo login..."),await W(),C.success("âœ… Authenticated successfully")),console.log("ðŸ”„ Generating Facebook OAuth URL...");let D;try{if(D=await Ka(),console.log("âœ… Facebook OAuth URL generated:",D),!D||typeof D!="string")throw new Error("Invalid OAuth URL received: "+D);D.startsWith("https://www.facebook.com/")||console.log("âš ï¸ Unexpected OAuth URL format:",D)}catch(I){throw console.error("âŒ Error generating OAuth URL:",I),new Error("Failed to generate Facebook OAuth URL: "+((I==null?void 0:I.message)||I))}const i=600,j=700,b=window.screenX+(window.outerWidth-i)/2,T=window.screenY+(window.outerHeight-j)/2;console.log("ðŸ”„ Opening Facebook OAuth popup..."),console.log("ðŸ”— OAuth URL:",D);const E=window.open(D,"fb_oauth",`width=${i},height=${j},left=${b},top=${T},toolbar=0,location=0,status=0,menubar=0`);if(console.log("ðŸ“± Popup opened:",!!E),E){const I=setInterval(()=>{E.closed&&(console.log("ðŸ”’ Popup was closed - checking if OAuth completed"),clearInterval(I),setTimeout(async()=>{console.log("ðŸ”„ Popup closed, attempting auto force connect...");try{const S=await Be();console.log("âœ… OAuth successful! Pages found:",S.length);const _={id:"4098579607137444",name:"Facebook User",email:""};if(console.log("ðŸš€ Auto applying force connect..."),P({isConnected:!0,facebookUser:_}),c==null||c(!0),U(S),C.success(`âœ… Facebook Lead Ads connected! Found ${S.length} pages.`),S.length>0){const ee=S[0].id;H(ee);try{const ge=await lt(ee);F(ge),console.log("âœ… Auto-loaded forms for first page:",ge.length)}catch(ge){console.log("âŒ Failed to auto-load forms:",ge)}}}catch(S){console.log("âŒ OAuth may have failed or been cancelled:",S),C.info("Facebook connection was cancelled or failed")}},2e3))},1e3);setTimeout(()=>{E.closed&&console.log("âš ï¸ Popup was closed immediately - might be blocked")},100)}if(!E){console.error("âŒ Popup was blocked by browser");const I=new Error("Popup was blocked. Please allow popups for this site and try again.");throw I.isPopupBlocked=!0,I}let R="";const me=setInterval(()=>{try{if(E&&!E.closed){const I=E.location.href;I!==R&&(console.log("ðŸ”„ Popup URL changed:",I),R=I)}else E&&E.closed&&(clearInterval(me),console.log("ðŸ”’ Popup closed, stopping URL monitoring"))}catch{R===""&&(console.log("ðŸŒ Popup navigated to external domain (Facebook)"),R="external")}},500);await new Promise((I,S)=>{let _=!1,ee=!1;const ge=[window.location.origin];try{const A=new URL(D),Oe=A.searchParams.get("redirect_uri");if(Oe)try{const pe=decodeURIComponent(Oe),Ee=new URL(pe).origin;ge.includes(Ee)||ge.push(Ee)}catch{}else{const pe=A.origin;ge.includes(pe)||ge.push(pe)}}catch{}let De;setTimeout(()=>{De=setInterval(()=>{E&&E.closed&&!_&&!ee&&setTimeout(()=>{if(!_&&!ee){_=!0,clearInterval(De),clearInterval(me),window.removeEventListener("message",oe);const A=new Error("Authentication was cancelled by user");A.isUserCancellation=!0,S(A)}},3e3)},1e3)},2e3);const oe=A=>{var pe,Ee,ut,ft,We;if(_){console.log("âš ï¸ [FB OAuth Listener] Message received but already resolved, ignoring");return}if(console.log("ðŸ“¨ [FB OAuth Listener] message received from",A.origin,A.data),console.log("ðŸ” [FB OAuth Listener] allowed origins:",ge),!(ge.includes(A.origin)||A.origin==="null"||A.origin==="*"||A.origin===window.location.origin||A.origin.includes("localhost")||A.origin.includes("ai.research-hero.com"))){console.log("âš ï¸ [FB OAuth Listener] Message from disallowed origin, ignoring:",A.origin),console.log("ðŸ” [FB OAuth Listener] Current window origin:",window.location.origin),console.log("ðŸ” [FB OAuth Listener] Allowed origins:",ge);return}if(console.log("âœ… [FB OAuth Listener] Origin validation passed for:",A.origin),!((pe=A.data)!=null&&pe.type)||!A.data.type.includes("facebook_oauth")){console.log("âš ï¸ [FB OAuth Listener] Not a Facebook OAuth message, ignoring:",(Ee=A.data)==null?void 0:Ee.type);return}console.log("âœ… [FB OAuth] Valid Facebook OAuth message received, processing..."),_=!0,clearInterval(De),clearInterval(me),window.removeEventListener("message",oe);try{E&&!E.closed&&(E.close(),console.log("Popup closed by frontend after message"))}catch(Z){console.log("Failed to close popup from frontend:",Z)}if(((ut=A.data)==null?void 0:ut.type)==="facebook_oauth_success"){console.log("ðŸŽ‰ [FB OAuth] Success message received!"),ee=!0;const Z=(ft=A.data.data)==null?void 0:ft.facebookUser;console.log("ðŸ‘¤ [FB OAuth] Facebook user data:",Z),console.log("âœ… [FB OAuth] Authentication completed successfully"),Z?(console.log("ðŸ’¾ [FB OAuth] Storing connection data..."),console.log("ðŸ“ [FB OAuth] Storing in session storage for immediate use"),sessionStorage.setItem("temp_facebook_user",JSON.stringify(Z)),sessionStorage.setItem("temp_facebook_connected","true"),console.log("âœ… [FB OAuth] Session storage updated:",{temp_facebook_connected:sessionStorage.getItem("temp_facebook_connected"),temp_facebook_user:!!sessionStorage.getItem("temp_facebook_user")}),t&&(console.log("ðŸ“ [FB OAuth] Also storing permanently for webhook:",t),localStorage.setItem(`facebook_connected_${t}`,"true"),localStorage.setItem(`facebook_user_${t}`,JSON.stringify(Z))),console.log("ðŸ”„ [FB OAuth] Setting status to connected..."),P({isConnected:!0,facebookUser:Z}),c==null||c(!0),console.log("ðŸ”„ Loading Facebook pages after OAuth success..."),Be().then(te=>{if(console.log("âœ… Facebook connected and pages loaded:",te.length,"pages"),console.log("ðŸ“„ Pages data:",te),U(te),te.length>0){const xe=te[0].id;H(xe),console.log("ðŸ”„ Auto-selecting first page and loading forms..."),lt(xe).then(Ie=>{console.log("âœ… Forms loaded for first page:",Ie.length,"forms"),F(Ie),C.success(`âœ… Facebook Lead Ads connected! Found ${te.length} pages and ${Ie.length} forms.`)}).catch(Ie=>{console.log("âŒ Failed to load forms for first page:",Ie),C.success(`âœ… Facebook Lead Ads connected! Found ${te.length} pages.`)})}else C.success("âœ… Facebook Lead Ads connected successfully!");setTimeout(()=>{console.log("ðŸ”„ Refreshing status after OAuth success..."),G()},100),setTimeout(()=>{const xe=document.getElementById("facebook-form-section");xe?(console.log("ðŸ“ Scrolling to form section"),xe.scrollIntoView({behavior:"smooth"})):console.log("âš ï¸ Form section not found")},500),I()}).catch(te=>{console.error("Error loading pages, trying fallback:",te),Je().then(xe=>{console.log("âœ… Facebook connected, using stored pages:",xe.length,"pages"),U(xe),C.success("âœ… Facebook Lead Ads connected successfully!"),I()}).catch(xe=>{console.error("Error loading stored pages:",xe),C.success("âœ… Facebook Lead Ads connected! Please refresh to load pages."),I()})})):S(new Error("No user data received from Facebook"))}else if(((We=A.data)==null?void 0:We.type)==="facebook_oauth_error"){const Z=A.data.error||A.data.message||"Failed to connect to Facebook";if(console.error("âŒ Facebook OAuth error:",Z),Z.toLowerCase().includes("denied")||Z.toLowerCase().includes("cancelled")||Z.toLowerCase().includes("access_denied")){console.log("â„¹ï¸ Facebook authentication denied by user");const te=new Error(Z);te.isUserCancellation=!0,S(te)}else C.error("âŒ "+Z),S(new Error(Z))}};window.addEventListener("message",oe);const Fe=setTimeout(()=>{if(!_){_=!0,clearInterval(De),clearInterval(me),window.removeEventListener("message",oe),E&&!E.closed&&E.close(),console.log("â° Facebook OAuth timeout - closing popup");const A=new Error("Facebook authentication timed out");A.isTimeout=!0,S(A)}},3e5),Dt=I,Ze=S;I=(...A)=>{clearTimeout(Fe),Dt(...A)},S=(...A)=>{clearTimeout(Fe),Ze(...A)}})}catch(p){const w=(p==null?void 0:p.isUserCancellation)===!0,D=(p==null?void 0:p.isTimeout)===!0,i=(p==null?void 0:p.isPopupBlocked)===!0;if(w)return;D?(console.error("â° Facebook authentication timed out"),C.error("Facebook authentication timed out. Please try again.")):i?(console.error("ðŸš« Popup blocked by browser"),C.error("Popup was blocked. Please allow popups for this site and try again.")):(console.error("âŒ Error in Facebook connection:",p),console.error("âŒ Error details:",{message:p instanceof Error?p.message:"Unknown error",stack:p instanceof Error?p.stack:void 0,type:typeof p,error:p}),C.error(p instanceof Error?p.message:"Failed to connect to Facebook"))}finally{B(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-4 border-b border-white/10",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500/20 rounded-lg flex items-center justify-center",children:e.jsx(Ds,{className:"h-5 w-5 text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Connect Facebook Lead Ads Account"}),e.jsx("p",{className:"text-sm text-white/50",children:"All connections are fully encrypted and secure. Comply with SOC Type 2 and GDPR."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Ds,{className:"h-5 w-5 text-white"})}),e.jsx("span",{className:"text-lg font-medium text-white",children:"Facebook Lead Ads"})]}),e.jsxs(Ja,{value:d,onValueChange:p=>v(p),className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Vs,{value:"new",id:"fb-new-connection",className:"border-white/40 text-blue-400"}),e.jsx(q,{htmlFor:"fb-new-connection",className:"text-sm font-medium text-white",children:"Add New Connection"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Vs,{value:"existing",id:"fb-existing-connection",className:"border-white/40 text-blue-400"}),e.jsx(q,{htmlFor:"fb-existing-connection",className:"text-sm font-medium text-white",children:"Select Existing Connection"})]})]}),d==="new"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"text-sm font-medium text-white",children:"New Connection Name"}),e.jsx($,{value:u,onChange:p=>Q(p.target.value),placeholder:"Facebook Lead Ads #1",className:"w-full h-12 border border-white/20 bg-white/5 text-white placeholder:text-white/40 rounded-lg"}),e.jsx("p",{className:"text-xs text-white/50",children:"Name your connection with Facebook Lead Ads account."})]}),e.jsxs("div",{className:"pt-4 space-y-2",children:[e.jsx("div",{className:"flex items-center gap-3",children:r.isConnected?e.jsxs(e.Fragment,{children:[e.jsxs(M,{onClick:V,disabled:y,className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ“˜"}),"Connect With Facebook Lead Ads"]}),e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-green-500/20 rounded-lg",children:e.jsx("svg",{className:"w-6 h-6 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}):e.jsxs(M,{onClick:V,disabled:y,className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center justify-center gap-2",children:[y?e.jsx(Re,{className:"h-4 w-4 animate-spin"}):e.jsx("span",{className:"text-lg",children:"ðŸ“˜"}),"Connect With Facebook Lead Ads"]})}),r.isConnected&&e.jsx("div",{className:"flex justify-end",children:e.jsx(M,{onClick:()=>{t?(localStorage.removeItem(`facebook_connected_${t}`),localStorage.removeItem(`facebook_user_${t}`)):(sessionStorage.removeItem("temp_facebook_connected"),sessionStorage.removeItem("temp_facebook_user")),P({isConnected:!1}),U([]),F([]),H(""),z(""),c==null||c(!1),C.success("Facebook disconnected successfully")},variant:"outline",size:"sm",className:"text-xs text-red-400 border-red-400/30 hover:text-red-300 hover:bg-red-500/10",children:"Disconnect"})})]})]})]})},io=({initialConfig:t,onCancel:o,onSave:c})=>{const[d,v]=l.useState({messageTemplate:(t==null?void 0:t.messageTemplate)||"New lead received from {name} ({email}) at {timestamp}",fromPhoneNumber:(t==null?void 0:t.fromPhoneNumber)||"+13462331126",testPhoneNumber:(t==null?void 0:t.testPhoneNumber)||"",enableNotifications:(t==null?void 0:t.enableNotifications)??!0}),[u,Q]=l.useState(!1),[r,P]=l.useState(!1),O=()=>{if(!d.messageTemplate.trim()){g.error("Message template is required");return}if(!d.fromPhoneNumber.trim()){g.error("From phone number is required");return}c(d)},U=async()=>{var F;if(!((F=d.testPhoneNumber)!=null&&F.trim())){g.error("Please enter a test phone number");return}P(!0);try{const H=await(await fetch("/api/text-webhook/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({toPhoneNumber:d.testPhoneNumber,message:d.messageTemplate,fromPhoneNumber:d.fromPhoneNumber})})).json();H.success?g.success("Test SMS sent successfully!"):g.error(`Failed to send test SMS: ${H.error}`)}catch(k){console.error("Error testing SMS:",k),g.error("Failed to send test SMS. Please try again.")}finally{P(!1)}},Y=[{placeholder:"{name}",description:"Contact name"},{placeholder:"{email}",description:"Contact email"},{placeholder:"{phone}",description:"Contact phone"},{placeholder:"{company}",description:"Company name"},{placeholder:"{message}",description:"Message content"},{placeholder:"{timestamp}",description:"Current timestamp"},{placeholder:"{webhook_id}",description:"Webhook ID"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-blue-100 rounded-lg",children:e.jsx(wa,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Text Webhook Configuration"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure SMS notifications for your webhook"})]})]}),e.jsxs(Et,{children:[e.jsxs(It,{children:[e.jsxs(Lt,{className:"flex items-center gap-2",children:[e.jsx(va,{className:"h-5 w-5"}),"Message Template"]}),e.jsx(Gs,{children:"Customize the SMS message that will be sent. Use placeholders to include dynamic data."})]}),e.jsxs(Tt,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"messageTemplate",children:"Message Template"}),e.jsx(Ta,{id:"messageTemplate",placeholder:"Enter your message template...",value:d.messageTemplate,onChange:F=>v({...d,messageTemplate:F.target.value}),rows:4,className:"font-mono text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{children:"Available Placeholders"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Y.map(F=>e.jsxs(ct,{variant:"outline",className:"cursor-pointer hover:bg-gray-100",onClick:()=>{const k=document.getElementById("messageTemplate");if(k){const H=k.selectionStart,ae=k.selectionEnd,z=k.value,y=z.substring(0,H),B=z.substring(ae);k.value=y+F.placeholder+B,k.focus(),k.setSelectionRange(H+F.placeholder.length,H+F.placeholder.length),v({...d,messageTemplate:k.value})}},children:[F.placeholder,e.jsxs("span",{className:"ml-1 text-xs text-gray-500",children:["(",F.description,")"]})]},F.placeholder))})]})]})]}),e.jsxs(Et,{children:[e.jsxs(It,{children:[e.jsxs(Lt,{className:"flex items-center gap-2",children:[e.jsx(ja,{className:"h-5 w-5"}),"Phone Number Configuration"]}),e.jsx(Gs,{children:"Configure the phone numbers for sending and testing SMS messages."})]}),e.jsxs(Tt,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"fromPhoneNumber",children:"From Phone Number"}),e.jsx($,{id:"fromPhoneNumber",type:"tel",placeholder:"+1234567890",value:d.fromPhoneNumber,onChange:F=>v({...d,fromPhoneNumber:F.target.value})}),e.jsx("p",{className:"text-xs text-gray-500",children:"This is the Twilio phone number that will send the SMS messages."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"testPhoneNumber",children:"Test Phone Number (Optional)"}),e.jsx($,{id:"testPhoneNumber",type:"tel",placeholder:"+1234567890",value:d.testPhoneNumber,onChange:F=>v({...d,testPhoneNumber:F.target.value})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enter a phone number to test your SMS configuration."})]}),d.testPhoneNumber&&e.jsx(M,{onClick:U,disabled:r,variant:"outline",className:"w-full",children:r?"Sending...":"Send Test SMS"})]})]}),e.jsxs(Et,{children:[e.jsx(It,{children:e.jsxs(Lt,{className:"flex items-center gap-2",children:[e.jsx(Na,{className:"h-5 w-5"}),"How It Works"]})}),e.jsx(Tt,{children:e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{children:"When webhook data is received, the system will automatically extract phone numbers from the payload."})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{children:"Your message template will be processed, replacing placeholders with actual data from the webhook."})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{children:"An SMS will be sent to the extracted phone number using your configured Twilio account."})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(ka,{className:"h-5 w-5 text-yellow-600 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium",children:"Important Note"}),e.jsx("p",{children:"Make sure your webhook data contains phone number fields (phone, mobile, cell, etc.) for this action to work properly."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(M,{variant:"outline",onClick:o,children:"Cancel"}),e.jsx(M,{onClick:O,disabled:u,children:u?"Saving...":"Save Configuration"})]})]})},lo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACu0lEQVR4nO2UT2jTYByG48F5c4ieFcdogqaVNkmXuJ7KDkILrcPN4y4y2KFnPYjebMCbc4JXT85Bq0IPWm1zsLVoFZFdNjfULV93kVHBuZJoP/lmo1lNmj/9K3wvvLfw6/skDyUIHBwcHBwcXcoez7ECRd0pkmSlQJI7BZIsFT2eaaLH+SHR06pEl5Q8vaPkvRU1T9+GWeqo9XiSXC1SFDToUnlkZLjbw2GWGVYkekmVvPCf5umVlhB7b954vNa1EkUx3Rqv5LyMKnnXDMf/7bw5AEluWQCg1gDPJTo9HvBcQpG8NYvxUMnTwByAouo2ACAQOCjz3MPPodCRdod/CQYPA4G7j25ajf8N4K2bHrMzXgNoQHzaHA/ybscDngkAgfug3bMDgNoxgEYVIHCXIUEccDK+IrCzgOdq+lv9AnCklF4Z0NS2AeYnZt65BbCjVLMywAXAq+zYa1OA4yKAk3OLap4+U3MD0EopI2WAA4DvOd/uzUy4Gk3HYUsA1MDVt/BeKP7TJcA+pVopA2wCrD8L1C49ikA03hYA6skbG/DKhWt1o79WO2MaEOuodp9XDcZnnozD8+nYn/G2AbROzi3WpdO+XTcATqvqhn/L+RQxM7FvuCsATak0G97qFcDmc/+2Xpm2ATSlkpHEClKqmwAvnvIfm5XpCIDW2ZmF90Dgql0AqC48Di+3Gt4RANSK4D8BePZlp8bLAvdmg/eP2hnfEQD0bJlhDso8K8oC15ZSMs/dXT03egjd7CmAFnCWiQGe3Xb+1tmv8hh7UX+rLwAoTpXSlCGa0jcAJ0rplRkoACuljJQZSAAjpcyUGVgAFKSJLLC3UM2UGWgAN4liABEDtJUoBkgCMPAAqbhsDiDK4qADRNKxpOmBU9eXh/YgLL5EPwAiqTiIpuLi1IOpoW79Pg4ODg4O8d/lF8QKnDLBCDeUAAAAAElFTkSuQmCC",Ks="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAADLElEQVR4nO2Zz08TQRTHNzM0MQHixaMnI2jE4Mmr/4A/okej3r0oAn+AiYke9IYkpDNFDAkRqokHL4bEEzFelIqAJP5IDPvetrXQAhXSsrRjplYMboGdnd0th/0m79TN7Pcz8+bN7KthRIoUKZJUbNg8Qxj0UYZJwnCGcsxTjpv1yBOGH2u/cbNXPmscCCVy7YRDP2XwmXIUSsFgXgIbg9m28I3fFS1yJinDZWXjDhBcIgzvyDHDMR/Hk4RjStv4f0EYThsJOBGodxqHS5RD0W/z9F9arVEOFwMxTxLWDcrBDsw8/xtgE25dD2LmQzCP2xCUwQV/3A+ZHX+WVs9U24glOiey4uzLn6LreVZ0jGfE4afWXhBFud98qDbeN2wLR3H1TV5Mpctis1IVjXR5cnn3jc3hg1Z1qpVKj+YPDVti4vuG2E9X9gCoQcSxx5v70XQr5ZDzCvBwpriveTcA8pyQB6aH2Yd+r+aPjmVEeZeUUQbg8oyAPmUAT9eDevS+W2lotlCuiPupNXFzqrAdx55l9h+TwbySeXnZ0qk4498a5/65VznPY8YS6dOhpI+Mt5myw/zs8qbn8ajqZpbXXp2XzeVtB8DY1w0tAMpwXGEF8JPOyxYKToDHc7/0VoBjSmUFlvwGGNAEoBxyKgDlgweApUAA7k2viXypsiO2GhwBpa2q47l8qSK6X2QDAXCdQo9cnriNVBVCtI9Y/qeQyibWAfhR3ApsEyfDAJiEUkBlVLZHQgAYUNjYhONt1wAxbnarfKgcGU3viC8rzirEFtYdz7U+cZv/KGIs3eUaoL4KswolLtgyyhQvc6ppFDQA4WZvqB80vgIwXPLcvZMds2YDEIa3DK2PeobTzQIgHN4bSUENLfHF45TBavgA4ENbpS7Z7lNpbOkDgE0T5nnDT8l2n1sIPQCwCcNrRhCS7T43XTrPAAxWfZ95hxh0yo6Z3wBEbtghs8MIRbI6xbFnt2u3GgDkaqVSu9p40WC2TZ7YhMOcKoC8qhB5wjblL6YGirF0V21VOE68NkuFxaJdWberQoZZtCsPUquWvBLX2iPD1qlm+40UKZJxMPQbpCHHxg1rFUAAAAAASUVORK5CYII=",co="data:image/png;base64,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",mo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE1UlEQVR4nO2afWwTZRzHf7zGPySRRBT+MRGjJoJRsyjGYbYOo70r82Vy3QYap251w+wFdOktRgpMtvgCZrtjuwdYlszwz2IEEyEhbZiwiGwrOrwWicERbCHBP3TiRtjW7WtuuGYvLezYruvLfZJvLk3au+f3uefuea73EJmYmJiYmMQtra1YIKs4JKkopFSEebFIUqFKPmyjeMJWiYetVdjAi1iT4cJCShXSHFjEOXGAF4GxcE6csX6IhygV4EW4xhcfjhOdgoAFlOzwIi5GFKD1hCqkUzLjcmE+L+JGNAE2J16jZIdz4nTEsy8ilP0RHtSzL+ksHpdVDMh+vEKJgrUKGVqxUwQ48bnefck+LJdVHNREUCJhdWItJ6KDc2KAc6KHF1GmXR6xOj46i1fDW7QbXkcZfMJiSiXQXXwfvI5eeB34PxKlEvBw5eOK13KBUgEwegCMDuPQqlMTBRT9Ee03zRdxl6Siou4nLKNEBa20GIzKwehfMIIeAfV+PC/7ANmHIt0Hlv1YJfvw1VzZGy28kd6FQj2jhY9FhwCNvSqe054odTdAUvG65MNgvYonKIaA0QowqoJCgQmF36GAGSH7cDfFADTRMjB6Ewp9C0ZDEQufCwFGABctRAOtxj7aBEafgdFpMBqOVvBII6H/g5vbuBUAr8M1aWiKnu+zT9zyDE/KsEToLSAM15sCEFcC0Ez3gFEeFHLiZE6T1phQVzGamo9FTN+PFckjAArlglFvuKGeF9q0xgx0vB/xMVnLnydFXQIGawmhL28vYNj73mV3EH+5A/C7g9jVdtXgGzcYZUCh0IQGGyCgr4xwY9v0BHiCQDgBnGqDgf9RgtHxKQ2eJQFDnxL6towT8PEdCAgC7gC2GFM8aB4UGjBKwEA14VrJLAgI4rgxAlw0H4wG412AJ4B2QwRogFF7AgjYSUYBRi9OmbnNkoCRvYTQFzMT4A7iQixGgkIw6jdyFLheSRj8RJeAG54gDh69EqOnV2hPbQoVg1EtTrzaojVmqHMzdtR1R8w/P2w1bCLUfglLDR36bkdKToXHYwr4pWRpy57S7IqK0p5oEStLv0ZnyUocefoRKJQDRtuh0DdgdPVWAkbkmwK0bdwK0BDeLlubW1COaLEXlHso2tyikZ6BQjvAyB+tF4Q/J5uAyWAfPQtG+8HoesReEa8CXn6ncon9rYp0LqegPIvPPT+Wl9bnd3Vv3H7+9/ydfuTVHMbG2rTp7A/76f7REUahawkhYIwsW65g4e0Yyzrefhn5tQgnr/YKXK5pv0aDTMvBiIUnX0kgYBiCS/dMDY2UDoV+TnwB+TV7ZvSu4JhlV0IJyOKFgHbdj+aNal3rByKBM4VpkwS0USyQfKiWVEh6BVh4YdbPELqKtF7Qjy7HOXQUPkmxQPKhRfLhu3gQENdkmQJyU1tAhlXYMF5AJme/FOs2AJinvRJvOItHY31syrIKj1l4+0hYAC8cifZd7fX7dG6semHnsELyISSr2E1zQSZv32zh7L9ZOMG9zpazcqYCtAVYggu6FkPV+fHUgV+xhBIdmwgHL6JXW5HGi2iI5Wq0OUdbgD15TaJVxCZKFawi+AiLsmsoVVi/FfdyTvw9TsCIzYlMSiV4EWt4EUd5Ee0p1f1NTExMTMh4/gNwIeTsDQJL/QAAAABJRU5ErkJggg==",ho="data:image/png;base64,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",qs=({webhook:t,workflowName:o,onBack:c,onSave:d})=>{var Vt,zt,Jt,Kt,qt,Zt,$t,es,ts;console.log("ðŸ” WebhookCreator rendered with props:",{webhook:!!t,workflowName:o});const{isSuperAdmin:v}=Ha(),[u,Q]=l.useState(null),[r,P]=l.useState(null),[O,U]=l.useState(""),[Y,F]=l.useState(!1),[k,H]=l.useState(""),[ae,z]=l.useState(!1),[y,B]=l.useState([]),[de,J]=l.useState(!1),[G,W]=l.useState(null),[V,p]=$s(),[w,D]=l.useState(!1),[i,j]=l.useState(null),[b,T]=l.useState("disconnected"),[E,R]=l.useState(!1),[me,I]=l.useState(null),[S,_]=l.useState(o||"Untitled Workflow"),[ee,ge]=l.useState(null),[De,gt]=l.useState(!1);l.useEffect(()=>{o&&o!==S&&(console.log("ðŸ”„ Updating workflow title from prop:",o),_(o))},[o]),l.useEffect(()=>{if(S&&S!=="Untitled Workflow"){const s={workflowTitle:S,selectedTrigger:u,selectedApp:r,actionCards:y.length>0?y:void 0,timestamp:Date.now()};localStorage.setItem("webhook_creator_state",JSON.stringify(s))}},[S,u,r,y]),l.useEffect(()=>{const s=localStorage.getItem("webhook_creator_state");if(s&&!t)try{const a=JSON.parse(s);Date.now()-a.timestamp<30*60*1e3?(console.log("ðŸ”„ Restoring workflow state from localStorage:",a),a.selectedTrigger&&!u&&Q(a.selectedTrigger),a.selectedApp&&!r&&P(a.selectedApp),a.actionCards&&y.length===0&&B(a.actionCards)):localStorage.removeItem("webhook_creator_state")}catch(a){console.error("Error restoring workflow state:",a),localStorage.removeItem("webhook_creator_state")}},[]);const[oe,Fe]=l.useState(!1),[Dt,Ze]=l.useState(!1),[A,Oe]=l.useState(!1),[pe,Ee]=l.useState([]),[ut,ft]=l.useState(null),[We,Z]=l.useState(!1),[te,xe]=l.useState(null),[Ie,pt]=l.useState(null),[Wt,xt]=l.useState(!1),[ia,Mt]=l.useState(!1),[go,uo]=l.useState("new"),[fo,po]=l.useState("Facebook Lead Ads #1"),[Le,ye]=l.useState({isConnected:!1}),[$e,Ue]=l.useState([]),[et,Xe]=l.useState([]),[tt,bt]=l.useState(""),[_t,wt]=l.useState(""),[xo,bo]=l.useState(!1),[Me,Gt]=l.useState(""),[vt,jt]=l.useState(!1),[Te,Ye]=l.useState({listName:"",description:"",type:"General"}),he=[{id:"webhook",name:"Webhook",icon:()=>e.jsx(He,{className:"h-10 w-1o text-purple-600"}),description:"Receive HTTP requests from external services"},{id:"email-parser",name:"Email Parser (AI Cruitment)",icon:()=>e.jsx(ot,{className:"h-8 w-8 text-pink-600"}),description:"Parse emails sent to a unique email address"},{id:"facebook-lead-ads",name:"Facebook Lead Ads",icon:()=>e.jsx("img",{src:Ks,alt:"Facebook",className:"h-10 w-10"}),description:"Trigger when new leads are submitted on your Facebook Lead Ads forms"}],Bt=[{id:"catch-webhook",name:"Catch Webhook (Preferred)",description:"Triggers when a new POST, PUT or GET request is sent to the webhook URL."}],Nt=[{id:"new-email-received",name:"New Email Received",description:"Triggers when a new email is sent to your unique email parser address."}],kt=[{id:"facebook-lead-ads-new-lead",name:"New Lead Instant",description:"Triggers when a new lead is submitted to your selected Facebook Lead Ads form."}],Qt=()=>(r==null?void 0:r.id)==="email-parser"?Nt:(r==null?void 0:r.id)==="facebook-lead-ads"?kt:Bt,la=[{id:"outbound-campaign",name:"Campaign",icon:()=>e.jsx("img",{src:mo,alt:"Gmail",className:"h-10 w-10"}),color:"bg-indigo-600",description:"Create or launch an outbound calling campaign",events:[{id:"create-campaign",name:"Create Campaign",description:"Create a new outbound campaign"}]},{id:"gmail-service",name:"Gmail Service",icon:()=>e.jsx("img",{src:lo,alt:"Gmail",className:"h-10 w-10"}),color:"bg-white",description:"Send emails and manage Gmail account",events:[{id:"send-email",name:"Send Email",description:"Send an email using Gmail."},{id:"create-draft",name:"Create Draft",description:"Create a draft email in Gmail."},{id:"reply-to-email",name:"Reply to Email",description:"Reply to an existing email."},{id:"star-email",name:"Star Email",description:"Star an email in Gmail."},{id:"trash-email",name:"Move to Trash",description:"Move an email to trash in Gmail."},{id:"forward-email",name:"Forward Email",description:"Forward an email to another recipient."},{id:"add-label",name:"Add Label to Email",description:"Add a label to an email in Gmail."},{id:"mark-as-read",name:"Mark Email as Read",description:"Mark an email as read in Gmail."},{id:"mark-as-unread",name:"Mark Email as Unread",description:"Mark an email as unread in Gmail."},{id:"archive-email",name:"Archive Email",description:"Archive an email in Gmail."},{id:"delete-email",name:"Delete Email",description:"Delete an email from Gmail."},{id:"search-emails",name:"Search Emails",description:"Search for emails in Gmail."}]},{id:"lists",name:"Lists",icon:()=>e.jsx("img",{src:ho,alt:"Gmail",className:"h-10 w-10"}),color:"bg-white",description:"Manage contact lists and data",events:[{id:"add-to-list",name:"Add Contact to List",description:"Add a new contact to a specific list."},{id:"create-list",name:"Create New List",description:"Create a new contact list."},{id:"update-contact",name:"Update Contact",description:"Update existing contact information."},{id:"remove-from-list",name:"Remove from List",description:"Remove a contact from a list."}]},{id:"text-webhook",name:"Text Webhook",icon:()=>e.jsx("img",{src:co,alt:"Gmail",className:"h-10 w-10"}),color:"bg-white",description:"Send SMS notifications when webhook data is received",events:[{id:"send-sms",name:"Send SMS",description:"Send an SMS notification to extracted phone numbers."}]}];l.useEffect(()=>{At(),console.log("WebhookCreator initialized with workflow name:",o)},[o]);const yt=async()=>{try{const s=await Pa();s.success&&Ee(s.data||[])}catch(s){console.error("Error loading lists:",s),Ee([])}},ca=async()=>{try{if(!Te.listName.trim()||!Te.description.trim()){g.error("Please fill in all required fields");return}const s=await Oa({listName:Te.listName,description:Te.description,type:Te.type});s.success&&(await yt(),Gt(s.data.id.toString()),Ye({listName:"",description:"",type:"General"}),jt(!1),g.success("List created successfully!"))}catch(s){console.error("Error creating list:",s),g.error("Failed to create list")}},At=async()=>{try{if(console.log("ðŸ” Loading Facebook connection status...",{currentWebhookId:re,isConnected:Le.isConnected,hasWebhook:!!t}),!re&&!Le.isConnected&&!t){console.log("ðŸ†• New webhook flow - not loading Facebook connection status"),ye({isConnected:!1}),Ue([]);return}const s=re||t&&(t.webhook_id||t.id);if(s){console.log("ðŸ“‹ Loading Facebook status for webhook:",s);const a=await aa(s);if(ye(a),a.isConnected){const m=await Je();Ue(m),console.log("âœ… Facebook connection loaded:",{status:a,pagesCount:m.length})}}}catch(s){console.error("Error loading Facebook connection status:",s),ye({isConnected:!1}),Ue([])}},da=async s=>{try{const a=await lt(s);Xe(a)}catch(a){console.error("Error loading lead forms:",a),Xe([])}},ma=s=>{bt(s),s?da(s):Xe([]),be()},Ht=s=>{P(s),Ze(!0)},st=()=>{if(y.length>=5){g.error("Maximum 5 action cards allowed per workflow");return}const s={id:Date.now(),isExpanded:!0,selectedApp:null,selectedEvent:null,searchQuery:"",isConnected:!1};B(a=>[...a,s]),be(),console.log(`âž• Added new action card. Total cards: ${y.length+1}`)},ha=s=>{B(a=>{const m=a.filter(f=>f.id!==s);return console.log(`ðŸ—‘ï¸ Removed action card ${s}. Remaining cards: ${m.length}`),be(),m})},ga=()=>{B(s=>{const a=s.filter((m,f,h)=>f===h.findIndex(x=>{var N,L,ne,X,ie,Pe;return((N=x.selectedApp)==null?void 0:N.id)===((L=m.selectedApp)==null?void 0:L.id)&&((ne=x.selectedEvent)==null?void 0:ne.id)===((X=m.selectedEvent)==null?void 0:X.id)&&((ie=x.selectedApp)==null?void 0:ie.id)&&((Pe=x.selectedEvent)==null?void 0:Pe.id)}));return a.length!==s.length&&(console.log(`ðŸ§¹ Removed ${s.length-a.length} duplicate cards`),g.success(`Removed ${s.length-a.length} duplicate action cards`),be()),a})},Ae=(s,a)=>{console.log("ðŸ”„ updateActionCard called:",{cardId:s,updates:a}),B(m=>{const f=m.map(h=>h.id===s?{...h,...a}:h);return console.log("ðŸ“‹ Updated action cards:",f),f}),be()},ue=(s,a,m)=>{const f=y.find(x=>x.id===s),h=(f==null?void 0:f.gmailConfig)||{action:"send",fromEmail:"",to:"",cc:"",bcc:"",subject:"",body:"",isHtml:!1,attachments:[],template:"default",messageId:"",signature:"",labelId:"",replyToMessageId:""};Ae(s,{gmailConfig:{...h,[a]:m}})},ua=async s=>{Q(s),F(!0);try{if((r==null?void 0:r.id)==="email-parser"){const m=`${Math.random().toString(36).substring(2,8)}@aicruitment.com`;H(m),g.success("Email Parser address generated! Forward emails to this address to trigger the workflow.")}else if((r==null?void 0:r.id)==="webhook"){const a="http://localhost:5000",m=Math.random().toString(36).substring(2,15),f=`${a}/api/webhook-data/capture/${m}`;H(f),g.success("Webhook URL generated! Toggle ON to activate and save to database.")}else(r==null?void 0:r.id)==="facebook-lead-ads"&&(H(""),g.info("Select event, then connect your Facebook Lead Ads."),S&&S.trim()?(console.log("ðŸ”§ Creating webhook record for Facebook Lead Ads with title:",S),await Ft()):console.log("ðŸ”§ No workflow title yet, webhook record will be created when title is entered"));y.length===0?(console.log("ðŸŽ¯ Auto-adding first action card since none exist"),st()):console.log(`ðŸŽ¯ Skipping auto-add, ${y.length} cards already exist`),console.log("ðŸ”„ Trigger selected, starting auto-save functionality"),xt(!0),xa(),g.success("ðŸ”„ Auto-save started! Changes will be saved every second.")}catch(a){console.error("Error handling trigger selection:",a),g.error("Failed to setup trigger")}finally{F(!1)}},fa=async()=>{if(!k)return;if(w){D(!1),me&&(clearInterval(me),I(null)),g.info("Stopped capturing webhook responses");return}D(!0),j(null),g.info("Listening for webhook responses...");const s=k.split("/").pop(),a=setInterval(async()=>{try{const m=await K.get(`/api/webhook-data/capture/${s}/history?limit=1`);if(m.data.success&&m.data.data&&m.data.data.webhookData&&m.data.data.webhookData.length>0){const f=m.data.data.webhookData[0],h=new Date(f.created_at);if((new Date().getTime()-h.getTime())/1e3<=60){let L=f.data;if(typeof L=="string")try{L=JSON.parse(L)}catch{}j(L),D(!1),clearInterval(a),I(null),g.success("Webhook data captured successfully!")}}}catch(m){console.error("Error fetching webhook data:",m)}},2e3);I(a),setTimeout(()=>{w&&(D(!1),clearInterval(a),I(null),g.warning("Capture timeout - no webhook response received"))},6e4)},St=async s=>{var a,m;if(A)try{const f=(t==null?void 0:t.webhook_id)||(t==null?void 0:t.id)||re||(k?k.split("/").pop():"");if(!f)throw new Error("Webhook ID not found");const h={name:S,description:(u==null?void 0:u.description)||"",trigger_event:u==null?void 0:u.id,trigger_app:(r==null?void 0:r.id)||"webhook",url:k,isActive:s,actionCards:y.map(N=>({id:N.id,selectedApp:N.selectedApp,selectedEvent:N.selectedEvent,isConnected:N.isConnected,selectedListId:N.selectedListId,campaignConfig:N.campaignConfig,textConfig:N.textConfig,gmailConfig:N.gmailConfig}))},x=await K.put(`/api/webhooks/${f}`,h);if(x.data.success)console.log(`Webhook ${s?"activated":"deactivated"} successfully`);else throw new Error(x.data.message||"Failed to update webhook")}catch(f){console.error("Error saving webhook toggle state:",f),g.error(((m=(a=f.response)==null?void 0:a.data)==null?void 0:m.message)||"Failed to save webhook state")}},pa=async s=>{var m,f;const a=(r==null?void 0:r.id)==="facebook-lead-ads";if(s&&!A&&u&&(k||a)){if(re){Fe(!0),await St(!0),g.success("Webhook activated!");return}if(!S||!S.trim()){g.error("Please enter a workflow name");return}if(!u.id){g.error("Please select a trigger event");return}if(!v)try{const x=(await K.get("/api/credits/balance")).data.data;if(!x||parseFloat(x.available_credits)<1){g.error("Insufficient credits to create webhook. Please purchase credits to continue.");return}}catch(h){console.error("Error checking credit balance:",h),g.error("Unable to verify credit balance. Please try again.");return}F(!0);try{console.log("ðŸ”§ Creating webhook with data:",{name:S,trigger_event:u.id,trigger_app:(r==null?void 0:r.id)||"webhook",description:u.description,url:k});const h=await K.post("/api/webhooks/create",{name:S||`Webhook - ${u.name}`,trigger_event:u.id,trigger_app:(r==null?void 0:r.id)||"webhook",description:u.description,url:k,is_active:!0});if(h.data.success){const x=h.data.data.webhook_id;Yt(x),Oe(!0),Fe(!0),h.data.data&&(console.log("âœ… Webhook created successfully:",h.data.data),console.log("âœ… Webhook ID from response:",x)),g.success("Webhook activated and saved to database!")}else throw new Error(h.data.message||"Failed to create webhook")}catch(h){console.error("Error creating webhook:",h);const x=((f=(m=h.response)==null?void 0:m.data)==null?void 0:f.message)||h.message||"Failed to activate webhook";g.error(x);return}finally{F(!1)}}else s&&A?(Fe(!0),await St(!0),g.success("Webhook activated!")):(Fe(!1),await St(!1),g.info("Webhook deactivated"))},Ct=async()=>{var s,a,m,f;if(Wt){gt(!0);try{!t&&!re&&await Ft();const h=t&&(t.webhook_id||t.id)||re;if(!h){console.error("âŒ No webhook ID available for auto-save");return}console.log("ðŸ’¾ Auto-saving webhook:",h);const x={name:S,description:(u==null?void 0:u.description)||"",trigger_event:u==null?void 0:u.id,trigger_app:(r==null?void 0:r.id)||"webhook",url:k,isActive:oe,actionCards:y.map(L=>({id:L.id,selectedApp:L.selectedApp,selectedEvent:L.selectedEvent,isConnected:L.isConnected,selectedListId:L.selectedListId,campaignConfig:L.campaignConfig,textConfig:L.textConfig,gmailConfig:L.gmailConfig})),facebookConnection:{isConnected:Le.isConnected,facebookUser:Le.facebookUser,pages:$e,selectedPageId:tt,selectedLeadFormId:_t,leadForms:et}};console.log("ðŸ“¤ Sending auto-save data:",{webhookId:h,hasActionCards:((s=x.actionCards)==null?void 0:s.length)||0,hasFacebookConnection:!!x.facebookConnection,facebookConnected:(a=x.facebookConnection)==null?void 0:a.isConnected,facebookPagesCount:((f=(m=x.facebookConnection)==null?void 0:m.pages)==null?void 0:f.length)||0});const N=await K.put(`/api/webhooks/${h}`,x);if(N.data.success)xt(!1),pt(new Date),Z(!0),console.log("âœ… Webhook auto-saved successfully");else throw console.error("âŒ Auto-save failed - server returned error:",N.data),new Error(N.data.message||"Auto-save failed")}catch(h){console.error("âŒ Auto-save failed:",h),setTimeout(()=>{Wt&&(console.log("ðŸ”„ Retrying auto-save..."),Ct())},5e3)}finally{gt(!1)}}},xa=()=>{console.log("ðŸ”„ Starting auto-save every 1 second"),ee&&clearInterval(ee);const s=setInterval(()=>{Ct()},1e3);ge(s)};l.useEffect(()=>()=>{ee&&clearInterval(ee)},[ee]);const be=async()=>{if(console.log("ðŸ”„ triggerAutoSave called",{hasWebhook:!!t,currentWebhookId:re,facebookConnected:Le.isConnected,facebookPagesCount:$e.length,actionCardsCount:y.length,campaignCards:y.filter(a=>{var m;return((m=a.selectedApp)==null?void 0:m.id)==="outbound-campaign"})}),!t&&!re)try{console.log("ðŸ”§ Creating webhook record before auto-save..."),await Ft()}catch(a){console.error("âŒ Failed to ensure webhook record:",a);return}xt(!0),te&&clearTimeout(te);const s=setTimeout(()=>{Ct()},2e3);xe(s)};l.useEffect(()=>{if(t){console.log("Loading existing webhook data:",t),Z(!0);const s=t.triggerType||t.trigger_type||t.events;let a=null;if(s)if(typeof s=="string"&&s.startsWith("["))try{a=JSON.parse(s)[0]}catch{a=s}else a=s;const m=a&&Nt.some(h=>h.id===a),f=a&&kt.some(h=>h.id===a);if(m){P(he.find(x=>x.id==="email-parser")||he[1]);const h=Nt.find(x=>x.id===a);console.log("Setting Email Parser trigger for existing webhook:",h||{id:a,name:a,description:""}),Q(h||{id:a,name:a,description:""})}else if(f){P(he.find(x=>x.id==="facebook-lead-ads")||he[2]);const h=kt.find(x=>x.id===a);console.log("Setting Facebook Lead Ads trigger for existing webhook:",h||{id:a,name:a,description:""}),Q(h||{id:a,name:a,description:""})}else{P(he[0]);const h=Bt.find(x=>x.id===a);console.log("Setting webhook trigger for existing webhook:",h||{id:a,name:a,description:""}),Q(h||{id:a,name:a,description:""})}if(Ze(!0),z(!0),H(t.url||""),Oe(!0),Fe(t.status==="active"||t.is_active||t.isActive),_(t.name||"Untitled Workflow"),t.metadata)try{const h=typeof t.metadata=="string"?JSON.parse(t.metadata):t.metadata;h.actionCards&&h.actionCards.length>0&&B(h.actionCards),h.facebookConnection&&(console.log("ðŸ”„ Restoring Facebook connection data from metadata:",h.facebookConnection),setTimeout(()=>{ye({isConnected:h.facebookConnection.isConnected||!1,facebookUser:h.facebookConnection.facebookUser}),h.facebookConnection.pages&&(Ue(h.facebookConnection.pages),console.log("âœ… Restored Facebook pages:",h.facebookConnection.pages.length)),h.facebookConnection.selectedPageId&&(bt(h.facebookConnection.selectedPageId),console.log("âœ… Restored selected page:",h.facebookConnection.selectedPageId)),h.facebookConnection.selectedLeadFormId&&(wt(h.facebookConnection.selectedLeadFormId),console.log("âœ… Restored selected lead form:",h.facebookConnection.selectedLeadFormId)),h.facebookConnection.leadForms&&(Xe(h.facebookConnection.leadForms),console.log("âœ… Restored lead forms:",h.facebookConnection.leadForms.length)),console.log("ðŸŽ‰ Facebook connection restoration completed")},100))}catch(h){console.error("Error parsing webhook metadata:",h)}pt(new Date(t.updated_at||t.created_at))}else Z(!1),z(!1)},[t]),l.useEffect(()=>{(async()=>{try{console.log("ðŸ” Checking Gmail connection status...");const a=await K.get("/api/gmail/auth/status");console.log("ðŸ“§ Gmail status response:",a.data),a.data.success&&a.data.data.isConnected?(console.log("âœ… Gmail account exists for user (global status)"),T("connected")):(console.log("âŒ Gmail is not connected"),T("disconnected"))}catch(a){console.error("Error checking Gmail status:",a),T("disconnected")}})()},[]),l.useEffect(()=>{const s=a=>{var x;const m=[window.location.origin,"http://localhost:5000","http://localhost:5173","http://localhost:5174","https://ai.research-hero.com"],f=a.origin.includes("localhost")||a.origin==="null";if(!(m.includes(a.origin)||f)){console.warn("ðŸš« Ignoring message from unauthorized origin:",a.origin);return}if(console.log("ðŸ“¨ Received popup message:",a.data),a.data.type==="GMAIL_AUTH_SUCCESS")console.log("ðŸŽ‰ Gmail OAuth success received from popup"),Xt(a.data.data),R(!1),g.success("Gmail connected successfully!");else if(a.data.type==="GMAIL_AUTH_ERROR")console.error("âŒ Gmail OAuth error received from popup:",a.data.message),T("disconnected"),R(!1),g.error(`Gmail connection failed: ${a.data.message}`);else if(a.data.type==="facebook_oauth_success"){console.log("ðŸŽ‰ Facebook OAuth success received from popup");const N=(x=a.data.data)==null?void 0:x.facebookUser;console.log("ðŸ‘¤ [WebhookCreator] Facebook user data:",N),N&&(console.log("ðŸ“ [WebhookCreator] Storing in session storage for webhook creation"),sessionStorage.setItem("temp_facebook_user",JSON.stringify(N)),sessionStorage.setItem("temp_facebook_connected","true"),console.log("âœ… [WebhookCreator] Session storage updated:",{temp_facebook_connected:sessionStorage.getItem("temp_facebook_connected"),temp_facebook_user:!!sessionStorage.getItem("temp_facebook_user")})),ye({isConnected:!0,facebookUser:N}),console.log("âœ… Facebook connection status updated:",{isConnected:!0,facebookUser:N}),At().then(async()=>{g.success("Facebook Lead Ads connected successfully!"),console.log("ðŸ”„ Triggering auto-save after Facebook connection..."),await be(),console.log("âœ… Auto-save triggered after Facebook connection"),setTimeout(async()=>{try{(re||t&&(t.webhook_id||t.id))&&(console.log("ðŸ” Verifying Facebook connection was saved..."),await At())}catch(L){console.error("Failed to verify Facebook connection persistence:",L)}},3e3)}).catch(L=>{console.error("Post-OAuth refresh failed",L),g.error("Failed to refresh Facebook connection status")})}else a.data.type==="facebook_oauth_error"&&(console.error("âŒ Facebook OAuth error received from popup:",a.data.message),g.error(`Facebook connection failed: ${a.data.message||"Unknown error"}`))};return window.addEventListener("message",s),()=>window.removeEventListener("message",s)},[]),l.useEffect(()=>{const s=V.get("gmail_success"),a=V.get("gmail_error"),m=V.get("email"),f=V.get("card_id"),h=V.get("tempId"),x=V.get("return_to_workflow");if(console.log("ðŸ” Gmail OAuth callback parameters:",{gmailSuccess:s,gmailError:a,email:m,cardId:f,tempId:h,returnToWorkflow:x,webhook:(t==null?void 0:t.id)||(t==null?void 0:t.webhook_id),actionCards:y.length}),s==="true"&&m){if(T("connected"),g.success(`Gmail account connected successfully! (${decodeURIComponent(m)})`),f){const L=parseInt(f);console.log("Updating specific Gmail card with ID:",L),B(ne=>ne.map(X=>{var ie;return X.id===L&&((ie=X.selectedApp)==null?void 0:ie.id)==="gmail-service"?{...X,isConnected:!0}:X})),R(!1)}else console.log("No card ID found; leaving action cards unchanged"),R(!1);if(G&&J(!1),t&&(t.webhook_id||t.id)){const L=t.webhook_id||t.id;console.log("Updating webhook in database with Gmail connection status:",L);const ne={name:S,description:(u==null?void 0:u.description)||"",trigger_event:u==null?void 0:u.id,trigger_app:(r==null?void 0:r.id)||"webhook",isActive:oe,metadata:JSON.stringify({actionCards:y.map(X=>{var ie;return{id:X.id,selectedApp:X.selectedApp,selectedEvent:X.selectedEvent,isConnected:((ie=X.selectedApp)==null?void 0:ie.id)==="gmail-service"?!0:X.isConnected,selectedListId:X.selectedListId,campaignConfig:X.campaignConfig,textConfig:X.textConfig,gmailConfig:X.gmailConfig}})})};K.put(`/api/webhooks/${L}`,ne).then(X=>{console.log("âœ… Updated webhook with Gmail connection status:",X.data)}).catch(X=>{console.error("âŒ Failed to update webhook with Gmail connection status:",X)})}const N=new URLSearchParams(V);N.delete("gmail_success"),N.delete("gmail_error"),N.delete("email"),p(N)}else if(a){const N=decodeURIComponent(a);if(T("disconnected"),g.error(`Gmail connection failed: ${N}`),f){const ne=parseInt(f);console.log("Updating specific Gmail card with ID:",ne),B(X=>X.map(ie=>{var Pe;return ie.id===ne&&((Pe=ie.selectedApp)==null?void 0:Pe.id)==="gmail-service"?{...ie,isConnected:!1}:ie}))}else console.log("No card ID found; leaving action cards unchanged");const L=new URLSearchParams(V);L.delete("gmail_success"),L.delete("gmail_error"),L.delete("email"),p(L)}},[V,p,G]),l.useEffect(()=>{if(t&&We&&y.length===0){let s=!1;if(t.metadata)try{const a=typeof t.metadata=="string"?JSON.parse(t.metadata):t.metadata;s=a.actionCards&&a.actionCards.length>0}catch{s=!1}if(!s){const a={id:Date.now(),isExpanded:!0,selectedApp:null,selectedEvent:null,searchQuery:"",isConnected:!1};B([a])}}},[t,We]),l.useEffect(()=>()=>{te&&clearTimeout(te),me&&clearInterval(me)},[te,me]);const Xt=async s=>{console.log("ðŸŽ‰ Gmail OAuth success in WebhookCreator:",s),T("connected");try{const a=await K.get("/api/gmail/auth/status");a.data.success&&a.data.data.isConnected&&(console.log("âœ… Gmail status confirmed from backend:",a.data.data),G&&B(m=>m.map(f=>{var h;return f.id===G&&((h=f.selectedApp)==null?void 0:h.id)==="gmail-service"?{...f,isConnected:!0}:f})),We&&be())}catch(a){console.error("Error re-checking Gmail status:",a)}console.log("âœ… Gmail connection status updated successfully")},[re,Yt]=l.useState(null),Ft=async()=>{var s,a,m;try{if(console.log("ðŸ”§ ensureWebhookRecord called with:",{webhookCreated:A,currentWebhookId:re,workflowTitle:S,selectedTrigger:u==null?void 0:u.id,selectedApp:r==null?void 0:r.id,webhookUrl:k}),A||re){console.log("ðŸ”§ Webhook already exists, skipping creation");return}if(!S||!S.trim()){console.log("ðŸ”§ No workflow title, skipping webhook creation");return}if(!(u!=null&&u.id)){console.log("ðŸ”§ No trigger selected, skipping webhook creation");return}const f=(r==null?void 0:r.id)==="facebook-lead-ads";if(!k&&!f){console.log("ðŸ”§ No webhook URL and not Facebook Lead Ads, skipping webhook creation");return}const h={name:S,trigger_event:u.id,trigger_app:(r==null?void 0:r.id)||"webhook",description:u.description,url:k||"",is_active:!1};console.log("ðŸ”§ Creating webhook with payload:",h);const x=await K.post("/api/webhooks",h);if(console.log("ðŸ”§ Webhook creation response:",x.data),(s=x.data)!=null&&s.success){const N=((a=x.data.data)==null?void 0:a.id)||((m=x.data.data)==null?void 0:m.webhook_id);if(N&&(console.log("âœ… Webhook created successfully with ID:",N),Yt(N),Oe(!0),Z(!0),pt(new Date),console.log("âœ… Draft webhook created for autosave:",N),(r==null?void 0:r.id)==="facebook-lead-ads")){const L=sessionStorage.getItem("temp_facebook_connected"),ne=sessionStorage.getItem("temp_facebook_user");L==="true"&&ne&&(localStorage.setItem(`facebook_connected_${N}`,"true"),localStorage.setItem(`facebook_user_${N}`,ne),console.log("âœ… Transferred temporary Facebook connection to webhook:",N))}}}catch(f){console.error("Failed to ensure webhook record (draft):",f)}};return e.jsx("div",{className:"min-h-screen app-shell-bg",children:e.jsxs("div",{className:"max-w-full mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(M,{variant:"ghost",onClick:()=>{localStorage.removeItem("webhook_creator_state"),c()},className:"h-10 px-3 rounded-lg text-white hover:bg-white/10",children:[e.jsx(ya,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{value:S,onChange:s=>{_(s.target.value),be()},className:"text-xl font-semibold border-none bg-transparent p-0 h-auto focus-visible:ring-0 text-white placeholder:text-white/50"}),e.jsx("div",{className:"flex items-center gap-2",children:De?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-400",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse"}),e.jsx("span",{children:"Saving..."})]}):ee?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-400",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{children:"Auto-save ON"})]}):Ie?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-white/60",children:[e.jsx("div",{className:"w-2 h-2 bg-white/50 rounded-full"}),e.jsxs("span",{children:["Saved ",Ie.toLocaleTimeString()]})]}):null}),e.jsx(ze,{className:"h-5 w-5 text-white/40"})]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-white/60",children:"OFF"}),e.jsx("div",{className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors cursor-pointer ${oe?"bg-blue-600":"bg-white/20"} ${Y?"opacity-50 cursor-not-allowed":""}`,onClick:()=>{if(!Y){if(!u&&!oe){g.error("Please select a trigger event first");return}if(!S.trim()&&!oe){g.error("Please enter a workflow name first");return}pa(!oe)}},children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${oe?"translate-x-6":"translate-x-1"}`})}),e.jsx("span",{className:"text-sm text-blue-400 font-medium",children:"ON"})]}),y.length>1&&e.jsx(M,{onClick:ga,variant:"outline",size:"sm",className:"ml-4 text-xs px-3 py-1 h-8 border-orange-400/50 text-orange-400 hover:bg-orange-400/10",children:"ðŸ§¹ Clean Duplicates"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-[#0b0f2e]/90 backdrop-blur-sm rounded-2xl border border-white/10 shadow-lg",children:[e.jsx("div",{className:`p-6 cursor-pointer transition-all duration-200 ${ae?"border-b border-white/10":""}`,onClick:()=>z(!ae),children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-purple-500/20 rounded-xl",children:e.jsx(He,{className:"h-6 w-6 text-purple-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-sm text-white/60",children:"Trigger : When this happens ..."})}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"1. Choose Your First Application : Trigger"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{variant:"secondary",className:"bg-green-500/20 text-green-400 hover:bg-green-500/20 border border-green-500/30",children:"Free Task"}),e.jsx("div",{className:"h-5 w-5 text-white/30 cursor-not-allowed",title:"Trigger card cannot be deleted",children:e.jsx(ze,{className:"h-5 w-5"})}),e.jsx(Ws,{className:`h-5 w-5 text-white/40 transition-transform ${ae?"rotate-180":""}`})]})]})}),ae&&e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Choose App"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-white/40"}),e.jsx($,{placeholder:"Search apps or type / and describe your task...",value:O,onChange:s=>U(s.target.value),className:"pl-12 h-12 border border-white/20 rounded-lg bg-white/5 text-white placeholder:text-white/40 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-4",children:[e.jsxs("div",{className:`flex flex-col items-center p-4 border rounded-lg cursor-pointer transition-all ${(r==null?void 0:r.id)==="webhook"?"border-purple-400 bg-purple-500/20":"border-white/20 hover:border-purple-400/50 hover:bg-purple-500/10"}`,onClick:()=>Ht(he[0]),children:[e.jsx("div",{className:"w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center mb-2",children:typeof((Vt=he[0])==null?void 0:Vt.icon)=="string"?e.jsx("span",{className:"text-lg",children:he[0].icon}):typeof((zt=he[0])==null?void 0:zt.icon)=="function"?he[0].icon():e.jsx(He,{className:"h-6 w-6 text-purple-400"})}),e.jsx("span",{className:"text-sm font-medium text-center text-white",children:"Webhook"})]}),e.jsxs("div",{className:`flex flex-col items-center p-4 border rounded-lg cursor-pointer transition-all ${(r==null?void 0:r.id)==="facebook-lead-ads"?"border-blue-400 bg-blue-500/20":"border-white/20 hover:border-blue-400/50 hover:bg-blue-500/10"}`,onClick:()=>Ht(he[2]),children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center mb-2",children:typeof((Jt=he[2])==null?void 0:Jt.icon)=="string"?e.jsx("span",{className:"text-lg",children:he[2].icon}):typeof((Kt=he[2])==null?void 0:Kt.icon)=="function"?he[2].icon():e.jsx("img",{src:Ks,alt:"Facebook",className:"h-6 w-6"})}),e.jsx("span",{className:"text-sm font-medium text-center text-white",children:"Facebook Lead Ads"})]})]})]}),r&&(r.id==="webhook"||r.id==="facebook-lead-ads")&&e.jsx("div",{className:"space-y-4 border-t border-white/10 pt-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Trigger Event"}),e.jsxs(we,{value:u==null?void 0:u.id,onValueChange:s=>{const a=Qt().find(m=>m.id===s);a&&(Q(a),ua(a))},children:[e.jsx(ve,{className:"w-full h-12 px-4 rounded-md border border-white/20 bg-white/5 text-sm text-white font-medium shadow-sm hover:border-white/40 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition",children:e.jsx(Qe,{placeholder:"Select a trigger event"})}),e.jsx(je,{className:"rounded-md border border-white/20 bg-[#0b0f2e] shadow-lg max-h-72 overflow-y-auto",children:Qt().map(s=>e.jsx(se,{value:s.id,className:"p-3 cursor-pointer hover:bg-white/10 focus:bg-white/10 rounded-sm transition",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:s.name}),e.jsx("span",{className:"text-xs text-white/60",children:s.description})]})},s.id))})]})]})}),u&&(r==null?void 0:r.id)==="facebook-lead-ads"&&e.jsxs("div",{className:"space-y-4 border-t border-white/10 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-500/20 border border-blue-400/30 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-400"}),e.jsx("span",{className:"text-sm text-blue-300",children:"Select event then connect your Facebook Lead Ads account to complete setup."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{onClick:()=>{if(console.log("ðŸ” Main Connect button - Webhook toggle check:",{workflowEnabled:oe}),!oe){g.error("First ON the Toggle");return}Mt(!0)},className:"flex-1 h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:"Connect"}),Le.isConnected&&e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-green-500/20 rounded-lg",children:e.jsx("svg",{className:"w-6 h-6 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]}),Le.isConnected&&e.jsxs("div",{className:"space-y-4 p-4 bg-green-500/10 border border-green-400/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsxs("span",{className:"text-sm font-medium text-green-400",children:["Connected as ",((qt=Le.facebookUser)==null?void 0:qt.name)||"Facebook User"]})]}),$e.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"text-sm font-medium text-white/80",children:"Select Facebook Page"}),e.jsxs("select",{value:tt,onChange:s=>ma(s.target.value),className:"w-full p-2 border border-white/20 bg-white/5 text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",className:"bg-[#0b0f2e] text-white",children:"Choose a page..."}),$e.map(s=>e.jsx("option",{value:s.id,className:"bg-[#0b0f2e] text-white",children:s.name},s.id))]})]}),tt&&et.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"text-sm font-medium text-white/80",children:"Select Lead Form"}),e.jsxs("select",{value:_t,onChange:s=>{wt(s.target.value),be()},className:"w-full p-2 border border-white/20 bg-white/5 text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",className:"bg-[#0b0f2e] text-white",children:"Choose a lead form..."}),et.map(s=>e.jsx("option",{value:s.id,className:"bg-[#0b0f2e] text-white",children:s.name},s.id))]})]}),tt&&et.length===0&&e.jsx("div",{className:"text-sm text-white/60",children:"No lead forms found for this page."})]})]}),u&&(r==null?void 0:r.id)==="email-parser"&&e.jsx("div",{className:"space-y-4 border-t border-white/10 pt-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-white",children:"Email Parser Address"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${A?"bg-green-400":"bg-yellow-400"}`}),e.jsx("span",{className:`text-xs font-medium ${A?"text-green-400":"text-yellow-400"}`,children:A?"Active":"Toggle ON to Activate"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{value:k||"Select a trigger event to generate email address...",readOnly:!0,className:"flex-1 h-12 border border-white/20 rounded-lg bg-white/5 text-white font-mono text-sm"}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>{k?(navigator.clipboard.writeText(k),g.success("Email address copied to clipboard!")):g.error("Please select a trigger event first")},className:"h-12 px-4 bg-blue-600 text-white hover:bg-blue-700",children:"Copy"})]}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-500/10 border border-blue-400/30 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-300 mb-2",children:"You need to send or forward the email to the above-mentioned email parser address and we will fetch all the details from that email."}),e.jsxs("div",{className:"bg-blue-500/20 border-l-4 border-blue-400 p-3 mt-3",children:[e.jsx("p",{className:"text-sm text-blue-300 font-medium",children:"Important Note:"}),e.jsx("p",{className:"text-sm text-blue-300/80 mt-1",children:"Please note that we can fetch attachments up to 5MB, and each workflow has a unique Email Parser address. Attachments will be stored for 48 hours. You can also use the Text Formatter > Text Parser Module to extract specific text from the email body."})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-white/60",children:"Simple Response"}),e.jsxs("div",{className:"relative inline-block w-12 h-6",children:[e.jsx("input",{type:"checkbox",className:"sr-only",checked:!0,readOnly:!0}),e.jsx("div",{className:"block bg-blue-600 w-12 h-6 rounded-full"}),e.jsx("div",{className:"dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition transform translate-x-6"})]})]}),e.jsx(M,{variant:"outline",className:"mt-4 w-full h-12 border-2 border-blue-500 text-blue-400 hover:bg-blue-500/10",children:"Capture Email Parser Response"})]})}),u&&(r==null?void 0:r.id)==="webhook"&&e.jsxs("div",{className:"space-y-4 border-t border-white/10 pt-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-white",children:"Webhook URL"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${A?"bg-green-400":"bg-yellow-400"}`}),e.jsx("span",{className:`text-xs font-medium ${A?"text-green-400":"text-yellow-400"}`,children:A?"Active in Database":"Not Saved - Toggle ON to Activate"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{value:k||"Select a trigger event to generate webhook URL...",readOnly:!0,className:"flex-1 h-12 border border-white/20 rounded-lg bg-white/5 text-white font-mono text-sm"}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>{k?(navigator.clipboard.writeText(k),g.success("Webhook URL copied to clipboard!")):g.error("Please select a trigger event first")},disabled:!k,className:"h-12 px-4 bg-blue-600 text-white hover:bg-blue-700 border-blue-600 disabled:bg-white/20 disabled:text-white/40",children:"Copy"}),e.jsx(M,{variant:"outline",size:"sm",onClick:async()=>{var s,a;if(!k){g.error("Please select a trigger event first");return}try{const m=k.split("/").pop();(await K.post(`/api/webhook-data/test/${m}`)).data.success?g.success("Test webhook sent successfully! Check your Gmail for the test email."):g.error("Failed to send test webhook")}catch(m){console.error("Test webhook error:",m),g.error(((a=(s=m.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to send test webhook")}},disabled:!k||!A,className:"h-12 px-4 bg-green-600 text-white hover:bg-green-700 border-green-600 disabled:bg-white/20 disabled:text-white/40",children:"Test"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"Follow the steps below:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-white/60",children:[e.jsx("li",{children:"â€¢ Log in to the application where you want to enter the webhook URL."}),e.jsx("li",{children:"â€¢ Copy the webhook URL and add it under the webhook section of the application."}),e.jsx("li",{children:'â€¢ Click on the below "Capture Webhook Response" button and do a test record so that the webhook response can be captured here.'})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-400/30 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-300 font-medium",children:"Important Note:"}),e.jsx("p",{className:"text-sm text-blue-300/80 mt-1",children:"The webhook URL is unique for every workflow. Toggle the workflow ON to activate and save it to the database. Only active webhooks will receive and process incoming requests."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Simple Response"}),e.jsx("div",{className:"relative inline-flex h-6 w-11 items-center rounded-full bg-blue-600",children:e.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white translate-x-6"})})]}),e.jsxs(M,{onClick:fa,disabled:!k,className:"w-full h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:bg-white/20 disabled:text-white/40",children:[w?e.jsx(Re,{className:"h-4 w-4 animate-spin mr-2"}):null,w?"Stop Capturing":"Capture Webhook Response"]}),i&&e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Captured Webhook Data"}),e.jsxs("p",{className:"text-sm text-white/60",children:["Data received at ",new Date().toLocaleString()]})]}),e.jsx(ct,{variant:"secondary",className:"bg-green-500/20 text-green-400 border border-green-400/30",children:"âœ“ Captured"})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg border border-white/10 overflow-hidden",children:[e.jsx("div",{className:"bg-white/10 px-4 py-2 border-b border-white/10",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm font-medium text-white/80",children:[e.jsx("span",{children:"Label"}),e.jsx("span",{children:"Value"})]})}),e.jsx("div",{className:"divide-y divide-white/10",children:Object.entries(i).map(([s,a])=>e.jsxs("div",{className:"grid grid-cols-2 gap-4 px-4 py-3",children:[e.jsx("div",{className:"text-sm font-medium text-white bg-white/10 px-3 py-2 rounded border border-white/10",children:s}),e.jsx("div",{className:"text-sm text-white/80 bg-white/10 px-3 py-2 rounded border border-white/10 min-h-[40px] flex items-center",children:typeof a=="object"?JSON.stringify(a,null,2):String(a)})]},s))})]})]})]})]}),!1]})]}),u&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-px h-8 bg-white/20"}),e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-700 transition-colors shadow-lg",onClick:st,children:e.jsx(nt,{className:"h-6 w-6 text-white"})}),e.jsx("div",{className:"w-px h-8 bg-white/20"})]})}),y.map((s,a)=>{var m,f,h,x,N,L,ne,X,ie,Pe,ss,as,os,rs,ns,is,ls,cs,ds,ms,hs,gs,us,fs,ps,xs;return e.jsxs(Ot.Fragment,{children:[e.jsxs("div",{className:"bg-[#0b0f2e]/90 backdrop-blur-sm rounded-2xl border border-white/10 shadow-lg",children:[e.jsx("div",{className:`p-6 cursor-pointer transition-all duration-200 ${s.isExpanded?"border-b border-white/10":""}`,onClick:()=>Ae(s.id,{isExpanded:!s.isExpanded}),children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-green-500/20 rounded-xl",children:e.jsx(Aa,{className:"h-6 w-6 text-green-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-sm text-white/60",children:"Action : Do this ..."})}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:s.selectedApp?`${a+2}. ${s.selectedApp.name} : ${((m=s.selectedEvent)==null?void 0:m.name)||"Action"}`:`${a+2}. Choose Your Next Application : Action`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ea,{children:[e.jsx(ta,{asChild:!0,children:e.jsx("button",{className:"h-5 w-5 text-white/40 hover:text-white/70 transition-colors",onClick:n=>n.stopPropagation(),children:e.jsx(ze,{className:"h-5 w-5"})})}),e.jsx(sa,{align:"end",className:"w-48 bg-[#0b0f2e] border-white/20",children:e.jsxs(it,{onClick:n=>{n.stopPropagation(),ha(s.id),g.success("Action card removed successfully")},className:"flex items-center gap-2 px-3 py-2 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 cursor-pointer",children:[e.jsx(Zs,{className:"h-4 w-4"}),"Delete Action"]})})]}),e.jsx(Ws,{className:`h-5 w-5 text-white/40 transition-transform ${s.isExpanded?"rotate-180":""}`})]})]})}),s.isExpanded&&e.jsx("div",{className:"p-6 space-y-6",children:s.selectedApp?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`w-8 h-8 ${s.selectedApp.color} rounded-lg flex items-center justify-center`,children:typeof((f=s.selectedApp)==null?void 0:f.icon)=="string"?e.jsx("span",{className:"text-lg",children:s.selectedApp.icon}):typeof((h=s.selectedApp)==null?void 0:h.icon)=="function"?s.selectedApp.icon():e.jsx("div",{className:"h-5 w-5 bg-white/20 rounded"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-white",children:[a+2,". ",s.selectedApp.name," :"]}),e.jsx("p",{className:"text-sm text-white/60",children:"Action : Do this ..."})]}),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:e.jsx(ze,{className:"h-5 w-5 text-white/40"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Selected App"}),e.jsxs("div",{className:"w-full h-14 border border-white/20 rounded-lg px-4 flex items-center gap-3 shadow-sm bg-white/5",children:[e.jsx("div",{className:`w-9 h-9 ${s.selectedApp.color} rounded-md flex items-center justify-center text-white text-sm font-medium shadow`,children:typeof((x=s.selectedApp)==null?void 0:x.icon)=="string"?e.jsx("span",{children:s.selectedApp.icon}):typeof((N=s.selectedApp)==null?void 0:N.icon)=="function"?s.selectedApp.icon():e.jsx("div",{className:"h-4 w-4 bg-white/20 rounded"})}),e.jsx("span",{className:"text-white font-medium truncate",children:s.selectedApp.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-white mb-2",children:"Action Event"}),e.jsxs(we,{value:(L=s.selectedEvent)==null?void 0:L.id,onValueChange:n=>{var fe,Ne,Se;const le=(Ne=(fe=s.selectedApp)==null?void 0:fe.events)==null?void 0:Ne.find(ce=>ce.id===n);if(le&&(Ae(s.id,{selectedEvent:le}),((Se=s.selectedApp)==null?void 0:Se.id)==="gmail-service")){let ce="send";switch(n){case"send-email":ce="send";break;case"create-draft":ce="draft";break;case"reply-to-email":ce="reply";break;case"star-email":ce="star";break;case"trash-email":ce="trash";break;case"forward-email":case"add-label":case"mark-as-read":case"mark-as-unread":case"archive-email":case"delete-email":case"search-emails":default:ce="send"}ue(s.id,"action",ce)}},children:[e.jsx(ve,{className:"w-full h-12 px-4 rounded-md border border-white/20 bg-white/5 text-sm text-white font-medium shadow-sm hover:border-white/40 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition",children:e.jsx(Qe,{placeholder:"Select an action event"})}),e.jsx(je,{className:"rounded-md border border-white/20 bg-[#0b0f2e] shadow-lg max-h-72 overflow-y-auto",children:(ne=s.selectedApp.events)==null?void 0:ne.map(n=>e.jsx(se,{value:n.id,className:"p-3 cursor-pointer hover:bg-white/10 focus:bg-white/10 rounded-sm transition text-white",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:n.name}),e.jsx("span",{className:"text-xs text-white/60",children:n.description})]})},n.id))})]})]}),s.selectedEvent&&e.jsxs("div",{className:"pt-4",children:[s.isConnected?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-500/10 border border-green-400/30 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-sm font-medium text-green-400",children:"Connected"})]}),e.jsx(M,{onClick:async()=>{var n;((n=s.selectedApp)==null?void 0:n.id)==="lists"&&await yt(),J(!0),W(s.id)},variant:"outline",className:"w-full h-12 border border-white/20 text-white hover:bg-white/10 rounded-lg",children:"Reconfigure"})]}):e.jsx(M,{onClick:async()=>{var n,le,fe,Ne,Se,ce;if(((n=s.selectedApp)==null?void 0:n.id)==="lists"&&await yt(),((le=s.selectedApp)==null?void 0:le.id)==="gmail-service"){if(s.isConnected){g.success("Gmail already connected for this action");return}try{const Ce=await K.get("/api/gmail/auth/url",{params:{redirectPath:"popup"}});if(!((fe=Ce.data)!=null&&fe.success)||!((Se=(Ne=Ce.data)==null?void 0:Ne.data)!=null&&Se.authUrl))throw new Error(((ce=Ce.data)==null?void 0:ce.message)||"Failed to generate Gmail OAuth URL");if(!window.open(Ce.data.data.authUrl,"gmail-oauth","width=600,height=700,scrollbars=yes,resizable=yes,status=yes,location=yes,toolbar=no,menubar=no")){g.error("Popup blocked. Please allow popups and try again.");return}T("connecting");const at=setInterval(async()=>{var ws,vs,js,Ns,ks,ys,As,Ss,Cs,Fs,Es,Is,Ls,Ts,Ps,Os,Us;try{const Ve=await K.get("/api/gmail/auth/status");if((ws=Ve.data)!=null&&ws.success&&((js=(vs=Ve.data)==null?void 0:vs.data)!=null&&js.isConnected)){clearInterval(at),T("connected");const Rs=((ys=(ks=(Ns=Ve.data)==null?void 0:Ns.data)==null?void 0:ks.profile)==null?void 0:ys.email)||((Ss=(As=Ve.data)==null?void 0:As.data)==null?void 0:Ss.email)||"";Ae(s.id,{isConnected:!0,gmailConfig:{action:((Cs=s.gmailConfig)==null?void 0:Cs.action)||"send",fromEmail:Rs,to:((Fs=s.gmailConfig)==null?void 0:Fs.to)||"",cc:((Es=s.gmailConfig)==null?void 0:Es.cc)||"",bcc:((Is=s.gmailConfig)==null?void 0:Is.bcc)||"",subject:((Ls=s.gmailConfig)==null?void 0:Ls.subject)||"",body:((Ts=s.gmailConfig)==null?void 0:Ts.body)||"",isHtml:((Ps=s.gmailConfig)==null?void 0:Ps.isHtml)||!1,attachments:((Os=s.gmailConfig)==null?void 0:Os.attachments)||[],template:((Us=s.gmailConfig)==null?void 0:Us.template)||"default"}}),g.success(`Gmail connected successfully! From: ${Rs}`)}}catch{}},2e3);setTimeout(()=>{clearInterval(at),T("disconnected")},6e4)}catch(Ce){console.error("Error starting Gmail OAuth:",Ce),g.error("Failed to initiate Gmail OAuth")}return}J(!0),W(s.id)},disabled:((X=s.selectedApp)==null?void 0:X.id)==="gmail-service"&&b==="connecting",className:`w-full h-12 text-white rounded-lg ${((ie=s.selectedApp)==null?void 0:ie.id)==="gmail-service"&&s.isConnected?"bg-green-600 hover:bg-green-700":((Pe=s.selectedApp)==null?void 0:Pe.id)==="gmail-service"&&b==="connecting"?"bg-blue-400":"bg-blue-600 hover:bg-blue-700"}`,children:((ss=s.selectedApp)==null?void 0:ss.id)==="gmail-service"?e.jsx(e.Fragment,{children:b==="connecting"?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"h-4 w-4 animate-spin mr-2"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),s.isConnected?"Gmail Connected âœ“":"Connect Gmail"]})}):"Connect"}),((as=s.selectedApp)==null?void 0:as.id)==="gmail-service"&&s.isConnected&&e.jsxs("div",{className:"mt-6 space-y-4 p-4 bg-white/5 rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ot,{className:"h-5 w-5 text-red-400"}),e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Email Configuration"})]}),i&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-500/10 border border-blue-400/30 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-300 font-medium",children:"âœ“ Webhook Data Captured"}),e.jsxs("p",{className:"text-xs text-blue-300/70 mt-1",children:["Available fields: ",Object.keys(i).map(n=>`{{${n}}}`).join(", ")]}),e.jsx("p",{className:"text-xs text-blue-300/70 mt-1",children:"Click the [+] button next to any field to insert dynamic values."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-white",children:"From (Connected Gmail)"}),e.jsx($,{value:((os=s.gmailConfig)==null?void 0:os.fromEmail)||"Connect Gmail first",readOnly:!0,className:"w-full h-10 mt-1 bg-white/5 border-white/20 text-white/60",placeholder:"Gmail will be set after connection"})]}),(((rs=s.gmailConfig)==null?void 0:rs.action)==="reply"||((ns=s.gmailConfig)==null?void 0:ns.action)==="star"||((is=s.gmailConfig)==null?void 0:is.action)==="trash")&&e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-white",children:"Message ID"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{value:((ls=s.gmailConfig)==null?void 0:ls.messageId)||"",onChange:n=>ue(s.id,"messageId",n.target.value),placeholder:"Message ID or {{messageId}}",className:"w-full h-10 mt-1 bg-white/5 border-white/20 text-white placeholder:text-white/40"}),i&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsxs(we,{onValueChange:n=>ue(s.id,"messageId",n),children:[e.jsx(ve,{className:"w-8 h-8 p-0 border-0 bg-transparent",children:e.jsx("div",{className:"w-6 h-6 bg-blue-500/20 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-blue-400",children:"+"})})}),e.jsx(je,{className:"bg-[#0b0f2e] border-white/20",children:Object.entries(i).map(([n,le])=>e.jsxs(se,{value:`{{${n}}}`,className:"text-white hover:bg-white/10",children:[n,": ",String(le).substring(0,30),"..."]},n))})]})})]})]}),(((cs=s.gmailConfig)==null?void 0:cs.action)==="send"||((ds=s.gmailConfig)==null?void 0:ds.action)==="draft"||((ms=s.gmailConfig)==null?void 0:ms.action)==="reply")&&e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-white",children:"To"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{value:((hs=s.gmailConfig)==null?void 0:hs.to)||"",onChange:n=>ue(s.id,"to",n.target.value),placeholder:"recipient@example.com or {{email}}",className:"w-full h-10 mt-1 bg-white/5 border-white/20 text-white placeholder:text-white/40"}),i&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsxs(we,{onValueChange:n=>ue(s.id,"to",n),children:[e.jsx(ve,{className:"w-8 h-8 p-0 border-0 bg-transparent",children:e.jsx("div",{className:"w-6 h-6 bg-blue-500/20 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-blue-400",children:"+"})})}),e.jsx(je,{className:"bg-[#0b0f2e] border-white/20",children:Object.keys(i).map(n=>e.jsxs(se,{value:`{{${n}}}`,className:"text-white hover:bg-white/10",children:[n,": ",String(i[n]).substring(0,30),"..."]},n))})]})})]})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-white",children:"CC (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{value:((gs=s.gmailConfig)==null?void 0:gs.cc)||"",onChange:n=>ue(s.id,"cc",n.target.value),placeholder:"cc@example.com or {{email}}",className:"w-full h-10 mt-1 bg-white/5 border-white/20 text-white placeholder:text-white/40"}),i&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsxs(we,{onValueChange:n=>ue(s.id,"cc",n),children:[e.jsx(ve,{className:"w-8 h-8 p-0 border-0 bg-transparent",children:e.jsx("div",{className:"w-6 h-6 bg-blue-500/20 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-blue-400",children:"+"})})}),e.jsx(je,{className:"bg-[#0b0f2e] border-white/20",children:Object.keys(i).map(n=>e.jsxs(se,{value:`{{${n}}}`,className:"text-white hover:bg-white/10",children:[n,": ",String(i[n]).substring(0,30),"..."]},n))})]})})]})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-white",children:"BCC (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{value:((us=s.gmailConfig)==null?void 0:us.bcc)||"",onChange:n=>ue(s.id,"bcc",n.target.value),placeholder:"bcc@example.com or {{email}}",className:"w-full h-10 mt-1 bg-white/5 border-white/20 text-white placeholder:text-white/40"}),i&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsxs(we,{onValueChange:n=>ue(s.id,"bcc",n),children:[e.jsx(ve,{className:"w-8 h-8 p-0 border-0 bg-transparent",children:e.jsx("div",{className:"w-6 h-6 bg-blue-500/20 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-blue-400",children:"+"})})}),e.jsx(je,{className:"bg-[#0b0f2e] border-white/20",children:Object.keys(i).map(n=>e.jsxs(se,{value:`{{${n}}}`,className:"text-white hover:bg-white/10",children:[n,": ",String(i[n]).substring(0,30),"..."]},n))})]})})]})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-white",children:"Subject"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{value:((fs=s.gmailConfig)==null?void 0:fs.subject)||"",onChange:n=>ue(s.id,"subject",n.target.value),placeholder:"Email subject or {{subject}}",className:"w-full h-10 mt-1 bg-white/5 border-white/20 text-white placeholder:text-white/40"}),i&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:e.jsxs(we,{onValueChange:n=>ue(s.id,"subject",n),children:[e.jsx(ve,{className:"w-8 h-8 p-0 border-0 bg-transparent",children:e.jsx("div",{className:"w-6 h-6 bg-blue-500/20 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-blue-400",children:"+"})})}),e.jsx(je,{className:"bg-[#0b0f2e] border-white/20",children:Object.keys(i).map(n=>e.jsxs(se,{value:`{{${n}}}`,className:"text-white hover:bg-white/10",children:[n,": ",String(i[n]).substring(0,30),"..."]},n))})]})})]})]})]}),e.jsxs("div",{children:[e.jsx(q,{className:"text-sm font-medium text-white",children:"Body"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:((ps=s.gmailConfig)==null?void 0:ps.body)||"",onChange:n=>ue(s.id,"body",n.target.value),placeholder:"Email body content or use dynamic fields like {{message}}",className:"w-full h-24 mt-1 px-3 py-2 border border-white/20 bg-white/5 text-white placeholder:text-white/40 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),i&&e.jsx("div",{className:"absolute right-2 top-2",children:e.jsxs(we,{onValueChange:n=>{var le;return ue(s.id,"body",(((le=s.gmailConfig)==null?void 0:le.body)||"")+n)},children:[e.jsx(ve,{className:"w-8 h-8 p-0 border-0 bg-transparent",children:e.jsx("div",{className:"w-6 h-6 bg-blue-500/20 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-blue-400",children:"+"})})}),e.jsx(je,{className:"bg-[#0b0f2e] border-white/20",children:Object.keys(i).map(n=>e.jsxs(se,{value:`{{${n}}}`,className:"text-white hover:bg-white/10",children:[n,": ",String(i[n]).substring(0,30),"..."]},n))})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`isHtml-${s.id}`,checked:((xs=s.gmailConfig)==null?void 0:xs.isHtml)||!1,onChange:n=>ue(s.id,"isHtml",n.target.checked),className:"w-4 h-4 text-blue-600 bg-white/10 border-white/20 rounded focus:ring-blue-500"}),e.jsx(q,{htmlFor:`isHtml-${s.id}`,className:"text-sm font-medium text-white",children:"Send as HTML"})]}),e.jsx(M,{variant:"outline",size:"sm",onClick:async()=>{const n=s.gmailConfig;if(!(n!=null&&n.to)||!(n!=null&&n.subject)||!(n!=null&&n.body)){g.error("Please fill in To, Subject, and Body fields");return}g.promise(async()=>{const le=(Ne,Se)=>{if(!Ne||typeof Ne!="string")return Ne;let ce=Ne;return Se&&Object.keys(Se).forEach(Ce=>{const bs=`{{${Ce}}}`,at=Se[Ce];ce=ce.replace(new RegExp(bs.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),String(at))}),ce},fe={to:le(n.to,i)||"",cc:le(n.cc,i)||"",bcc:le(n.bcc,i)||"",subject:le(n.subject,i)||"",body:le(n.body,i)||"",isHtml:n.isHtml||!1};if(!fe.to||fe.to.includes("{{")||fe.to.includes("}}"))throw i?new Error("To field contains unresolved placeholders. Check that the field names match your webhook data."):new Error("To field contains placeholders but no webhook data captured. Please capture webhook data first or use a static email address.");if(!fe.to||!fe.subject||!fe.body)throw new Error("To, Subject, and Body fields are required.");return await Za(fe)},{loading:"Sending test email...",success:"Test email sent successfully via Gmail!",error:"Failed to send test email"})},children:"Send Test Email"})]}),e.jsx("div",{className:"pt-4 border-t border-white/10",children:e.jsx(M,{onClick:()=>{g.success("Gmail configuration saved successfully!"),be()},className:"w-full h-12 bg-green-600 hover:bg-green-700 text-white",children:"Save Gmail Configuration"})})]})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Choose App"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-white/40"}),e.jsx($,{placeholder:"Search apps or type / and describe your task...",value:s.searchQuery,onChange:n=>Ae(s.id,{searchQuery:n.target.value}),className:"pl-12 h-12 border border-white/20 bg-white/5 text-white placeholder:text-white/40 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-4",children:la.map(n=>e.jsxs("div",{className:"flex flex-col items-center p-4 border border-white/10 rounded-lg hover:border-blue-400/50 hover:bg-blue-500/10 cursor-pointer transition-all",onClick:()=>Ae(s.id,{selectedApp:n,isExpanded:!0}),children:[e.jsx("div",{className:`w-12 h-12 ${n.color} rounded-lg flex items-center justify-center mb-2`,children:typeof n.icon=="string"?e.jsx("span",{className:"text-lg",children:n.icon}):typeof n.icon=="function"?n.icon():e.jsx("div",{className:"h-6 w-6 bg-white/20 rounded"})}),e.jsx("span",{className:"text-sm font-medium text-center text-white",children:n.name})]},n.id))})]})})]}),a<y.length-1&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-px h-8 bg-white/20"}),e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-700 transition-colors shadow-lg",onClick:st,children:e.jsx(nt,{className:"h-6 w-6 text-white"})}),e.jsx("div",{className:"w-px h-8 bg-white/20"})]})})]},s.id)}),y.length>0&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-px h-8 bg-white/20"}),e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center cursor-pointer hover:bg-blue-700 transition-colors shadow-lg",onClick:st,children:e.jsx(nt,{className:"h-6 w-6 text-white"})})]})})]}),e.jsx(Qs,{open:de,onOpenChange:J,children:e.jsxs(Hs,{side:"right",className:"sheet-half-width max-w-none p-6 bg-[#0b0f2e] border-l border-white/10",style:{width:"50vw",maxWidth:"none",minWidth:"50vw"},children:[e.jsx(Xs,{children:e.jsx(Ys,{className:"text-white",children:G&&(($t=(Zt=y.find(s=>s.id===G))==null?void 0:Zt.selectedApp)!=null&&$t.name)?`Configure ${(ts=(es=y.find(s=>s.id===G))==null?void 0:es.selectedApp)==null?void 0:ts.name}`:"Configure Action"})}),e.jsx("div",{className:"mt-6 h-full overflow-y-auto",children:G&&(()=>{const s=y.find(m=>m.id===G),a=s==null?void 0:s.selectedApp;return(a==null?void 0:a.id)==="facebook-lead-ads"?null:(a==null?void 0:a.id)==="lists"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-white",children:"Lists Configuration"}),e.jsx("p",{className:"text-white/60 mb-4",children:"Configure how webhook data will be stored in your contact lists."})]}),e.jsxs("div",{className:"space-y-4",children:[vt?e.jsxs("div",{className:"space-y-4 p-4 border border-white/20 rounded-lg bg-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-white",children:"Create New List"}),e.jsx(M,{variant:"ghost",size:"sm",className:"text-white/60 hover:text-white hover:bg-white/10",onClick:()=>{jt(!1),Ye({listName:"",description:"",type:"General"})},children:"Cancel"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-1",children:"List Name *"}),e.jsx($,{value:Te.listName,onChange:m=>Ye(f=>({...f,listName:m.target.value})),placeholder:"Enter list name",className:"w-full bg-white/5 border-white/20 text-white placeholder:text-white/40"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-1",children:"Description *"}),e.jsx($,{value:Te.description,onChange:m=>Ye(f=>({...f,description:m.target.value})),placeholder:"Enter list description",className:"w-full bg-white/5 border-white/20 text-white placeholder:text-white/40"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/80 mb-1",children:"Type"}),e.jsxs(we,{value:Te.type,onValueChange:m=>Ye(f=>({...f,type:m})),children:[e.jsx(ve,{className:"w-full bg-white/5 border-white/20 text-white",children:e.jsx(Qe,{})}),e.jsxs(je,{className:"bg-[#0b0f2e] border-white/20",children:[e.jsx(se,{value:"General",className:"text-white hover:bg-white/10",children:"General"}),e.jsx(se,{value:"Marketing",className:"text-white hover:bg-white/10",children:"Marketing"}),e.jsx(se,{value:"Sales",className:"text-white hover:bg-white/10",children:"Sales"}),e.jsx(se,{value:"Event",className:"text-white hover:bg-white/10",children:"Event"}),e.jsx(se,{value:"Customer",className:"text-white hover:bg-white/10",children:"Customer"})]})]})]}),e.jsx(M,{onClick:ca,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:"Create List"})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Select List"}),e.jsxs(we,{value:Me,onValueChange:m=>{m==="create-new"?jt(!0):Gt(m)},children:[e.jsx(ve,{className:"w-full h-12 border border-white/20 bg-white/5 text-white rounded-lg",children:e.jsx(Qe,{placeholder:"Choose a list or create new..."})}),e.jsxs(je,{className:"bg-[#0b0f2e] border-white/20",children:[pe&&pe.length>0?pe.map(m=>e.jsx(se,{value:m.id.toString(),className:"p-3 text-white hover:bg-white/10",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:m.list_name}),e.jsxs("div",{className:"text-sm text-white/50",children:[m.contactCount||0," contacts"]})]})},m.id)):e.jsx(se,{value:"no-lists",disabled:!0,className:"p-3",children:e.jsx("div",{className:"text-sm text-white/50",children:"No lists available"})}),e.jsx(se,{value:"create-new",className:"p-3 border-t border-white/10 text-white hover:bg-white/10",children:e.jsx("div",{className:"font-medium text-blue-400",children:"+ Create New List"})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Field Mapping"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border border-white/20 rounded-lg bg-white/5",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:"Email"}),e.jsx("span",{className:"text-sm text-white/50",children:"â†’ email"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border border-white/20 rounded-lg bg-white/5",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:"Phone"}),e.jsx("span",{className:"text-sm text-white/50",children:"â†’ phoneNumber"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border border-white/20 rounded-lg bg-white/5",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:"Name"}),e.jsx("span",{className:"text-sm text-white/50",children:"â†’ fullName"})]})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(M,{onClick:async()=>{var m,f,h;if(!Me&&!vt){g.error("Please select a list first");return}try{if(!A||!oe){g.error("Please activate the webhook first before configuring lists");return}if(k){const x=k.split("/").pop();if(!x)throw new Error("Invalid webhook URL - cannot extract webhook ID");console.log("ðŸ”§ Saving webhook configuration:",{webhookId:x,listId:Me,appType:"lists"});try{const N=await K.put(`/api/webhooks/${x}/config`,{listId:Me,appType:"lists"});console.log("âœ… Configuration save response:",N.data)}catch(N){if(((m=N.response)==null?void 0:m.status)===404){g.error("Webhook not found. Please toggle the webhook ON first to create it in the database.");return}throw N}}else throw new Error("No webhook URL available");G&&Ae(G,{isConnected:!0,selectedListId:Me}),g.success("Lists configuration saved!"),J(!1)}catch(x){console.error("Error saving webhook configuration:",x);const N=((h=(f=x.response)==null?void 0:f.data)==null?void 0:h.message)||x.message||"Failed to save configuration";g.error(N)}},className:"w-full h-12 bg-green-600 hover:bg-green-700 text-white rounded-lg",disabled:!Me&&!vt,children:"Save Configuration"})})]})]}):(a==null?void 0:a.id)==="facebook-lead-ads"?null:(a==null?void 0:a.id)==="text-webhook"?e.jsx(io,{initialConfig:s==null?void 0:s.textConfig,onCancel:()=>J(!1),onSave:async m=>{G&&(Ae(G,{isConnected:!0,textConfig:m}),be(),g.success("Text webhook configured"),J(!1))}}):(a==null?void 0:a.id)==="gmail-service"?e.jsxs("div",{className:"text-white/60 text-center py-8",children:[e.jsx(ot,{className:"h-12 w-12 text-white/40 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-white mb-2",children:"Gmail Configuration"}),e.jsx("p",{className:"text-sm text-white/50",children:"Gmail configuration is now available directly in the action card below the Connect Gmail button."})]}):(a==null?void 0:a.id)==="outbound-campaign"?e.jsx($a,{initialConfig:s==null?void 0:s.campaignConfig,onCancel:()=>J(!1),onSave:async m=>{var x,N;if(!G)return;console.log("ðŸ”§ Saving campaign config:",m),console.log("ðŸ”§ Selected card for sidebar:",G);const f=y.find(L=>L.id===G),h=(N=(x=f==null?void 0:f.selectedApp)==null?void 0:x.events)==null?void 0:N.find(L=>L.id==="create-campaign");Ae(G,{isConnected:!0,campaignConfig:m,selectedEvent:h||(f==null?void 0:f.selectedEvent)}),console.log("âœ… Campaign action card updated"),be(),g.success("Campaign action configured"),J(!1)}}):e.jsx("div",{className:"text-white/60",children:"Select an app to configure."})})()})]})}),e.jsx(Qs,{open:ia,onOpenChange:Mt,children:e.jsxs(Hs,{side:"right",className:"sheet-half-width max-w-none p-6 bg-[#0b0f2e] border-l border-white/10",style:{width:"50vw",maxWidth:"none",minWidth:"50vw"},children:[e.jsx(Xs,{children:e.jsx(Ys,{className:"text-white",children:r!=null&&r.name?`Configure ${r.name}`:"Configure Trigger"})}),e.jsx("div",{className:"mt-6 h-full overflow-y-auto",children:(r==null?void 0:r.id)==="facebook-lead-ads"&&e.jsx(no,{webhookId:(t==null?void 0:t.webhook_id)||(t==null?void 0:t.id)||re,workflowEnabled:oe,onConnectionChange:async s=>{if(console.log("ðŸ”§ Facebook connection changed:",s),console.log("ðŸ”§ Current webhook IDs:",{"webhook?.webhook_id":t==null?void 0:t.webhook_id,"webhook?.id":t==null?void 0:t.id,currentWebhookId:re,final_webhookId:(t==null?void 0:t.webhook_id)||(t==null?void 0:t.id)||re}),s){const a=(t==null?void 0:t.webhook_id)||(t==null?void 0:t.id)||re;console.log("ðŸ”§ Loading Facebook connection status with webhookId:",a);const m=sessionStorage.getItem("temp_facebook_user");if(m)try{const f=JSON.parse(m);console.log("ðŸ“¦ Using temp Facebook user for main trigger area:",f),ye({isConnected:!0,facebookUser:f})}catch(f){console.error("âŒ Failed to parse temp Facebook user:",f),ye({isConnected:!0})}else ye({isConnected:!0});try{const f=await Je();console.log("ðŸ“¦ Loaded pages for main trigger area:",f.length,"pages"),Ue(f)}catch(f){console.error("âŒ Failed to load pages for main trigger area:",f),Ue([])}}else ye({isConnected:!1}),Ue([]),Xe([]),bt(""),wt("")}})})]})}),e.jsx(Xa,{isOpen:E,onClose:()=>R(!1),onSuccess:Xt})]})})},Po=()=>{const[t,o]=$s(),{user:c}=Ua(),d=(c==null?void 0:c.isSuperAdmin)||!1,[v,u]=l.useState("list"),[Q,r]=l.useState(null),[P,O]=l.useState(""),[U,Y]=l.useState(!1),[F,k]=l.useState([]),[H,ae]=l.useState(!1),[z,y]=l.useState(""),[B,de]=l.useState(!1);l.useEffect(()=>{const i=t.get("view"),j=t.get("workflow"),b=t.get("tempId"),T=t.get("workflowId"),E=t.get("gmail_success"),R=t.get("gmail_error"),me=t.get("email"),I=t.get("card_id");if(console.log("ðŸ” URL State Check:",{view:i,workflow:j,tempId:b,workflowId:T,gmailSuccess:E,gmailError:R,email:me,cardId:I}),i==="creator"){j&&y(decodeURIComponent(j));const S=localStorage.getItem("current_workflow_state");if(S&&b)try{const _=JSON.parse(S);if(_.tempId===b){if(y(_.name),_.webhookId){const ee=new URLSearchParams(t);ee.set("id",_.webhookId.toString()),o(ee)}console.log("ðŸ”„ Restored workflow state:",_)}}catch(_){console.error("Error restoring workflow state:",_)}if(u("create"),E||R){const _=new URLSearchParams(t);_.delete("gmail_success"),_.delete("gmail_error"),_.delete("email"),o(_)}else if(T){const _=F.find(ee=>ee.id===parseInt(T));_&&(r(_),u("view"))}}},[t,o,F]),l.useEffect(()=>{const i=t.get("code"),j=t.get("state");i&&(async()=>{try{await qa(i,j||void 0);const b=new URLSearchParams(t);b.delete("code"),b.delete("state"),o(b)}catch{const T=new URLSearchParams(t);T.delete("code"),T.delete("state"),o(T)}})()},[t,o]),l.useEffect(()=>{if(!!t.get("view"))return;const j=b=>{const T=localStorage.getItem(b);if(!T)return!1;try{const E=JSON.parse(T);if(!E||!E.tempId)return!1;const R=new URLSearchParams(t);return R.set("view","creator"),E.name&&R.set("workflow",encodeURIComponent(E.name)),R.set("tempId",E.tempId),o(R),!0}catch{return!1}};j("current_workflow_state")||j("webhook_creator_state")},[]);const J=async(i=!1)=>{try{i&&Y(!0);const j=await K.get("/api/webhooks");j.data.success&&(console.log("Loaded webhooks:",j.data.data),j.data.data.length>0&&console.log("Sample webhook structure:",j.data.data[0]),k(j.data.data))}catch(j){console.error("Error loading webhooks:",j)}finally{i&&Y(!1)}},G=async i=>{var j,b;try{Y(!0),console.log("Attempting to delete webhook with ID:",i);const T=await K.delete(`/api/webhooks/${i}`);if(T.data.success)g.success("Webhook deleted successfully!"),J(!0);else throw new Error(T.data.message||"Failed to delete webhook")}catch(T){console.error("Error deleting webhook:",T),console.error("Full error response:",T.response),g.error(((b=(j=T.response)==null?void 0:j.data)==null?void 0:b.message)||"Failed to delete webhook"),Y(!1)}},W=i=>{console.log("Viewing webhook:",i),r(i),u("view");const j=new URLSearchParams(t);j.set("workflowId",String(i.id)),j.set("view","view"),i.name&&j.set("workflow",encodeURIComponent(i.name)),o(j)},V=()=>{y(""),ae(!0)},p=async()=>{if(!z.trim()){g.error("Please enter a workflow name");return}de(!0);try{console.log("ðŸš€ Creating new workflow with name:",z);const i=`temp_${Date.now()}`;ae(!1),u("create"),o({view:"creator",workflow:encodeURIComponent(z),tempId:i}),localStorage.setItem("current_workflow_state",JSON.stringify({name:z,tempId:i,created:Date.now(),status:"creating"})),g.success(`Workflow "${z}" ready for configuration!`)}catch(i){console.error("Error creating workflow:",i),g.error("Failed to create workflow")}finally{de(!1)}};l.useEffect(()=>{const i=t.get("gmail_success"),j=t.get("gmail_error"),b=t.get("email");if(i==="true"&&b){g.success(`Gmail account connected successfully! (${decodeURIComponent(b)})`);const T=new URLSearchParams(t);T.delete("gmail_success"),T.delete("gmail_error"),T.delete("email"),o(T)}else if(j){const T=decodeURIComponent(j);g.error(`Gmail connection failed: ${T}`);const E=new URLSearchParams(t);E.delete("gmail_success"),E.delete("gmail_error"),E.delete("email"),o(E)}},[t,o]),l.useEffect(()=>{J(!0)},[]);const w=F.filter(i=>{var j,b;return((j=i.name)==null?void 0:j.toLowerCase().includes(P.toLowerCase()))||((b=i.trigger_type)==null?void 0:b.toLowerCase().includes(P.toLowerCase()))}),D=()=>{u("list"),o({}),localStorage.removeItem("current_workflow_state"),localStorage.removeItem("webhook_creator_state"),J(!0)};return v==="create"?e.jsx(qs,{workflowName:z,onBack:D,onSave:()=>{u("list"),J(!0)}}):v==="view"&&Q?e.jsx(qs,{webhook:Q,onBack:D,onSave:()=>{u("list"),J(!0)}}):e.jsxs(La,{children:[e.jsx("div",{"aria-hidden":!0,className:"absolute inset-0 pointer-events-none bg-gradient-to-r from-indigo-500/10 via-purple-500/10 to-pink-500/10"}),e.jsx("div",{className:"relative z-10 min-h-screen",children:e.jsxs("div",{className:"max-w-full mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl",children:e.jsx(He,{className:"h-6 w-6 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Webhook Workflows"})]}),e.jsx("p",{className:"text-gray-400 ml-16",children:"Manage your webhook automations and integrations"})]}),e.jsxs(M,{onClick:V,className:"h-12 px-6 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white rounded-lg font-medium border-0",children:[e.jsx(nt,{className:"h-5 w-5 mr-2"}),"Create Workflow"]})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-md rounded-lg border border-white/10 p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx($,{placeholder:"Search webhook workflows...",value:P,onChange:i=>O(i.target.value),className:"pl-10 h-10 w-80 bg-white/5 border-white/20 text-white placeholder:text-gray-500 rounded-lg focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(M,{variant:"outline",size:"sm",className:"h-10 px-3 bg-transparent border-white/20 text-white hover:bg-white/10",children:[e.jsx(Sa,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs(M,{variant:"outline",size:"sm",className:"h-10 px-3 bg-transparent border-white/20 text-white hover:bg-white/10",children:[e.jsx(Ca,{className:"h-4 w-4 mr-2"}),"Export"]})]})]})}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-md rounded-lg border border-white/10 shadow-sm",children:[U?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Re,{className:"h-8 w-8 animate-spin text-indigo-400"}),e.jsx("span",{className:"ml-3 text-gray-400",children:"Loading webhooks..."})]}):w.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-white/10 rounded-xl mb-4",children:e.jsx(He,{className:"h-8 w-8 text-gray-500"})}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Webhook Workflows"}),e.jsx("p",{className:"text-gray-400 mb-6",children:P?"No workflows match your search criteria.":"Get started by creating your first webhook workflow."})]}):e.jsxs(Ga,{children:[e.jsx(Ba,{children:e.jsxs(Bs,{className:"border-b border-white/10",children:[e.jsx(_e,{className:"h-12 px-6 text-left text-sm font-semibold text-white",children:"Workflow Name"}),e.jsx(_e,{className:"h-12 px-6 text-left text-sm font-semibold text-white",children:"Trigger"}),d&&e.jsx(_e,{className:"h-12 px-6 text-left text-sm font-semibold text-white",children:"User"}),e.jsx(_e,{className:"h-12 px-6 text-left text-sm font-semibold text-white",children:"Status"}),e.jsx(_e,{className:"h-12 px-6 text-left text-sm font-semibold text-white",children:"Created"}),e.jsx(_e,{className:"h-12 px-6 text-right text-sm font-semibold text-white",children:"Actions"})]})}),e.jsx(Qa,{children:w.map(i=>e.jsxs(Bs,{className:"border-b border-white/10 hover:bg-white/5 transition-colors",children:[e.jsx(Ge,{className:"h-16 px-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-indigo-500/20 rounded-lg",children:e.jsx(He,{className:"h-5 w-5 text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-white",children:i.name}),e.jsx("div",{className:"text-sm text-gray-500 mt-1"})]})]})}),e.jsx(Ge,{className:"h-16 px-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fa,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:i.trigger_type||"Unknown trigger"})]})}),d&&e.jsx(Ge,{className:"h-16 px-6",children:e.jsxs("div",{className:"text-sm text-gray-300",children:[i.username||i.email||`User ${i.user_id}`,i.first_name&&i.last_name&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[i.first_name," ",i.last_name]})]})}),e.jsx(Ge,{className:"h-16 px-6",children:e.jsx(ct,{variant:i.is_active?"default":"secondary",className:`px-3 py-1 text-xs font-medium ${i.is_active?"bg-green-500/20 text-green-300 border border-green-500/30":"bg-gray-500/20 text-gray-300 border border-gray-500/30"}`,children:i.is_active?"active":"inactive"})}),e.jsx(Ge,{className:"h-16 px-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(Ea,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:new Date(i.created_at).toLocaleDateString()})]})}),e.jsx(Ge,{className:"h-16 px-6",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(M,{variant:"ghost",size:"sm",onClick:()=>W(i),className:"h-8 px-3 text-indigo-400 hover:text-indigo-300 hover:bg-indigo-500/10 rounded-md",children:[e.jsx(Ms,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsxs(ea,{children:[e.jsx(ta,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-gray-400 hover:text-white hover:bg-white/10 rounded-md",children:e.jsx(ze,{className:"h-4 w-4"})})}),e.jsxs(sa,{align:"end",className:"w-48 bg-[#0e1340] border border-white/10 text-white",children:[e.jsxs(it,{onClick:()=>W(i),className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-white/10 focus:bg-white/10",children:[e.jsx(Ms,{className:"h-4 w-4"}),"View Details"]}),e.jsxs(it,{onClick:()=>{i.url&&(navigator.clipboard.writeText(i.url),g.success("Webhook URL copied to clipboard!"))},className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-white/10 focus:bg-white/10",children:[e.jsx(Ia,{className:"h-4 w-4"}),"Copy URL"]}),e.jsxs(it,{onClick:()=>G(i.webhook_id||i.id),disabled:U,className:"flex items-center gap-2 px-3 py-2 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 focus:bg-red-500/10",children:[U?e.jsx(Re,{className:"h-4 w-4 animate-spin"}):e.jsx(Zs,{className:"h-4 w-4"}),"Delete"]})]})]})]})})]},i.id))})]}),!U&&w.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-white/10 bg-white/5",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Showing ",w.length," of ",F.length," webhook",F.length!==1?"s":""]}),e.jsx("div",{className:"text-sm text-gray-500",children:P&&`Filtered by: "${P}"`})]})]})]})}),e.jsx(Ra,{open:H,onOpenChange:ae,children:e.jsxs(Da,{className:"sm:max-w-md bg-[#0e1340] border border-white/10 text-white",children:[e.jsx(Wa,{children:e.jsx(Ma,{className:"text-xl font-semibold text-white",children:"Create New Workflow"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Workflow Name"}),e.jsx($,{value:z,onChange:i=>y(i.target.value),placeholder:"Enter workflow name...",className:"w-full h-12 bg-white/5 border-white/20 text-white placeholder:text-gray-500 rounded-lg focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500",onKeyDown:i=>{i.key==="Enter"&&p()}})]})}),e.jsxs(_a,{className:"flex gap-3",children:[e.jsx(M,{variant:"outline",onClick:()=>ae(!1),className:"flex-1 h-12 bg-transparent border-white/20 text-white hover:bg-white/10 rounded-lg",children:"Cancel"}),e.jsxs(M,{onClick:p,disabled:B||!z.trim(),className:"flex-1 h-12 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white border-0 rounded-lg disabled:opacity-50",children:[B?e.jsx(Re,{className:"h-4 w-4 animate-spin mr-2"}):null,"Save"]})]})]})})]})};export{Po as default};
//# sourceMappingURL=Webhooks-C29xU_ZY.js.map
