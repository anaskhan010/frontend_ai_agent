import{j as e,a4 as re,b_ as Q,bu as h,bQ as ne,bc as U,at as le}from"./ui-D0JisYOU.js";import{r as c}from"./vendor-D6QveUxv.js";import{u as ie,b as j,c as ce}from"./query-CXvbhbrr.js";import{u as de,O as me,P as oe,t as x,B as $,L as d,I as xe,S,p as F,q as I,r as P,s as m}from"./index-D9y2aYC5.js";import{R as B,a as G}from"./radio-group-BCidXVlc.js";import{P as ue}from"./Page-CMDChCTT.js";import{e as he}from"./campaignService-TpBEspOP.js";import{h as ge}from"./agentService-BksjFfeh.js";import{g as pe}from"./phoneNumberService-Bcbb38rL.js";import{u as je}from"./router-jXXg-8rg.js";import"./scroll-area-DyZFf7r4.js";import"./index-BZw056XW.js";function Ae(){var M,R,K,O;const A=je(),[N,z]=c.useState(""),[W,H]=c.useState("manual"),[b,J]=c.useState(""),[f,X]=c.useState(""),[u,p]=c.useState([]),[t,Y]=c.useState(""),[Z,D]=c.useState("now"),[q,ee]=c.useState(!1),se=ie(),{user:g}=de(),{data:y,isLoading:E}=j({queryKey:["assistants","vapi",g==null?void 0:g.id],queryFn:()=>ge(),retry:(s,a)=>{var i;return[404,204,402].includes((i=a==null?void 0:a.response)==null?void 0:i.status)?!1:s<1},enabled:!!(g!=null&&g.id)}),{data:v,isLoading:k}=j({queryKey:["phoneNumbers"],queryFn:()=>pe(),retry:1}),{data:w,isLoading:T}=j({queryKey:["contactLists"],queryFn:()=>me(),retry:1}),{data:r,isLoading:C}=j({queryKey:["listContacts",t],queryFn:()=>oe(t),enabled:!!t,retry:1});c.useEffect(()=>{var s,a;if(console.log("Contacts data received:",r),r!=null&&r.success&&((s=r==null?void 0:r.data)!=null&&s.contacts)){const n=r.data.contacts;console.log("Processing contacts array:",n);const i=n.map(l=>({name:`${l.firstName||l.first_name||""} ${l.lastName||l.last_name||""}`.trim()||l.fullName||l.email||"Unknown",number:l.contact_number||l.phoneNumber||l.phone,email:l.email||""}));console.log("Mapped contacts:",i),p(i)}else r&&!r.success?(console.log("API error response:",r),p([])):t&&r&&r.success&&(!((a=r.data)!=null&&a.contacts)||r.data.contacts.length===0)&&(console.log("Empty list detected"),p([]))},[r,t]);const L=ce({mutationFn:he,onSuccess:s=>{se.invalidateQueries({queryKey:["outboundCampaigns"]});const a=(s==null?void 0:s.message)||"Campaign created successfully";x.success(a),A("/outbound")},onError:s=>{var a,n;x.error(((n=(a=s.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to create campaign")}}),ae=s=>{Y(s),p([])},te=()=>{if(!N.trim()){x.error("Campaign name is required");return}if(!b){x.error("Phone number is required");return}if(!f){x.error("Assistant is required");return}if(!t){x.error("Please select a contact list");return}if(u.length===0){x.error("Selected list has no contacts");return}const s=u.filter(n=>{const i=n.number;return!i||!i.startsWith("+")||!/^\+[1-9]\d{1,14}$/.test(i)});if(s.length>0){x.error(`Invalid phone numbers found. Please ensure all numbers are in E.164 format (e.g., +1234567890). Found ${s.length} invalid numbers.`);return}const a={name:N,phoneNumberId:b,assistantId:f,customers:u,autoLaunch:q};console.log("Creating campaign with data:",a),L.mutate(a)},V=(y==null?void 0:y.data)||[],_=(v==null?void 0:v.data)||[],o=(w==null?void 0:w.data)||[];return e.jsx(ue,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs($,{variant:"ghost",size:"sm",onClick:()=>A("/outbound"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[e.jsx(re,{className:"h-4 w-4"}),"Back to Outbound"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Create Campaign"}),e.jsxs("p",{className:"text-muted-foreground",children:["Create a new outbound campaign • Contacts loaded: ",u.length,t&&o.length>0&&e.jsxs("span",{className:"ml-2",children:['from "',((M=o.find(s=>s.id===t))==null?void 0:M.listName)||((R=o.find(s=>s.id===t))==null?void 0:R.list_name),'"']})]})]})]})}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-1/2",children:e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"campaign-name",className:"text-sm font-medium text-gray-700",children:"Campaign Name"}),e.jsx(xe,{id:"campaign-name",placeholder:"Campaign Name",value:N,onChange:s=>z(s.target.value),className:"w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex flex-col space-y-3",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700",children:"Campaign Type"}),e.jsx(B,{value:W,onValueChange:H,className:"flex items-start space-x-8 border-t border-gray-200 pt-4",children:e.jsxs("div",{className:" flex items-start space-x-2",children:[e.jsx(G,{value:"manual",id:"manual",className:"mt-1 text-blue-600"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"manual",className:"font-medium cursor-pointer text-gray-900",children:"Manual"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Start campaign now or schedule for later"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{htmlFor:"phone-number",className:"text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:"From AI CRUITMENT"})]})]}),e.jsxs(S,{value:b,onValueChange:J,children:[e.jsx(F,{className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(I,{placeholder:k?"Loading...":"Select phone number"})}),e.jsx(P,{children:k?e.jsxs(m,{value:"loading",disabled:!0,children:[e.jsx(h,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):_.length===0?e.jsx(m,{value:"no-numbers",disabled:!0,children:"No phone numbers available"}):_.map(s=>e.jsx(m,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.number||s.twilioPhoneNumber}),s.name&&e.jsx("span",{className:"text-xs text-gray-500",children:s.name})]})},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{htmlFor:"contact-list",className:"text-sm font-medium text-gray-700",children:"Contact List"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:"From Lists"})]})]}),e.jsxs(S,{value:t,onValueChange:ae,children:[e.jsx(F,{className:"border-gray-300 ",children:e.jsx(I,{placeholder:T?"Loading...":"Select contact list"})}),e.jsx(P,{children:T?e.jsxs(m,{value:"loading",disabled:!0,children:[e.jsx(h,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):o.length===0?e.jsx(m,{value:"no-lists",disabled:!0,children:"No contact lists available"}):o.map(s=>e.jsx(m,{value:s.id,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-6 w-6 bg-gradient-to-br from-primary/20 to-primary/10 rounded flex items-center justify-center",children:e.jsx(ne,{className:"h-3 w-3 text-primary"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.listName||s.list_name}),e.jsxs("span",{className:"text-xs text-gray-500",children:[e.jsx(U,{className:"h-3 w-3 inline mr-1"}),s.contactCount||s.contacts_count||0," contacts"]})]})]})},s.id))})]}),t&&C&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsx(h,{className:"h-4 w-4 animate-spin text-blue-600"}),e.jsx("span",{className:"text-sm text-blue-800",children:"Loading contacts..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{htmlFor:"assistant",className:"text-sm font-medium text-gray-700",children:"Assistant"}),e.jsx("span",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:"From AI CRUITMENT"})]}),e.jsxs(S,{value:f,onValueChange:X,children:[e.jsx(F,{className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(I,{placeholder:E?"Loading...":"Select assistant"})}),e.jsx(P,{children:E?e.jsxs(m,{value:"loading",disabled:!0,children:[e.jsx(h,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):V.length===0?e.jsx(m,{value:"no-assistants",disabled:!0,children:"No assistants available"}):V.map(s=>{var a,n;return e.jsx(m,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),((a=s.model)==null?void 0:a.model)&&e.jsxs("span",{className:"text-xs text-gray-500",children:[s.model.model," • ",((n=s.voice)==null?void 0:n.voiceId)||"Default Voice"]})]})},s.id)})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{className:"text-sm font-medium text-gray-700",children:"Choose when to send"}),e.jsx(B,{value:Z,onValueChange:D,className:"flex items-center space-x-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"now",id:"send-now",className:"text-blue-600"}),e.jsx(d,{htmlFor:"send-now",className:"cursor-pointer text-gray-900",children:"Send Now"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4 border-t border-gray-200",children:[e.jsx("input",{type:"checkbox",id:"auto-launch",checked:q,onChange:s=>ee(s.target.checked),className:"h-4 w-4 text-teal-600 focus:ring-teal-500 border-gray-300 rounded"}),e.jsx(d,{htmlFor:"auto-launch",className:"text-sm text-gray-700 cursor-pointer",children:"Automatically launch campaign after creation"})]}),e.jsxs($,{onClick:te,disabled:L.isPending,className:"w-full bg-teal-600 hover:bg-teal-700 text-white py-3 text-base font-medium rounded-lg",children:[L.isPending&&e.jsx(h,{className:"h-4 w-4 mr-2 animate-spin"}),"Launch campaign"]})]})})}),e.jsx("div",{className:"w-1/2",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Contact Preview"}),e.jsx("p",{className:"text-sm text-gray-500",children:t?C?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4 animate-spin"}),"Loading contacts..."]}):e.jsxs(e.Fragment,{children:[u.length," contacts from selected list",t&&o.length>0&&e.jsxs("span",{className:"ml-1 font-medium",children:['"',((K=o.find(s=>s.id===t))==null?void 0:K.listName)||((O=o.find(s=>s.id===t))==null?void 0:O.list_name),'"']})]}):"Select a list to preview contacts"})]}),e.jsx("div",{className:"p-6",children:t?C?e.jsx("div",{className:"h-96 flex items-center justify-center border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(h,{className:"h-8 w-8 animate-spin text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading contacts..."})]})}):u.length===0?e.jsx("div",{className:"h-96 flex items-center justify-center border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(U,{className:"h-8 w-8 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No contacts found in this list"})]})}):e.jsx("div",{className:"h-96 overflow-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Phone Number"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Email"})]})}),e.jsx("tbody",{children:u.map((s,a)=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.number}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.email})]},a))})]})}):e.jsx("div",{className:"h-96 flex items-center justify-center border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{className:"h-8 w-8 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select List for Preview Contacts"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose a contact list from the form to preview contacts here"})]})})})]})})]})]})})}export{Ae as CreateCampaignPage};
//# sourceMappingURL=CreateCampaignPage-lLlf-xp3.js.map
