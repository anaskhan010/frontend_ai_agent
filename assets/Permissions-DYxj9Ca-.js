import{j as e,ct as b,ay as F,D as z,O as I,aA as K,S as M,H as O,T as V}from"./ui-BZ34e_bG.js";import{r as H}from"./vendor-DG599jyl.js";import{b as Y}from"./query-BwaCLewj.js";import{P as W}from"./Page-RlnDfmDi.js";import{H as X}from"./Header-z9YYy-Xz.js";import{B as P}from"./badge-CiNZHaLO.js";import{S as m}from"./skeleton-BGDIo3Fc.js";import{C,b as A,c as S,a as T,d as E}from"./card-BYrCuzD5.js";import{T as G,a as J,b as R,c as g,d as Z,e as n}from"./table-C6M1Val8.js";import{T as ee,a as se,b as L,c as re}from"./tabs-BYqCgTJp.js";import{u as ae,a as Q,d as U,t as $}from"./index-DWPNxztX.js";import{L as ie}from"./Loading-BYOLa5uC.js";import{A as q,a as _}from"./alert-D9nrEz5p.js";import{a as te,N as p}from"./router-BavLd_S0.js";import{B as D}from"./button-Cm3qqFtR.js";import"./scroll-area-sAMvAiol.js";import"./index-3J7IwK8P.js";import"./index-DwBQLlhe.js";import"./sheet-Di2b-amD.js";const ne=({children:l,permission:x,permissions:a,requireAll:N=!1,role:r,roles:c,requireSuperAdmin:u=!1,redirectTo:j="/login",showError:d=!0})=>{const{isLoggedIn:y,loading:o}=ae(),{hasPermission:w,hasAnyPermission:s,hasAllPermissions:h,role:t,isSuperAdmin:f,loading:v}=Q(),i=te();return o||v?e.jsx(ie,{}):y?u&&!f?d?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(q,{variant:"destructive",className:"max-w-md",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(_,{children:"Super admin privileges required to access this page."})]})}):e.jsx(p,{to:"/dashboard",replace:!0}):r&&(!t||t.name!==r)?d?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(q,{variant:"destructive",className:"max-w-md",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(_,{children:`${r} role required to access this page.`})]})}):e.jsx(p,{to:"/dashboard",replace:!0}):c&&c.length>0&&(!t||!c.includes(t.name))?d?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(q,{variant:"destructive",className:"max-w-md",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(_,{children:`One of the following roles required: ${c.join(", ")}`})]})}):e.jsx(p,{to:"/dashboard",replace:!0}):x&&!w(x)?d?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(q,{variant:"destructive",className:"max-w-md",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(_,{children:"You don't have permission to access this page."})]})}):e.jsx(p,{to:"/dashboard",replace:!0}):a&&a.length>0&&!(N?h(a):s(a))?d?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(q,{variant:"destructive",className:"max-w-md",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(_,{children:"You don't have the required permissions to access this page."})]})}):e.jsx(p,{to:"/dashboard",replace:!0}):e.jsx(e.Fragment,{children:l}):e.jsx(p,{to:j,state:{from:i},replace:!0})},B=({children:l,permission:x,permissions:a,requireAll:N=!1,role:r,roles:c,requireSuperAdmin:u=!1,fallback:j,hideWhenNoAccess:d=!1,disabled:y,...o})=>{const{hasPermission:w,hasAnyPermission:s,hasAllPermissions:h,role:t,isSuperAdmin:f,loading:v}=Q();if(v)return e.jsx(D,{disabled:!0,...o,children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-300"})});let i=!0;return u&&!f&&(i=!1),i&&r&&(!t||t.name!==r)&&(i=!1),i&&c&&c.length>0&&(!t||!c.includes(t.name))&&(i=!1),i&&x&&!w(x)&&(i=!1),i&&a&&a.length>0&&((N?h(a):s(a))||(i=!1)),!i&&d?null:!i&&j?e.jsx(e.Fragment,{children:j}):e.jsx(D,{disabled:y||!i,...o,children:l})},le=async()=>(await U.get("/api/permissions")).data.data,Se=()=>{const[l,x]=H.useState(""),[a,N]=H.useState("all"),{data:r,isLoading:c,error:u,refetch:j}=Y({queryKey:["permissions"],queryFn:le}),d=s=>{x(s)},y=async(s,h)=>{var t,f;if(window.confirm(`Are you sure you want to delete the permission "${h}"?`))try{await U.delete(`/api/permissions/${s}`),$.success("Permission deleted successfully"),j()}catch(v){$.error(((f=(t=v.response)==null?void 0:t.data)==null?void 0:f.message)||"Failed to delete permission")}};if(u)return console.error("Error fetching permissions",u),e.jsx("div",{children:"Error loading permissions"});let o=(r==null?void 0:r.filter(s=>s.name.toLowerCase().includes(l.toLowerCase())||s.display_name.toLowerCase().includes(l.toLowerCase())||s.description.toLowerCase().includes(l.toLowerCase())||s.category.toLowerCase().includes(l.toLowerCase())))||[];a!=="all"&&(o=o.filter(s=>s.category.toLowerCase()===a.toLowerCase()));const w=[...new Set((r==null?void 0:r.map(s=>s.category))||[])];return e.jsx(ne,{requireSuperAdmin:!0,children:e.jsxs(W,{children:[e.jsx(X,{title:"Permission Management",buttonText:"Create Permission",filterByName:!0,filterWord:l,onFilterChange:d,useSheet:!1,showViewToggle:!1,showFilters:!1}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(P,{variant:"secondary",className:"px-3 py-1",children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),e.jsxs("span",{children:[o.length," Permissions"]})]})}),e.jsxs(B,{requireSuperAdmin:!0,className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Create Permission"]})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(C,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"Total Permissions"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All permissions"})]})]}),e.jsxs(C,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"System Permissions"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.filter(s=>s.is_system_permission).length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Built-in permissions"})]})]}),e.jsxs(C,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"Custom Permissions"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.filter(s=>!s.is_system_permission).length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"User-created permissions"})]})]}),e.jsxs(C,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(S,{className:"text-sm font-medium",children:"Categories"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Permission categories"})]})]})]}),e.jsxs(C,{children:[e.jsxs(A,{children:[e.jsx(S,{children:"Permissions"}),e.jsx(E,{children:"Manage system permissions and their assignments"})]}),e.jsx(T,{children:e.jsxs(ee,{value:a,onValueChange:N,children:[e.jsxs(se,{className:"grid w-full grid-cols-5",children:[e.jsx(L,{value:"all",children:"All"}),e.jsx(L,{value:"pages",children:"Pages"}),e.jsx(L,{value:"users",children:"Users"}),e.jsx(L,{value:"roles",children:"Roles"}),e.jsx(L,{value:"system",children:"System"})]}),e.jsx(re,{value:a,className:"mt-4",children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs(R,{children:[e.jsx(g,{children:"Permission"}),e.jsx(g,{children:"Resource"}),e.jsx(g,{children:"Action"}),e.jsx(g,{children:"Category"}),e.jsx(g,{children:"Type"}),e.jsx(g,{children:"Actions"})]})}),e.jsx(Z,{children:c?Array.from({length:8}).map((s,h)=>e.jsxs(R,{children:[e.jsx(n,{children:e.jsxs("div",{children:[e.jsx(m,{className:"h-4 w-32 mb-1"}),e.jsx(m,{className:"h-3 w-24"})]})}),e.jsx(n,{children:e.jsx(m,{className:"h-6 w-16"})}),e.jsx(n,{children:e.jsx(m,{className:"h-6 w-16"})}),e.jsx(n,{children:e.jsx(m,{className:"h-4 w-20"})}),e.jsx(n,{children:e.jsx(m,{className:"h-6 w-20"})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-8 w-8"}),e.jsx(m,{className:"h-8 w-8"})]})})]},`permission-skeleton-${h}`)):o.map(s=>e.jsxs(R,{children:[e.jsx(n,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.display_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.name})]})}),e.jsx(n,{children:e.jsx(P,{variant:"outline",children:s.resource})}),e.jsx(n,{children:e.jsx(P,{variant:"secondary",children:s.action})}),e.jsx(n,{children:e.jsx(P,{variant:"default",children:s.category})}),e.jsx(n,{children:e.jsx(P,{variant:s.is_system_permission?"secondary":"default",children:s.is_system_permission?"System":"Custom"})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{requireSuperAdmin:!0,size:"sm",variant:"outline",children:e.jsx(O,{className:"h-3 w-3"})}),!s.is_system_permission&&e.jsx(B,{requireSuperAdmin:!0,size:"sm",variant:"outline",onClick:()=>y(s.id,s.display_name),children:e.jsx(V,{className:"h-3 w-3"})})]})})]},s.id))})]})})]})})]})]})]})})};export{Se as default};
//# sourceMappingURL=Permissions-DYxj9Ca-.js.map
