import{j as e,S as F,a5 as H,ba as _,bx as A,b$ as O}from"./ui-Bcnk-Zux.js";import{r}from"./vendor-D6QveUxv.js";import{u as z,b as y,c as D}from"./query-CO-DO_55.js";import{P as V}from"./Page-nWNwBMZO.js";import{H as W}from"./Header-xb2_Hucx.js";import{j as n,t as m,C as f,l as L,n as q,o as T,k as w,v as N,B as v,L as h,y as G,z as J,A as X,E as Y,F as Z,I as E,T as ee}from"./index-CBGUjL3x.js";import{C as se}from"./checkbox-DuOqqt8X.js";import{P as ae}from"./PermissionRoute-DBBfh75O.js";import"./scroll-area-D4vCxucE.js";import"./index-Dd6xZiaQ.js";import"./sheet-BA7FcpU-.js";import"./router-jXXg-8rg.js";import"./usePermissions-C0uDjlTS.js";const te=async()=>(await n.get("/api/roles")).data,ie=async()=>{const a=await n.get("/api/permissions");return a.data.data||a.data},re=async a=>{const l=await n.get(`/api/role-permissions/role/${a}`);return l.data.data||l.data},Ne=()=>{const[a,l]=r.useState(null),[C,P]=r.useState([]),[x,S]=r.useState(!1),[p,K]=r.useState(""),[M,d]=r.useState(!1),[o,c]=r.useState({name:"",display_name:"",description:""}),R=z(),{data:g,isLoading:oe}=y({queryKey:["roles"],queryFn:te}),{data:u,isLoading:ne}=y({queryKey:["permissions"],queryFn:ie}),{data:j,isLoading:le}=y({queryKey:["rolePermissions",a==null?void 0:a.id],queryFn:()=>re(a.id),enabled:!!a});r.useEffect(()=>{j&&P(j.map(s=>s.permission_id))},[j]);const Q=D({mutationFn:async({roleId:s,permissionIds:t})=>{await n.post(`/api/role-permissions/role/${s}/bulk`,{permission_ids:t})},onSuccess:()=>{m.success("Role permissions updated successfully"),R.invalidateQueries({queryKey:["rolePermissions"]})},onError:s=>{var t,i;m.error(((i=(t=s.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to update permissions")}}),b=D({mutationFn:async s=>(await n.post("/api/roles",s)).data,onSuccess:()=>{m.success("Role created successfully"),R.invalidateQueries({queryKey:["roles"]}),d(!1),c({name:"",display_name:"",description:""})},onError:s=>{var t,i;m.error(((i=(t=s.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to create role")}}),$=s=>{l(s)},B=s=>{P(t=>t.includes(s)?t.filter(i=>i!==s):[...t,s])},I=async()=>{if(a){S(!0);try{await Q.mutateAsync({roleId:a.id,permissionIds:C})}finally{S(!1)}}},U=()=>{b.mutate(o)},k=(g==null?void 0:g.filter(s=>s.display_name.toLowerCase().includes(p.toLowerCase())||s.name.toLowerCase().includes(p.toLowerCase())))||[];return e.jsx(ae,{requireSuperAdmin:!0,children:e.jsxs(V,{children:[e.jsx("div",{"aria-hidden":!0,className:"absolute inset-0 pointer-events-none bg-gradient-to-r from-indigo-500/10 via-purple-500/10 to-pink-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(W,{title:"Roles & Permissions Management",buttonText:"Create Role",action:()=>d(!0),filterByName:!0,filterWord:p,onFilterChange:K,useSheet:!1,showViewToggle:!1,showFilters:!1}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-200px)]",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(f,{className:"h-full bg-white/5 backdrop-blur-md border border-white/10",children:[e.jsxs(L,{children:[e.jsxs(q,{className:"flex items-center gap-2 text-white",children:[e.jsx(F,{className:"h-5 w-5 text-indigo-400"}),"Roles (",k.length,")"]}),e.jsx(T,{className:"text-gray-400",children:"Select a role to manage its permissions"})]}),e.jsx(w,{className:"p-0",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-y-auto",children:k.map(s=>e.jsx("div",{onClick:()=>$(s),className:`p-4 border-b border-white/10 cursor-pointer hover:bg-white/10 transition-colors ${(a==null?void 0:a.id)===s.id?"bg-indigo-500/20 border-l-4 border-l-indigo-500":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white",children:s.display_name}),e.jsx("p",{className:"text-sm text-gray-400",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(N,{variant:"outline",className:"text-xs bg-white/5 border-white/20 text-gray-300",children:["#",s.id]}),s.is_system_role&&e.jsx(N,{variant:"secondary",className:"text-xs bg-purple-500/20 text-purple-300 border border-purple-500/30",children:"System"})]})]}),(a==null?void 0:a.id)===s.id&&e.jsx(H,{className:"h-5 w-5 text-indigo-400"})]})},s.id))})})]})}),e.jsx("div",{className:"lg:col-span-2",children:a?e.jsxs(f,{className:"h-full bg-white/5 backdrop-blur-md border border-white/10",children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(q,{className:"flex items-center gap-2 text-white",children:[e.jsx(_,{className:"h-5 w-5 text-indigo-400"}),"Permissions for ",a.display_name]}),e.jsx(T,{className:"text-gray-400",children:"Manage permissions for this role"})]}),e.jsxs(v,{onClick:I,disabled:x,className:"flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white border-0",children:[x?e.jsx(A,{className:"h-4 w-4 animate-spin"}):e.jsx(O,{className:"h-4 w-4"}),x?"Updating...":"Update Permissions"]})]})}),e.jsx(w,{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-3 flex items-center gap-2 text-white",children:[e.jsx(_,{className:"h-4 w-4 text-indigo-400"}),"System Permissions"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-60 overflow-y-auto",children:u==null?void 0:u.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 border border-white/10 rounded bg-white/5",children:[e.jsx(se,{id:`permission-${s.id}`,checked:C.includes(s.id),onCheckedChange:()=>B(s.id),className:"border-white/30 data-[state=checked]:bg-indigo-600 data-[state=checked]:border-indigo-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(h,{htmlFor:`permission-${s.id}`,className:"text-sm font-medium cursor-pointer text-white",children:s.display_name}),e.jsx("p",{className:"text-xs text-gray-400",children:s.description}),e.jsx(N,{variant:"outline",className:"text-xs mt-1 bg-white/5 border-white/20 text-gray-300",children:s.category})]})]},s.id))})]})})]}):e.jsx(f,{className:"h-full flex items-center justify-center bg-white/5 backdrop-blur-md border border-white/10",children:e.jsxs(w,{className:"text-center",children:[e.jsx(F,{className:"h-12 w-12 text-gray-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Select a Role"}),e.jsx("p",{className:"text-gray-400",children:"Choose a role from the left panel to manage its permissions."})]})})})]}),e.jsx(G,{open:M,onOpenChange:d,children:e.jsxs(J,{className:"bg-[#0e1340] border border-white/10 text-white",children:[e.jsxs(X,{children:[e.jsx(Y,{className:"text-white",children:"Create New Role"}),e.jsx(Z,{className:"text-gray-400",children:"Create a new role with custom permissions and access levels."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"role-name",className:"text-gray-300",children:"Role Name"}),e.jsx(E,{id:"role-name",placeholder:"e.g., manager",value:o.name,onChange:s=>c(t=>({...t,name:s.target.value})),className:"bg-white/5 border-white/20 text-white placeholder:text-gray-500 focus:border-indigo-500"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"role-display-name",className:"text-gray-300",children:"Display Name"}),e.jsx(E,{id:"role-display-name",placeholder:"e.g., Manager",value:o.display_name,onChange:s=>c(t=>({...t,display_name:s.target.value})),className:"bg-white/5 border-white/20 text-white placeholder:text-gray-500 focus:border-indigo-500"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"role-description",className:"text-gray-300",children:"Description"}),e.jsx(ee,{id:"role-description",placeholder:"Describe the role's responsibilities...",value:o.description,onChange:s=>c(t=>({...t,description:s.target.value})),className:"bg-white/5 border-white/20 text-white placeholder:text-gray-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"outline",onClick:()=>d(!1),className:"bg-transparent border-white/20 text-white hover:bg-white/10",children:"Cancel"}),e.jsx(v,{onClick:U,disabled:!o.name||!o.display_name||b.isPending,className:"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white border-0",children:b.isPending?"Creating...":"Create Role"})]})]})]})})]})]})})};export{Ne as default};
//# sourceMappingURL=Roles-Dp6srmsD.js.map
