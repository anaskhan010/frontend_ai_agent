import{j as e,m as me,c1 as z,aS as p,bT as xe,aI as W,I as he}from"./ui-B8VyAbFl.js";import{r as c}from"./vendor-DG599jyl.js";import{u as ue,a as g,c as pe}from"./query-CWB_8EHL.js";import{u as ge,K as je,M as Ne,t as h,B as H,L as o,I as fe,g as I,h as P,i as q,j as k,k as m}from"./index-BQqu6sK2.js";import{R as J,a as X}from"./radio-group-CUOg2T2A.js";import{e as be}from"./campaignService-BQC_55Ov.js";import{k as ve,c as we}from"./agentService-CYr8QiHt.js";import{g as ye}from"./phoneNumberService-BebE_AwU.js";import{u as Ce}from"./router-BnJytTjr.js";function _e(){var B,O,Q,G;const E=Ce(),[b,Y]=c.useState(""),[Z,D]=c.useState("manual"),[v,_]=c.useState(""),[j,ee]=c.useState(""),[u,N]=c.useState([]),[a,se]=c.useState(""),[T,te]=c.useState("now"),[R,ae]=c.useState(!1),[f,ne]=c.useState("vapi"),ie=ue(),{user:l}=ge(),{data:w,isLoading:le}=g({queryKey:["assistants","vapi",l==null?void 0:l.id],queryFn:()=>ve(),retry:(s,t)=>{var d;return[404,204,402].includes((d=t==null?void 0:t.response)==null?void 0:d.status)?!1:s<1},enabled:!!(l!=null&&l.id)}),{data:y,isLoading:re}=g({queryKey:["retellAgents",l==null?void 0:l.id],queryFn:()=>we(),enabled:!!(l!=null&&l.id)}),{data:C,isLoading:V}=g({queryKey:["phoneNumbers"],queryFn:()=>ye(),retry:1}),{data:L,isLoading:K}=g({queryKey:["contactLists"],queryFn:()=>je(),retry:1}),{data:n,isLoading:S}=g({queryKey:["listContacts",a],queryFn:()=>Ne(a),enabled:!!a,retry:1});c.useEffect(()=>{var s,t;if(console.log("Contacts data received:",n),n!=null&&n.success&&((s=n==null?void 0:n.data)!=null&&s.contacts)){const i=n.data.contacts;console.log("Processing contacts array:",i);const d=i.map(r=>({name:`${r.firstName||r.first_name||""} ${r.lastName||r.last_name||""}`.trim()||r.fullName||r.email||"Unknown",number:r.contact_number||r.phoneNumber||r.phone,email:r.email||""}));console.log("Mapped contacts:",d),N(d)}else n&&!n.success?(console.log("API error response:",n),N([])):a&&n&&n.success&&(!((t=n.data)!=null&&t.contacts)||n.data.contacts.length===0)&&(console.log("Empty list detected"),N([]))},[n,a]);const A=pe({mutationFn:be,onSuccess:s=>{ie.invalidateQueries({queryKey:["outboundCampaigns"]});const t=(s==null?void 0:s.message)||"Campaign created successfully";h.success(t),E("/outbound")},onError:s=>{var t,i;h.error(((i=(t=s.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to create campaign")}}),ce=s=>{se(s),N([])},de=()=>{if(!b.trim()){h.error("Campaign name is required");return}if(!v){h.error("Phone number is required");return}if(!j){h.error("Assistant is required");return}if(!a){h.error("Please select a contact list");return}if(u.length===0){h.error("Selected list has no contacts");return}const s=u.filter(i=>{const d=i.number;return!d||!d.startsWith("+")||!/^\+[1-9]\d{1,14}$/.test(d)});if(s.length>0){h.error(`Invalid phone numbers found. Please ensure all numbers are in E.164 format (e.g., +1234567890). Found ${s.length} invalid numbers.`);return}const t={name:b,phoneNumberId:v,assistantId:j,customers:u,autoLaunch:R,provider:f,sendOption:T};console.log("Creating campaign with data:",t),A.mutate(t)},oe=(w==null?void 0:w.data)||[],M=(y==null?void 0:y.data)||[],F=[...oe.map(s=>({...s,provider:"vapi"})),...Array.isArray(M)?M.map(s=>({id:s.agent_id,name:s.agent_name||"Unnamed Retell Agent",provider:"retell",model:{model:s.llm_id}})):[]],U=le||re,$=((C==null?void 0:C.data)||[]).filter(s=>{if(!j)return!0;const t=(s.provider||"vapi").toLowerCase();return f==="vapi"?["vapi","twilio","vonage","telnyx","byo-phone-number"].includes(t):f==="retell"?t==="retell"||t==="twilio":t===f}),x=(L==null?void 0:L.data)||[];return e.jsx("div",{className:"app-shell-bg min-h-screen w-full overflow-auto",children:e.jsxs("div",{className:"p-6 max-w-[1600px] mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(H,{variant:"ghost",size:"sm",onClick:()=>E("/outbound"),className:"flex items-center gap-2 text-white/65 hover:text-white neo-topbar-btn",children:[e.jsx(me,{className:"h-4 w-4"}),"Back to Outbound"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-white",children:"Create Campaign"}),e.jsxs("p",{className:"text-white/65",children:["Create a new outbound campaign • Contacts loaded: ",u.length,a&&x.length>0&&e.jsxs("span",{className:"ml-2",children:['from "',((B=x.find(s=>s.id===a))==null?void 0:B.listName)||((O=x.find(s=>s.id===a))==null?void 0:O.list_name),'"']})]})]})]})}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-1/2",children:e.jsx("div",{className:"neo-card p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"campaign-name",className:"text-sm font-medium text-white/65",children:"Campaign Name"}),e.jsx(fe,{id:"campaign-name",placeholder:"Campaign Name",value:b,onChange:s=>Y(s.target.value),className:"w-full bg-white/10 border-white/20 text-white placeholder:text-white/40"})]}),e.jsxs("div",{className:"flex flex flex-col space-y-3",children:[e.jsx(o,{className:"text-sm font-medium text-white/65",children:"Campaign Type"}),e.jsx(J,{value:Z,onValueChange:D,className:"flex items-start space-x-8 border-t border-white/10 pt-4",children:e.jsxs("div",{className:" flex items-start space-x-2",children:[e.jsx(X,{value:"manual",id:"manual",className:"mt-1 text-cyan-400"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{htmlFor:"manual",className:"font-medium cursor-pointer text-white",children:"Manual"}),e.jsx("p",{className:"text-sm text-white/65",children:"Start campaign now or schedule for later"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{htmlFor:"phone-number",className:"text-sm font-medium text-white/65",children:"Phone Number"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"h-4 w-4 text-white/40"}),e.jsx("span",{className:"text-xs text-cyan-400 bg-cyan-500/10 px-2 py-1 rounded",children:"From AI CRUITMENT"})]})]}),e.jsxs(I,{value:v,onValueChange:_,children:[e.jsx(P,{className:"border-gray-300 text-white focus:border-blue-500 focus:ring-blue-500",children:e.jsx(q,{placeholder:V?"Loading...":"Select phone number"})}),e.jsx(k,{children:V?e.jsxs(m,{value:"loading",disabled:!0,children:[e.jsx(p,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):$.length===0?e.jsx(m,{value:"no-numbers",disabled:!0,children:"No phone numbers available"}):$.map(s=>e.jsx(m,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.number||s.twilioPhoneNumber}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${(s.provider||"vapi").toLowerCase()==="retell"?"bg-purple-500/20 text-purple-400 border border-purple-500/30":"bg-blue-500/20 text-blue-400 border border-blue-500/30"}`,children:(s.provider||"VAPI").toUpperCase()})]}),s.name&&e.jsx("span",{className:"text-xs text-gray-500",children:s.name})]})},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{htmlFor:"contact-list",className:"text-sm font-medium text-white/65",children:"Contact List"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"h-4 w-4 text-white/40"}),e.jsx("span",{className:"text-xs text-cyan-400 bg-cyan-500/10 px-2 py-1 rounded",children:"From Lists"})]})]}),e.jsxs(I,{value:a,onValueChange:ce,children:[e.jsx(P,{className:"border-gray-300 text-white  ",children:e.jsx(q,{placeholder:K?"Loading...":"Select contact list"})}),e.jsx(k,{children:K?e.jsxs(m,{value:"loading",disabled:!0,children:[e.jsx(p,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):x.length===0?e.jsx(m,{value:"no-lists",disabled:!0,children:"No contact lists available"}):x.map(s=>e.jsx(m,{value:s.id,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-6 w-6 bg-gradient-to-br from-primary/20 to-primary/10 rounded flex items-center justify-center",children:e.jsx(xe,{className:"h-3 w-3 text-primary"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.listName||s.list_name}),e.jsxs("span",{className:"text-xs text-white/65",children:[e.jsx(W,{className:"h-3 w-3 inline stroke-8  mr-1"}),s.contactCount||s.contacts_count||0," contacts"]})]})]})},s.id))})]}),a&&S&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-cyan-500/10 border border-cyan-500/20 rounded-md",children:[e.jsx(p,{className:"h-4 w-4 animate-spin text-cyan-400"}),e.jsx("span",{className:"text-sm text-white",children:"Loading contacts..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{htmlFor:"assistant",className:"text-sm font-medium text-white/65",children:"Assistant"}),e.jsx("span",{className:"text-xs text-cyan-400 bg-cyan-500/10 px-2 py-1 rounded",children:"From AI CRUITMENT"})]}),e.jsxs(I,{value:j,onValueChange:s=>{ee(s);const t=F.find(i=>i.id===s);t&&(ne(t.provider),_(""))},children:[e.jsx(P,{className:"border-gray-300 text-white  focus:border-blue-500 focus:ring-blue-500",children:e.jsx(q,{placeholder:U?"Loading...":"Select assistant"})}),e.jsx(k,{children:U?e.jsxs(m,{value:"loading",disabled:!0,children:[e.jsx(p,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):F.length===0?e.jsx(m,{value:"no-assistants",disabled:!0,children:"No assistants available"}):F.map(s=>{var t,i;return e.jsx(m,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${s.provider==="retell"?"bg-purple-500/20 text-purple-400 border border-purple-500/30":"bg-blue-500/20 text-blue-400 border border-blue-500/30"}`,children:s.provider.toUpperCase()})]}),((t=s.model)==null?void 0:t.model)&&e.jsxs("span",{className:"text-xs text-gray-500",children:[s.model.model," ",(i=s.voice)!=null&&i.voiceId?`• ${s.voice.voiceId}`:""]})]})},s.id)})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{className:"text-sm font-medium text-white/65",children:"Choose when to send"}),e.jsx(J,{value:T,onValueChange:te,className:"flex items-center space-x-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{value:"now",id:"send-now",className:"text-cyan-400"}),e.jsx(o,{htmlFor:"send-now",className:"cursor-pointer text-white",children:"Send Now"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4 border-t border-white/10",children:[e.jsx("input",{type:"checkbox",id:"auto-launch",checked:R,onChange:s=>ae(s.target.checked),className:"h-4 w-4 text-cyan-400 focus:ring-cyan-500 border-white/20 rounded bg-white/10"}),e.jsx(o,{htmlFor:"auto-launch",className:"text-sm text-white/65 cursor-pointer",children:"Automatically launch campaign after creation"})]}),e.jsxs(H,{onClick:de,disabled:A.isPending,className:"w-full neo-btn py-3 text-base font-medium rounded-lg",children:[A.isPending&&e.jsx(p,{className:"h-4 w-4 mr-2 animate-spin"}),"Launch campaign"]})]})})}),e.jsx("div",{className:"w-1/2",children:e.jsxs("div",{className:"neo-card",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Contact Preview"}),e.jsx("p",{className:"text-sm text-white/65",children:a?S?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4 animate-spin"}),"Loading contacts..."]}):e.jsxs(e.Fragment,{children:[u.length," contacts from selected list",a&&x.length>0&&e.jsxs("span",{className:"ml-1 font-medium",children:['"',((Q=x.find(s=>s.id===a))==null?void 0:Q.listName)||((G=x.find(s=>s.id===a))==null?void 0:G.list_name),'"']})]}):"Select a list to preview contacts"})]}),e.jsx("div",{className:"p-6",children:a?S?e.jsx("div",{className:"h-96 flex items-center justify-center border border-white/10 rounded-lg bg-white/5",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{className:"h-8 w-8 animate-spin text-white/40 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-white/65",children:"Loading contacts..."})]})}):u.length===0?e.jsx("div",{className:"h-96 flex items-center justify-center border border-white/10 rounded-lg bg-white/5",children:e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"h-8 w-8 text-white/40 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-white/65",children:"No contacts found in this list"})]})}):e.jsx("div",{className:"h-96 overflow-auto border border-white/10 rounded-lg neon-fire-scroll",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white/5 border-b border-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-white/65",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-white/65",children:"Phone Number"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-white/65",children:"Email"})]})}),e.jsx("tbody",{children:u.map((s,t)=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[e.jsx("td",{className:"px-4 py-3 text-white",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-white/65",children:s.number}),e.jsx("td",{className:"px-4 py-3 text-white/65",children:s.email})]},t))})]})}):e.jsx("div",{className:"h-96 flex items-center justify-center border border-white/10 rounded-lg bg-white/5",children:e.jsxs("div",{className:"text-center",children:[e.jsx(he,{className:"h-8 w-8 text-white/40 mx-auto mb-3"}),e.jsx("p",{className:"text-lg font-medium text-white mb-2",children:"Select List for Preview Contacts"}),e.jsx("p",{className:"text-sm text-white/65",children:"Choose a contact list from the form to preview contacts here"})]})})})]})})]})]})})}export{_e as CreateCampaignPage};
//# sourceMappingURL=CreateCampaignPage-Ca6y0PTH.js.map
