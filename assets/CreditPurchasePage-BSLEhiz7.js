import{j as e,aS as w,m as F,am as P,b3 as $,bj as C}from"./ui-h9OBLyTx.js";import{r as l}from"./vendor-DG599jyl.js";import{a as S,t as n,B as E,C as u,b as g,p as v,aa as T,ab as A,ac as I,ad as N,ae as L}from"./index-CzOkn7Aq.js";import{u as B}from"./router-BnJytTjr.js";import"./query-B7U7fZu0.js";const k=L("pk_test_51S8GFm2MMm3Fy1PB45KAluHAtFTOmAY9qKUE4sITR1TA1zfX97ON36OAcAALplq6LbLgqXaTyY0hRB7ae55LzpBQ00DfkbC8oy"),q=({selectedPackage:i,onSuccess:x})=>{const o=A(),t=I(),[p,c]=l.useState(!1),[h,f]=l.useState(""),[d,y]=l.useState(!1);l.useEffect(()=>{i&&s()},[i]);const s=async()=>{try{const m=await S.post("/api/credits/purchase",{packageId:i.package_id});f(m.data.data.client_secret),y(m.data.data.isFreeTrial||!1)}catch(m){console.error("Error creating payment intent:",m),n.error("Failed to initialize payment")}},r=async m=>{if(m.preventDefault(),!(!o||!t||!h)){c(!0);try{let a;if(d){const _=t.getElement(N);console.log("ðŸ”„ Creating payment method with card element");const{error:j,paymentMethod:b}=await o.createPaymentMethod({type:"card",card:_});if(j){console.error("âŒ Payment method creation failed:",j),n.error(j.message||"Card validation failed"),c(!1);return}console.log("âœ… Payment method created successfully:",b.id),console.log("ðŸ”„ Confirming setup intent with payment method:",b.id),a=await o.confirmSetup({clientSecret:h,confirmParams:{payment_method:b.id},redirect:"if_required"}),console.log("âœ… Setup intent confirmation result:",a),a.error?(console.error("Setup failed:",a.error),n.error(a.error.message||"Card verification failed"),c(!1)):a.setupIntent.status==="succeeded"&&(n.success("ðŸŽ‰ Free trial activated! $10 worth of credits added to your account."),window.dispatchEvent(new CustomEvent("creditBalanceUpdate")),setTimeout(()=>{x(a.setupIntent)},2e3))}else a=await o.confirmCardPayment(h,{payment_method:{card:t.getElement(N)}}),a.error?(console.error("Payment failed:",a.error),n.error(a.error.message||"Payment failed"),c(!1)):a.paymentIntent.status==="succeeded"&&(n.success("ðŸŽ‰ Payment successful! Credits added to your account."),window.dispatchEvent(new CustomEvent("creditBalanceUpdate")),setTimeout(()=>{x(a.paymentIntent)},2e3))}catch(a){console.error("Error processing payment:",a),n.error("An error occurred while processing your request"),c(!1)}}};return e.jsxs("form",{onSubmit:r,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Card Information"}),e.jsxs("div",{className:"relative p-4 border-2 border-gray-200 rounded-lg focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-200 transition-all",children:[e.jsxs("div",{className:"absolute right-3 top-3 flex space-x-1",children:[e.jsx("img",{src:"https://js.stripe.com/v3/fingerprinted/img/visa-729c05c240c4bdb47b03ac81d9945bfe.svg",alt:"Visa",className:"h-6 w-auto opacity-60"}),e.jsx("img",{src:"https://js.stripe.com/v3/fingerprinted/img/mastercard-4d8844094130711885b5e41b28c9848f.svg",alt:"Mastercard",className:"h-6 w-auto opacity-60"})]}),e.jsx(N,{options:{style:{base:{fontSize:"16px",color:"#374151",fontFamily:'"Inter", system-ui, sans-serif',"::placeholder":{color:"#9CA3AF"},iconColor:"#6B7280"},invalid:{color:"#EF4444",iconColor:"#EF4444"}},hidePostalCode:!1,disableLink:!0}})]})]}),e.jsx(E,{type:"submit",disabled:!o||p,className:"w-full h-12 bg-blue-600 hover:bg-blue-700 text-white font-semibold",children:p?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-5 w-5 mr-2 animate-spin"}),d?"Verifying Card...":"Processing Payment..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"h-5 w-5 mr-2"}),d?"Claim Free Trial":`Pay $${i==null?void 0:i.price_dollars}`]})})]})},U=()=>{console.log("ðŸŽ‰ CreditPurchasePage component loaded");const i=B(),[x,o]=l.useState([]),[t,p]=l.useState(null),[c,h]=l.useState(!0);if(c&&x.length===0)return e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"ðŸŽ‰ Credit Purchase Page Loaded!"}),e.jsx("p",{className:"text-gray-600",children:"This page is working correctly."}),e.jsx("button",{onClick:()=>i("/credits"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Back to Credits"})]})});l.useEffect(()=>{f()},[]);const f=async()=>{try{const s=await S.get("/api/credits/packages");o(s.data.data.packages)}catch(s){console.error("Error fetching packages:",s),n.error("Failed to load credit packages")}finally{h(!1)}},d=s=>(s/100).toFixed(2),y=()=>{window.location.href="/credits"};return c?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx(w,{className:"h-8 w-8 animate-spin text-blue-600"})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsxs(E,{variant:"ghost",onClick:()=>i("/credits"),className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),"Back to Credits"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Purchase Credits"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Choose a package and complete your purchase"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Select Package"}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:x.map(s=>{const r=s.package_id==="free_trial";return e.jsx(u,{className:`cursor-pointer transition-all hover:shadow-md border-2 ${(t==null?void 0:t.package_id)===s.package_id?r?"border-green-500 bg-green-50":"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"} ${s.is_popular?"ring-1 ring-blue-400":""} ${r?"ring-2 ring-green-400 bg-gradient-to-r from-green-50 to-emerald-50":""}`,onClick:()=>p(s),children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:`text-lg font-semibold ${r?"text-green-800":"text-gray-900"}`,children:s.name}),r&&e.jsx(v,{className:"bg-green-500 text-white text-xs font-bold",children:"ðŸŽ‰ FREE TRIAL"}),s.is_popular&&!r&&e.jsxs(v,{className:"bg-blue-500 text-white text-xs",children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),"Popular"]})]}),e.jsxs("div",{className:`mb-1 ${r?"text-green-700":"text-gray-600"}`,children:[s.total_credits.toLocaleString()," credits"]}),r?e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Card required for verification â€¢ One-time offer"}):e.jsxs("div",{className:"text-sm text-gray-500",children:["$",(s.price_cents/100/s.total_credits).toFixed(4)," per credit"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-2xl font-bold ${r?"text-green-600":"text-blue-600"}`,children:r?"FREE":`$${d(s.price_cents)}`}),r&&e.jsx("div",{className:"text-sm text-green-600 line-through",children:"$10.00 value"}),(t==null?void 0:t.package_id)===s.package_id&&e.jsx($,{className:`h-5 w-5 mt-1 ml-auto ${r?"text-green-600":"text-blue-600"}`})]})]})})},s.package_id)})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Payment Details"}),t?e.jsxs("div",{className:"space-y-6",children:[e.jsx(u,{className:"bg-gray-50 border-gray-200",children:e.jsxs(g,{className:"p-6",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Order Summary"}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-gray-600",children:t.name}),e.jsxs("span",{className:"font-medium",children:["$",d(t.price_cents)]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-gray-600",children:"Credits"}),e.jsx("span",{className:"font-medium",children:t.total_credits.toLocaleString()})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Total"}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:["$",d(t.price_cents)]})]})})]})}),e.jsx(u,{children:e.jsx(g,{className:"p-6",children:e.jsx(T,{stripe:k,children:e.jsx(q,{selectedPackage:t,onSuccess:y})})})})]}):e.jsx(u,{children:e.jsxs(g,{className:"p-12 text-center",children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"Select a package to continue with payment"})]})})]})]})]})};export{U as default};
//# sourceMappingURL=CreditPurchasePage-BSLEhiz7.js.map
