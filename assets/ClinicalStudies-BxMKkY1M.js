import{j as e,K as R,aS as Q,N as G,M as J,F as C,bS as Ae,aI as w,X as Ee,V as Ie,bz as W,Y as De,bR as Te,aq as ke,C as qe}from"./ui-B8VyAbFl.js";import{r as c}from"./vendor-DG599jyl.js";import{a as Le,t as i,s as Z,A as Ve,B as l,v as ee,w as se,x as te,y as ae,L as n,I as d,T as Me,g as F,h as P,i as A,j as E,k as I,C as m,d as y,e as v,b as x,p as le}from"./index-BJQAqHy1.js";import{u as Ue,a as N,c as $}from"./query-CWB_8EHL.js";import{a as Oe,g as ze,c as Ke,b as Re}from"./clinicalStudyService-BiiSI9gc.js";import{a as Qe}from"./clinicalSiteService-C7pAypIB.js";import{a as $e}from"./clinicalUserService-C4DKw-oy.js";import{g as Be}from"./clinicalRoleService-g8LRQwDt.js";import"./router-BnJytTjr.js";const Ye=async D=>(await Le.post("/api/study-assignments",D)).data,as=()=>{const[D,B]=c.useState(""),[ie,h]=c.useState(!1),[ne,u]=c.useState(!1),[g,T]=c.useState(null),[b,k]=c.useState(""),[Y,q]=c.useState(""),[re,ce]=c.useState(!1),[p,H]=c.useState(null),[t,f]=c.useState({name:"",study_id:"",description:"",protocol_number:"",principal_investigator_id:"",study_type:"interventional",phase:"not_applicable",status:"not_yet_recruiting",target_enrollment:"",start_date:"",end_date:""}),j=Ue(),{data:L,isLoading:de,error:oe}=N({queryKey:["clinicalStudies"],queryFn:Oe,retry:1}),{data:V,isLoading:_}=N({queryKey:["clinicalStudyStats"],queryFn:ze,retry:1}),{data:M}=N({queryKey:["clinicalSites"],queryFn:Qe,retry:1}),{data:U}=N({queryKey:["clinicalUsers"],queryFn:$e,retry:1}),{data:O}=N({queryKey:["clinicalRoles"],queryFn:Be,retry:1}),X=(L==null?void 0:L.data)||[],S=(V==null?void 0:V.data)||{total_studies:0,active_studies:0,recruiting_studies:0,completed_studies:0},me=(M==null?void 0:M.data)||[],xe=(U==null?void 0:U.data)||[];O!=null&&O.data;const he=xe.map(s=>({id:s.id,name:s.username||`${s.first_name} ${s.last_name}`.trim()||s.email,email:s.email})).filter(s=>s.name),ue=[{value:"early_phase_1",label:"Early Phase 1"},{value:"phase_1",label:"Phase 1"},{value:"phase_2",label:"Phase 2"},{value:"phase_3",label:"Phase 3"},{value:"phase_4",label:"Phase 4"},{value:"not_applicable",label:"Not Applicable"}],ge=[{value:"interventional",label:"Interventional"},{value:"observational",label:"Observational"},{value:"expanded_access",label:"Expanded Access"}],z=$({mutationFn:Ke,onSuccess:()=>{i.success("Study created successfully"),j.invalidateQueries({queryKey:["clinicalStudies"]}),j.invalidateQueries({queryKey:["clinicalStudyStats"]}),h(!1),f({name:"",study_id:"",description:"",protocol_number:"",principal_investigator_id:"",study_type:"interventional",phase:"not_applicable",status:"not_yet_recruiting",target_enrollment:"",start_date:"",end_date:""})},onError:s=>{var a,o;i.error(((o=(a=s.response)==null?void 0:a.data)==null?void 0:o.message)||"Failed to create study")}});$({mutationFn:Ye,onSuccess:()=>{j.invalidateQueries(["studyAssignments"]),i.success("User assigned to study successfully!"),u(!1),setSelectedUserForAssignment(""),setSelectedRoleForAssignment(""),T(null)},onError:s=>{i.error("Failed to assign user: "+s.message)}});const K=$({mutationFn:({studyId:s,siteId:a,notes:o})=>Re(s,a,o),onSuccess:()=>{j.invalidateQueries(["clinicalStudies"]),j.invalidateQueries(["clinicalSites"]),i.success("Study assigned to site successfully!"),u(!1),k(""),q(""),T(null)},onError:s=>{i.error("Failed to assign study to site: "+s.message)}}),pe=()=>{if(!t.name||!t.study_id||!t.protocol_number){i.error("Please fill in all required fields");return}const s={...t,principal_investigator_id:t.principal_investigator_id?parseInt(t.principal_investigator_id):null,target_enrollment:t.target_enrollment?parseInt(t.target_enrollment):0};z.mutate(s)},r=(s,a)=>{f(o=>({...o,[s]:a}))},je=()=>{if(!g||!b){i.error("Please select a clinical site");return}K.mutate({studyId:g.id.toString(),siteId:b,notes:Y})},ye=s=>{T(s),k(""),q(""),u(!0)},ve=s=>{var a;H(s),f({name:s.name||"",study_id:s.study_id||"",description:s.description||"",protocol_number:s.protocol_number||"",principal_investigator_id:((a=s.principal_investigator_id)==null?void 0:a.toString())||"",study_type:s.study_type||"interventional",phase:s.phase||"not_applicable",status:s.status||"planning",start_date:s.start_date||"",end_date:s.end_date||"",target_enrollment:s.target_enrollment||""}),h(!0)},Ne=s=>{i.info(`Opening management panel for "${s.name}"`)},be=s=>{i.info(`Viewing participants for "${s.name}"`)},fe=s=>{i.info(`Viewing timeline for "${s.name}"`)},_e=s=>{i.info(`Viewing documents for "${s.name}"`)},Se=()=>{ce(!re)},Ce=s=>({recruiting:"bg-blue-100 text-blue-800",not_yet_recruiting:"bg-yellow-100 text-yellow-800",active:"bg-green-100 text-green-800",suspended:"bg-yellow-100 text-yellow-800",completed:"bg-gray-100 text-gray-800",terminated:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",we=s=>({phase_1:"bg-purple-100 text-purple-800",phase_2:"bg-blue-100 text-blue-800",phase_3:"bg-green-100 text-green-800",phase_4:"bg-orange-100 text-orange-800",post_market:"bg-gray-100 text-gray-800"})[s]||"bg-gray-100 text-gray-800",Fe=s=>({phase_1:"Phase I",phase_2:"Phase II",phase_3:"Phase III",phase_4:"Phase IV",post_market:"Post Market"})[s]||s,Pe=s=>({recruiting:"Recruiting",not_yet_recruiting:"Not Yet Recruiting",active:"Active",suspended:"Suspended",completed:"Completed",terminated:"Terminated"})[s]||s;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Clinical Studies"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage clinical research studies and trials"})]}),e.jsxs(Z,{open:ie,onOpenChange:h,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(l,{children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Create New Study"]})}),e.jsxs(ee,{className:"max-w-2xl max-h-[80vh] overflow-y-auto","aria-describedby":"create-study-description",children:[e.jsxs(se,{children:[e.jsx(te,{children:p?"Edit Clinical Study":"Create New Clinical Study"}),e.jsx(ae,{id:"create-study-description",children:p?"Update the clinical research study information.":"Fill out the form below to create a new clinical research study. All required fields must be completed."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"studyName",children:"Study Name *"}),e.jsx(d,{id:"studyName",placeholder:"Enter study name",value:t.name,onChange:s=>r("name",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"studyCode",children:"Study Code *"}),e.jsx(d,{id:"studyCode",placeholder:"e.g., STUDY2024",value:t.study_id,onChange:s=>r("study_id",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"description",children:"Description"}),e.jsx(Me,{id:"description",placeholder:"Enter study description",rows:3,value:t.description,onChange:s=>r("description",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"pi",children:"Principal Investigator"}),e.jsxs(F,{value:t.principal_investigator_id,onValueChange:s=>r("principal_investigator_id",s),children:[e.jsx(P,{children:e.jsx(A,{placeholder:"Select PI (optional)"})}),e.jsx(E,{children:he.map(s=>e.jsx(I,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"type",children:"Study Type"}),e.jsxs(F,{value:t.study_type,onValueChange:s=>r("study_type",s),children:[e.jsx(P,{children:e.jsx(A,{placeholder:"Select type"})}),e.jsx(E,{children:ge.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"phase",children:"Phase"}),e.jsxs(F,{value:t.phase,onValueChange:s=>r("phase",s),children:[e.jsx(P,{children:e.jsx(A,{placeholder:"Select phase"})}),e.jsx(E,{children:ue.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"targetEnrollment",children:"Target Enrollment"}),e.jsx(d,{id:"targetEnrollment",type:"number",placeholder:"100",value:t.target_enrollment,onChange:s=>r("target_enrollment",s.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"startDate",children:"Start Date"}),e.jsx(d,{id:"startDate",type:"date",value:t.start_date,onChange:s=>r("start_date",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"endDate",children:"Expected End Date"}),e.jsx(d,{id:"endDate",type:"date",value:t.end_date,onChange:s=>r("end_date",s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"protocolNumber",children:"Protocol Number *"}),e.jsx(d,{id:"protocolNumber",placeholder:"Enter protocol number",value:t.protocol_number,onChange:s=>r("protocol_number",s.target.value)})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(l,{variant:"outline",onClick:()=>{h(!1),H(null),f({name:"",study_id:"",description:"",protocol_number:"",principal_investigator_id:"",study_type:"interventional",phase:"not_applicable",status:"planning",start_date:"",end_date:"",target_enrollment:""})},children:"Cancel"}),e.jsx(l,{onClick:pe,disabled:z.isPending,children:z.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2 animate-spin"}),p?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[p?e.jsx(G,{className:"h-4 w-4 mr-2"}):e.jsx(R,{className:"h-4 w-4 mr-2"}),p?"Update Study":"Create Study"]})})]})]})]})]}),e.jsx(Z,{open:ne,onOpenChange:u,children:e.jsxs(ee,{className:"max-w-md","aria-describedby":"assign-site-description",children:[e.jsxs(se,{children:[e.jsx(te,{children:"Assign Study to Site"}),e.jsxs(ae,{id:"assign-site-description",children:["Assign ",g==null?void 0:g.name," to a clinical site for patient recruitment."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"site-select",children:"Select Clinical Site"}),e.jsxs(F,{value:b,onValueChange:k,children:[e.jsx(P,{children:e.jsx(A,{placeholder:"Choose a clinical site"})}),e.jsx(E,{children:me.map(s=>e.jsxs(I,{value:s.id.toString(),children:[s.site_name," (",s.site_code,")"]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"notes",children:"Assignment Notes (Optional)"}),e.jsx("textarea",{id:"notes",className:"w-full p-2 border border-gray-300 rounded-md",rows:"3",placeholder:"Add any notes about this site assignment...",value:Y,onChange:s=>q(s.target.value)})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(l,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(l,{onClick:je,disabled:!b||K.isPending,children:K.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2 animate-spin"}),"Assigning..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Assign to Site"]})})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(m,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Total Studies"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[_?e.jsx("div",{className:"text-2xl font-bold",children:"--"}):e.jsx("div",{className:"text-2xl font-bold",children:S.total_studies}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Across all sites"})]})]}),e.jsxs(m,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Active Studies"}),e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[_?e.jsx("div",{className:"text-2xl font-bold",children:"--"}):e.jsx("div",{className:"text-2xl font-bold",children:S.active_studies}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Currently active"})]})]}),e.jsxs(m,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Recruiting"}),e.jsx(w,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[_?e.jsx("div",{className:"text-2xl font-bold",children:"--"}):e.jsx("div",{className:"text-2xl font-bold",children:S.recruiting_studies}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Open for enrollment"})]})]}),e.jsxs(m,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Completed"}),e.jsx(w,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(x,{children:[_?e.jsx("div",{className:"text-2xl font-bold",children:"--"}):e.jsx("div",{className:"text-2xl font-bold",children:S.completed_studies}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Finished studies"})]})]})]}),e.jsxs(m,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(v,{children:"Clinical Studies Management"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(d,{placeholder:"Search studies...",value:D,onChange:s=>B(s.target.value),className:"pl-8 w-64"})]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:Se,children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Filter"]})]})]})}),e.jsx(x,{children:de?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Q,{className:"h-8 w-8 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading clinical studies..."})]}):oe?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(W,{className:"h-12 w-12 text-red-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Studies"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Failed to load clinical studies. Please try again."})]}):X.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Studies Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No clinical studies have been created yet."}),e.jsxs(l,{onClick:()=>h(!0),children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Create First Study"]})]}):e.jsx("div",{className:"space-y-6",children:X.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Protocol: ",s.protocol_number]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{className:Ce(s.status),children:Pe(s.status)}),e.jsx(le,{className:we(s.phase),children:Fe(s.phase)}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>ve(s),children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>ye(s),children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Assign to Site"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>Ne(s),children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),"Manage"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Te,{className:"h-4 w-4 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Site"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.site})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(C,{className:"h-4 w-4 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Type"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.type})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Start Date"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.startDate})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(w,{className:"h-4 w-4 text-gray-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Principal Investigator"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.principalInvestigator})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Enrollment Progress"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.currentEnrollment," / ",s.targetEnrollment," participants"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${s.currentEnrollment/s.targetEnrollment*100}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"0%"})," Enrolled"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Target: ",e.jsx("strong",{children:s.targetEnrollment})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>be(s),children:[e.jsx(w,{className:"h-4 w-4 mr-1"}),"Participants"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>fe(s),children:[e.jsx(qe,{className:"h-4 w-4 mr-1"}),"Timeline"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>_e(s),children:[e.jsx(C,{className:"h-4 w-4 mr-1"}),"Documents"]})]})]})]},s.id))})})]}),e.jsx(m,{className:"border-yellow-200 bg-yellow-50",children:e.jsxs(x,{className:"flex items-center space-x-3 pt-6",children:[e.jsx(W,{className:"h-5 w-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-800",children:"Study Management System"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"This is a preview of the Clinical Studies management system. Full functionality including study creation, participant enrollment, timeline management, and document handling will be implemented in the next phase."})]})]})})]})};export{as as default};
//# sourceMappingURL=ClinicalStudies-BxMKkY1M.js.map
