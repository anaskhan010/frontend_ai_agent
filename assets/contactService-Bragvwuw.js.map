{"version":3,"file":"contactService-Bragvwuw.js","sources":["../../src/api/services/contact/contactService.ts"],"sourcesContent":["// src/api/services/contact/contactService.ts\r\n\r\nimport axiosInstance from \"@/api/axios/axiosInstance\";\r\nimport { toast } from \"sonner\";\r\n\r\n// Types\r\nexport interface Contact {\r\n  id: string;\r\n  email: string;\r\n  contact_number: string;\r\n  firstName?: string;\r\n  lastName?: string;\r\n  company?: string;\r\n  tags?: string[];\r\n  metadata?: Record<string, any>;\r\n  listId?: string;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface ContactList {\r\n  id: string;\r\n  list_name: string;\r\n  list_description?: string;\r\n  user_id: number;\r\n  contactCount: number;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface ContactPayload {\r\n  email: string;\r\n  contact_number: string;\r\n  firstName?: string;\r\n  lastName?: string;\r\n  fullName?: string;\r\n  phoneNumber?: string;\r\n  company?: string;\r\n  tags?: string[];\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface ContactServiceData {\r\n  user_id: number;\r\n  list_name: string;\r\n  list_description: string;\r\n  contacts: ContactPayload[];\r\n}\r\n\r\nexport interface ContactStats {\r\n  totalContacts: number;\r\n  totalLists: number;\r\n  contactsByList: Array<{\r\n    listId: string;\r\n    listName: string;\r\n    count: number;\r\n  }>;\r\n  contactsByTag: Array<{\r\n    tag: string;\r\n    count: number;\r\n  }>;\r\n  recentContacts: Contact[];\r\n}\r\n\r\n// Create contact list\r\nexport const createContactService = async (\r\n  data: ContactServiceData\r\n): Promise<string> => {\r\n  try {\r\n    const response = await axiosInstance.post(\"/api/contacts\", data);\r\n    toast.success(\"Contact list created successfully\");\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Contact Service Error:\", error);\r\n    toast.error(\"Failed to create contact list\");\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Get all contacts\r\nexport const getAllContacts = async (page: number, search: string) => {\r\n  try {\r\n    const response = await axiosInstance.get(\"/api/contacts\", {\r\n      params: { page, search },\r\n    });\r\n    return response.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching contacts:\", error);\r\n\r\n    // Check if it's a \"no contacts found\" scenario (404 or specific error message)\r\n    const isNoContactsFound =\r\n      error.response?.status === 404 ||\r\n      error.response?.data?.message?.toLowerCase().includes('not found') ||\r\n      error.response?.data?.error?.toLowerCase().includes('not found');\r\n\r\n    // Only show toast for actual errors, not when no contacts are found\r\n    if (!isNoContactsFound) {\r\n      toast.error(\"Failed to fetch contacts\");\r\n    }\r\n\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Get contact by ID\r\nexport const getContactById = async (id: string) => {\r\n  try {\r\n    const response = await axiosInstance.get(`/api/contacts/${id}`);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Error fetching contact:\", error);\r\n    toast.error(\"Failed to fetch contact\");\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Update contact (using new PATCH endpoint)\r\nexport const updateContact = async (id: string, data: Partial<ContactPayload>) => {\r\n  try {\r\n    // Map frontend field names to backend expected names\r\n    const payload = {\r\n      fullName: data.fullName,\r\n      email: data.email,\r\n      phoneNumber: data.phoneNumber,\r\n    };\r\n\r\n    const response = await axiosInstance.patch(`/api/contacts/${id}`, payload);\r\n    // Don't show toast here - let the component handle it\r\n    return response.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error updating contact:\", error);\r\n    const message = error.response?.data?.error || error.response?.data?.message || \"Failed to update contact\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Delete contact\r\nexport const deleteContact = async (id: string) => {\r\n  try {\r\n    const response = await axiosInstance.delete(`/api/contacts/${id}`);\r\n    // Don't show toast here - let the component handle it\r\n    return response.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error deleting contact:\", error);\r\n    const message = error.response?.data?.message || \"Failed to delete contact\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Get all contact lists (using new lists API)\r\nexport const getAllContactLists = async (page?: number, search?: string, includeDeleted?: boolean) => {\r\n  try {\r\n    const response = await axiosInstance.get(\"/api/lists\", {\r\n      params: { page, search, includeDeleted },\r\n    });\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Error fetching contact lists:\", error);\r\n\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Legacy function for backward compatibility\r\nexport const getListNamesWithContactCount = async () => {\r\n  try {\r\n    const response = await axiosInstance.get(\"/api/contacts/lists\");\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Error fetching list names:\", error);\r\n    toast.error(\"Failed to fetch list names\");\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Get contact list by ID (using new lists API)\r\nexport const getContactListById = async (id: string) => {\r\n  try {\r\n    const response = await axiosInstance.get(`/api/lists/${id}`);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Error fetching contact list:\", error);\r\n    toast.error(\"Failed to fetch contact list\");\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Get contacts for a specific list\r\nexport const getContactsForList = async (listId: string, page?: number, search?: string) => {\r\n  try {\r\n    const response = await axiosInstance.get(`/api/lists/${listId}/contacts`, {\r\n      params: { page, search },\r\n    });\r\n    return response.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching list contacts:\", error);\r\n\r\n    // Check if it's a \"no contacts found\" scenario (404 or specific error message)\r\n    const isNoContactsFound =\r\n      error.response?.status === 404 ||\r\n      error.response?.data?.message?.toLowerCase().includes('not found') ||\r\n      error.response?.data?.error?.toLowerCase().includes('not found');\r\n\r\n    // Only show toast for actual errors, not when no contacts are found\r\n    if (!isNoContactsFound) {\r\n      const errorMessage = error.response?.data?.error || error.response?.data?.message || \"Failed to fetch list contacts\";\r\n      toast.error(errorMessage);\r\n    }\r\n\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Create a new list\r\nexport const createList = async (data: {\r\n  listName: string;\r\n  description: string;\r\n  type?: string;\r\n}) => {\r\n  try {\r\n    // Map frontend field names to backend expected names\r\n    const payload = {\r\n      list_name: data.listName,\r\n      list_description: data.description,\r\n      type: data.type || 'General'\r\n    };\r\n\r\n    const response = await axiosInstance.post(\"/api/lists\", payload);\r\n    toast.success(\"List created successfully\");\r\n    return response.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error creating list:\", error);\r\n    const message = error.response?.data?.error || error.response?.data?.message || \"Failed to create list\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Update contact list\r\nexport const updateContactList = async (id: string, data: {\r\n  list_name?: string;\r\n  list_description?: string;\r\n}) => {\r\n  try {\r\n    const response = await axiosInstance.put(`/api/lists/${id}`, data);\r\n    toast.success(\"Contact list updated successfully\");\r\n    return response.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error updating contact list:\", error);\r\n    const message = error.response?.data?.error || error.response?.data?.message || \"Failed to update contact list\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Delete contact list (soft delete)\r\nexport const deleteContactList = async (id: string) => {\r\n  try {\r\n    const response = await axiosInstance.delete(`/api/lists/${id}`);\r\n    toast.success(\"Contact list disabled successfully\");\r\n    return response.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error deleting contact list:\", error);\r\n    const message = error.response?.data?.error || error.response?.data?.message || \"Failed to delete contact list\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Restore contact list (super admin only)\r\nexport const restoreContactList = async (id: string) => {\r\n  try {\r\n    const response = await axiosInstance.patch(`/api/lists/${id}/restore`);\r\n    toast.success(\"Contact list restored successfully\");\r\n    return response.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error restoring contact list:\", error);\r\n    const message = error.response?.data?.error || error.response?.data?.message || \"Failed to restore contact list\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Add contact to list\r\nexport const addContactToList = async (listId: string, contact: ContactPayload) => {\r\n  try {\r\n    // Map frontend field names to backend expected names\r\n    const payload = {\r\n      email: contact.email,\r\n      contact_number: contact.phoneNumber || contact.contact_number, // Map phoneNumber to contact_number\r\n      first_name: contact.fullName || contact.firstName || '', // Map fullName to first_name\r\n    };\r\n\r\n    const response = await axiosInstance.post(`/api/lists/${listId}/contacts`, payload);\r\n    // Don't show toast here - let the component handle it\r\n    return response.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error adding contact to list:\", error);\r\n    const message = error.response?.data?.error || error.response?.data?.message || \"Failed to add contact to list\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Remove contact from list\r\nexport const removeContactFromList = async (listId: string, contactId: string) => {\r\n  try {\r\n    const response = await axiosInstance.delete(`/api/lists/${listId}/contacts/${contactId}`);\r\n    toast.success(\"Contact removed from list successfully\");\r\n    return response.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error removing contact from list:\", error);\r\n    const message = error.response?.data?.error || error.response?.data?.message || \"Failed to remove contact from list\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Import contacts from CSV\r\nexport const importContactsFromCSV = async (listId: string, file: File) => {\r\n  try {\r\n    const formData = new FormData();\r\n    formData.append(\"file\", file);\r\n    formData.append(\"listId\", listId);\r\n\r\n    const response = await axiosInstance.post(\"/api/contacts/import\", formData, {\r\n      headers: {\r\n        \"Content-Type\": \"multipart/form-data\",\r\n      },\r\n    });\r\n    toast.success(\"Contacts imported successfully\");\r\n    return response.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error importing contacts:\", error);\r\n    const message = error.response?.data?.message || \"Failed to import contacts\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Export contacts to CSV\r\nexport const exportContactsToCSV = async (listId?: string) => {\r\n  try {\r\n    const response = await axiosInstance.get(\"/api/contacts/export\", {\r\n      params: { listId },\r\n      responseType: \"blob\",\r\n    });\r\n\r\n    // Create blob link to download\r\n    const url = window.URL.createObjectURL(new Blob([response.data]));\r\n    const link = document.createElement(\"a\");\r\n    link.href = url;\r\n    link.setAttribute(\"download\", `contacts-export.csv`);\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    link.remove();\r\n    window.URL.revokeObjectURL(url);\r\n\r\n    toast.success(\"Contacts exported successfully\");\r\n    return response.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error exporting contacts:\", error);\r\n    const message = error.response?.data?.message || \"Failed to export contacts\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Get contact statistics\r\nexport const getContactStats = async () => {\r\n  try {\r\n    const response = await axiosInstance.get(\"/api/contacts/stats\");\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Error fetching contact stats:\", error);\r\n    toast.error(\"Failed to fetch contact statistics\");\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Search contacts\r\nexport const searchContacts = async (query: string, filters?: {\r\n  listId?: string;\r\n  tags?: string[];\r\n  company?: string;\r\n}) => {\r\n  try {\r\n    const response = await axiosInstance.get(\"/api/contacts/search\", {\r\n      params: { query, ...filters },\r\n    });\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Error searching contacts:\", error);\r\n    toast.error(\"Failed to search contacts\");\r\n    throw error;\r\n  }\r\n};\r\n"],"names":["createContactService","data","response","axiosInstance","toast","error","getAllContacts","page","search","_a","_d","_c","_b","_g","_f","_e","updateContact","id","payload","message","deleteContact","getAllContactLists","includeDeleted","getContactListById","getContactsForList","listId","errorMessage","_i","_h","_k","_j","createList","addContactToList","contact","removeContactFromList","contactId"],"mappings":"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"}