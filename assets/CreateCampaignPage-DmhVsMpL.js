import{j as e,k as re,b7 as B,aT as h,b6 as le,az as O,y as ne}from"./ui-CNbESIMS.js";import{r as d}from"./vendor-DG599jyl.js";import{u as ie,b as j,c as ce}from"./query-DFkYe0MV.js";import{B as Q}from"./button-BpHONB4D.js";import{I as de}from"./input-DOIJ2OtM.js";import{L as n}from"./label-DkC73-VZ.js";import{S as F,a as I,b as P,c as A,d as m}from"./select-CSg3IHkG.js";import{R as z,a as N}from"./radio-group-DmkFYh_Q.js";import{u as me,t as x}from"./index-CvuFKe2_.js";import{P as oe}from"./Page-B106cZ-W.js";import{e as xe}from"./campaignService-D9FnlXTQ.js";import{h as ue}from"./agentService-XJiHAFON.js";import{g as he}from"./phoneNumberService-_WdHtDLM.js";import{b as ge,f as pe}from"./contactService-Bsi66vCj.js";import{u as je}from"./router-BavLd_S0.js";import"./index-DklBfCbe.js";import"./index-HDeFwIcs.js";import"./scroll-area-CQNQHAmm.js";import"./index-U78YeT7B.js";function Me(){var R,K,U,$;const q=je(),[f,G]=d.useState(""),[W,H]=d.useState("manual"),[b,J]=d.useState(""),[y,X]=d.useState(""),[u,p]=d.useState([]),[t,Y]=d.useState(""),[Z,D]=d.useState("now"),[k,ee]=d.useState(!1),se=ie(),{user:g}=me(),{data:v,isLoading:E}=j({queryKey:["assistants","vapi",g==null?void 0:g.id],queryFn:()=>ue(),retry:(s,a)=>{var c;return[404,204,402].includes((c=a==null?void 0:a.response)==null?void 0:c.status)?!1:s<1},enabled:!!(g!=null&&g.id)}),{data:w,isLoading:T}=j({queryKey:["phoneNumbers"],queryFn:()=>he(),retry:1}),{data:C,isLoading:V}=j({queryKey:["contactLists"],queryFn:()=>ge(),retry:1}),{data:r,isLoading:L}=j({queryKey:["listContacts",t],queryFn:()=>pe(t),enabled:!!t,retry:1});d.useEffect(()=>{var s,a;if(console.log("Contacts data received:",r),r!=null&&r.success&&((s=r==null?void 0:r.data)!=null&&s.contacts)){const l=r.data.contacts;console.log("Processing contacts array:",l);const c=l.map(i=>({name:`${i.firstName||i.first_name||""} ${i.lastName||i.last_name||""}`.trim()||i.fullName||i.email||"Unknown",number:i.contact_number||i.phoneNumber||i.phone,email:i.email||""}));console.log("Mapped contacts:",c),p(c)}else r&&!r.success?(console.log("API error response:",r),p([])):t&&r&&r.success&&(!((a=r.data)!=null&&a.contacts)||r.data.contacts.length===0)&&(console.log("Empty list detected"),p([]))},[r,t]);const S=ce({mutationFn:xe,onSuccess:s=>{se.invalidateQueries({queryKey:["outboundCampaigns"]});const a=(s==null?void 0:s.message)||"Campaign created successfully";x.success(a),q("/outbound")},onError:s=>{var a,l;x.error(((l=(a=s.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to create campaign")}}),ae=s=>{Y(s),p([])},te=()=>{if(!f.trim()){x.error("Campaign name is required");return}if(!b){x.error("Phone number is required");return}if(!y){x.error("Assistant is required");return}if(!t){x.error("Please select a contact list");return}if(u.length===0){x.error("Selected list has no contacts");return}const s=u.filter(l=>{const c=l.number;return!c||!c.startsWith("+")||!/^\+[1-9]\d{1,14}$/.test(c)});if(s.length>0){x.error(`Invalid phone numbers found. Please ensure all numbers are in E.164 format (e.g., +1234567890). Found ${s.length} invalid numbers.`);return}const a={name:f,phoneNumberId:b,assistantId:y,customers:u,autoLaunch:k};console.log("Creating campaign with data:",a),S.mutate(a)},_=(v==null?void 0:v.data)||[],M=(w==null?void 0:w.data)||[],o=(C==null?void 0:C.data)||[];return e.jsx(oe,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Q,{variant:"ghost",size:"sm",onClick:()=>q("/outbound"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[e.jsx(re,{className:"h-4 w-4"}),"Back to Outbound"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Create Campaign"}),e.jsxs("p",{className:"text-muted-foreground",children:["Create a new outbound campaign • Contacts loaded: ",u.length,t&&o.length>0&&e.jsxs("span",{className:"ml-2",children:['from "',((R=o.find(s=>s.id===t))==null?void 0:R.listName)||((K=o.find(s=>s.id===t))==null?void 0:K.list_name),'"']})]})]})]})}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-1/2",children:e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"campaign-name",className:"text-sm font-medium text-gray-700",children:"Campaign Name"}),e.jsx(de,{id:"campaign-name",placeholder:"Campaign Name",value:f,onChange:s=>G(s.target.value),className:"w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex flex-col space-y-3",children:[e.jsx(n,{className:"text-sm font-medium text-gray-700",children:"Campaign Type"}),e.jsxs(z,{value:W,onValueChange:H,className:"flex items-start space-x-8 border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:" flex items-start space-x-2",children:[e.jsx(N,{value:"manual",id:"manual",className:"mt-1 text-blue-600"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{htmlFor:"manual",className:"font-medium cursor-pointer text-gray-900",children:"Manual"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Start campaign now or schedule for later"})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(N,{value:"live",id:"live",className:"mt-1 text-blue-600"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(n,{htmlFor:"live",className:"font-medium cursor-pointer text-gray-900",children:"Live"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Triggered via webhooks from your website or forms"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{htmlFor:"phone-number",className:"text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:"From AI CRUITMENT"})]})]}),e.jsxs(F,{value:b,onValueChange:J,children:[e.jsx(I,{className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(P,{placeholder:T?"Loading...":"Select phone number"})}),e.jsx(A,{children:T?e.jsxs(m,{value:"loading",disabled:!0,children:[e.jsx(h,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):M.length===0?e.jsx(m,{value:"no-numbers",disabled:!0,children:"No phone numbers available"}):M.map(s=>e.jsx(m,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.number||s.twilioPhoneNumber}),s.name&&e.jsx("span",{className:"text-xs text-gray-500",children:s.name})]})},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{htmlFor:"contact-list",className:"text-sm font-medium text-gray-700",children:"Contact List"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:"From Lists"})]})]}),e.jsxs(F,{value:t,onValueChange:ae,children:[e.jsx(I,{className:"border-gray-300 ",children:e.jsx(P,{placeholder:V?"Loading...":"Select contact list"})}),e.jsx(A,{children:V?e.jsxs(m,{value:"loading",disabled:!0,children:[e.jsx(h,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):o.length===0?e.jsx(m,{value:"no-lists",disabled:!0,children:"No contact lists available"}):o.map(s=>e.jsx(m,{value:s.id,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-6 w-6 bg-gradient-to-br from-primary/20 to-primary/10 rounded flex items-center justify-center",children:e.jsx(le,{className:"h-3 w-3 text-primary"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.listName||s.list_name}),e.jsxs("span",{className:"text-xs text-gray-500",children:[e.jsx(O,{className:"h-3 w-3 inline mr-1"}),s.contactCount||s.contacts_count||0," contacts"]})]})]})},s.id))})]}),t&&L&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsx(h,{className:"h-4 w-4 animate-spin text-blue-600"}),e.jsx("span",{className:"text-sm text-blue-800",children:"Loading contacts..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{htmlFor:"assistant",className:"text-sm font-medium text-gray-700",children:"Assistant"}),e.jsx("span",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:"From AI CRUITMENT"})]}),e.jsxs(F,{value:y,onValueChange:X,children:[e.jsx(I,{className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(P,{placeholder:E?"Loading...":"Select assistant"})}),e.jsx(A,{children:E?e.jsxs(m,{value:"loading",disabled:!0,children:[e.jsx(h,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):_.length===0?e.jsx(m,{value:"no-assistants",disabled:!0,children:"No assistants available"}):_.map(s=>{var a,l;return e.jsx(m,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),((a=s.model)==null?void 0:a.model)&&e.jsxs("span",{className:"text-xs text-gray-500",children:[s.model.model," • ",((l=s.voice)==null?void 0:l.voiceId)||"Default Voice"]})]})},s.id)})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{className:"text-sm font-medium text-gray-700",children:"Choose when to send"}),e.jsxs(z,{value:Z,onValueChange:D,className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{value:"now",id:"send-now",className:"text-blue-600"}),e.jsx(n,{htmlFor:"send-now",className:"cursor-pointer text-gray-900",children:"Send Now"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{value:"later",id:"send-later",className:"text-blue-600"}),e.jsx(n,{htmlFor:"send-later",className:"cursor-pointer text-gray-900",children:"Schedule for later"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4 border-t border-gray-200",children:[e.jsx("input",{type:"checkbox",id:"auto-launch",checked:k,onChange:s=>ee(s.target.checked),className:"h-4 w-4 text-teal-600 focus:ring-teal-500 border-gray-300 rounded"}),e.jsx(n,{htmlFor:"auto-launch",className:"text-sm text-gray-700 cursor-pointer",children:"Automatically launch campaign after creation"})]}),e.jsxs(Q,{onClick:te,disabled:S.isPending,className:"w-full bg-teal-600 hover:bg-teal-700 text-white py-3 text-base font-medium rounded-lg",children:[S.isPending&&e.jsx(h,{className:"h-4 w-4 mr-2 animate-spin"}),"Launch campaign"]})]})})}),e.jsx("div",{className:"w-1/2",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Contact Preview"}),e.jsx("p",{className:"text-sm text-gray-500",children:t?L?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4 animate-spin"}),"Loading contacts..."]}):e.jsxs(e.Fragment,{children:[u.length," contacts from selected list",t&&o.length>0&&e.jsxs("span",{className:"ml-1 font-medium",children:['"',((U=o.find(s=>s.id===t))==null?void 0:U.listName)||(($=o.find(s=>s.id===t))==null?void 0:$.list_name),'"']})]}):"Select a list to preview contacts"})]}),e.jsx("div",{className:"p-6",children:t?L?e.jsx("div",{className:"h-96 flex items-center justify-center border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(h,{className:"h-8 w-8 animate-spin text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading contacts..."})]})}):u.length===0?e.jsx("div",{className:"h-96 flex items-center justify-center border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"h-8 w-8 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No contacts found in this list"})]})}):e.jsx("div",{className:"h-96 overflow-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Phone Number"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Email"})]})}),e.jsx("tbody",{children:u.map((s,a)=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.number}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.email})]},a))})]})}):e.jsx("div",{className:"h-96 flex items-center justify-center border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{className:"h-8 w-8 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select List for Preview Contacts"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose a contact list from the form to preview contacts here"})]})})})]})})]})]})})}export{Me as CreateCampaignPage};
//# sourceMappingURL=CreateCampaignPage-DmhVsMpL.js.map
