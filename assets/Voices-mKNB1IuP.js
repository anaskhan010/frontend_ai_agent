import{j as e,aU as $,at as Y,bl as ae,bk as te,an as C}from"./ui-S570Xcny.js";import{r as c}from"./vendor-DG599jyl.js";import{u as re,b as z,c as q}from"./query-Cab5P5bd.js";import{C as g,a as v,b,c as E,d as oe}from"./card-DMfGhRm1.js";import{B as Z}from"./button-BSd9MMPp.js";import{B as J}from"./badge-ij7fArnn.js";import{T as ne,a as ie,b as W,c as G}from"./tabs-CbOWgAXT.js";import{d as w,t as o}from"./index-YNP4OU4_.js";import{P as X}from"./Page-BJWqKr2O.js";import"./router-BavLd_S0.js";import"./scroll-area-C-pzVjaj.js";import"./index-BHBJ6RT-.js";import"./index-CWMUKvWL.js";async function ce(){try{return(await w.get("/api/voices/available")).data}catch(t){throw console.error("Error fetching available voices:",t),o.error("Failed to fetch available voices"),t}}async function le(t){var n,d;try{const s=await w.post("/api/voices/config",t);return o.success("Voice configuration created successfully"),s.data}catch(s){console.error("Error creating voice config:",s);const f=((d=(n=s.response)==null?void 0:n.data)==null?void 0:d.message)||"Failed to create voice configuration";throw o.error(f),s}}async function de(t){var n,d;try{const s=await w.post("/api/voices/test",t);return o.success("Voice test completed successfully"),s.data}catch(s){console.error("Error testing voice:",s);const f=((d=(n=s.response)==null?void 0:n.data)==null?void 0:d.message)||"Failed to test voice";throw o.error(f),s}}async function ue(){try{return(await w.get("/api/voices/stats")).data}catch(t){throw console.error("Error fetching voice stats:",t),o.error("Failed to fetch voice statistics"),t}}async function me(t){var n,d;try{const s=new FormData;s.append("provider",t.provider),s.append("name",t.name),t.description&&s.append("description",t.description),t.files.forEach((u,h)=>{s.append(`files[${h}]`,u)});const f=await w.post("/api/voices/clone",s,{headers:{"Content-Type":"multipart/form-data"}});return o.success("Voice cloned successfully"),f.data}catch(s){console.error("Error cloning voice:",s);const f=((d=(n=s.response)==null?void 0:n.data)==null?void 0:d.message)||"Failed to clone voice";throw o.error(f),s}}const Le=()=>{var D,B,K,M,Q,H;const[t,n]=c.useState(""),[d,s]=c.useState(""),[f,u]=c.useState("Hello, this is a test of the voice synthesis."),[h,V]=c.useState(1),[S,y]=c.useState(1),[T,F]=c.useState(!1),[A,P]=c.useState(!1),[k,L]=c.useState(!1),[I,O]=c.useState([]),[U,l]=c.useState(""),[i,a]=c.useState(""),N=re(),{data:j,isLoading:_,error:ee}=z({queryKey:["voices","available"],queryFn:ce,retry:1}),{data:x,isLoading:se}=z({queryKey:["voices","stats"],queryFn:ue,retry:1});q({mutationFn:de,onSuccess:p=>{o.success("Voice test completed successfully"),console.log("Test result:",p)},onError:p=>{var m,r;console.error("Voice test failed:",p),o.error(((r=(m=p.response)==null?void 0:m.data)==null?void 0:r.message)||"Voice test failed")}}),q({mutationFn:le,onSuccess:()=>{N.invalidateQueries({queryKey:["voices"]}),P(!1),o.success("Voice configuration created successfully")},onError:p=>{var m,r;o.error(((r=(m=p.response)==null?void 0:m.data)==null?void 0:r.message)||"Failed to create voice configuration")}}),q({mutationFn:me,onSuccess:()=>{N.invalidateQueries({queryKey:["voices"]}),L(!1),O([]),l(""),a(""),o.success("Voice cloned successfully")},onError:p=>{var m,r;o.error(((r=(m=p.response)==null?void 0:m.data)==null?void 0:r.message)||"Failed to clone voice")}});const R=(j==null?void 0:j.data)||{};return ee?e.jsx(X,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Voice Synthesis"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and configure text-to-speech voices from different providers"})]}),e.jsx(g,{children:e.jsx(v,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Unable to connect to the backend API. Please ensure the backend server is running."}),e.jsx(Z,{onClick:()=>window.location.reload(),children:"Retry Connection"})]})})})]})}):e.jsx(X,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Voice Synthesis"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and configure text-to-speech voices from different providers"})]}),e.jsx("div",{className:"flex gap-2"})]}),e.jsxs(ne,{defaultValue:"providers",className:"space-y-4",children:[e.jsxs(ie,{children:[e.jsx(W,{value:"providers",children:"Available Voices"}),e.jsx(W,{value:"stats",children:"Statistics"})]}),e.jsx(G,{value:"providers",className:"space-y-4",children:_?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx($,{className:"h-8 w-8 animate-spin"})}):e.jsx("div",{className:"grid gap-6",children:Object.keys(R).length===0?e.jsx(g,{children:e.jsx(v,{className:"pt-6",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No voices available. Please check your backend configuration."})})})}):Object.entries(R).map(([p,m])=>e.jsxs(g,{children:[e.jsxs(b,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),p]}),e.jsxs(oe,{children:[Array.isArray(m)?m.length:0," voices available"]})]}),e.jsx(v,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:Array.isArray(m)&&m.map(r=>e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold",children:r.name}),e.jsxs("div",{className:"flex gap-1",children:[r.gender&&e.jsx(J,{variant:"secondary",children:r.gender}),r.accent&&e.jsx(J,{variant:"outline",children:r.accent})]})]}),r.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:r.description}),r.language&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Language: ",r.language]}),r.previewUrl&&e.jsx(fe,{previewUrl:r.previewUrl,voiceName:r.name})]})},r.id||r.name))})})]},p))})}),e.jsx(G,{value:"stats",className:"space-y-4",children:se?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx($,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(g,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"Total Synthesis"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold",children:((B=(D=x==null?void 0:x.data)==null?void 0:D.totalSynthesis)==null?void 0:B.toLocaleString())||0})})]}),e.jsxs(g,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"Total Characters"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold",children:((M=(K=x==null?void 0:x.data)==null?void 0:K.totalCharacters)==null?void 0:M.toLocaleString())||0})})]}),e.jsxs(g,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"Avg Latency"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(v,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[((Q=x==null?void 0:x.data)==null?void 0:Q.averageLatency)||0,"ms"]})})]}),e.jsxs(g,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:"Error Rate"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(v,{children:e.jsxs("div",{className:"text-2xl font-bold",children:[((((H=x==null?void 0:x.data)==null?void 0:H.errorRate)||0)*100).toFixed(1),"%"]})})]})]})})]})]})})},fe=({previewUrl:t,voiceName:n})=>{const[d,s]=c.useState(!1),[f,u]=c.useState(!1),[h,V]=c.useState(null),[S,y]=c.useState(!1),T=()=>{h&&(h.pause(),h.removeEventListener("loadstart",F),h.removeEventListener("canplay",A),h.removeEventListener("ended",k),h.removeEventListener("error",L),h.removeEventListener("loadeddata",P),V(null))},F=()=>u(!0),A=()=>u(!1),P=()=>u(!1),k=()=>{s(!1),u(!1)},L=l=>{console.error("Audio error for",n,":",l),u(!1),s(!1),y(!0),o.error(`Preview not available for ${n}`)},I=async()=>{if(d&&h){h.pause(),s(!1);return}y(!1);try{if(u(!0),T(),!t||t.trim()==="")throw new Error("No preview URL available");t.startsWith("/api/voices/preview")?await O(t):await U(t)}catch(l){console.error("Error playing voice preview:",l),u(!1),s(!1),y(!0),l instanceof Error?l.message.includes("timeout")?o.error(`Preview timeout for ${n}`):l.message.includes("No preview URL")?o.error(`No preview available for ${n}`):l.message.includes("Voice preview not available")?o.error(`${n} preview is currently unavailable`):o.error(`Preview unavailable for ${n}`):o.error(`Failed to play preview for ${n}`)}},O=async l=>{var i;try{console.log("🔄 Making request to:",l);const a=await w.get(l);if(console.log("🎵 Voice preview response received:",a.data),console.log("🔍 Response analysis:"),console.log("  - success:",a.data.success),console.log("  - audioUrl:",a.data.audioUrl),console.log("  - note:",a.data.note),console.log("  - message:",a.data.message),a.data.success&&a.data.audioUrl)console.log("✅ Path 1: Playing audio from:",a.data.audioUrl),await U(a.data.audioUrl),o.success(`Playing ${n} preview`);else if(a.data.note){console.log("✅ Path 2: Showing note toast:",a.data.note),o.info(a.data.note),u(!1),y(!1);return}else if(a.data.message&&!a.data.audioUrl){console.log("✅ Path 3: Showing message toast:",a.data.message),o.info(a.data.message),u(!1),y(!1);return}else throw console.log("❌ Path 4: No valid response found"),console.log("❌ Full response:",JSON.stringify(a.data,null,2)),new Error("Voice preview not available")}catch(a){throw console.error("❌ Error in handleDynamicPreview:",a),((i=a.response)==null?void 0:i.status)===401?new Error("Authentication failed - please log in again"):a}},U=async l=>{const i=new Audio;i.addEventListener("loadstart",F),i.addEventListener("canplay",A),i.addEventListener("loadeddata",P),i.addEventListener("ended",k),i.addEventListener("error",L),i.preload="metadata",i.crossOrigin="anonymous",V(i),i.src=l,i.load(),await new Promise((a,N)=>{const j=setTimeout(()=>{N(new Error("Audio load timeout"))},1e4);i.addEventListener("canplay",()=>{clearTimeout(j),a(void 0)},{once:!0}),i.addEventListener("error",()=>{clearTimeout(j),N(new Error("Audio load failed"))},{once:!0})}),await i.play(),s(!0),u(!1)};return c.useEffect(()=>T,[]),e.jsxs(Z,{variant:"outline",size:"sm",className:"w-full",onClick:I,disabled:f||S,children:[f?e.jsx($,{className:"h-3 w-3 mr-1 animate-spin"}):d?e.jsx(ae,{className:"h-3 w-3 mr-1"}):S?e.jsx(Y,{className:"h-3 w-3 mr-1 opacity-50"}):e.jsx(te,{className:"h-3 w-3 mr-1"}),f?"Loading...":d?"Pause":S?"Unavailable":"Preview"]})};export{Le as default};
//# sourceMappingURL=Voices-mKNB1IuP.js.map
