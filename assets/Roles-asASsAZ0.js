import{j as e,aG as F,bx as H,aF as _,bB as O,c2 as A}from"./ui-B8VyAbFl.js";import{r}from"./vendor-DG599jyl.js";import{u as z,a as f,c as q}from"./query-CWB_8EHL.js";import{P as G}from"./Page-DeS2--Hf.js";import{H as V}from"./Header-pRDXIysU.js";import{a as o,t as h,C as w,d as D,e as L,f as K,b as N,p as v,B as C,L as x,s as W,v as J,w as X,x as Y,y as Z,I as Q,T as ee}from"./index-BJQAqHy1.js";import{C as se}from"./checkbox-C3ZVuZoP.js";import{P as ae}from"./PermissionRoute-nPuwqSxi.js";import"./sheet-DONoOQoo.js";import"./router-BnJytTjr.js";import"./usePermissions-D5708ELN.js";const te=async()=>(await o.get("/api/roles")).data,ie=async()=>{const a=await o.get("/api/permissions");return a.data.data||a.data},re=async a=>{const l=await o.get(`/api/role-permissions/role/${a}`);return l.data.data||l.data},fe=()=>{const[a,l]=r.useState(null),[P,S]=r.useState([]),[p,R]=r.useState(!1),[g,T]=r.useState(""),[B,d]=r.useState(!1),[n,c]=r.useState({name:"",display_name:"",description:""}),m=z(),{data:u,isLoading:ne}=f({queryKey:["roles"],queryFn:te}),{data:y,isLoading:oe}=f({queryKey:["permissions"],queryFn:ie}),{data:j,isLoading:le}=f({queryKey:["rolePermissions",a==null?void 0:a.id],queryFn:()=>re(a.id),enabled:!!a});r.useEffect(()=>{j&&S(j.map(s=>s.permission_id))},[j]);const M=q({mutationFn:async({roleId:s,permissionIds:t})=>{await o.post(`/api/role-permissions/role/${s}/bulk`,{permission_ids:t})},onSuccess:()=>{h.success("Role permissions updated successfully"),m.invalidateQueries({queryKey:["rolePermissions"]}),m.invalidateQueries({queryKey:["pagePermissions"]})},onError:s=>{var t,i;h.error(((i=(t=s.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to update permissions")}}),b=q({mutationFn:async s=>(await o.post("/api/roles",s)).data,onSuccess:()=>{h.success("Role created successfully"),m.invalidateQueries({queryKey:["roles"]}),m.invalidateQueries({queryKey:["pagePermissions"]}),d(!1),c({name:"",display_name:"",description:""})},onError:s=>{var t,i;h.error(((i=(t=s.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to create role")}}),E=s=>{l(s)},I=s=>{S(t=>t.includes(s)?t.filter(i=>i!==s):[...t,s])},U=async()=>{if(a){R(!0);try{await M.mutateAsync({roleId:a.id,permissionIds:P})}finally{R(!1)}}},$=()=>{b.mutate(n)},k=(u==null?void 0:u.filter(s=>s.display_name.toLowerCase().includes(g.toLowerCase())||s.name.toLowerCase().includes(g.toLowerCase())))||[];return e.jsx(ae,{requireSuperAdmin:!0,children:e.jsxs(G,{children:[e.jsx("div",{"aria-hidden":!0,className:"absolute inset-0 pointer-events-none bg-gradient-to-r from-indigo-500/10 via-purple-500/10 to-pink-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(V,{title:"Roles & Permissions Management",buttonText:"Create Role",action:()=>d(!0),filterByName:!0,filterWord:g,onFilterChange:T,useSheet:!1,showViewToggle:!1,showFilters:!1}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-200px)]",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(w,{className:"h-full bg-white/5 backdrop-blur-md border border-white/10",children:[e.jsxs(D,{children:[e.jsxs(L,{className:"flex items-center gap-2 text-white",children:[e.jsx(F,{className:"h-5 w-5 text-indigo-400"}),"Roles (",k.length,")"]}),e.jsx(K,{className:"text-gray-400",children:"Select a role to manage its permissions"})]}),e.jsx(N,{className:"p-0",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-y-auto",children:k.map(s=>e.jsx("div",{onClick:()=>E(s),className:`p-4 border-b border-white/10 cursor-pointer hover:bg-white/10 transition-colors ${(a==null?void 0:a.id)===s.id?"bg-indigo-500/20 border-l-4 border-l-indigo-500":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-white",children:s.display_name}),e.jsx("p",{className:"text-sm text-gray-400",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(v,{variant:"outline",className:"text-xs bg-white/5 border-white/20 text-gray-300",children:["#",s.id]}),s.is_system_role&&e.jsx(v,{variant:"secondary",className:"text-xs bg-purple-500/20 text-purple-300 border border-purple-500/30",children:"System"})]})]}),(a==null?void 0:a.id)===s.id&&e.jsx(H,{className:"h-5 w-5 text-indigo-400"})]})},s.id))})})]})}),e.jsx("div",{className:"lg:col-span-2",children:a?e.jsxs(w,{className:"h-full bg-white/5 backdrop-blur-md border border-white/10",children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(L,{className:"flex items-center gap-2 text-white",children:[e.jsx(_,{className:"h-5 w-5 text-indigo-400"}),"Permissions for ",a.display_name]}),e.jsx(K,{className:"text-gray-400",children:"Manage permissions for this role"})]}),e.jsxs(C,{onClick:U,disabled:p,className:"flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white border-0",children:[p?e.jsx(O,{className:"h-4 w-4 animate-spin"}):e.jsx(A,{className:"h-4 w-4"}),p?"Updating...":"Update Permissions"]})]})}),e.jsx(N,{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-3 flex items-center gap-2 text-white",children:[e.jsx(_,{className:"h-4 w-4 text-indigo-400"}),"System Permissions"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-60 overflow-y-auto",children:y==null?void 0:y.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 border border-white/10 rounded bg-white/5",children:[e.jsx(se,{id:`permission-${s.id}`,checked:P.includes(s.id),onCheckedChange:()=>I(s.id),className:"border-white/30 data-[state=checked]:bg-indigo-600 data-[state=checked]:border-indigo-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{htmlFor:`permission-${s.id}`,className:"text-sm font-medium cursor-pointer text-white",children:s.display_name}),e.jsx("p",{className:"text-xs text-gray-400",children:s.description}),e.jsx(v,{variant:"outline",className:"text-xs mt-1 bg-white/5 border-white/20 text-gray-300",children:s.category})]})]},s.id))})]})})]}):e.jsx(w,{className:"h-full flex items-center justify-center bg-white/5 backdrop-blur-md border border-white/10",children:e.jsxs(N,{className:"text-center",children:[e.jsx(F,{className:"h-12 w-12 text-gray-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Select a Role"}),e.jsx("p",{className:"text-gray-400",children:"Choose a role from the left panel to manage its permissions."})]})})})]}),e.jsx(W,{open:B,onOpenChange:d,children:e.jsxs(J,{className:"bg-[#0e1340] border border-white/10 text-white",children:[e.jsxs(X,{children:[e.jsx(Y,{className:"text-white",children:"Create New Role"}),e.jsx(Z,{className:"text-gray-400",children:"Create a new role with custom permissions and access levels."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"role-name",className:"text-gray-300",children:"Role Name"}),e.jsx(Q,{id:"role-name",placeholder:"e.g., manager",value:n.name,onChange:s=>c(t=>({...t,name:s.target.value})),className:"bg-white/5 border-white/20 text-white placeholder:text-gray-500 focus:border-indigo-500"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"role-display-name",className:"text-gray-300",children:"Display Name"}),e.jsx(Q,{id:"role-display-name",placeholder:"e.g., Manager",value:n.display_name,onChange:s=>c(t=>({...t,display_name:s.target.value})),className:"bg-white/5 border-white/20 text-white placeholder:text-gray-500 focus:border-indigo-500"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"role-description",className:"text-gray-300",children:"Description"}),e.jsx(ee,{id:"role-description",placeholder:"Describe the role's responsibilities...",value:n.description,onChange:s=>c(t=>({...t,description:s.target.value})),className:"bg-white/5 border-white/20 text-white placeholder:text-gray-500 focus:border-indigo-500"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(C,{variant:"outline",onClick:()=>d(!1),className:"bg-transparent border-white/20 text-white hover:bg-white/10",children:"Cancel"}),e.jsx(C,{onClick:$,disabled:!n.name||!n.display_name||b.isPending,className:"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white border-0",children:b.isPending?"Creating...":"Create Role"})]})]})]})})]})]})})};export{fe as default};
//# sourceMappingURL=Roles-asASsAZ0.js.map
