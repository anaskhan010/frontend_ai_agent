const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/outboundService-Cg0vzci1.js","assets/index-C95eVPAi.js","assets/ui-S570Xcny.js","assets/vendor-DG599jyl.js","assets/router-BavLd_S0.js","assets/query-Cab5P5bd.js","assets/index-CfoR_XJg.css"])))=>i.map(i=>d[i]);
import{u as Be,t as h,_ as Ve}from"./index-C95eVPAi.js";import{j as e,aZ as $e,aU as C,D as Ee,aw as Ke,f as _e,J as V,aL as te,a$ as ze,y as He,b2 as Qe,an as A}from"./ui-S570Xcny.js";import{r as b}from"./vendor-DG599jyl.js";import{u as Ue,b as v,c as $}from"./query-Cab5P5bd.js";import{C as m,a as x,b as p,c as f,d as E}from"./card-DMfGhRm1.js";import{B as o}from"./button-BSd9MMPp.js";import{B as ne}from"./badge-ij7fArnn.js";import{I as ie}from"./input-jxB46izN.js";import{L as r}from"./label-C1-UM1F-.js";import{T as D}from"./textarea-Cw4zrZDH.js";import{S as le,a as re,b as de,c as oe,d as ce}from"./select-D0_OqHwT.js";import{D as ue,d as he,a as me,b as xe,c as je,e as ge}from"./dialog-DGdhV35L.js";import{T as Je,a as Ze,b as F,c as M}from"./tabs-CbOWgAXT.js";import{T as pe,a as fe,b as w,c as d,d as be,e as i}from"./table-Beiyegzh.js";import{S as Ne}from"./switch-4e3Rf_kA.js";import{g as Ge,A as ye,a as We,s as Xe,d as Ye}from"./recordingService-DiYZgCSe.js";import{P as es}from"./Page-BJWqKr2O.js";import{getAllOutboundCalls as ss,getCallStats as as,createOutboundCall as ts,createBulkOutboundCalls as ns,endOutboundCall as is,getCallTranscript as ls}from"./outboundService-Cg0vzci1.js";import{f as rs,h as ds}from"./agentService-CSD2ntxe.js";import{g as os}from"./phoneNumberService-okmGsQRH.js";import"./router-BavLd_S0.js";import"./index-BHBJ6RT-.js";import"./index-HDeFwIcs.js";import"./slider-DHO3HMwz.js";import"./dropdown-menu-Bxst4dXB.js";import"./scroll-area-C-pzVjaj.js";import"./index-CWMUKvWL.js";const $s=()=>{var J,Z,G,W,X,Y,ee,se,ae;const[Ce,K]=b.useState(!1),[ve,_]=b.useState(!1),[cs,us]=b.useState(null),[n,c]=b.useState({assistantId:"",phoneNumber:"",firstMessage:"",voicemailMessage:"",maxDurationSeconds:300}),[P,z]=b.useState(""),[j,H]=b.useState(!1),[hs,S]=b.useState(null),k=Ue(),{user:a}=Be(),{data:I,isLoading:we,error:Se}=v({queryKey:["outboundCalls",a==null?void 0:a.id],queryFn:()=>ss(),retry:1,enabled:!!(a!=null&&a.id)}),{data:T,isLoading:ke}=v({queryKey:["assistants","database",a==null?void 0:a.id],queryFn:()=>rs(""),retry:1,enabled:!j&&!!(a!=null&&a.id)}),{data:R,isLoading:Ae}=v({queryKey:["assistants","vapi",a==null?void 0:a.id],queryFn:()=>ds(),retry:1,enabled:j&&!!(a!=null&&a.id)}),{data:L}=v({queryKey:["phoneNumbers",a==null?void 0:a.id],queryFn:()=>os(),retry:1,enabled:!!(a!=null&&a.id)}),{data:l}=v({queryKey:["callStats",a==null?void 0:a.id],queryFn:()=>as(),retry:1,enabled:!!(a!=null&&a.id)}),{data:N,isLoading:De}=v({queryKey:["recordings","outbound",a==null?void 0:a.id],queryFn:()=>Ge(1,50),retry:1,enabled:!!(a!=null&&a.id)}),O=$({mutationFn:ts,onSuccess:()=>{k.invalidateQueries({queryKey:["outboundCalls",a==null?void 0:a.id]}),K(!1),c({assistantId:"",phoneNumber:"",firstMessage:"",voicemailMessage:"",maxDurationSeconds:300}),h.success("Outbound call initiated successfully")},onError:s=>{var t,u;h.error(((u=(t=s.response)==null?void 0:t.data)==null?void 0:u.message)||"Failed to create outbound call")}}),q=$({mutationFn:ns,onSuccess:()=>{k.invalidateQueries({queryKey:["outboundCalls"]}),_(!1),z(""),h.success("Bulk outbound calls initiated successfully")},onError:s=>{var t,u;h.error(((u=(t=s.response)==null?void 0:t.data)==null?void 0:u.message)||"Failed to create bulk outbound calls")}}),Q=$({mutationFn:is,onSuccess:()=>{k.invalidateQueries({queryKey:["outboundCalls"]}),h.success("Call ended successfully")},onError:s=>{var t,u;h.error(((u=(t=s.response)==null?void 0:t.data)==null?void 0:u.message)||"Failed to end call")}}),Fe=()=>{if(!n.assistantId||!n.phoneNumber){h.error("Please select an assistant and enter a phone number");return}O.mutate(n)},Me=()=>{if(!n.assistantId||!P.trim()){h.error("Please select an assistant and enter phone numbers");return}const s=P.split(`
`).map(t=>t.trim()).filter(t=>t.length>0);if(s.length===0){h.error("Please enter at least one phone number");return}q.mutate({assistantId:n.assistantId,phoneNumbers:s,firstMessage:n.firstMessage,voicemailMessage:n.voicemailMessage,maxDurationSeconds:n.maxDurationSeconds})},Pe=s=>{confirm("Are you sure you want to end this call?")&&Q.mutate(s)},Ie=async s=>{try{await ls(s)}catch(t){console.error("Error downloading transcript:",t)}},Te=async s=>{try{const{downloadCallRecording:t}=await Ve(async()=>{const{downloadCallRecording:u}=await import("./outboundService-Cg0vzci1.js");return{downloadCallRecording:u}},__vite__mapDeps([0,1,2,3,4,5,6]));await t(s)}catch(t){console.error("Error downloading recording:",t)}},Re=s=>{We(s.id,`${s.recordingName}.${s.format}`)},Le=s=>{Xe(s.id,{expiresIn:"7d"})},Oe=s=>{confirm(`Are you sure you want to delete "${s.recordingName}"?`)&&Ye(s.id).then(()=>{k.invalidateQueries({queryKey:["recordings"]})})},qe=s=>{const t={queued:"outline",ringing:"secondary","in-progress":"default",forwarding:"secondary",ended:"destructive"};return e.jsx(ne,{variant:t[s]||"outline",children:s})},y=j?(R==null?void 0:R.data)||[]:(T==null?void 0:T.data)||[];L!=null&&L.data;const U=(I==null?void 0:I.data)||[],B=(N==null?void 0:N.recordings)||[],g=j?Ae:ke;return Se?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Outbound Calls"}),e.jsx("p",{className:"text-muted-foreground",children:"Make and manage outbound calls with your AI assistants"})]}),e.jsx(m,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Unable to connect to the backend API. Please ensure the backend server is running."}),e.jsx(o,{onClick:()=>window.location.reload(),children:"Retry Connection"})]})})})]}):e.jsx(es,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Outbound Calls"}),e.jsx("p",{className:"text-muted-foreground",children:"Make and manage outbound calls with your AI assistants"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ue,{open:ve,onOpenChange:_,children:[e.jsx(he,{asChild:!0,children:e.jsxs(o,{variant:"outline",children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Bulk Calls"]})}),e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(je,{children:"Create Bulk Outbound Calls"}),e.jsx(ge,{children:"Create multiple outbound calls at once"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{htmlFor:"bulk-assistant-source",children:"Assistant Source"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{htmlFor:"bulk-assistant-source",className:"text-sm",children:"Database"}),e.jsx(Ne,{id:"bulk-assistant-source",checked:j,onCheckedChange:s=>{H(s),c(t=>({...t,assistantId:""}))}}),e.jsx(r,{htmlFor:"bulk-assistant-source",className:"text-sm",children:"VAPI"})]})]}),e.jsxs("div",{children:[e.jsxs(r,{htmlFor:"bulk-assistant",children:["Assistant ",g&&e.jsx(C,{className:"h-3 w-3 animate-spin inline ml-1"})]}),e.jsxs(le,{value:n.assistantId,onValueChange:s=>c(t=>({...t,assistantId:s})),disabled:g,children:[e.jsx(re,{children:e.jsx(de,{placeholder:g?"Loading assistants...":y.length===0?"No assistants found":"Select an assistant"})}),e.jsx(oe,{children:y.map(s=>e.jsx(ce,{value:s.id,children:s.name},s.id))})]}),y.length===0&&!g&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:j?"No assistants found in VAPI. Try switching to Database source.":"No assistants found in database. Try creating an assistant first."})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"bulk-numbers",children:"Phone Numbers (one per line)"}),e.jsx(D,{id:"bulk-numbers",value:P,onChange:s=>z(s.target.value),placeholder:`+1234567890
+1987654321
+1555123456`,rows:5})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"bulk-first-message",children:"First Message (Optional)"}),e.jsx(D,{id:"bulk-first-message",value:n.firstMessage||"",onChange:s=>c(t=>({...t,firstMessage:s.target.value})),placeholder:"Custom greeting message..."})]}),e.jsxs(o,{onClick:Me,disabled:q.isPending,className:"w-full",children:[q.isPending&&e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Create Bulk Calls"]})]})]})]}),e.jsxs(ue,{open:Ce,onOpenChange:K,children:[e.jsx(he,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Make Call"]})}),e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(je,{children:"Create Outbound Call"}),e.jsx(ge,{children:"Start a new outbound call with an AI assistant"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{htmlFor:"assistant-source",children:"Assistant Source"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{htmlFor:"assistant-source",className:"text-sm",children:"Database"}),e.jsx(Ne,{id:"assistant-source",checked:j,onCheckedChange:s=>{H(s),c(t=>({...t,assistantId:""}))}}),e.jsx(r,{htmlFor:"assistant-source",className:"text-sm",children:"VAPI"})]})]}),e.jsxs("div",{children:[e.jsxs(r,{htmlFor:"assistant",children:["Assistant ",g&&e.jsx(C,{className:"h-3 w-3 animate-spin inline ml-1"})]}),e.jsxs(le,{value:n.assistantId,onValueChange:s=>c(t=>({...t,assistantId:s})),disabled:g,children:[e.jsx(re,{children:e.jsx(de,{placeholder:g?"Loading assistants...":y.length===0?"No assistants found":"Select an assistant"})}),e.jsx(oe,{children:y.map(s=>e.jsx(ce,{value:s.id,children:s.name},s.id))})]}),y.length===0&&!g&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:j?"No assistants found in VAPI. Try switching to Database source.":"No assistants found in database. Try creating an assistant first."})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx(ie,{id:"phoneNumber",value:n.phoneNumber,onChange:s=>c(t=>({...t,phoneNumber:s.target.value})),placeholder:"+1234567890"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"firstMessage",children:"First Message (Optional)"}),e.jsx(D,{id:"firstMessage",value:n.firstMessage||"",onChange:s=>c(t=>({...t,firstMessage:s.target.value})),placeholder:"Custom greeting message..."})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"voicemailMessage",children:"Voicemail Message (Optional)"}),e.jsx(D,{id:"voicemailMessage",value:n.voicemailMessage||"",onChange:s=>c(t=>({...t,voicemailMessage:s.target.value})),placeholder:"Message to leave if voicemail is detected..."})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"maxDuration",children:"Max Duration (seconds)"}),e.jsx(ie,{id:"maxDuration",type:"number",value:n.maxDurationSeconds,onChange:s=>c(t=>({...t,maxDurationSeconds:parseInt(s.target.value)})),min:"30",max:"3600"})]}),e.jsxs(o,{onClick:Fe,disabled:O.isPending,className:"w-full",children:[O.isPending&&e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Start Call"]})]})]})]})]})]}),e.jsxs(Je,{defaultValue:"calls",className:"space-y-4",children:[e.jsxs(Ze,{children:[e.jsx(F,{value:"calls",children:"Active Calls"}),e.jsx(F,{value:"recordings",children:"All Recordings"}),e.jsx(F,{value:"history",children:"Call History"}),e.jsx(F,{value:"stats",children:"Statistics"})]}),e.jsx(M,{value:"calls",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5"}),"Outbound Calls"]}),e.jsx(E,{children:"Manage your outbound calls and view their status"})]}),e.jsx(x,{children:we?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(C,{className:"h-8 w-8 animate-spin"})}):e.jsxs(pe,{children:[e.jsx(fe,{children:e.jsxs(w,{children:[e.jsx(d,{children:"Phone Number"}),e.jsx(d,{children:"Assistant"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Duration"}),e.jsx(d,{children:"Recording"}),e.jsx(d,{children:"Started"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(be,{children:U.length===0?e.jsx(w,{children:e.jsx(i,{colSpan:7,className:"text-center text-muted-foreground",children:"No outbound calls found. Create your first call to get started."})}):U.map(s=>e.jsxs(w,{children:[e.jsx(i,{className:"font-mono",children:s.phoneNumber}),e.jsx(i,{children:s.assistantId}),e.jsx(i,{children:qe(s.status)}),e.jsx(i,{children:s.duration?`${Math.floor(s.duration/60)}:${(s.duration%60).toString().padStart(2,"0")}`:"-"}),e.jsx(i,{children:s.status==="ended"||s.recording?e.jsx(ye,{src:s.recording||`/api/outboundcall/recording/${s.id}`,title:`Call Recording - ${s.phoneNumber}`,duration:s.duration?`${Math.floor(s.duration/60)}:${(s.duration%60).toString().padStart(2,"0")}`:"0:00",compact:!0,onPlay:()=>S(s.id),onPause:()=>S(null)}):s.status==="in-progress"?e.jsx("span",{className:"text-muted-foreground text-sm",children:"Recording..."}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No recording"})}),e.jsx(i,{children:s.startedAt?new Date(s.startedAt).toLocaleString():"-"}),e.jsx(i,{children:e.jsxs("div",{className:"flex gap-2",children:[s.status==="in-progress"&&e.jsx(o,{size:"sm",variant:"outline",onClick:()=>Pe(s.id),disabled:Q.isPending,children:e.jsx(_e,{className:"h-3 w-3"})}),s.transcript&&e.jsx(o,{size:"sm",variant:"outline",onClick:()=>Ie(s.id),children:e.jsx(V,{className:"h-3 w-3"})}),(s.status==="ended"||s.recording)&&e.jsx(o,{size:"sm",variant:"outline",onClick:()=>Te(s.id),title:"Download Recording",children:e.jsx(V,{className:"h-3 w-3"})})]})})]},s.id))})]})})]})}),e.jsx(M,{value:"recordings",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"All Call Recordings"]}),e.jsx(E,{children:"View and manage all call recordings with inline playback"})]}),e.jsx(x,{children:De?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(C,{className:"h-8 w-8 animate-spin"})}):e.jsxs(pe,{children:[e.jsx(fe,{children:e.jsxs(w,{children:[e.jsx(d,{children:"Recording Name"}),e.jsx(d,{children:"Type"}),e.jsx(d,{children:"Duration"}),e.jsx(d,{children:"Audio Player"}),e.jsx(d,{children:"Date"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(be,{children:B.length===0?e.jsx(w,{children:e.jsx(i,{colSpan:6,className:"text-center text-muted-foreground",children:"No recordings found. Recordings will appear here after calls are completed."})}):B.map(s=>e.jsxs(w,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.recordingName}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: ",s.id]})]})}),e.jsx(i,{children:e.jsx(ne,{variant:"outline",children:s.type})}),e.jsx(i,{children:s.duration}),e.jsx(i,{children:e.jsx(ye,{src:`/api/recordings/${s.id}/stream`,title:s.recordingName,duration:s.duration,compact:!0,onPlay:()=>S(s.id),onPause:()=>S(null)})}),e.jsx(i,{children:new Date(s.date).toLocaleDateString()}),e.jsx(i,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>Re(s),title:"Download Recording",children:e.jsx(V,{className:"h-3 w-3"})}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>Le(s),title:"Share Recording",children:e.jsx(ze,{className:"h-3 w-3"})}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>window.open(`/recordings/${s.id}`,"_blank"),title:"View Details",children:e.jsx(He,{className:"h-3 w-3"})}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>Oe(s),title:"Delete Recording",children:e.jsx(Qe,{className:"h-3 w-3"})})]})})]},s.id))})]})})]})}),e.jsx(M,{value:"history",className:"space-y-4",children:e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsx(f,{children:"Call History"}),e.jsx(E,{children:"View completed and failed calls"})]}),e.jsx(x,{children:e.jsx("p",{className:"text-muted-foreground",children:"Call history will be displayed here."})})]})}),e.jsx(M,{value:"stats",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsxs(m,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Total Calls"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:((Z=(J=l==null?void 0:l.data)==null?void 0:J.totalCalls)==null?void 0:Z.toLocaleString())||0})})]}),e.jsxs(m,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Successful Calls"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:((W=(G=l==null?void 0:l.data)==null?void 0:G.successfulCalls)==null?void 0:W.toLocaleString())||0})})]}),e.jsxs(m,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Avg Duration"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:(X=l==null?void 0:l.data)!=null&&X.averageDuration?`${Math.floor(l.data.averageDuration/60)}:${(l.data.averageDuration%60).toString().padStart(2,"0")}`:"0:00"})})]}),e.jsxs(m,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Total Cost"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsxs("div",{className:"text-2xl font-bold",children:["$",((ee=(Y=l==null?void 0:l.data)==null?void 0:Y.totalCost)==null?void 0:ee.toFixed(2))||"0.00"]})})]}),e.jsxs(m,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Total Recordings"}),e.jsx(te,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:((ae=(se=N==null?void 0:N.pagination)==null?void 0:se.totalRecordings)==null?void 0:ae.toLocaleString())||B.length})})]})]})})]})]})})};export{$s as default};
//# sourceMappingURL=OutboundCalls-o99wP_8j.js.map
