import{j as e,S as _,a5 as H,ba as D,bx as A,b$ as O}from"./ui-D0JisYOU.js";import{r}from"./vendor-D6QveUxv.js";import{u as z,b as f,c as L}from"./query-CXvbhbrr.js";import{P as V}from"./Page-CMDChCTT.js";import{H as W}from"./Header-IreCODSI.js";import{j as l,t as m,C as N,l as k,n as q,o as T,k as C,v,B as w,L as x,y as G,z as J,A as X,E as Y,F as Z,I as E,T as ee}from"./index-D9y2aYC5.js";import{C as se}from"./checkbox-wAkmhRxN.js";import{P as ae}from"./PermissionRoute-qlaJjYpy.js";import"./scroll-area-DyZFf7r4.js";import"./index-BZw056XW.js";import"./router-jXXg-8rg.js";import"./usePermissions-l31Jn2hQ.js";import"./Loading-_we4eg7o.js";const ie=async()=>(await l.get("/api/roles")).data,te=async()=>{const a=await l.get("/api/permissions");return a.data.data||a.data},re=async a=>{const o=await l.get(`/api/role-permissions/role/${a}`);return o.data.data||o.data},ve=()=>{const[a,o]=r.useState(null),[b,P]=r.useState([]),[h,S]=r.useState(!1),[p,K]=r.useState(""),[M,c]=r.useState(!1),[n,d]=r.useState({name:"",display_name:"",description:""}),R=z(),{data:u,isLoading:ne}=f({queryKey:["roles"],queryFn:ie}),{data:g,isLoading:le}=f({queryKey:["permissions"],queryFn:te}),{data:j,isLoading:oe}=f({queryKey:["rolePermissions",a==null?void 0:a.id],queryFn:()=>re(a.id),enabled:!!a});r.useEffect(()=>{j&&P(j.map(s=>s.permission_id))},[j]);const Q=L({mutationFn:async({roleId:s,permissionIds:i})=>{await l.post(`/api/role-permissions/role/${s}/bulk`,{permission_ids:i})},onSuccess:()=>{m.success("Role permissions updated successfully"),R.invalidateQueries({queryKey:["rolePermissions"]})},onError:s=>{var i,t;m.error(((t=(i=s.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to update permissions")}}),y=L({mutationFn:async s=>(await l.post("/api/roles",s)).data,onSuccess:()=>{m.success("Role created successfully"),R.invalidateQueries({queryKey:["roles"]}),c(!1),d({name:"",display_name:"",description:""})},onError:s=>{var i,t;m.error(((t=(i=s.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to create role")}}),$=s=>{o(s)},B=s=>{P(i=>i.includes(s)?i.filter(t=>t!==s):[...i,s])},I=async()=>{if(a){S(!0);try{await Q.mutateAsync({roleId:a.id,permissionIds:b})}finally{S(!1)}}},U=()=>{y.mutate(n)},F=(u==null?void 0:u.filter(s=>s.display_name.toLowerCase().includes(p.toLowerCase())||s.name.toLowerCase().includes(p.toLowerCase())))||[];return e.jsx(ae,{requireSuperAdmin:!0,children:e.jsxs(V,{children:[e.jsx(W,{title:"Roles & Permissions Management",buttonText:"Create Role",action:()=>c(!0),filterByName:!0,filterWord:p,onFilterChange:K,useSheet:!1,showViewToggle:!1,showFilters:!1}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-200px)]",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(N,{className:"h-full",children:[e.jsxs(k,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Roles (",F.length,")"]}),e.jsx(T,{children:"Select a role to manage its permissions"})]}),e.jsx(C,{className:"p-0",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-y-auto",children:F.map(s=>e.jsx("div",{onClick:()=>$(s),className:`p-4 border-b cursor-pointer hover:bg-gray-50 transition-colors ${(a==null?void 0:a.id)===s.id?"bg-blue-50 border-l-4 border-l-blue-500":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.display_name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(v,{variant:"outline",className:"text-xs",children:["#",s.id]}),s.is_system_role&&e.jsx(v,{variant:"secondary",className:"text-xs",children:"System"})]})]}),(a==null?void 0:a.id)===s.id&&e.jsx(H,{className:"h-5 w-5 text-blue-500"})]})},s.id))})})]})}),e.jsx("div",{className:"lg:col-span-2",children:a?e.jsxs(N,{className:"h-full",children:[e.jsx(k,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Permissions for ",a.display_name]}),e.jsx(T,{children:"Manage permissions for this role"})]}),e.jsxs(w,{onClick:I,disabled:h,className:"flex items-center gap-2",children:[h?e.jsx(A,{className:"h-4 w-4 animate-spin"}):e.jsx(O,{className:"h-4 w-4"}),h?"Updating...":"Update Permissions"]})]})}),e.jsx(C,{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-3 flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"System Permissions"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-60 overflow-y-auto",children:g==null?void 0:g.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 border rounded",children:[e.jsx(se,{id:`permission-${s.id}`,checked:b.includes(s.id),onCheckedChange:()=>B(s.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{htmlFor:`permission-${s.id}`,className:"text-sm font-medium cursor-pointer",children:s.display_name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.description}),e.jsx(v,{variant:"outline",className:"text-xs mt-1",children:s.category})]})]},s.id))})]})})]}):e.jsx(N,{className:"h-full flex items-center justify-center",children:e.jsxs(C,{className:"text-center",children:[e.jsx(_,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a Role"}),e.jsx("p",{className:"text-gray-500",children:"Choose a role from the left panel to manage its permissions."})]})})})]}),e.jsx(G,{open:M,onOpenChange:c,children:e.jsxs(J,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Create New Role"}),e.jsx(Z,{children:"Create a new role with custom permissions and access levels."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"role-name",children:"Role Name"}),e.jsx(E,{id:"role-name",placeholder:"e.g., manager",value:n.name,onChange:s=>d(i=>({...i,name:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"role-display-name",children:"Display Name"}),e.jsx(E,{id:"role-display-name",placeholder:"e.g., Manager",value:n.display_name,onChange:s=>d(i=>({...i,display_name:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"role-description",children:"Description"}),e.jsx(ee,{id:"role-description",placeholder:"Describe the role's responsibilities...",value:n.description,onChange:s=>d(i=>({...i,description:s.target.value}))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(w,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(w,{onClick:U,disabled:!n.name||!n.display_name||y.isPending,children:y.isPending?"Creating...":"Create Role"})]})]})]})})]})})};export{ve as default};
//# sourceMappingURL=Roles-1gEw0stl.js.map
