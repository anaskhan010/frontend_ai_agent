var ce=Object.defineProperty;var de=(r,c,d)=>c in r?ce(r,c,{enumerable:!0,configurable:!0,writable:!0,value:d}):r[c]=d;var I=(r,c,d)=>de(r,typeof c!="symbol"?c+"":c,d);import{j as e,aW as me,k as H,aX as ue,az as he,D as W,b4 as xe,H as fe,b1 as pe,aq as ge,au as Ne,ak as je}from"./ui-C7wuVsKo.js";import{r as l}from"./vendor-DG599jyl.js";import{M as be}from"./ModernTable-B9imemWD.js";import{P as B}from"./Page-CldTp-5P.js";import{B as p}from"./button-DAfv1lEn.js";import{B as X}from"./badge-DTmq5TA0.js";import{I as F}from"./input-qfwdyloT.js";import{L as O}from"./label-BXa85Llt.js";import{S as ye,a as we,b as Ce,d as ve,e as Pe}from"./sheet-Co2P1ukb.js";import{d as Se,e as J,u as Ae,f as Ee,h as ke}from"./contactService-DUk7iUZZ.js";import{e as K,t as o}from"./index-DMttttgJ.js";import{u as De}from"./resolvers-BzctgYTE.js";import{o as Te,c as Le,a as M}from"./index.esm-C7RSptL2.js";import{d as Ie,u as Fe}from"./router-BavLd_S0.js";import"./table-D230vnLP.js";import"./dropdown-menu-owisP8lR.js";import"./scroll-area-DnO9GNsc.js";import"./index-DUGBtJKR.js";import"./index-CyKAHSi_.js";import"./query-BI4h7QWD.js";class Ue extends l.Component{constructor(){super(...arguments);I(this,"state",{hasError:!1});I(this,"handleReset",()=>{this.setState({hasError:!1,error:void 0})});I(this,"handleReload",()=>{window.location.reload()})}static getDerivedStateFromError(d){return{hasError:!0,error:d}}componentDidCatch(d,v){console.error("ErrorBoundary caught an error:",d,v)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[400px] p-8 bg-white rounded-lg border border-red-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"âš ï¸"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md",children:"An unexpected error occurred. This might be due to a temporary issue."}),e.jsxs("div",{className:"space-x-4",children:[e.jsx(p,{onClick:this.handleReset,variant:"outline",children:"Try Again"}),e.jsx(p,{onClick:this.handleReload,variant:"default",children:"Reload Page"})]}),!1]})}):this.props.children}}const Re=Le().shape({email:M().required("Email is required").email("Email is invalid"),phoneNumber:M().required("Phone number is required"),fullName:M().required("Full name is required")}),rt=()=>{const{id:r}=Ie(),c=Fe(),[d,v]=l.useState(null),[Z,N]=l.useState([]),[A,$]=l.useState(!0),[y,j]=l.useState(!1),[z,_]=l.useState(0),[g,V]=l.useState(1),[E,k]=l.useState(0),[U,w]=l.useState(0),[b,ee]=l.useState(""),[h,D]=l.useState(null),[G,P]=l.useState(!1);l.useEffect(()=>{(()=>{const n=K.getItem("authToken")||K.getItem("token");if(console.log("ğŸ” Auth check - Token exists:",!!n),!n){console.log("âŒ No authentication token found"),o.error("Please log in to view list details"),c("/login");return}})()},[c]);const{register:R,handleSubmit:te,formState:{errors:C,isSubmitting:Q},reset:T,setValue:q}=De({resolver:Te(Re),defaultValues:{email:"",phoneNumber:"",fullName:""}}),Y=l.useCallback(async()=>{var t,n,m,x;if(r)try{$(!0);const s=new Promise((L,S)=>setTimeout(()=>S(new Error("Request timeout")),1e4)),a=Promise.all([Se(r),J(r,g,b)]),f=await Promise.race([a,s]),[i,u]=f;i&&i.success?v(i.data):(console.log("List API failed, creating minimal list info for ID:",r),v({id:parseInt(r),listName:`List ${r}`,description:"List details could not be loaded",type:"General",contactCount:0,createdAt:new Date().toISOString()})),u&&u.success?(N(u.data.contacts||[]),w(((t=u.data.pagination)==null?void 0:t.totalContacts)||0),k(((n=u.data.pagination)==null?void 0:n.totalPages)||1)):(console.log("Contacts API failed, showing empty state"),N([]),w(0),k(1))}catch(s){if(console.error("Error fetching list data:",s),(s==null?void 0:s.message)==="Request timeout")o.error("Request timed out. Please try again.");else if(((m=s==null?void 0:s.response)==null?void 0:m.status)===401){o.error("Authentication failed. Please log in again."),c("/login");return}else((x=s==null?void 0:s.response)==null?void 0:x.status)>=500?o.error("Server error. Please try again later."):console.error("Failed to fetch list details");console.log("API error, creating fallback list info for ID:",r),v({id:parseInt(r),listName:`List ${r}`,description:"Unable to load list details",type:"General",contactCount:0,createdAt:new Date().toISOString()}),N([]),w(0),k(1)}finally{$(!1)}},[r,g,b,c]);l.useCallback(async()=>{var t,n;if(r)try{const m=new Promise((a,f)=>setTimeout(()=>f(new Error("Refresh timeout")),5e3)),x=J(r,g,b),s=await Promise.race([x,m]);s&&s.success&&(N(s.data.contacts||[]),w(((t=s.data.pagination)==null?void 0:t.totalContacts)||0),k(((n=s.data.pagination)==null?void 0:n.totalPages)||1))}catch(m){console.error("Error refreshing contacts data:",m)}},[r,g,b]),l.useEffect(()=>{Y()},[Y]);const se=async t=>{var n,m,x;if(!(!r||y))try{j(!0);const s=Ee(r,{email:t.email,contact_number:t.phoneNumber,phoneNumber:t.phoneNumber,fullName:t.fullName}),a=new Promise((i,u)=>setTimeout(()=>u(new Error("Add timeout")),15e3));await Promise.race([s,a]),T(),P(!1);const f={id:Date.now(),email:t.email,phoneNumber:t.phoneNumber,fullName:t.fullName,createdAt:new Date().toISOString()};N(i=>[...i,f]),w(i=>i+1),o.success("Contact added successfully")}catch(s){console.error("Error adding contact:",s),(s==null?void 0:s.message)==="Add timeout"?o.error("Add timed out. Please check if the contact was added and try again."):((n=s==null?void 0:s.response)==null?void 0:n.status)===401?o.error("Authentication failed. Please log in again."):(x=(m=s==null?void 0:s.response)==null?void 0:m.data)!=null&&x.error?o.error(`Add failed: ${s.response.data.error}`):o.error("Failed to add contact")}finally{j(!1)}},ae=t=>{console.log("ğŸ”„ handleEditContact called",{contact:t}),setTimeout(()=>{D(t),q("email",t.email),q("phoneNumber",t.phoneNumber),q("fullName",t.fullName||"")},100)},re=async t=>{var m,x,s;if(console.log("ğŸ”„ handleUpdateContact called",{editingContact:h,data:t,operationLoading:y}),!h||y){console.log("âŒ Update blocked:",{editingContact:!!h,operationLoading:y});return}const n=Date.now();if(n-z<1e3){o.error("Please wait a moment before performing another operation");return}_(n);try{console.log("âœ… Starting update operation for contact:",h.id),j(!0);const a=Ae(h.id.toString(),{email:t.email,phoneNumber:t.phoneNumber,fullName:t.fullName}),f=new Promise((u,L)=>setTimeout(()=>L(new Error("Update timeout")),15e3));await Promise.race([a,f]),console.log("âœ… Update API call successful");const i=h.id;console.log("ğŸ”„ Updating local state for contact:",i),N(u=>{const L=u.map(S=>S.id===i?{...S,...t}:S);return console.log("âœ… Local state updated successfully"),L}),T(),D(null),console.log("âœ… Form reset and editing contact cleared"),o.success("Contact updated successfully")}catch(a){console.error("Error updating contact:",a),(a==null?void 0:a.message)==="Update timeout"?o.error("Update timed out. Please check if the contact was updated and try again."):((m=a==null?void 0:a.response)==null?void 0:m.status)===401?o.error("Authentication failed. Please log in again."):(s=(x=a==null?void 0:a.response)==null?void 0:x.data)!=null&&s.error?o.error(`Update failed: ${a.response.data.error}`):o.error("Failed to update contact");try{j(!1)}catch(f){console.error("Error resetting operation state:",f),window.location.reload()}}finally{try{j(!1)}catch(a){console.error("Critical error in finally block:",a)}}},ne=async t=>{var m,x,s;if(!confirm("Are you sure you want to delete this contact?")||y)return;const n=Date.now();if(n-z<1e3){o.error("Please wait a moment before performing another operation");return}_(n);try{j(!0);const a=ke(t.toString()),f=new Promise((i,u)=>setTimeout(()=>u(new Error("Delete timeout")),15e3));await Promise.race([a,f]),N(i=>i.filter(u=>u.id!==t)),w(i=>Math.max(0,i-1)),o.success("Contact deleted successfully")}catch(a){console.error("Error deleting contact:",a),(a==null?void 0:a.message)==="Delete timeout"?o.error("Delete timed out. Please check if the contact was deleted and try again."):((m=a==null?void 0:a.response)==null?void 0:m.status)===401?o.error("Authentication failed. Please log in again."):(s=(x=a==null?void 0:a.response)==null?void 0:x.data)!=null&&s.error?o.error(`Delete failed: ${a.response.data.error}`):o.error("Failed to delete contact")}finally{j(!1)}},oe=t=>{const n=new Date(t);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(n)},ie=t=>{switch(t){case"Marketing":return"default";case"Sales":return"secondary";case"Event":return"outline";case"Customer":return"destructive";default:return"default"}},le=[{label:"Edit Contact",icon:e.jsx(fe,{className:"h-4 w-4"}),onClick:ae},{label:"Delete Contact",icon:e.jsx(pe,{className:"h-4 w-4"}),onClick:t=>ne(t.id)}];return A&&!d?e.jsx(B,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading list details..."})]})})}):d?e.jsx(Ue,{children:e.jsxs(B,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>c("/lists"),className:"flex items-center space-x-2",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{children:"Back to Lists"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:d.listName}),e.jsx("p",{className:"text-gray-600",children:d.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[y&&e.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm",children:"Processing..."})]}),e.jsx(X,{variant:ie(d.type),className:"capitalize",children:d.type}),e.jsxs(X,{variant:"secondary",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),U," Contacts"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(F,{placeholder:"Search contacts...",value:b,onChange:t=>ee(t.target.value),className:"w-full"})}),e.jsxs(ye,{open:G||!!h,onOpenChange:t=>{console.log("ğŸ”„ Sheet onOpenChange",{open:t,isAddingContact:G,editingContact:!!h}),t||(P(!1),D(null),T())},children:[e.jsx(we,{asChild:!0,children:e.jsxs(p,{onClick:()=>P(!0),className:"flex items-center space-x-2",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Contact"})]})}),e.jsxs(Ce,{size:"md",onOpenAutoFocus:t=>{t.preventDefault()},onCloseAutoFocus:t=>{t.preventDefault()},children:[e.jsx(ve,{children:h?"Edit Contact":"Add New Contact"}),e.jsx(Pe,{children:h?"Update the contact information below.":"Add a new contact to this list."}),e.jsxs("form",{onSubmit:te(h?re:se),className:"space-y-4 mt-6",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"fullName",children:"Full Name *"}),e.jsx(F,{id:"fullName",placeholder:"Enter full name",...R("fullName")}),C.fullName&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:C.fullName.message})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"email",children:"Email *"}),e.jsx(F,{id:"email",type:"email",placeholder:"Enter email address",...R("email")}),C.email&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:C.email.message})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"phoneNumber",children:"Phone Number *"}),e.jsx(F,{id:"phoneNumber",placeholder:"Enter phone number",...R("phoneNumber")}),C.phoneNumber&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:C.phoneNumber.message})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>{P(!1),D(null),T()},children:"Cancel"}),e.jsx(p,{type:"submit",disabled:Q,children:Q?h?"Updating...":"Adding...":h?"Update Contact":"Add Contact"})]})]})]})]})]}),e.jsx(be,{data:Z,isSelectable:!0,showColumnSelection:!0,columns:[{header:"Contact",accessor:"email",className:"min-w-[250px]",cell:(t,n)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-9 w-9 bg-gradient-to-br from-primary/20 to-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ge,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:n.fullName?`${n.fullName}`:"No Name"}),e.jsx("div",{className:"text-sm text-gray-500",children:String(t)})]})]}),sortable:!0},{header:"Phone Number",accessor:"phoneNumber",className:"min-w-[150px]",cell:t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:String(t)})]}),sortable:!0},{header:"Added",accessor:"createdAt",className:"min-w-[150px]",cell:t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-700",children:oe(String(t))})]}),sortable:!0}],actions:le,emptyState:e.jsxs("div",{className:"text-center p-12",children:[e.jsx("div",{className:"h-20 w-20 bg-gradient-to-br from-primary/20 to-primary/10 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(xe,{className:"h-10 w-10 text-primary"})}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:A?"Loading contacts...":"No contacts"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:A?"Please wait while we fetch the contacts":b?"No contacts match your search criteria.":"This list is empty. Add your first contact to get started."}),!A&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(p,{onClick:()=>P(!0),className:"flex items-center space-x-2 px-6 py-3",size:"lg",children:[e.jsx(W,{className:"h-5 w-5"}),e.jsx("span",{children:"Add Contact"})]}),!b&&e.jsx("p",{className:"text-xs text-gray-400",children:"You can add contacts manually or import them from a CSV file"})]})]})}),E>1&&e.jsx("div",{className:"mt-8 border-t border-gray-200 pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(g-1)*10+1," to ",Math.min(g*10,U)," of ",U," contacts"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>V(t=>Math.max(1,t-1)),disabled:g===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",g," of ",E]}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>V(t=>Math.min(E,t+1)),disabled:g===E,children:"Next"})]})]})})]})}):e.jsx(B,{children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"h-16 w-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(me,{className:"h-8 w-8 text-red-500"})}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"List not found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"The requested list could not be found. This might be due to:"}),e.jsxs("ul",{className:"text-sm text-gray-500 mb-6 text-left max-w-md mx-auto",children:[e.jsx("li",{children:"â€¢ The list may have been deleted"}),e.jsx("li",{children:"â€¢ You may not have permission to view this list"}),e.jsx("li",{children:"â€¢ There may be a connection issue"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(p,{onClick:()=>c("/lists"),variant:"outline",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Back to Lists"]}),e.jsxs(p,{onClick:()=>window.location.reload(),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Retry"]})]})]})})};export{rt as default};
//# sourceMappingURL=ListDetails-Dg0Rjark.js.map
