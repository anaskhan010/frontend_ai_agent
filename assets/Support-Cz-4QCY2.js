import{j as e,ao as q,F as De,aW as be,ai as ye,bj as Ae,b as Fe,b5 as qe,ak as ve,C as ee,K as Me,aG as Z,bg as $e,aU as he,D as Ie,y as Oe,H as Ue,b1 as Ee,e as ge,aV as Ve}from"./ui-CNbESIMS.js";import{r as h}from"./vendor-DG599jyl.js";import{u as Qe,c as Re}from"./router-BavLd_S0.js";import{M as Le}from"./ModernTable-BXdElgiq.js";import{H as Ke}from"./Header-_7JnCJSB.js";import{P as fe}from"./Page-B106cZ-W.js";import{u as Be}from"./resolvers-BzctgYTE.js";import{o as ze,c as Ge,b as He,a as U}from"./index.esm-C7RSptL2.js";import{B as D}from"./button-BpHONB4D.js";import{I as je}from"./input-DOIJ2OtM.js";import{L as $}from"./label-DkC73-VZ.js";import{T as We}from"./textarea-BUHDDiup.js";import{d as Xe,e as Je,f as Ye}from"./sheet-C1SMzTQ8.js";import{S as E,a as V,b as Q,c as R,d as _}from"./select-CSg3IHkG.js";import{u as Ne,b as we,c as se}from"./query-DFkYe0MV.js";import{g as Ze,c as es,a as ss,d as ts,u as as}from"./supportService-BNTfrmTT.js";import{t as I,u as rs}from"./index-m2-1zBbl.js";import{B as g}from"./badge-DO_1G0Ng.js";import{A as ls,a as is}from"./avatar-NIDa_0ed.js";import{D as te,a as ae,b as re,e as le}from"./dropdown-menu-B0-iA4d2.js";import{P as ns,a as cs,b as os}from"./popover-D-5n613e.js";import{A as ds,a as us,b as ms,c as xs,d as ps,e as hs,f as gs,g as fs}from"./alert-dialog-SEQAZiDA.js";import"./table-C7swbe4_.js";import"./scroll-area-CQNQHAmm.js";import"./index-DklBfCbe.js";import"./index-U78YeT7B.js";import"./index-HDeFwIcs.js";import"./client-2idf8d8P.js";const js=Ge().shape({title:U().required("Title is required").min(5,"Title must be at least 5 characters").max(500,"Title cannot exceed 500 characters"),description:U().required("Description is required").min(10,"Description must be at least 10 characters"),category:U().required("Category is required"),priority:U().required("Priority is required"),tags:He().of(U().required()).optional()});function bs(){const j=h.useRef(null),i=h.useRef(null),[b,p]=h.useState(""),[f,w]=h.useState([]),C=Ne(),{data:y}=we({queryKey:["supportCategories"],queryFn:Ze}),v=(y==null?void 0:y.data)||[],{register:x,handleSubmit:A,formState:{errors:d,isSubmitting:N},reset:S,setValue:a,watch:c}=Be({resolver:ze(js),defaultValues:{category:"general",priority:"medium",tags:[]}}),t=se({mutationFn:es,onSuccess:r=>{I.success("Support ticket created successfully!"),C.invalidateQueries({queryKey:["supportTickets"]}),S(),w([]),p(""),setTimeout(()=>{var o;(o=i.current)==null||o.click()},100)},onError:r=>{I.error(r.message||"Failed to create support ticket")}}),u=async r=>{try{const o={...r,tags:f};await t.mutateAsync(o)}catch(o){console.error("Error submitting form:",o)}},T=r=>{(r.key==="Enter"||r.key===",")&&(r.preventDefault(),O())},O=()=>{const r=b.trim();if(r&&!f.includes(r)){const o=[...f,r];w(o),a("tags",o),p("")}},L=r=>{const o=f.filter(M=>M!==r);w(o),a("tags",o)},z=()=>{var r;(r=j.current)==null||r.click()},P=[{value:"low",label:"Low",color:"text-green-600"},{value:"medium",label:"Medium",color:"text-yellow-600"},{value:"high",label:"High",color:"text-orange-600"},{value:"urgent",label:"Urgent",color:"text-red-600"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(Xe,{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"h-5 w-5 text-primary"}),e.jsx("span",{children:"Create Support Ticket"})]}),e.jsx(Je,{children:"Submit a new support ticket and we'll get back to you as soon as possible."})]}),e.jsxs("form",{onSubmit:A(u),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(De,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-sm font-medium",children:"Ticket Information"})]}),e.jsxs("div",{children:[e.jsxs($,{htmlFor:"title",className:"text-sm font-medium text-foreground mb-1.5 block",children:["Title",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(je,{id:"title",placeholder:"Brief description of your issue",className:"w-full border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20",...x("title")}),d.title&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:d.title.message})]}),e.jsxs("div",{children:[e.jsxs($,{htmlFor:"description",className:"text-sm font-medium text-foreground mb-1.5 block",children:["Description",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(We,{id:"description",placeholder:"Please provide detailed information about your issue...",rows:6,className:"w-full border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20 resize-none",...x("description")}),d.description&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:d.description.message})]}),e.jsxs("div",{children:[e.jsxs($,{htmlFor:"category",className:"text-sm font-medium text-foreground mb-1.5 block",children:["Category",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(E,{onValueChange:r=>a("category",r),defaultValue:"general",children:[e.jsx(V,{className:"w-full border-border/50 bg-card focus:border-primary/50",children:e.jsx(Q,{placeholder:"Select a category"})}),e.jsx(R,{children:v.map(r=>e.jsx(_,{value:r.category_id,children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{children:r.name})})},r.category_id))})]}),d.category&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:d.category.message})]}),e.jsxs("div",{children:[e.jsxs($,{htmlFor:"priority",className:"text-sm font-medium text-foreground mb-1.5 block",children:["Priority",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(E,{onValueChange:r=>a("priority",r),defaultValue:"medium",children:[e.jsx(V,{className:"w-full border-border/50 bg-card focus:border-primary/50",children:e.jsx(Q,{placeholder:"Select priority level"})}),e.jsx(R,{children:P.map(r=>e.jsx(_,{value:r.value,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:`h-4 w-4 ${r.color}`}),e.jsx("span",{children:r.label})]})},r.value))})]}),d.priority&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:d.priority.message})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"tags",className:"text-sm font-medium text-foreground mb-1.5 block",children:"Tags (Optional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(je,{value:b,onChange:r=>p(r.target.value),onKeyPress:T,placeholder:"Add tags (press Enter or comma to add)",className:"w-full pl-10 border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20"})]}),e.jsx(D,{type:"button",variant:"outline",size:"sm",onClick:O,disabled:!b.trim(),children:"Add"})]}),f.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:f.map((r,o)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-primary/10 text-primary border border-primary/20",children:[r,e.jsx("button",{type:"button",onClick:()=>L(r),className:"ml-1 text-primary/60 hover:text-primary",children:"×"})]},o))})]})]}),e.jsxs("div",{children:[e.jsx($,{className:"text-sm font-medium text-foreground mb-1.5 block",children:"Attachments (Optional)"}),e.jsxs("div",{onClick:z,className:"border-2 border-dashed border-border/50 rounded-lg p-4 text-center cursor-pointer hover:border-primary/50 transition-colors",children:[e.jsx(Ae,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to attach files or drag and drop"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Supported formats: PDF, DOC, DOCX, TXT, PNG, JPG (Max 10MB)"})]}),e.jsx("input",{ref:j,type:"file",multiple:!0,accept:".pdf,.doc,.docx,.txt,.png,.jpg,.jpeg",className:"hidden",onChange:r=>{console.log("Files selected:",r.target.files)}})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-border/50",children:[e.jsx(Ye,{asChild:!0,children:e.jsx(D,{ref:i,type:"button",variant:"outline",className:"border-border/50 hover:bg-secondary/80",children:"Cancel"})}),e.jsx(D,{type:"submit",disabled:N||t.isPending,className:"bg-primary hover:bg-primary/90 text-primary-foreground",children:N||t.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Create Ticket"]})})]})]})]})}const ys=({data:j,onItemClick:i,actions:b,getStatusBadgeVariant:p,getPriorityBadgeVariant:f,getCategoryBadgeVariant:w,getStatusIcon:C,formatDate:y,isSuperAdmin:v=!1,onStatusUpdate:x,isUpdatingStatus:A=!1})=>{const d=(a,c)=>a.length<=c?a:a.substring(0,c)+"...",N=a=>`#${a.slice(-8).toUpperCase()}`,S=({ticket:a})=>{const c=t=>[{value:"open",label:"Open",disabled:!1},{value:"in_progress",label:"Under Process",disabled:!1},{value:"waiting_response",label:"Waiting Response",disabled:!1},{value:"resolved",label:"Complete",disabled:!1},{value:"closed",label:"Closed",disabled:!1}].filter(T=>T.value!==t);return e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsx("div",{className:"cursor-pointer",onClick:t=>t.stopPropagation(),children:e.jsxs(g,{variant:p(a.status),className:"flex items-center gap-1",children:[C(a.status),a.status==="in_progress"?"Under Process":a.status==="resolved"?"Complete":a.status.replace("_"," ")]})})}),e.jsx(re,{align:"start",className:"w-48",children:c(a.status).map(t=>e.jsx(le,{onClick:u=>{u.stopPropagation(),x==null||x(a.ticket_id,t.value)},disabled:A,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[C(t.value),e.jsx("span",{children:t.label})]})},t.value))})]})};return j.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"h-16 w-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(q,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"No support tickets found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by creating your first support ticket"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map(a=>e.jsxs("div",{className:"bg-card border border-border/50 rounded-lg p-6 hover:shadow-md transition-all duration-200 cursor-pointer group",onClick:()=>i(a),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-10 w-10 bg-gradient-to-br from-primary/20 to-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(q,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground line-clamp-1",children:d(a.title,30)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:N(a.ticket_id)})]})]}),e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:c=>c.stopPropagation(),children:e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsx(re,{align:"end",className:"w-48",children:b.map((c,t)=>e.jsxs(le,{onClick:u=>{u.stopPropagation(),c.onClick(a)},className:c.variant==="destructive"?"text-red-600 focus:text-red-600":"",children:[c.icon,e.jsx("span",{className:"ml-2",children:c.label})]},t))})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:d(a.description,100)}),e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[v?e.jsx(S,{ticket:a}):e.jsxs(g,{variant:p(a.status),className:"flex items-center gap-1",children:[C(a.status),a.status==="in_progress"?"Under Process":a.status==="resolved"?"Complete":a.status.replace("_"," ")]}),e.jsx(g,{variant:f(a.priority),children:a.priority.toUpperCase()}),e.jsx(g,{variant:w(a.category),children:a.category.replace("_"," ")})]}),a.tags&&a.tags.length>0&&e.jsxs("div",{className:"flex items-center space-x-1 mb-4",children:[e.jsx(ye,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.tags.slice(0,2).map((c,t)=>e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-secondary text-secondary-foreground",children:c},t)),a.tags.length>2&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",a.tags.length-2," more"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground pt-4 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(qe,{className:"h-3 w-3"}),e.jsx("span",{children:a.message_count})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ve,{className:"h-3 w-3"}),e.jsx("span",{children:y(a.created_at)})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ee,{className:"h-3 w-3"}),e.jsx("span",{children:y(a.updated_at)})]})]})]},a.id))})},vs=({onFilterChange:j})=>{var S,a,c;const[i,b]=h.useState({}),[p,f]=h.useState(!1),w=[{value:"open",label:"Open"},{value:"in_progress",label:"In Progress"},{value:"waiting_response",label:"Waiting Response"},{value:"resolved",label:"Resolved"},{value:"closed",label:"Closed"}],C=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"urgent",label:"Urgent"}],y=[{value:"technical",label:"Technical Support"},{value:"billing",label:"Billing & Payments"},{value:"feature_request",label:"Feature Request"},{value:"bug_report",label:"Bug Report"},{value:"general",label:"General Inquiry"}],v=(t,u)=>{const T={...i};u?T[t]=u:delete T[t],b(T)},x=()=>{j(i),f(!1)},A=()=>{b({}),j({})},d=Object.keys(i).length>0,N=Object.keys(i).length;return e.jsxs(ns,{open:p,onOpenChange:f,children:[e.jsx(cs,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",className:"relative border-border/50 hover:bg-secondary/80",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Filters",N>0&&e.jsx(g,{variant:"secondary",className:"ml-2 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs",children:N})]})}),e.jsx(os,{className:"w-80 p-4",align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Filter Tickets"}),d&&e.jsx(D,{variant:"ghost",size:"sm",onClick:A,className:"h-auto p-1 text-xs text-muted-foreground hover:text-foreground",children:"Clear all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Status"}),e.jsxs(E,{value:i.status||"",onValueChange:t=>v("status",t==="all"?void 0:t),children:[e.jsx(V,{className:"w-full border-border/50 bg-card",children:e.jsx(Q,{placeholder:"All statuses"})}),e.jsxs(R,{children:[e.jsx(_,{value:"all",children:"All statuses"}),w.map(t=>e.jsx(_,{value:t.value,children:t.label},t.value))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Priority"}),e.jsxs(E,{value:i.priority||"",onValueChange:t=>v("priority",t==="all"?void 0:t),children:[e.jsx(V,{className:"w-full border-border/50 bg-card",children:e.jsx(Q,{placeholder:"All priorities"})}),e.jsxs(R,{children:[e.jsx(_,{value:"all",children:"All priorities"}),C.map(t=>e.jsx(_,{value:t.value,children:t.label},t.value))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Category"}),e.jsxs(E,{value:i.category||"",onValueChange:t=>v("category",t==="all"?void 0:t),children:[e.jsx(V,{className:"w-full border-border/50 bg-card",children:e.jsx(Q,{placeholder:"All categories"})}),e.jsxs(R,{children:[e.jsx(_,{value:"all",children:"All categories"}),y.map(t=>e.jsx(_,{value:t.value,children:t.label},t.value))]})]})]}),d&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Active Filters"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.status&&e.jsxs(g,{variant:"secondary",className:"text-xs",children:["Status: ",(S=w.find(t=>t.value===i.status))==null?void 0:S.label,e.jsx("button",{onClick:()=>v("status",void 0),className:"ml-1 hover:text-foreground",children:e.jsx(Z,{className:"h-3 w-3"})})]}),i.priority&&e.jsxs(g,{variant:"secondary",className:"text-xs",children:["Priority: ",(a=C.find(t=>t.value===i.priority))==null?void 0:a.label,e.jsx("button",{onClick:()=>v("priority",void 0),className:"ml-1 hover:text-foreground",children:e.jsx(Z,{className:"h-3 w-3"})})]}),i.category&&e.jsxs(g,{variant:"secondary",className:"text-xs",children:["Category: ",(c=y.find(t=>t.value===i.category))==null?void 0:c.label,e.jsx("button",{onClick:()=>v("category",void 0),className:"ml-1 hover:text-foreground",children:e.jsx(Z,{className:"h-3 w-3"})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 pt-2 border-t border-border/50",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>f(!1),className:"border-border/50",children:"Cancel"}),e.jsxs(D,{size:"sm",onClick:x,className:"bg-primary hover:bg-primary/90",children:[e.jsx($e,{className:"h-4 w-4 mr-1"}),"Apply"]})]})]})})]})},Xs=()=>{var de,ue,me;const j=Qe(),[i,b]=Re(),[p,f]=h.useState(i.get("search")||""),[w,C]=h.useState(p),[y,v]=h.useState(i.get("view")==="grid"?"grid":"list"),[x,A]=h.useState({}),[d,N]=h.useState(null),[S,a]=h.useState(!1),[c,t]=h.useState(!1),u=Ne(),{login:T,isLoggedIn:O}=rs(),L=parseInt(i.get("page")||"1"),z=10;h.useEffect(()=>{!O&&!c&&!S&&t(!0)},[O,c,S]),h.useEffect(()=>{const s=setTimeout(()=>{f(w)},300);return()=>clearTimeout(s)},[w]),h.useEffect(()=>{const s=new URLSearchParams(i);p?s.set("search",p):s.delete("search"),s.set("page","1"),b(s)},[p,b]);const{data:P,isLoading:r,error:o,refetch:M}=we({queryKey:["supportTickets",p,x,L],queryFn:()=>ss({search:p,...x,page:L,limit:z}),staleTime:1*60*1e3,gcTime:3*60*1e3,placeholderData:s=>s}),G=se({mutationFn:ts,onSuccess:()=>{I.success("Support ticket deleted successfully"),u.invalidateQueries({queryKey:["supportTickets"]}),N(null)},onError:s=>{I.error(s.message||"Failed to delete support ticket"),N(null)}}),H=se({mutationFn:({ticketId:s,status:l})=>as(s,{status:l}),onMutate:async({ticketId:s,status:l})=>{console.log(`🔄 Starting optimistic update for ticket ${s} to status ${l}`),await u.cancelQueries({queryKey:["supportTickets"]});const m=u.getQueriesData({queryKey:["supportTickets"]}),k=u.getQueriesData({queryKey:["supportTickets"]});return console.log("🔍 All support ticket queries:",k.map(([n])=>n)),u.setQueriesData({queryKey:["supportTickets"]},n=>{var pe;if(console.log("🔍 Processing query data:",{hasData:!!(n!=null&&n.data),dataLength:(pe=n==null?void 0:n.data)==null?void 0:pe.length,dataType:typeof(n==null?void 0:n.data)}),!(n!=null&&n.data))return console.log("❌ No data found for optimistic update"),n;const Y=n.data.findIndex(F=>F.ticket_id===s);if(console.log(`🎯 Found ticket at index ${Y} for ID ${s}`),Y===-1)return console.log("❌ Ticket not found in current data"),n;console.log(`✅ Optimistically updating ticket ${s} status from ${n.data[Y].status} to ${l}`);const xe={...n,data:n.data.map(F=>F.ticket_id===s?{...F,status:l,updated_at:new Date().toISOString()}:F)};return console.log("📊 Updated ticket:",xe.data.find(F=>F.ticket_id===s)),xe}),{previousData:m}},onSuccess:(s,l)=>{console.log(`✅ Status update successful for ticket ${l.ticketId}`),I.success("Ticket status updated successfully"),u.invalidateQueries({queryKey:["supportTickets"]}),M(),setTimeout(()=>{j("/support")},1500)},onError:(s,l,m)=>{console.log(`❌ Status update failed for ticket ${l.ticketId}:`,s),I.error(s.message||"Failed to update ticket status"),m!=null&&m.previousData&&m.previousData.forEach(([k,n])=>{u.setQueryData(k,n)})},onSettled:()=>{console.log("🏁 Mutation settled - refreshing data"),u.invalidateQueries({queryKey:["supportTickets"]}),M()}}),W=(P==null?void 0:P.data)||[],K=(P==null?void 0:P.is_super_admin)||!1,Ce=s=>{C(s)},Se=s=>{v(s);const l=new URLSearchParams(i);l.set("view",s),b(l)},ke=s=>{A(s);const l=new URLSearchParams(i);l.set("page","1"),b(l)},Te=s=>{N(s)},ie=(s,l)=>{console.log(`🚀 Initiating status update for ticket ${s} to ${l}`),H.mutate({ticketId:s,status:l}),setTimeout(()=>{console.log("🔄 Triggering immediate refresh after status update"),M()},500)},Pe=()=>{d&&G.mutate(d)},X=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),_e=({ticket:s})=>{const l=m=>[{value:"open",label:"Open",disabled:!1},{value:"in_progress",label:"Under Process",disabled:!1},{value:"waiting_response",label:"Waiting Response",disabled:!1},{value:"resolved",label:"Complete",disabled:!1},{value:"closed",label:"Closed",disabled:!1}].filter(n=>n.value!==m);return e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsx("div",{className:"cursor-pointer",onClick:m=>m.stopPropagation(),children:e.jsxs(g,{variant:J(s.status),className:"flex items-center gap-1",children:[B(s.status),s.status==="in_progress"?"Under Process":s.status==="resolved"?"Complete":s.status.replace("_"," ")]})})}),e.jsx(re,{align:"start",className:"w-48",children:l(s.status).map(m=>e.jsx(le,{onClick:k=>{k.stopPropagation(),ie(s.ticket_id,m.value)},disabled:H.isPending,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[B(m.value),e.jsx("span",{children:m.label})]})},m.value))})]})},J=s=>{switch(s){case"open":return"default";case"in_progress":return"secondary";case"waiting_response":return"outline";case"resolved":return"success";case"closed":return"destructive";default:return"default"}},ne=s=>{switch(s){case"low":return"secondary";case"medium":return"default";case"high":return"destructive";case"urgent":return"destructive";default:return"default"}},ce=s=>{switch(s){case"technical":return"default";case"billing":return"secondary";case"feature_request":return"outline";case"bug_report":return"destructive";case"general":return"secondary";default:return"default"}},B=s=>{switch(s){case"open":return e.jsx(ge,{className:"h-3 w-3"});case"in_progress":return e.jsx(ee,{className:"h-3 w-3"});case"waiting_response":return e.jsx(be,{className:"h-3 w-3"});case"resolved":return e.jsx(Ve,{className:"h-3 w-3"});case"closed":return e.jsx(he,{className:"h-3 w-3"});default:return e.jsx(ge,{className:"h-3 w-3"})}};if(o){const s=((de=o.message)==null?void 0:de.includes("token"))||((ue=o.message)==null?void 0:ue.includes("authentication"))||((me=o.message)==null?void 0:me.includes("unauthorized"));return e.jsx(fe,{children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"h-16 w-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(he,{className:"h-8 w-8 text-red-600"})}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"Error loading support tickets"}),e.jsx("p",{className:"text-gray-500 mb-4",children:o.message||"Something went wrong"}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:e.jsx("button",{className:"bg-primary px-4 py-2 rounded-md text-white hover:bg-primary/90 transition-colors",onClick:()=>M(),disabled:S,children:"Try Again"})}),s&&e.jsx("p",{className:"text-sm text-gray-400 mt-3",children:"It looks like you're not authenticated. Try the demo login to access support tickets."})]})})}const oe=[{label:"View Details",icon:e.jsx(Oe,{className:"h-4 w-4"}),onClick:s=>{j(`/support/ticket/${s.ticket_id}`)}},{label:"Edit Ticket",icon:e.jsx(Ue,{className:"h-4 w-4"}),onClick:s=>{console.log("Editing ticket",s.ticket_id)}},{label:"Delete Ticket",icon:e.jsx(Ee,{className:"h-4 w-4"}),onClick:s=>Te(s.ticket_id),variant:"destructive"}];return e.jsxs(fe,{children:[e.jsx(Ke,{title:"Support Center",buttonText:"New Ticket",filterByName:!0,filterWord:p,onFilterChange:Ce,useSheet:!0,sheetContent:e.jsx(bs,{}),viewMode:y,onViewModeChange:Se,showViewToggle:!0,showFilters:!1}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(g,{variant:"secondary",className:"px-3 py-1",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),e.jsxs("span",{children:[W.length," Tickets"]})]}),x.status&&e.jsxs(g,{variant:"outline",className:"px-3 py-1",children:["Status: ",x.status]}),x.priority&&e.jsxs(g,{variant:"outline",className:"px-3 py-1",children:["Priority: ",x.priority]}),x.category&&e.jsxs(g,{variant:"outline",className:"px-3 py-1",children:["Category: ",x.category]})]}),e.jsx(vs,{onFilterChange:ke})]}),y==="list"?e.jsx(Le,{data:W,isLoading:r,isSelectable:!0,showColumnSelection:!0,onRowClick:s=>j(`/support/ticket/${s.ticket_id}`),columns:[{header:"Ticket",accessor:"title",className:"min-w-[300px]",cell:(s,l)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-9 w-9 bg-gradient-to-br from-primary/20 to-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(q,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 line-clamp-1",children:String(s)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["#",String(l.ticket_id).slice(-8).toUpperCase()]})]})]}),sortable:!0},...K?[{header:"User",accessor:"user_email",className:"min-w-[200px]",cell:(s,l)=>{var m,k;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ls,{className:"h-8 w-8",children:e.jsxs(is,{className:"text-xs",children:[(m=l.user_first_name)==null?void 0:m.charAt(0),(k=l.user_last_name)==null?void 0:k.charAt(0)]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 text-sm",children:[l.user_first_name," ",l.user_last_name]}),e.jsx("div",{className:"text-xs text-gray-500",children:String(s)})]})]})},sortable:!0}]:[],{header:"Status",accessor:"status",className:"min-w-[120px]",cell:(s,l)=>K?e.jsx(_e,{ticket:l}):e.jsxs(g,{variant:J(String(s)),className:"flex items-center gap-1",children:[B(String(s)),String(s)==="in_progress"?"Under Process":String(s)==="resolved"?"Complete":String(s).replace("_"," ")]}),sortable:!0},{header:"Priority",accessor:"priority",className:"min-w-[100px]",cell:s=>e.jsx(g,{variant:ne(String(s)),children:String(s).toUpperCase()}),sortable:!0},{header:"Category",accessor:"category",className:"min-w-[120px]",cell:s=>e.jsx(g,{variant:ce(String(s)),children:String(s).replace("_"," ")}),sortable:!0},{header:"Description",accessor:"description",className:"min-w-[200px]",cell:s=>e.jsx("div",{className:"max-w-xs",children:e.jsx("span",{className:"text-sm text-gray-600 line-clamp-2",children:String(s).length>100?`${String(s).substring(0,100)}...`:String(s)})}),sortable:!0},{header:"Created",accessor:"created_at",className:"min-w-[120px]",cell:s=>e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ve,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:X(String(s))})]}),sortable:!0},{header:"Updated",accessor:"updated_at",className:"min-w-[120px]",cell:s=>e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ee,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:X(String(s))})]}),sortable:!0}],actions:oe,emptyState:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"h-16 w-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(q,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"No support tickets found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by creating your first support ticket"}),e.jsxs("button",{className:"bg-primary px-4 py-2 rounded-md text-white flex items-center justify-center mx-auto",onClick:()=>console.log("Create support ticket"),children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Create Ticket"]})]})}):e.jsx(ys,{data:W,onItemClick:s=>j(`/support/ticket/${s.ticket_id}`),actions:oe,getStatusBadgeVariant:J,getPriorityBadgeVariant:ne,getCategoryBadgeVariant:ce,getStatusIcon:B,formatDate:X,isSuperAdmin:K,onStatusUpdate:ie,isUpdatingStatus:H.isPending}),e.jsx(ds,{open:!!d,onOpenChange:()=>N(null),children:e.jsxs(us,{children:[e.jsxs(ms,{children:[e.jsx(xs,{children:"Delete Support Ticket"}),e.jsx(ps,{children:"Are you sure you want to delete this support ticket? This action cannot be undone."})]}),e.jsxs(hs,{children:[e.jsx(gs,{children:"Cancel"}),e.jsx(fs,{onClick:Pe,className:"bg-red-600 hover:bg-red-700",disabled:G.isPending,children:G.isPending?"Deleting...":"Delete"})]})]})})]})};export{Xs as default};
//# sourceMappingURL=Support-Cz-4QCY2.js.map
