import{j as e,aK as T,bd as O,a3 as R,by as $,c6 as A,aA as V,bs as j,br as g,bt as _,a$ as z,a1 as F}from"./ui-D0JisYOU.js";import{r as n}from"./vendor-D6QveUxv.js";import{y as q,z as H,A as K,E as G,F as J,j as Q,t as E,C as N,k as C,B as v,l as W,n as X,v as P}from"./index-pyURvRiW.js";import{P as Y}from"./PurchaseCreditsModal-GOeXWX-S.js";import{u as Z}from"./router-jXXg-8rg.js";const ee=({isOpen:m,onClose:l})=>{const h=[{category:"AI Cruitment Portal Services",functions:[{icon:e.jsx(O,{className:"h-4 w-4 text-blue-500"}),name:"AI CRUITMENT Assistant Call",incoming:"1 Credit / Call + 0.5 Credits / Minute",outgoing:"1 Credit / Call + 0.5 Credits / Minute"},{icon:e.jsx(R,{className:"h-4 w-4 text-blue-500"}),name:"Outbound Call",incoming:"-",outgoing:"1 Credit / Call + 0.5 Credits / Minute"},{icon:e.jsx($,{className:"h-4 w-4 text-green-500"}),name:"Buy Phone Number",incoming:"-",outgoing:"5 Credits / Phone Number"},{icon:e.jsx(A,{className:"h-4 w-4 text-purple-500"}),name:"Campaign Creation",incoming:"-",outgoing:"2 Credits / Campaign"},{icon:e.jsx(A,{className:"h-4 w-4 text-purple-500"}),name:"Campaign Launch",incoming:"-",outgoing:"3 Credits / Campaign Launch"},{icon:e.jsx(V,{className:"h-4 w-4 text-orange-500"}),name:"Assistant Creation",incoming:"-",outgoing:"2 Credits / Assistant"}]}];return e.jsx(q,{open:m,onOpenChange:l,children:e.jsxs(H,{className:"max-w-7xl max-h-[90vh] overflow-y-auto","aria-describedby":"credit-usage-description",children:[e.jsx(K,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-400 to-red-500 rounded-full flex items-center justify-center",children:e.jsx(T,{className:"h-4 w-4 text-white"})}),e.jsx(G,{className:"text-xl font-semibold",children:"Credits Usage"})]}),e.jsx(J,{id:"credit-usage-description",children:"View the credit costs for each function in the AI Cruitment Portal. Each function requires a specific amount of credits to complete."})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Credit usage for AI Cruitment Portal"}),e.jsx("p",{className:"text-gray-600",children:"Each function requires a specific amount of credits to complete."})]}),e.jsx("div",{className:"space-y-6",children:h.map((s,p)=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 border-b pb-2",children:s.category}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-3 bg-gray-50 rounded-lg font-semibold text-gray-700",children:[e.jsx("div",{children:"Functions"}),e.jsx("div",{className:"text-center",children:"Incoming"}),e.jsx("div",{className:"text-center",children:"Outgoing"})]}),e.jsx("div",{className:"space-y-2",children:s.functions.map((r,x)=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[r.icon,e.jsx("span",{className:"font-medium text-gray-900",children:r.name})]}),e.jsx("div",{className:"text-center font-medium text-gray-900",children:r.incoming||"-"}),e.jsx("div",{className:"text-center font-medium text-gray-900",children:r.outgoing||"-"})]},x))})]},p))})]})]})})},ne=({showPurchaseButton:m=!0,compact:l=!1,showUsageButton:h=!1})=>{Z();const[s,p]=n.useState(null),[r,x]=n.useState(!0),[U,w]=n.useState(null),[b,f]=n.useState(!1),[D,y]=n.useState(!1),c=async()=>{var t,a,d;try{x(!0),console.log("ðŸ” CreditBalance: Fetching balance...");const i=await Q.get(`/api/credits/balance?t=${Date.now()}`);console.log("ðŸ” CreditBalance: API response:",i.data);const u=i.data.data;console.log("ðŸ” CreditBalance: Raw API response:",u),p(u),w(null),console.log("âœ… CreditBalance: Balance updated:",u),console.log("ðŸŽ¯ CreditBalance: Should show:",u.available_credits,"credits")}catch(i){console.error("âŒ CreditBalance: Error fetching credit balance:",i),console.error("âŒ CreditBalance: Error response:",(t=i.response)==null?void 0:t.data),w(((d=(a=i.response)==null?void 0:a.data)==null?void 0:d.message)||"Failed to fetch credit balance"),E.error("Failed to fetch credit balance")}finally{x(!1)}};n.useEffect(()=>{console.log("ðŸ” CreditBalance: Component mounted, fetching balance..."),c();const t=()=>{console.log("ðŸ” CreditBalance: Credit update event received, refreshing..."),c()};window.addEventListener("creditBalanceUpdate",t);const a=()=>{console.log("ðŸ” CreditBalance: Storage change detected, refreshing..."),setTimeout(c,100)};return window.addEventListener("storage",a),()=>{window.removeEventListener("creditBalanceUpdate",t),window.removeEventListener("storage",a)}},[]);const B=()=>{console.log("ðŸ” Buy button clicked - opening purchase modal"),f(!0)},L=t=>{E.success("ðŸŽ‰ Purchase successful! Credits added to your account."),f(!1),c(),window.dispatchEvent(new CustomEvent("creditBalanceUpdate"))},o=t=>{if(console.log("ðŸ” formatCredits called with:",t,"type:",typeof t),t==="unlimited")return"Unlimited";const a=typeof t=="string"?parseFloat(t):t;if(console.log("ðŸ” numCredits after conversion:",a,"type:",typeof a),typeof a=="number"&&!isNaN(a)){const d=a.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2});return console.log("ðŸ” formatted result:",d),d}return console.log('ðŸ” returning default "0"'),"0"},S=t=>{if(t==="unlimited")return"text-green-600";const a=typeof t=="string"?parseFloat(t):t;return a<=10?"text-red-600":a<=50?"text-yellow-600":"text-green-600"},I=t=>{if(t==="unlimited")return"default";const a=typeof t=="string"?parseFloat(t):t;return a<=10?"destructive":a<=50?"secondary":"default"};if(r)return e.jsx(N,{className:l?"w-full":"w-full max-w-md",children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"h-5 w-5 text-gray-400 animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20 animate-pulse"})]})})});if(U)return e.jsx(N,{className:l?"w-full":"w-full max-w-md",children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-600",children:[e.jsx(g,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:"Error loading balance"})]})})});const M=e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:`font-medium text-sm ${S(s==null?void 0:s.available_credits)}`,children:s!=null&&s.isSuperAdmin?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{children:"Unlimited"})]}):e.jsxs("span",{title:`${o(s==null?void 0:s.available_credits)} credits available`,children:[o(s==null?void 0:s.available_credits)," credits"]})}),!(s!=null&&s.isSuperAdmin)&&parseFloat(s==null?void 0:s.available_credits)<=10&&parseFloat(s==null?void 0:s.available_credits)>0&&e.jsx(g,{className:"h-4 w-4 text-yellow-500",title:"Low credit balance"}),!(s!=null&&s.isSuperAdmin)&&parseFloat(s==null?void 0:s.available_credits)<=0&&e.jsx(g,{className:"h-4 w-4 text-red-500",title:"No credits remaining"}),h&&e.jsxs(v,{size:"sm",variant:"outline",onClick:()=>y(!0),className:"h-7 px-3 text-xs",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Credits Usage"]}),m&&!(s!=null&&s.isSuperAdmin)&&e.jsxs(v,{size:"sm",variant:parseFloat(s==null?void 0:s.available_credits)<=10?"default":"outline",onClick:B,className:"h-7 px-3 text-xs",children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Buy Credits"]})]}),k=e.jsxs(N,{className:"w-full max-w-md",children:[e.jsx(W,{className:"pb-3",children:e.jsxs(X,{className:"flex items-center space-x-2 text-lg",children:[e.jsx(j,{className:"h-5 w-5"}),e.jsx("span",{children:"Credit Balance"})]})}),e.jsxs(C,{className:"space-y-4",children:[s!=null&&s.isSuperAdmin?e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(_,{className:"h-8 w-8 text-green-600"}),e.jsx("span",{className:"text-2xl font-bold text-green-600",children:"Unlimited"})]}),e.jsx(P,{variant:"default",className:"bg-green-100 text-green-800",children:"Super Admin"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-3xl font-bold ${S(s==null?void 0:s.available_credits)}`,children:o(s==null?void 0:s.available_credits)}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Available Credits"}),parseFloat(s==null?void 0:s.available_credits)<=10&&e.jsxs(P,{variant:I(s==null?void 0:s.available_credits),className:"mt-2",children:[e.jsx(g,{className:"h-3 w-3 mr-1"}),"Low Balance"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-gray-900",children:o(s==null?void 0:s.total_credits)}),e.jsx("div",{className:"text-gray-600",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-gray-900",children:o(s==null?void 0:s.used_credits)}),e.jsx("div",{className:"text-gray-600",children:"Used"})]})]}),(s==null?void 0:s.last_purchase_at)&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["Last purchase: ",new Date(s.last_purchase_at).toLocaleDateString()]}),m&&e.jsxs(v,{onClick:B,className:"w-full",variant:parseFloat(s==null?void 0:s.available_credits)<=10?"default":"outline",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Purchase Credits"]})]}),e.jsx("div",{className:"flex justify-between text-xs text-gray-500",children:e.jsx("button",{onClick:c,className:"hover:text-gray-700 transition-colors",children:"Refresh"})})]})]});return e.jsxs(e.Fragment,{children:[l?M:k,e.jsx(Y,{isOpen:b,onClose:()=>f(!1),onSuccess:L}),e.jsx(ee,{isOpen:D,onClose:()=>y(!1)})]})};export{ne as C,ee as a};
//# sourceMappingURL=CreditBalance-B1WGy4Ek.js.map
