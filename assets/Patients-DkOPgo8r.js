import{j as e,aW as B,aA as $,aV as q,b6 as G,b4 as je,b7 as X,ar as fe,av as Q,b8 as ge,b9 as ve,ba as Z,N as Ne,C as ee,y as be}from"./ui-BZ34e_bG.js";import{r as i}from"./vendor-DG599jyl.js";import{b as se}from"./query-BwaCLewj.js";import{c as pe}from"./router-BavLd_S0.js";import{B as A}from"./badge-CiNZHaLO.js";import{B as p}from"./button-Cm3qqFtR.js";import{I as we}from"./input-DmGou_SQ.js";import{C as c,b as d,c as o,a as x}from"./card-BYrCuzD5.js";import{A as ye,a as Ce}from"./avatar-C3L3uLDQ.js";import{S as D,a as E,b as I,c as V,d as t}from"./select-DZgTcSvR.js";import{T as Se,a as Pe,b as ae,c as h,d as _e,e as m}from"./table-C6M1Val8.js";import"./tabs-BYqCgTJp.js";import{P as w}from"./Page-RlnDfmDi.js";import{H as qe}from"./Header-z9YYy-Xz.js";import{C as Ae}from"./CustomPagination-BeWU0rjq.js";import{g as Fe,a as Te}from"./contactService-ALigg3kZ.js";import"./index-HDeFwIcs.js";import"./scroll-area-sAMvAiol.js";import"./index-3J7IwK8P.js";import"./index-DwBQLlhe.js";import"./sheet-Di2b-amD.js";import"./index-DWPNxztX.js";const ss=()=>{console.log("Patients component loaded");const[n,L]=pe(),[v,R]=i.useState(null),[te,U]=i.useState(!1),[le,ie]=i.useState("table"),[N,H]=i.useState(n.get("search")||""),[y,M]=i.useState(n.get("status")||""),[C,O]=i.useState(n.get("qualified_status")||""),[b,W]=i.useState(n.get("banned")||""),[S,Y]=i.useState(n.get("dnq")||""),z=parseInt(n.get("page"))||1,[J,ne]=i.useState(N);i.useEffect(()=>{const s=setTimeout(()=>ne(N),300);return()=>clearTimeout(s)},[N]);const{data:u,isLoading:P,error:j,refetch:K}=se({queryKey:["patients",z,J,y,C,b,S],queryFn:()=>Fe(z,J,{status:y,qualified_status:C,banned:b==="true"?!0:b==="false"?!1:void 0,dnq:S==="true"?!0:S==="false"?!1:void 0}),keepPreviousData:!0,retry:1}),{data:F}=se({queryKey:["patient-stats"],queryFn:Te,retry:1}),_=(u==null?void 0:u.data)||[],f=(u==null?void 0:u.pagination)||{},g=(F==null?void 0:F.data)||{};console.log("Patients data:",{patients:_,pagination:f,stats:g,isLoading:P,error:j});const re=s=>{H(s),k({search:s,page:1})},T=(s,a)=>{const l={[s]:a,page:1};switch(s){case"status":M(a);break;case"qualified_status":O(a);break;case"banned":W(a);break;case"dnq":Y(a);break}k(l)},k=s=>{const a=new URLSearchParams(n);Object.entries(s).forEach(([l,r])=>{r?a.set(l,r):a.delete(l)}),L(a)},ce=s=>{k({page:s})},de=s=>{R(s),U(!0)},oe=s=>{const a={new:{variant:"secondary",icon:ee,label:"New"},contacted:{variant:"info",icon:Q,label:"Contacted"},screening:{variant:"warning",icon:Ne,label:"Screening"},qualified:{variant:"success",icon:q,label:"Qualified"},enrolled:{variant:"success",icon:G,label:"Enrolled"},completed:{variant:"success",icon:q,label:"Completed"},withdrawn:{variant:"destructive",icon:Z,label:"Withdrawn"},disqualified:{variant:"destructive",icon:X,label:"Disqualified"}},l=a[s]||a.new,r=l.icon;return e.jsxs(A,{variant:l.variant,className:"flex items-center gap-1",children:[e.jsx(r,{className:"h-3 w-3"}),l.label]})},xe=s=>{const a={pending:{variant:"secondary",icon:ee,label:"Pending"},qualified:{variant:"success",icon:q,label:"Qualified"},not_qualified:{variant:"destructive",icon:Z,label:"Not Qualified"},needs_review:{variant:"warning",icon:B,label:"Needs Review"}},l=a[s]||a.pending,r=l.icon;return e.jsxs(A,{variant:l.variant,className:"flex items-center gap-1",children:[e.jsx(r,{className:"h-3 w-3"}),l.label]})},he=(s,a)=>s&&s.trim()?s.split(" ").map(l=>l[0]).join("").toUpperCase().slice(0,2):a?a.slice(0,2).toUpperCase():"PA",me=(s,a)=>{if(s)return`${s} years`;if(a){const l=new Date(a);return`${new Date().getFullYear()-l.getFullYear()} years`}return"N/A"},ue=()=>{H(""),M(""),O(""),W(""),Y(""),L({})};return P?e.jsx(w,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{children:"Loading patients..."})]})})}):j?e.jsx(w,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"h-8 w-8 text-destructive mx-auto mb-4"}),e.jsx("p",{className:"text-destructive",children:"Error loading patients"}),e.jsx(p,{onClick:()=>K(),className:"mt-2",children:"Try Again"})]})})}):P?e.jsx(w,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{children:"Loading patients..."})]})})}):j?e.jsx(w,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"h-8 w-8 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-500 mb-2",children:"Error loading patients"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:j.message}),e.jsx(p,{onClick:()=>K(),children:"Try Again"})]})})}):e.jsxs(w,{children:[e.jsx(qe,{title:"Patient Management",subtitle:"Alcohol Study Patient Recruitment",buttonText:"Add Patient",useSheet:!0,sheetContent:e.jsx("div",{children:"Add Patient Form Coming Soon"}),showViewToggle:!0,viewMode:le,onViewModeChange:ie}),e.jsxs(c,{className:"mb-6 border-yellow-200 bg-yellow-50",children:[e.jsx(d,{children:e.jsx(o,{className:"text-sm text-yellow-800",children:"Debug Information"})}),e.jsx(x,{children:e.jsxs("div",{className:"text-xs space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Loading:"})," ",P?"Yes":"No"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Error:"})," ",j?j.message:"None"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Patients Count:"})," ",_.length]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Stats:"})," ",JSON.stringify(g)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Pagination:"})," ",JSON.stringify(f)]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Total Patients"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:g.total_patients||0})})]}),e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Qualified"}),e.jsx(q,{className:"h-4 w-4 text-green-600"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:g.study_qualified||0})})]}),e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"Enrolled"}),e.jsx(G,{className:"h-4 w-4 text-blue-600"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g.enrolled_patients||0})})]}),e.jsxs(c,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium",children:"New Leads"}),e.jsx(je,{className:"h-4 w-4 text-orange-600"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:g.new_patients||0})})]})]}),e.jsxs(c,{className:"mb-6",children:[e.jsx(d,{children:e.jsx(o,{className:"text-lg",children:"Filters & Search"})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(we,{placeholder:"Search patients...",value:N,onChange:s=>re(s.target.value),className:"w-full"})}),e.jsxs(D,{value:y,onValueChange:s=>T("status",s),children:[e.jsx(E,{children:e.jsx(I,{placeholder:"Status"})}),e.jsxs(V,{children:[e.jsx(t,{value:"",children:"All Statuses"}),e.jsx(t,{value:"new",children:"New"}),e.jsx(t,{value:"contacted",children:"Contacted"}),e.jsx(t,{value:"screening",children:"Screening"}),e.jsx(t,{value:"qualified",children:"Qualified"}),e.jsx(t,{value:"enrolled",children:"Enrolled"}),e.jsx(t,{value:"completed",children:"Completed"}),e.jsx(t,{value:"withdrawn",children:"Withdrawn"}),e.jsx(t,{value:"disqualified",children:"Disqualified"})]})]}),e.jsxs(D,{value:C,onValueChange:s=>T("qualified_status",s),children:[e.jsx(E,{children:e.jsx(I,{placeholder:"Qualification"})}),e.jsxs(V,{children:[e.jsx(t,{value:"",children:"All"}),e.jsx(t,{value:"pending",children:"Pending"}),e.jsx(t,{value:"qualified",children:"Qualified"}),e.jsx(t,{value:"not_qualified",children:"Not Qualified"}),e.jsx(t,{value:"needs_review",children:"Needs Review"})]})]}),e.jsxs(D,{value:b,onValueChange:s=>T("banned",s),children:[e.jsx(E,{children:e.jsx(I,{placeholder:"Banned"})}),e.jsxs(V,{children:[e.jsx(t,{value:"",children:"All"}),e.jsx(t,{value:"false",children:"Not Banned"}),e.jsx(t,{value:"true",children:"Banned"})]})]}),e.jsx(p,{variant:"outline",onClick:ue,children:"Clear Filters"})]})})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(o,{className:"flex items-center justify-between",children:e.jsxs("span",{children:["Patients (",f.totalContacts||0,")"]})})}),e.jsx(x,{children:_.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No patients found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:N||y||C||b||S?"Try adjusting your filters":"Get started by adding your first patient"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Se,{children:[e.jsx(Pe,{children:e.jsxs(ae,{children:[e.jsx(h,{children:"Patient"}),e.jsx(h,{children:"Contact"}),e.jsx(h,{children:"Demographics"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Qualification"}),e.jsx(h,{children:"Lead Info"}),e.jsx(h,{children:"Actions"})]})}),e.jsx(_e,{children:_.map(s=>e.jsxs(ae,{children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ye,{children:e.jsx(Ce,{children:he(s.fullName,s.email)})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.fullName||"N/A"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: ",s.id]}),s.banned&&e.jsxs(A,{variant:"destructive",className:"mt-1",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Banned"]})]})]})}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),s.email]}),s.phoneNumber&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),s.phoneNumber]}),s.phone2&&e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),s.phone2]})]})}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Age: ",me(s.age,s.date_of_birth)]}),s.height&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),s.height]}),s.weight_lbs&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),s.weight_lbs," lbs"]})]})}),e.jsxs(m,{children:[oe(s.status),s.dnq&&e.jsx(A,{variant:"destructive",className:"mt-1 block w-fit",children:"DNQ"})]}),e.jsx(m,{children:xe(s.qualified_status)}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-1 text-sm",children:[s.patient_lead_source&&e.jsxs("div",{children:["Source: ",s.patient_lead_source]}),s.patient_lead_owner&&e.jsxs("div",{children:["Owner: ",s.patient_lead_owner]}),s.patient_lead_name&&e.jsxs("div",{children:["Lead: ",s.patient_lead_name]})]})}),e.jsx(m,{children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>de(s),children:e.jsx(be,{className:"h-4 w-4"})})})})]},s.id))})]}),f.totalPages>1&&e.jsx("div",{className:"mt-6",children:e.jsx(Ae,{currentPage:f.currentPage,totalPages:f.totalPages,onPageChange:ce})})]})})]}),te&&v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Patient Details"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Detailed patient view coming soon. For now, here's basic info:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",v.fullName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",v.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",v.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Qualified:"})," ",v.qualified_status]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(p,{onClick:()=>{U(!1),R(null)},children:"Close"})})]})})]})};export{ss as default};
//# sourceMappingURL=Patients-DkOPgo8r.js.map
