import{j as e,aM as T,aA as k,au as R,U as O,a0 as V,M as $,ar as H,c as Q,ca as z,aR as j,aQ as g,aS as U,am as W,D as _}from"./ui-C7wuVsKo.js";import{r as n}from"./vendor-DG599jyl.js";import{C as N,a as C,b as q,c as K}from"./card-aEf8HYk2.js";import{B as v}from"./button-DAfv1lEn.js";import{B as F}from"./badge-DTmq5TA0.js";import{d as G,t as E}from"./index-CUjvNcD6.js";import{P as J}from"./PurchaseCreditsModal-CjhuoYUk.js";import{D as X,a as Y,b as Z,c as ee}from"./dialog-D2hWIkvB.js";import{u as se}from"./router-BavLd_S0.js";const te=({isOpen:m,onClose:l})=>{const h=[{category:"AI Cruitment Portal Services",functions:[{icon:e.jsx(k,{className:"h-4 w-4 text-blue-500"}),name:"AI CRUITMENT Assistant Call",incoming:"1 Credit / Call + 0.5 Credits / Minute",outgoing:"1 Credit / Call + 0.5 Credits / Minute"},{icon:e.jsx(R,{className:"h-4 w-4 text-blue-500"}),name:"Outbound Call",incoming:"-",outgoing:"1 Credit / Call + 0.5 Credits / Minute"},{icon:e.jsx(O,{className:"h-4 w-4 text-blue-500"}),name:"File Upload & Processing",incoming:"-",outgoing:"0.25 Credits / MB"},{icon:e.jsx(V,{className:"h-4 w-4 text-blue-500"}),name:"Knowledge Base Query",incoming:"-",outgoing:"0.05 Credits / Query"},{icon:e.jsx($,{className:"h-4 w-4 text-blue-500"}),name:"Audio Transcription",incoming:"-",outgoing:"0.3 Credits / Minute"},{icon:e.jsx(H,{className:"h-4 w-4 text-blue-500"}),name:"Text-to-Speech",incoming:"-",outgoing:"0.001 Credits / Character"},{icon:e.jsx(Q,{className:"h-4 w-4 text-blue-500"}),name:"Workflow Execution",incoming:"-",outgoing:"0.75 Credits / Execution"},{icon:e.jsx(z,{className:"h-4 w-4 text-blue-500"}),name:"Call Recording",incoming:"-",outgoing:"0.1 Credits / Minute"}]}];return e.jsx(X,{open:m,onOpenChange:l,children:e.jsxs(Y,{className:"max-w-7xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Z,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-400 to-red-500 rounded-full flex items-center justify-center",children:e.jsx(T,{className:"h-4 w-4 text-white"})}),e.jsx(ee,{className:"text-xl font-semibold",children:"Credits Usage"})]})})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Credit usage for AI Cruitment Portal"}),e.jsx("p",{className:"text-gray-600",children:"Each function requires a specific amount of credits to complete."})]}),e.jsx("div",{className:"space-y-6",children:h.map((s,p)=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 border-b pb-2",children:s.category}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-3 bg-gray-50 rounded-lg font-semibold text-gray-700",children:[e.jsx("div",{children:"Functions"}),e.jsx("div",{className:"text-center",children:"Incoming"}),e.jsx("div",{className:"text-center",children:"Outgoing"})]}),e.jsx("div",{className:"space-y-2",children:s.functions.map((r,x)=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[r.icon,e.jsx("span",{className:"font-medium text-gray-900",children:r.name})]}),e.jsx("div",{className:"text-center font-medium text-gray-900",children:r.incoming||"-"}),e.jsx("div",{className:"text-center font-medium text-gray-900",children:r.outgoing||"-"})]},x))})]},p))})]})]})})},xe=({showPurchaseButton:m=!0,compact:l=!1,showUsageButton:h=!1})=>{se();const[s,p]=n.useState(null),[r,x]=n.useState(!0),[A,w]=n.useState(null),[M,f]=n.useState(!1),[P,y]=n.useState(!1),c=async()=>{var t,a,d;try{x(!0),console.log("🔍 CreditBalance: Fetching balance...");const i=await G.get(`/api/credits/balance?t=${Date.now()}`);console.log("🔍 CreditBalance: API response:",i.data);const u=i.data.data;console.log("🔍 CreditBalance: Raw API response:",u),p(u),w(null),console.log("✅ CreditBalance: Balance updated:",u),console.log("🎯 CreditBalance: Should show:",u.available_credits,"credits")}catch(i){console.error("❌ CreditBalance: Error fetching credit balance:",i),console.error("❌ CreditBalance: Error response:",(t=i.response)==null?void 0:t.data),w(((d=(a=i.response)==null?void 0:a.data)==null?void 0:d.message)||"Failed to fetch credit balance"),E.error("Failed to fetch credit balance")}finally{x(!1)}};n.useEffect(()=>{console.log("🔍 CreditBalance: Component mounted, fetching balance..."),c();const t=()=>{console.log("🔍 CreditBalance: Credit update event received, refreshing..."),c()};window.addEventListener("creditBalanceUpdate",t);const a=()=>{console.log("🔍 CreditBalance: Storage change detected, refreshing..."),setTimeout(c,100)};return window.addEventListener("storage",a),()=>{window.removeEventListener("creditBalanceUpdate",t),window.removeEventListener("storage",a)}},[]);const B=()=>{console.log("🔍 Buy button clicked - opening purchase modal"),f(!0)},b=t=>{E.success("🎉 Purchase successful! Credits added to your account."),f(!1),c(),window.dispatchEvent(new CustomEvent("creditBalanceUpdate"))},o=t=>{if(console.log("🔍 formatCredits called with:",t,"type:",typeof t),t==="unlimited")return"Unlimited";const a=typeof t=="string"?parseFloat(t):t;if(console.log("🔍 numCredits after conversion:",a,"type:",typeof a),typeof a=="number"&&!isNaN(a)){const d=a.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2});return console.log("🔍 formatted result:",d),d}return console.log('🔍 returning default "0"'),"0"},S=t=>{if(t==="unlimited")return"text-green-600";const a=typeof t=="string"?parseFloat(t):t;return a<=10?"text-red-600":a<=50?"text-yellow-600":"text-green-600"},D=t=>{if(t==="unlimited")return"default";const a=typeof t=="string"?parseFloat(t):t;return a<=10?"destructive":a<=50?"secondary":"default"};if(r)return e.jsx(N,{className:l?"w-full":"w-full max-w-md",children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"h-5 w-5 text-gray-400 animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20 animate-pulse"})]})})});if(A)return e.jsx(N,{className:l?"w-full":"w-full max-w-md",children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-600",children:[e.jsx(g,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:"Error loading balance"})]})})});const I=e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:`font-medium text-sm ${S(s==null?void 0:s.available_credits)}`,children:s!=null&&s.isSuperAdmin?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx("span",{children:"Unlimited"})]}):e.jsxs("span",{title:`${o(s==null?void 0:s.available_credits)} credits available`,children:[o(s==null?void 0:s.available_credits)," credits"]})}),!(s!=null&&s.isSuperAdmin)&&parseFloat(s==null?void 0:s.available_credits)<=10&&parseFloat(s==null?void 0:s.available_credits)>0&&e.jsx(g,{className:"h-4 w-4 text-yellow-500",title:"Low credit balance"}),!(s!=null&&s.isSuperAdmin)&&parseFloat(s==null?void 0:s.available_credits)<=0&&e.jsx(g,{className:"h-4 w-4 text-red-500",title:"No credits remaining"}),h&&e.jsxs(v,{size:"sm",variant:"outline",onClick:()=>y(!0),className:"h-7 px-3 text-xs",children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"Credits Usage"]}),m&&!(s!=null&&s.isSuperAdmin)&&e.jsxs(v,{size:"sm",variant:parseFloat(s==null?void 0:s.available_credits)<=10?"default":"outline",onClick:B,className:"h-7 px-3 text-xs",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),"Buy Credits"]})]}),L=e.jsxs(N,{className:"w-full max-w-md",children:[e.jsx(q,{className:"pb-3",children:e.jsxs(K,{className:"flex items-center space-x-2 text-lg",children:[e.jsx(j,{className:"h-5 w-5"}),e.jsx("span",{children:"Credit Balance"})]})}),e.jsxs(C,{className:"space-y-4",children:[s!=null&&s.isSuperAdmin?e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(U,{className:"h-8 w-8 text-green-600"}),e.jsx("span",{className:"text-2xl font-bold text-green-600",children:"Unlimited"})]}),e.jsx(F,{variant:"default",className:"bg-green-100 text-green-800",children:"Super Admin"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-3xl font-bold ${S(s==null?void 0:s.available_credits)}`,children:o(s==null?void 0:s.available_credits)}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Available Credits"}),parseFloat(s==null?void 0:s.available_credits)<=10&&e.jsxs(F,{variant:D(s==null?void 0:s.available_credits),className:"mt-2",children:[e.jsx(g,{className:"h-3 w-3 mr-1"}),"Low Balance"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-gray-900",children:o(s==null?void 0:s.total_credits)}),e.jsx("div",{className:"text-gray-600",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-gray-900",children:o(s==null?void 0:s.used_credits)}),e.jsx("div",{className:"text-gray-600",children:"Used"})]})]}),(s==null?void 0:s.last_purchase_at)&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["Last purchase: ",new Date(s.last_purchase_at).toLocaleDateString()]}),m&&e.jsxs(v,{onClick:B,className:"w-full",variant:parseFloat(s==null?void 0:s.available_credits)<=10?"default":"outline",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Purchase Credits"]})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("button",{onClick:c,className:"hover:text-gray-700 transition-colors",children:"Refresh"}),e.jsx("a",{href:"/credits/history",className:"hover:text-gray-700 transition-colors",children:"View History"})]})]})]});return e.jsxs(e.Fragment,{children:[l?I:L,e.jsx(J,{isOpen:M,onClose:()=>f(!1),onSuccess:b}),e.jsx(te,{isOpen:P,onClose:()=>y(!1)})]})};export{xe as C,te as a};
//# sourceMappingURL=CreditBalance-EXXXcXdO.js.map
