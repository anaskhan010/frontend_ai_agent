import{j as e,c8 as D,S as L,Z as F,ah as M,bh as z,C as Y}from"./ui-DHRUPyaA.js";import{r as l}from"./vendor-DG599jyl.js";import{D as A,a as k,c as $,d as I}from"./dialog-DAE_8wqa.js";import{B as S}from"./button-D7rqocXn.js";import{C as q,a as R}from"./card-DNPHHQQ5.js";import{d as _,t as c}from"./index-kojKzVbx.js";import{E as O,u as U,a as W,C,b as V,c as G,l as K}from"./react-stripe.esm-DpsyRb7I.js";const X=K("pk_test_51S8GFm2MMm3Fy1PB45KAluHAtFTOmAY9qKUE4sITR1TA1zfX97ON36OAcAALplq6LbLgqXaTyY0hRB7ae55LzpBQ00DfkbC8oy").then(t=>(console.log("✅ Stripe loaded successfully:",!!t),t||console.error("❌ Failed to load Stripe"),t)).catch(t=>(console.error("❌ Error loading Stripe:",t),null)),Z=({selectedPackage:t,onSuccess:d,onCancel:m})=>{const i=U(),x=W(),[h,n]=l.useState(!1),[r,u]=l.useState(""),[o,p]=l.useState(!1),[b,g]=l.useState("professional");l.useEffect(()=>{t&&y()},[t]);const y=async()=>{try{const a={packageId:t.package_id};t.is_free_trial&&(a.isFreeTrial=!0,a.autoSubscriptionEnabled=o,a.autoSubscriptionPackage=b);const s=await _.post("/api/credits/purchase",a);u(s.data.data.client_secret)}catch(a){console.error("Error creating payment intent:",a),c.error("Failed to initialize payment")}},j=async a=>{if(a.preventDefault(),!i||!x||!r)return;n(!0);let s;if(t.is_free_trial){const v=x.getElement(C);console.log("🔄 Creating payment method with card element");const{error:f,paymentMethod:w}=await i.createPaymentMethod({type:"card",card:v});if(f){console.error("❌ Payment method creation failed:",f),c.error(f.message||"Card validation failed"),n(!1);return}console.log("✅ Payment method created successfully:",w.id);try{console.log("🔄 Confirming setup intent with payment method:",w.id),s=await i.confirmSetup({clientSecret:r,confirmParams:{payment_method:w.id},redirect:"if_required"}),console.log("✅ Setup intent confirmation result:",s)}catch(B){console.error("❌ Setup intent confirmation failed:",B),c.error("Payment setup failed. Please try again."),n(!1);return}}else s=await i.confirmCardPayment(r,{payment_method:{card:x.getElement(C)}});const{error:N,setupIntent:T,paymentIntent:P}=s,E=T||P;if(N)console.error("Payment/Setup failed:",N),c.error(N.message||"Payment failed"),n(!1);else if(E.status==="succeeded"){const v=t.is_free_trial?`🎉 Free trial activated! ${t.total_credits} credits added to your account.`:`Payment successful! ${t.total_credits} credits added to your account.`;c.success(v),setTimeout(async()=>{try{await _.get(`/api/credits/payment-status/${E.id}`),window.dispatchEvent(new CustomEvent("creditBalanceUpdate"))}catch(f){console.warn("Payment status check failed:",f)}},2e3),d(P)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border border-blue-100",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Order Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:t.name}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["$",t.price_dollars]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Credits"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:t.total_credits.toLocaleString()})]}),e.jsx("div",{className:"border-t border-blue-200 pt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-base font-semibold text-gray-900",children:"Total"}),e.jsxs("span",{className:"text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:["$",t.price_dollars]})]})})]})]}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-base font-semibold text-gray-900",children:"Payment Information"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Card Number"}),e.jsxs("div",{className:"relative p-3 border-2 border-gray-200 rounded-lg focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-100 transition-all bg-white shadow-sm",children:[e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex space-x-1.5",children:[e.jsx("img",{src:"https://js.stripe.com/v3/fingerprinted/img/visa-729c05c240c4bdb47b03ac81d9945bfe.svg",alt:"Visa",className:"h-5 w-auto opacity-70"}),e.jsx("img",{src:"https://js.stripe.com/v3/fingerprinted/img/mastercard-4d8844094130711885b5e41b28c9848f.svg",alt:"Mastercard",className:"h-5 w-auto opacity-70"})]}),e.jsx(C,{options:{style:{base:{fontSize:"16px",color:"#1f2937",fontFamily:'"Inter", system-ui, sans-serif',fontWeight:"500","::placeholder":{color:"#9CA3AF"},iconColor:"#6B7280"},invalid:{color:"#EF4444",iconColor:"#EF4444"}}}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"MM / YY"}),e.jsx("div",{className:"p-3 border-2 border-gray-200 rounded-lg focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-100 transition-all bg-white shadow-sm",children:e.jsx(V,{options:{style:{base:{fontSize:"14px",color:"#1f2937",fontFamily:'"Inter", system-ui, sans-serif',fontWeight:"500","::placeholder":{color:"#9CA3AF"}},invalid:{color:"#EF4444"}}}})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"CVC"}),e.jsx("div",{className:"p-3 border-2 border-gray-200 rounded-lg focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-100 transition-all bg-white shadow-sm",children:e.jsx(G,{options:{style:{base:{fontSize:"14px",color:"#1f2937",fontFamily:'"Inter", system-ui, sans-serif',fontWeight:"500","::placeholder":{color:"#9CA3AF"}},invalid:{color:"#EF4444"}}}})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Postal Code"}),e.jsx("div",{className:"p-3 border-2 border-gray-200 rounded-lg focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-100 transition-all bg-white shadow-sm",children:e.jsx("input",{type:"text",placeholder:"12345",className:"w-full bg-transparent border-none outline-none text-gray-900 placeholder-gray-400 font-medium",style:{fontSize:"14px",fontFamily:'"Inter", system-ui, sans-serif'}})})]})]})]}),t.is_free_trial&&e.jsxs("div",{className:"space-y-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("input",{type:"checkbox",id:"autoSubscription",checked:o,onChange:a=>p(a.target.checked),className:"mt-0.5 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:"autoSubscription",className:"block text-sm font-semibold text-blue-900 cursor-pointer",children:["🔄 Auto-buy Professional Pack when credits expire ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-xs text-blue-700 mt-0.5",children:"Automatically purchase Professional Pack ($45 for 500 credits) when your free trial credits run out. You can disable this anytime in your account settings."}),!o&&e.jsx("p",{className:"text-xs text-red-600 mt-1 font-medium",children:"* This option is required to complete your free trial purchase."})]})]}),o&&e.jsxs("div",{className:"ml-6 p-2 bg-white rounded-md border border-blue-200",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Auto-purchase package:"}),e.jsxs("select",{value:b,onChange:a=>g(a.target.value),className:"w-full text-xs border border-gray-300 rounded px-2 py-1.5 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"professional",children:"Professional Pack - $45 (500 credits)"}),e.jsx("option",{value:"business",children:"Business Pack - $80 (1,000 credits)"}),e.jsx("option",{value:"enterprise",children:"Enterprise Pack - $180 (2,500 credits)"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-green-50 rounded-xl border border-green-200",children:[e.jsx(L,{className:"h-5 w-5 text-green-600 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-green-800",children:"Your payment information is secured with 256-bit SSL encryption"})]}),e.jsxs("div",{className:"flex space-x-4 pt-2",children:[e.jsx(S,{type:"button",variant:"outline",onClick:m,disabled:h,className:"flex-1 h-14 text-lg font-semibold border-2 hover:bg-primary hover:text-white",children:"Back"}),e.jsx(S,{type:"submit",disabled:!i||h||t.is_free_trial&&!o,className:"flex-1 h-14 text-lg font-semibold bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white shadow-lg hover:shadow-xl transition-all duration-300",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin mr-3"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-6 w-6 mr-3"}),"Complete Purchase"]})})]})]})]})},ae=({isOpen:t,onClose:d,onSuccess:m})=>{const[i,x]=l.useState([]),[h,n]=l.useState(!0),[r,u]=l.useState(null),[o,p]=l.useState(!1);l.useEffect(()=>{t&&b()},[t]);const b=async()=>{try{n(!0);const s=await _.get("/api/credits/packages");x(s.data.data)}catch(s){console.error("Error fetching packages:",s),c.error("Failed to load credit packages")}finally{n(!1)}},g=s=>{u(s),p(!0)},y=s=>{p(!1),u(null),m==null||m(s),d()},j=()=>{p(!1),u(null)},a=s=>(s/100).toFixed(2);return o&&r?e.jsx(A,{open:t,onOpenChange:d,children:e.jsxs(k,{className:"max-w-[1400px] max-h-[80vh] p-0 bg-white shadow-2xl",children:[e.jsx("div",{className:"relative px-6 py-3 bg-gradient-to-r from-slate-50 to-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-600 to-purple-700 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(D,{className:"h-6 w-6 text-white"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx($,{className:"text-xl font-bold text-gray-900 mb-1",children:"Complete Your Purchase"}),e.jsxs(I,{className:"text-sm text-gray-600 font-medium",children:[r.name," • ",r.total_credits.toLocaleString()," credits • $",r.price_dollars]})]})]})}),e.jsxs("div",{className:"flex min-h-[400px] max-h-[calc(80vh-80px)] overflow-hidden",children:[e.jsxs("div",{className:"w-1/2 p-4 bg-gray-50 border-r border-gray-200 overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Details About Package"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:r.name}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:["$",r.price_dollars]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center py-1.5 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Credits"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:r.total_credits.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center py-1.5 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Price per Credit"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["$",(r.price_dollars/r.total_credits).toFixed(4)]})]}),e.jsxs("div",{className:"flex justify-between items-center py-1.5 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Expires"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"30 days from purchase"})]}),e.jsxs("div",{className:"flex justify-between items-center py-1.5 font-bold text-base",children:[e.jsx("span",{className:"text-gray-900",children:"Total"}),e.jsxs("span",{className:"text-blue-600",children:["$",r.price_dollars]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-gray-200",children:[e.jsx("h5",{className:"text-sm font-semibold text-gray-900 mb-2",children:"What's Included"}),e.jsxs("ul",{className:"space-y-1.5 text-xs text-gray-600",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mr-2"}),"AI-powered voice calls"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mr-2"}),"Advanced analytics"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mr-2"}),"24/7 support"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mr-2"}),"No setup fees"]})]})]})]})]}),e.jsxs("div",{className:"w-1/2 p-4 bg-white overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Card Details"}),e.jsx(O,{stripe:X,children:e.jsx(Z,{selectedPackage:r,onSuccess:y,onCancel:j})})]})]})]})}):e.jsx(A,{open:t,onOpenChange:d,children:e.jsxs(k,{className:"max-w-[1400px] max-h-[80vh] overflow-hidden p-0 bg-gradient-to-br from-slate-50 to-white",children:[e.jsx("div",{className:"relative px-4 pt-4 pb-3 bg-white border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:e.jsx(F,{className:"h-6 w-6 text-white"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx($,{className:"text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent mb-1",children:"Choose Your Plan"}),e.jsx(I,{className:"text-sm text-gray-600",children:"Unlock the full potential of our AI platform with flexible credit packages designed for every need"})]})]})}),e.jsx("div",{className:"px-4 py-4 overflow-y-auto max-h-[calc(80vh-100px)]",children:h?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 space-y-4",children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-16 h-16 border-4 border-blue-200 rounded-full animate-spin border-t-blue-600"})}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading packages..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-4",children:i.map(s=>e.jsxs("div",{className:`relative group cursor-pointer pricing-card-hover ${s.is_popular?"transform scale-105 z-10":""}`,onClick:()=>g(s),children:[!!s.is_popular&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 z-20",children:e.jsxs("div",{className:"bg-gradient-to-r from-orange-400 to-pink-500 text-white px-3 py-1.5 rounded-full text-xs font-semibold shadow-lg",children:[e.jsx(M,{className:"h-3 w-3 inline mr-1"}),"Most Popular"]})}),e.jsx(q,{className:`h-full transition-all duration-300 ${s.is_popular?"gradient-border-popular popular-glow bg-white":"border-2 border-gray-200 hover:border-blue-300 hover:shadow-xl bg-white"}`,children:e.jsxs(R,{className:"p-5 h-full flex flex-col",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900 mb-1",children:s.name}),e.jsx("p",{className:"text-gray-600 text-xs leading-relaxed",children:s.description})]}),e.jsx("div",{className:"text-center mb-4",children:s.is_free_trial?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-baseline justify-center space-x-1",children:[e.jsx("span",{className:"text-3xl font-bold bg-gradient-to-r from-green-500 to-emerald-600 bg-clip-text text-transparent",children:"FREE"}),e.jsx("span",{className:"text-green-600 text-sm",children:"🎉"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsxs("span",{className:"line-through",children:["$",a(s.original_price_dollars*100)]}),e.jsx("span",{className:"ml-1 text-green-600 font-semibold",children:"One-time offer!"})]})]}):e.jsxs("div",{className:"flex items-baseline justify-center space-x-1",children:[e.jsxs("span",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:["$",a(s.price_cents)]}),e.jsx("span",{className:"text-gray-500 text-sm",children:"USD"})]})}),e.jsxs("div",{className:"space-y-3 mb-5 flex-grow",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-700 text-sm font-medium",children:"Base Credits"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:s.credits_amount.toLocaleString()})]}),s.bonus_credits>0&&e.jsxs("div",{className:"flex items-center justify-between border-t border-gray-200 pt-2",children:[e.jsxs("span",{className:"text-green-700 text-sm font-medium flex items-center",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Bonus Credits"]}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:["+",s.bonus_credits.toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t border-gray-200 pt-2",children:[e.jsx("span",{className:"text-gray-900 text-sm font-semibold",children:"Total Credits"}),e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:s.total_credits.toLocaleString()})]})]}),e.jsx("div",{className:"text-center",children:s.is_free_trial?e.jsx("span",{className:"text-xs text-green-600 bg-green-50 px-2 py-1 rounded-full font-semibold",children:"🎉 FREE Trial • Card required for verification"}):e.jsxs("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:["$",(s.price_cents/100/s.total_credits).toFixed(4)," per credit"]})})]}),e.jsx(S,{className:`w-full h-10 text-sm font-semibold transition-all duration-300 ${s.is_popular?"bg-gradient-to-r from-orange-500 to-pink-600 hover:from-orange-600 hover:to-pink-700 text-white shadow-lg hover:shadow-xl":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white hover:shadow-lg"}`,children:"Get Started"})]})})]},s.package_id))}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-1.5",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"h-4 w-4 text-green-600"})}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Secure Payment"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Protected by Stripe's enterprise-grade security"})]}),e.jsxs("div",{className:"flex flex-col items-center space-y-1.5",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(F,{className:"h-4 w-4 text-blue-600"})}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Instant Activation"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Credits added to your account immediately"})]}),e.jsxs("div",{className:"flex flex-col items-center space-y-1.5",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Y,{className:"h-4 w-4 text-purple-600"})}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"30-Day Validity"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Credits expire one month from purchase"})]})]})})]})})]})})};export{ae as P};
//# sourceMappingURL=PurchaseCreditsModal-CBKb_hOZ.js.map
