import{j as e,bL as Y,ba as te,bz as R,e as ae,C as D,aw as fe,bx as O,by as Ne,Y as G,bw as Ye,bR as ee,c3 as Ge,aI as z,ar as re,au as ie,aq as Je,bA as me,K as Ze,aQ as es,V as ss,X as ts,Q as as,I as rs}from"./ui-CZ40mCLE.js";import{r as I}from"./vendor-DG599jyl.js";import{M as is}from"./ModernTable-G9hoLxoQ.js";import{H as ns}from"./Header-qJuikBQ2.js";import{P as ue}from"./Page-BmZHcHXa.js";import{L as ve}from"./Loading-SJ35f_wk.js";import{u as le,b as A,c as J}from"./query-Dkjx6fBT.js";import{a as U}from"./client-CcI4PSpV.js";import{C as ls}from"./CustomPagination-KmeYrdY2.js";import{d as cs}from"./router-BnJytTjr.js";import{t as P,q as ye,r as be,s as we,v as _e,x as ke,n as k,L as Z,S as Q,f as B,g as E,h as V,i as m,T as Se,W as Ce,B as K,C as u,c as g,d as j,b as h,e as F,P as ds,Q as os,R as W,U as X,I as xs}from"./index-BXZmpi2n.js";import{u as Te}from"./resolvers-BzctgYTE.js";import{o as Ae,c as qe,a as ne,d as ms}from"./index.esm-C7RSptL2.js";import{R as he,P as us,a as hs,b as ps,T as pe,C as gs,X as js,Y as fs,B as ge}from"./PieChart-IKeR1IVE.js";import{B as je}from"./BarChart-D1_4-kGp.js";import"./table-8bxuBYt8.js";import"./sheet-Br8IFp_r.js";const Ns=async(t={})=>{try{const l=new URLSearchParams;return t.search&&l.append("search",t.search),t.status&&l.append("status",t.status),t.category&&l.append("category",t.category),t.priority&&l.append("priority",t.priority),t.assigned_to&&l.append("assigned_to",t.assigned_to.toString()),t.user_id&&l.append("user_id",t.user_id.toString()),t.created_from&&l.append("created_from",t.created_from),t.created_to&&l.append("created_to",t.created_to),t.sort_by&&l.append("sort_by",t.sort_by),t.sort_order&&l.append("sort_order",t.sort_order),t.page&&l.append("page",t.page.toString()),t.limit&&l.append("limit",t.limit.toString()),(await U.get(`/api/support/admin/tickets?${l.toString()}`)).data}catch(l){throw console.error("Error fetching admin support tickets:",l),l}},Fe=async(t,l)=>{try{return(await U.put(`/api/support/admin/tickets/${t}/assign`,{assigned_to:l})).data}catch(i){throw console.error("Error assigning ticket:",i),i}},Pe=async(t,l,i)=>{try{return(await U.put(`/api/support/admin/tickets/${t}/status`,{status:l,notes:i})).data}catch(o){throw console.error("Error updating ticket status:",o),o}},Re=async()=>{try{return(await U.get("/api/support/admin/stats")).data}catch(t){throw console.error("Error fetching support ticket stats:",t),t}},Le=async()=>{try{return(await U.get("/api/support/admin/stats/category")).data}catch(t){throw console.error("Error fetching ticket count by category:",t),t}},Ke=async(t=10)=>{try{return(await U.get(`/api/support/admin/activity?limit=${t}`)).data}catch(l){throw console.error("Error fetching recent ticket activity:",l),l}},Ue=async()=>{try{return(await U.get("/api/support/admin/staff")).data}catch(t){throw console.error("Error fetching support staff:",t),t}},vs=qe().shape({assigned_to:ms().required("Please select a staff member"),notes:ne().optional()}),ys=({isOpen:t,onClose:l,ticket:i})=>{const o=le(),[N,S]=I.useState(null),{register:r,handleSubmit:L,formState:{errors:w},reset:C,setValue:q}=Te({resolver:Ae(vs)}),{data:x,isLoading:T}=A({queryKey:["support-staff"],queryFn:Ue}),v=(x==null?void 0:x.data)||[],b=J({mutationFn:({ticketId:d,assignedTo:p})=>Fe(d,p),onSuccess:()=>{P.success("Ticket assigned successfully"),o.invalidateQueries({queryKey:["admin-support-tickets"]}),o.invalidateQueries({queryKey:["support-ticket-stats"]}),o.invalidateQueries({queryKey:["recent-ticket-activity"]}),a()},onError:d=>{var p,$;P.error((($=(p=d.response)==null?void 0:p.data)==null?void 0:$.message)||"Failed to assign ticket")}}),y=d=>{i&&b.mutate({ticketId:i.ticket_id,assignedTo:d.assigned_to})},a=()=>{C(),S(null),l()},c=d=>{const p=parseInt(d);S(p),q("assigned_to",p)};if(!i)return null;const f=v.find(d=>d.id===N);return e.jsx(ye,{open:t,onOpenChange:a,children:e.jsxs(be,{className:"sm:max-w-[500px]",children:[e.jsxs(we,{children:[e.jsxs(_e,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Assign Ticket"]}),e.jsx(ke,{children:"Assign this support ticket to a staff member for handling."})]}),e.jsxs("form",{onSubmit:L(y),className:"space-y-6",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Ticket ID:"}),e.jsx("span",{className:"font-mono text-sm",children:i.ticket_id})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Title:"}),e.jsx("span",{className:"text-sm max-w-xs truncate",children:i.title})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"User:"}),e.jsxs("span",{className:"text-sm",children:[i.user_first_name," ",i.user_last_name]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Priority:"}),e.jsx(k,{variant:i.priority==="urgent"||i.priority==="high"?"destructive":"default",children:i.priority})]}),i.assigned_first_name&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Currently Assigned:"}),e.jsxs("span",{className:"text-sm",children:[i.assigned_first_name," ",i.assigned_last_name]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"assigned_to",children:"Assign to Staff Member *"}),e.jsxs(Q,{onValueChange:c,disabled:T,children:[e.jsx(B,{children:e.jsx(E,{placeholder:T?"Loading staff...":"Select a staff member"})}),e.jsx(V,{children:v.map(d=>e.jsx(m,{value:d.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[d.first_name," ",d.last_name]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[d.role_display_name," • ",d.assigned_tickets_count," active tickets"]})]})]})},d.id))})]}),w.assigned_to&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600",children:[e.jsx(R,{className:"h-4 w-4"}),w.assigned_to.message]})]}),f&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(te,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-blue-900",children:[f.first_name," ",f.last_name]}),e.jsx("p",{className:"text-sm text-blue-700",children:f.email}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(k,{variant:"outline",className:"text-xs",children:f.role_display_name}),e.jsxs("span",{className:"text-xs text-blue-600",children:[f.assigned_tickets_count," active tickets"]})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"notes",children:"Assignment Notes (Optional)"}),e.jsx(Se,{id:"notes",placeholder:"Add any notes about this assignment...",...r("notes"),rows:3})]}),e.jsxs(Ce,{children:[e.jsx(K,{type:"button",variant:"outline",onClick:a,disabled:b.isPending,children:"Cancel"}),e.jsx(K,{type:"submit",disabled:b.isPending||!N,children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Assigning..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Assign Ticket"]})})]})]})]})})},bs=qe().shape({status:ne().required("Please select a status"),notes:ne().optional()}),se=[{value:"open",label:"Open",description:"Ticket is open and awaiting attention",icon:e.jsx(ae,{className:"h-4 w-4"}),color:"text-red-600",bgColor:"bg-red-50 border-red-200"},{value:"in_progress",label:"In Progress",description:"Ticket is being actively worked on",icon:e.jsx(D,{className:"h-4 w-4"}),color:"text-blue-600",bgColor:"bg-blue-50 border-blue-200"},{value:"waiting_response",label:"Waiting Response",description:"Waiting for user response or information",icon:e.jsx(fe,{className:"h-4 w-4"}),color:"text-yellow-600",bgColor:"bg-yellow-50 border-yellow-200"},{value:"resolved",label:"Resolved",description:"Issue has been resolved",icon:e.jsx(O,{className:"h-4 w-4"}),color:"text-green-600",bgColor:"bg-green-50 border-green-200"},{value:"closed",label:"Closed",description:"Ticket is closed and no further action needed",icon:e.jsx(Ne,{className:"h-4 w-4"}),color:"text-gray-600",bgColor:"bg-gray-50 border-gray-200"}],ws=({isOpen:t,onClose:l,ticket:i})=>{const o=le(),[N,S]=I.useState(""),{register:r,handleSubmit:L,formState:{errors:w},reset:C,setValue:q}=Te({resolver:Ae(bs)}),x=J({mutationFn:({ticketId:c,status:f,notes:d})=>Pe(c,f,d),onSuccess:()=>{P.success("Ticket status updated successfully"),o.invalidateQueries({queryKey:["admin-support-tickets"]}),o.invalidateQueries({queryKey:["support-ticket-stats"]}),o.invalidateQueries({queryKey:["recent-ticket-activity"]}),v()},onError:c=>{var f,d;P.error(((d=(f=c.response)==null?void 0:f.data)==null?void 0:d.message)||"Failed to update ticket status")}}),T=c=>{i&&x.mutate({ticketId:i.ticket_id,status:c.status,notes:c.notes})},v=()=>{C(),S(""),l()},b=c=>{S(c),q("status",c)};if(!i)return null;const y=se.find(c=>c.value===N),a=se.find(c=>c.value===i.status);return e.jsx(ye,{open:t,onOpenChange:v,children:e.jsxs(be,{className:"sm:max-w-[500px]",children:[e.jsxs(we,{children:[e.jsxs(_e,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Update Ticket Status"]}),e.jsx(ke,{children:"Change the status of this support ticket and add notes about the update."})]}),e.jsxs("form",{onSubmit:L(T),className:"space-y-6",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Ticket ID:"}),e.jsx("span",{className:"font-mono text-sm",children:i.ticket_id})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Title:"}),e.jsx("span",{className:"text-sm max-w-xs truncate",children:i.title})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"User:"}),e.jsxs("span",{className:"text-sm",children:[i.user_first_name," ",i.user_last_name]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Current Status:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[a==null?void 0:a.icon,e.jsx(k,{variant:i.status==="open"?"destructive":"default",children:a==null?void 0:a.label})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"status",children:"New Status *"}),e.jsxs(Q,{onValueChange:b,children:[e.jsx(B,{children:e.jsx(E,{placeholder:"Select new status"})}),e.jsx(V,{children:se.map(c=>e.jsx(m,{value:c.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:c.color,children:c.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:c.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:c.description})]})]})},c.value))})]}),w.status&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600",children:[e.jsx(R,{className:"h-4 w-4"}),w.status.message]})]}),y&&e.jsx("div",{className:`border p-4 rounded-lg ${y.bgColor}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:y.color,children:y.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-medium ${y.color}`,children:y.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:y.description})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"notes",children:"Status Change Notes"}),e.jsx(Se,{id:"notes",placeholder:"Add notes about this status change...",...r("notes"),rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"These notes will be visible in the ticket history and to the user."})]}),N==="closed"&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(R,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-800",children:"Closing Ticket"}),e.jsx("p",{className:"text-yellow-700",children:"This will close the ticket permanently. The user will be notified of the closure."})]})]})}),N==="resolved"&&e.jsx("div",{className:"bg-green-50 border border-green-200 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-green-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-green-800",children:"Resolving Ticket"}),e.jsx("p",{className:"text-green-700",children:"This will mark the ticket as resolved. The user will be notified and can reopen if needed."})]})]})}),e.jsxs(Ce,{children:[e.jsx(K,{type:"button",variant:"outline",onClick:v,disabled:x.isPending,children:"Cancel"}),e.jsx(K,{type:"submit",disabled:x.isPending||!N,children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Update Status"]})})]})]})]})})},_s=()=>{const{data:t,isLoading:l}=A({queryKey:["support-ticket-stats"],queryFn:Re}),{data:i,isLoading:o}=A({queryKey:["ticket-count-by-category"],queryFn:Le}),{data:N,isLoading:S}=A({queryKey:["recent-ticket-activity"],queryFn:()=>Ke(20)}),r=t==null?void 0:t.data,L=(i==null?void 0:i.data)||[],w=(N==null?void 0:N.data)||[];if(l||o||S)return e.jsx(ve,{});const C=r?[{name:"Open",value:r.open_tickets,color:"#ef4444"},{name:"In Progress",value:r.in_progress_tickets,color:"#3b82f6"},{name:"Waiting Response",value:r.waiting_response_tickets,color:"#f59e0b"},{name:"Resolved",value:r.resolved_tickets,color:"#10b981"},{name:"Closed",value:r.closed_tickets,color:"#6b7280"}]:[],q=r?[{name:"Urgent",value:r.urgent_tickets,color:"#dc2626"},{name:"High",value:r.high_priority_tickets,color:"#ea580c"},{name:"Medium",value:r.total_tickets-r.urgent_tickets-r.high_priority_tickets,color:"#0891b2"},{name:"Low",value:Math.max(0,r.total_tickets-r.urgent_tickets-r.high_priority_tickets),color:"#059669"}]:[],x=L.map(a=>({name:a.category.replace("_"," ").toUpperCase(),total:a.count,active:a.active_count})),T=r?((r.resolved_tickets+r.closed_tickets)/r.total_tickets*100).toFixed(1):"0",v="2.4",b="4.2",y=a=>new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(u,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Resolution Rate"}),e.jsx(Ye,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[T,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx(ee,{className:"inline h-3 w-3 mr-1"}),"+2.1% from last month"]})]})]}),e.jsxs(u,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Avg Response Time"}),e.jsx(D,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[v,"h"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx(Ge,{className:"inline h-3 w-3 mr-1"}),"-0.3h from last month"]})]})]}),e.jsxs(u,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Customer Satisfaction"}),e.jsx(z,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[b,"/5"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx(ee,{className:"inline h-3 w-3 mr-1"}),"+0.2 from last month"]})]})]}),e.jsxs(u,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Active Tickets"}),e.jsx(re,{className:"h-4 w-4 text-orange-600"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:r?r.open_tickets+r.in_progress_tickets+r.waiting_response_tickets:0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(r==null?void 0:r.tickets_last_24h)||0," new in 24h"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Ticket Status Distribution"]}),e.jsx(F,{children:"Current status breakdown of all tickets"})]}),e.jsx(h,{children:e.jsx("div",{className:"h-80",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(us,{children:[e.jsx(hs,{data:C,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:c})=>`${a} ${(c*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:C.map((a,c)=>e.jsx(ps,{fill:a.color},`cell-${c}`))}),e.jsx(pe,{})]})})})})]}),e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"Tickets by Category"]}),e.jsx(F,{children:"Total and active tickets per category"})]}),e.jsx(h,{children:e.jsx("div",{className:"h-80",children:e.jsx(he,{width:"100%",height:"100%",children:e.jsxs(je,{data:x,children:[e.jsx(gs,{strokeDasharray:"3 3"}),e.jsx(js,{dataKey:"name"}),e.jsx(fs,{}),e.jsx(pe,{}),e.jsx(ge,{dataKey:"total",fill:"#3b82f6",name:"Total"}),e.jsx(ge,{dataKey:"active",fill:"#10b981",name:"Active"})]})})})})]})]}),e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Priority Analysis"]}),e.jsx(F,{children:"Ticket distribution by priority level"})]}),e.jsx(h,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:q.map(a=>e.jsxs("div",{className:"text-center p-4 rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:a.color},children:a.value}),e.jsx("div",{className:"text-sm font-medium",children:a.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r?(a.value/r.total_tickets*100).toFixed(1):0,"%"]})]},a.name))})})]}),e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-5 w-5"}),"Recent Activity Timeline"]}),e.jsx(F,{children:"Latest ticket updates and changes"})]}),e.jsx(h,{children:e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:w.map(a=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex-shrink-0 mt-1",children:[a.action==="created"&&e.jsx(ie,{className:"h-4 w-4 text-green-500"}),a.action==="status_changed"&&e.jsx(re,{className:"h-4 w-4 text-blue-500"}),a.action==="assigned"&&e.jsx(z,{className:"h-4 w-4 text-purple-500"}),a.action==="priority_changed"&&e.jsx(R,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:a.ticket_title}),e.jsx(k,{variant:"outline",className:"text-xs",children:a.action.replace("_"," ")})]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:a.notes}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[a.user_first_name," ",a.user_last_name]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:y(a.created_at)})]})]})]},a.id))})})]}),e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Performance Insights"]}),e.jsx(F,{children:"Key insights and recommendations"})]}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-green-50 border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(O,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Strong Performance"})]}),e.jsxs("p",{className:"text-sm text-green-700",children:["Resolution rate is above target at ",T,"%. Keep up the excellent work!"]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-blue-50 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(D,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-800",children:"Response Time"})]}),e.jsx("p",{className:"text-sm text-blue-700",children:"Average response time has improved by 0.3 hours this month."})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-orange-50 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-800",children:"Priority Focus"})]}),e.jsxs("p",{className:"text-sm text-orange-700",children:[(r==null?void 0:r.urgent_tickets)||0," urgent tickets need immediate attention."]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-purple-50 border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-800",children:"Team Workload"})]}),e.jsxs("p",{className:"text-sm text-purple-700",children:[(r==null?void 0:r.unassigned_tickets)||0," tickets are unassigned and need distribution."]})]})]})})]})]})},Vs=()=>{var de,oe;const[t,l]=cs(),i=le(),[o,N]=I.useState({page:parseInt(t.get("page")||"1"),limit:parseInt(t.get("limit")||"20"),search:t.get("search")||"",status:t.get("status")||"",category:t.get("category")||"",priority:t.get("priority")||"",assigned_to:t.get("assigned_to")?parseInt(t.get("assigned_to")):void 0,sort_by:t.get("sort_by")||"created_at",sort_order:t.get("sort_order")||"desc"}),[S,r]=I.useState(!1),[L,w]=I.useState(!1),[C,q]=I.useState(null),{data:x,isLoading:T,error:v}=A({queryKey:["admin-support-tickets",o],queryFn:()=>Ns(o)}),{data:b,isLoading:y}=A({queryKey:["support-ticket-stats"],queryFn:Re}),{data:a}=A({queryKey:["ticket-count-by-category"],queryFn:Le}),{data:c}=A({queryKey:["recent-ticket-activity"],queryFn:()=>Ke(10)}),{data:f}=A({queryKey:["support-staff"],queryFn:Ue});J({mutationFn:({ticketId:s,assignedTo:n})=>Fe(s,n),onSuccess:()=>{P.success("Ticket assigned successfully"),i.invalidateQueries({queryKey:["admin-support-tickets"]}),i.invalidateQueries({queryKey:["support-ticket-stats"]})},onError:s=>{var n,_;P.error(((_=(n=s.response)==null?void 0:n.data)==null?void 0:_.message)||"Failed to assign ticket")}}),J({mutationFn:({ticketId:s,status:n,notes:_})=>Pe(s,n,_),onSuccess:()=>{P.success("Ticket status updated successfully"),i.invalidateQueries({queryKey:["admin-support-tickets"]}),i.invalidateQueries({queryKey:["support-ticket-stats"]})},onError:s=>{var n,_;P.error(((_=(n=s.response)==null?void 0:n.data)==null?void 0:_.message)||"Failed to update ticket status")}});const d=(x==null?void 0:x.data)||[],p=b==null?void 0:b.data;a!=null&&a.data;const $=(c==null?void 0:c.data)||[],Ie=(f==null?void 0:f.data)||[],M=(s,n)=>{const _={...o,[s]:n,page:1};N(_);const xe=new URLSearchParams;Object.entries(_).forEach(([ze,H])=>{H!==""&&H!==void 0&&H!==null&&xe.set(ze,H.toString())}),l(xe)},Me=s=>{M("page",s)},Qe=s=>{q(s),r(!0)},Be=s=>{q(s),w(!0)},Ee=s=>{console.log("View ticket details:",s)},Ve=s=>{switch(s){case"open":return"destructive";case"in_progress":return"default";case"waiting_response":return"secondary";case"resolved":return"outline";case"closed":return"outline";default:return"default"}},De=s=>{switch(s){case"urgent":return"destructive";case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"default"}},Oe=s=>{switch(s){case"technical":return"default";case"billing":return"secondary";case"feature_request":return"outline";case"bug_report":return"destructive";case"general":return"secondary";default:return"default"}},$e=s=>{switch(s){case"open":return e.jsx(ae,{className:"h-4 w-4"});case"in_progress":return e.jsx(D,{className:"h-4 w-4"});case"waiting_response":return e.jsx(fe,{className:"h-4 w-4"});case"resolved":return e.jsx(O,{className:"h-4 w-4"});case"closed":return e.jsx(Ne,{className:"h-4 w-4"});default:return e.jsx(ae,{className:"h-4 w-4"})}},ce=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),He=[{header:"Ticket ID",accessor:"ticket_id",sortable:!0,cell:(s,n)=>e.jsx("div",{className:"font-mono text-sm",children:n.ticket_id})},{header:"Title",accessor:"title",sortable:!0,cell:(s,n)=>e.jsx("div",{className:"max-w-xs truncate font-medium",children:n.title})},{header:"User",accessor:"user_email",cell:(s,n)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium text-sm",children:[n.user_first_name," ",n.user_last_name]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n.user_email}),e.jsx(k,{variant:"outline",className:"text-xs",children:n.user_role_display_name})]})},{header:"Category",accessor:"category",sortable:!0,cell:(s,n)=>e.jsx(k,{variant:Oe(n.category),children:n.category.replace("_"," ")})},{header:"Priority",accessor:"priority",sortable:!0,cell:(s,n)=>e.jsx(k,{variant:De(n.priority),children:n.priority})},{header:"Status",accessor:"status",sortable:!0,cell:(s,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[$e(n.status),e.jsx(k,{variant:Ve(n.status),children:n.status.replace("_"," ")})]})},{header:"Assigned To",accessor:"assigned_email",cell:(s,n)=>e.jsx("div",{children:n.assigned_first_name?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium text-sm",children:[n.assigned_first_name," ",n.assigned_last_name]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n.assigned_email})]}):e.jsx(k,{variant:"outline",children:"Unassigned"})})},{header:"Created",accessor:"created_at",sortable:!0,cell:(s,n)=>e.jsx("div",{className:"text-sm text-muted-foreground",children:ce(n.created_at)})}];if(T||y)return e.jsx(ve,{});if(v)return e.jsx(ue,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(R,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Support Tickets"}),e.jsx("p",{className:"text-gray-600 mb-4",children:((oe=(de=v==null?void 0:v.response)==null?void 0:de.data)==null?void 0:oe.message)||"Failed to load support tickets"}),e.jsxs(K,{onClick:()=>window.location.reload(),children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})});const We=Math.ceil(((x==null?void 0:x.count)||0)/(o.limit||20)),Xe=o.page||1;return e.jsxs(ue,{children:[e.jsx(ns,{title:"Admin Support Center",buttonText:"Support Ticket",filterByName:!1}),e.jsxs(ds,{defaultValue:"dashboard",className:"space-y-6",children:[e.jsxs(os,{className:"grid w-full grid-cols-4",children:[e.jsx(W,{value:"dashboard",children:"Dashboard"}),e.jsx(W,{value:"tickets",children:"All Tickets"}),e.jsx(W,{value:"analytics",children:"Analytics"}),e.jsx(W,{value:"staff",children:"Staff Management"})]}),e.jsxs(X,{value:"dashboard",className:"space-y-6",children:[p&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(u,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Total Tickets"}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.total_tickets}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p.tickets_last_24h," in last 24h"]})]})]}),e.jsxs(u,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Open Tickets"}),e.jsx(R,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:p.open_tickets}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p.urgent_tickets," urgent priority"]})]})]}),e.jsxs(u,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"In Progress"}),e.jsx(D,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:p.in_progress_tickets}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p.assigned_tickets," assigned"]})]})]}),e.jsxs(u,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(j,{className:"text-sm font-medium",children:"Resolved"}),e.jsx(O,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.resolved_tickets}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p.tickets_last_week," this week"]})]})]})]}),e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Recent Activity"]}),e.jsx(F,{children:"Latest ticket updates and changes"})]}),e.jsx(h,{children:e.jsx("div",{className:"space-y-4",children:$.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex-shrink-0",children:[s.action==="created"&&e.jsx(Ze,{className:"h-4 w-4 text-green-500"}),s.action==="status_changed"&&e.jsx(G,{className:"h-4 w-4 text-blue-500"}),s.action==="assigned"&&e.jsx(Y,{className:"h-4 w-4 text-purple-500"}),s.action==="priority_changed"&&e.jsx(es,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium",children:s.ticket_title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.notes}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["by ",s.user_first_name," ",s.user_last_name]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"•"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:ce(s.created_at)})]})]})]},s.id))})})]})]}),e.jsxs(X,{value:"tickets",className:"space-y-6",children:[e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-5 w-5"}),"Filters"]})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(ts,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(xs,{placeholder:"Search tickets...",value:o.search||"",onChange:s=>M("search",s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Status"}),e.jsxs(Q,{value:o.status||"",onValueChange:s=>M("status",s==="all"?"":s),children:[e.jsx(B,{children:e.jsx(E,{placeholder:"All statuses"})}),e.jsxs(V,{children:[e.jsx(m,{value:"all",children:"All statuses"}),e.jsx(m,{value:"open",children:"Open"}),e.jsx(m,{value:"in_progress",children:"In Progress"}),e.jsx(m,{value:"waiting_response",children:"Waiting Response"}),e.jsx(m,{value:"resolved",children:"Resolved"}),e.jsx(m,{value:"closed",children:"Closed"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Priority"}),e.jsxs(Q,{value:o.priority||"",onValueChange:s=>M("priority",s==="all"?"":s),children:[e.jsx(B,{children:e.jsx(E,{placeholder:"All priorities"})}),e.jsxs(V,{children:[e.jsx(m,{value:"all",children:"All priorities"}),e.jsx(m,{value:"urgent",children:"Urgent"}),e.jsx(m,{value:"high",children:"High"}),e.jsx(m,{value:"medium",children:"Medium"}),e.jsx(m,{value:"low",children:"Low"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Category"}),e.jsxs(Q,{value:o.category||"",onValueChange:s=>M("category",s==="all"?"":s),children:[e.jsx(B,{children:e.jsx(E,{placeholder:"All categories"})}),e.jsxs(V,{children:[e.jsx(m,{value:"all",children:"All categories"}),e.jsx(m,{value:"technical",children:"Technical"}),e.jsx(m,{value:"billing",children:"Billing"}),e.jsx(m,{value:"feature_request",children:"Feature Request"}),e.jsx(m,{value:"bug_report",children:"Bug Report"}),e.jsx(m,{value:"general",children:"General"})]})]})]})]})})]}),e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Support Tickets"}),e.jsxs(F,{children:["Showing ",d.length," of ",(x==null?void 0:x.count)||0," tickets"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(K,{variant:"outline",size:"sm",children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:()=>i.invalidateQueries({queryKey:["admin-support-tickets"]}),children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]})}),e.jsxs(h,{children:[e.jsx(is,{data:d,columns:He,onRowClick:s=>console.log("Ticket clicked",s),actions:[{label:"View Details",icon:e.jsx(rs,{className:"h-4 w-4"}),onClick:s=>Ee(s),variant:"ghost"},{label:"Assign",icon:e.jsx(Y,{className:"h-4 w-4"}),onClick:s=>Qe(s),variant:"ghost"},{label:"Update Status",icon:e.jsx(G,{className:"h-4 w-4"}),onClick:s=>Be(s),variant:"ghost"}]}),e.jsx("div",{className:"mt-6 border-t border-gray-200 pt-4",children:e.jsx(ls,{currentPage:Xe,totalPages:We,onPageChange:Me})})]})]})]}),e.jsx(X,{value:"analytics",className:"space-y-6",children:e.jsx(_s,{})}),e.jsx(X,{value:"staff",className:"space-y-6",children:e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Support Staff"]}),e.jsx(F,{children:"Manage support team members and assignments"})]}),e.jsx(h,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Ie.map(s=>e.jsx(u,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(te,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium",children:[s.first_name," ",s.last_name]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(k,{variant:"outline",className:"text-xs",children:s.role_display_name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.assigned_tickets_count," active tickets"]})]})]})]})})},s.id))})})]})})]}),e.jsx(ys,{isOpen:S,onClose:()=>r(!1),ticket:C}),e.jsx(ws,{isOpen:L,onClose:()=>w(!1),ticket:C})]})};export{Vs as default};
//# sourceMappingURL=AdminSupport-Bzi1FIyr.js.map
