import{j as e,bz as z,bA as E,Q as K,T as Q,F as w,ba as X,ah as G,C as W,V as Y,X as Z,aq as ee}from"./ui-CZ40mCLE.js";import{r as o}from"./vendor-DG599jyl.js";import{b as U}from"./query-Dkjx6fBT.js";import{a as v,t as x,C as p,b as u,B as T,w as se,c as M,d as V,I as A,S as ae,f as te,g as re,h as ne,i as y,n as le,q as ie,z as de,r as ce,s as oe,v as xe}from"./index-DAuDxp-c.js";import{C as me}from"./calendar-Cb7UHr_4.js";import{P as he,a as ge,b as pe}from"./popover-C9xN7H2Y.js";import{T as ue,a as be,b as P,c as b,d as je,e as j}from"./table-DKSJ-9yH.js";import{f}from"./format-C-QuTXqM.js";import"./router-BnJytTjr.js";async function fe(r={}){var n,i;try{const t=new URLSearchParams;return Object.entries(r).forEach(([m,a])=>{a!=null&&a!==""&&t.append(m,String(a))}),(await v.get(`/api/audit-logs?${t.toString()}`)).data}catch(t){console.error("Error fetching audit logs:",t);const d=((i=(n=t.response)==null?void 0:n.data)==null?void 0:i.message)||"Failed to fetch audit logs";throw x.error(d),t}}async function Ne(r={}){var n,i;try{const t=new URLSearchParams;return Object.entries(r).forEach(([m,a])=>{a!=null&&a!==""&&t.append(m,String(a))}),(await v.get(`/api/audit-logs/stats?${t.toString()}`)).data}catch(t){console.error("Error fetching audit log stats:",t);const d=((i=(n=t.response)==null?void 0:n.data)==null?void 0:i.message)||"Failed to fetch audit log statistics";throw x.error(d),t}}async function ye(r={}){var n,i;try{const t=new URLSearchParams;Object.entries(r).forEach(([m,a])=>{a!=null&&a!==""&&t.append(m,String(a))});const d=await v.get(`/api/audit-logs/export?${t.toString()}`);return x.success("Audit logs exported successfully"),d.data}catch(t){console.error("Error exporting audit logs:",t);const d=((i=(n=t.response)==null?void 0:n.data)==null?void 0:i.message)||"Failed to export audit logs";throw x.error(d),t}}async function we(r=90){var n,i;try{const t=await v.delete(`/api/audit-logs/cleanup?days=${r}`);return x.success(`Cleaned up audit logs older than ${r} days`),t.data}catch(t){console.error("Error cleaning up audit logs:",t);const d=((i=(n=t.response)==null?void 0:n.data)==null?void 0:i.message)||"Failed to cleanup audit logs";throw x.error(d),t}}function ve(r){return{CREATE:"Created",UPDATE:"Updated",DELETE:"Deleted",READ:"Viewed"}[r]||r}function _e(r){return r.split("_").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ")}function Ce(r){return{CREATE:"text-green-600 bg-green-50",UPDATE:"text-blue-600 bg-blue-50",DELETE:"text-red-600 bg-red-50",READ:"text-gray-600 bg-gray-50",Login:"text-emerald-600 bg-emerald-50",Logout:"text-orange-600 bg-orange-50"}[r]||"text-gray-600 bg-gray-50"}const Ue=()=>{const[r,n]=o.useState({limit:50,offset:0,sort_by:"created_at",sort_order:"DESC"}),[i,t]=o.useState(""),[d,m]=o.useState(!1),[a,I]=o.useState({from:void 0,to:void 0}),$=s=>{I(s||{from:void 0,to:void 0})},[L,D]=o.useState(!1),[F,k]=o.useState(!1),[Se,H]=o.useState(null),{data:l,isLoading:_,error:q,refetch:C}=U({queryKey:["auditLogs",r],queryFn:()=>fe(r),refetchInterval:2*60*1e3,staleTime:30*1e3,gcTime:5*60*1e3}),{data:h}=U({queryKey:["auditLogStats",r],queryFn:()=>Ne(r)});o.useEffect(()=>{const s=setTimeout(()=>{n(i?c=>({...c,user_email:i,offset:0}):c=>{const{user_email:g,...N}=c;return{...N,offset:0}})},500);return()=>clearTimeout(s)},[i]),o.useEffect(()=>{(a.from||a.to)&&n(s=>({...s,start_date:a.from?f(a.from,"yyyy-MM-dd"):void 0,end_date:a.to?f(a.to,"yyyy-MM-dd"):void 0,offset:0}))},[a]);const S=(s,c)=>{n(g=>({...g,[s]:c,offset:0}))},B=async()=>{D(!0);try{const s=await ye(r);x.success(`Exported ${s.data.recordCount} records to ${s.data.filename}`)}catch(s){console.error("Export failed:",s)}finally{D(!1)}},J=async()=>{k(!0);try{const s=await we(90);x.success(`Cleaned up ${s.data.deletedCount} old audit log entries`),C()}catch(s){console.error("Cleanup failed:",s)}finally{k(!1)}},O=s=>{const c=r.offset||0,g=r.limit||50;n(s==="next"?N=>({...N,offset:c+g}):N=>({...N,offset:Math.max(0,c-g)}))},R=s=>f(new Date(s),"MMM dd, yyyy HH:mm:ss");return q?e.jsx("div",{className:"p-6",children:e.jsx(p,{children:e.jsx(u,{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(z,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Audit Logs"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Failed to load audit logs. Please try again."}),e.jsxs(T,{onClick:()=>C(),children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):e.jsxs("div",{className:`
      min-h-screen
      app-shell-bg
      p-6 space-y-6
      text-slate-100
      font-sans
    `,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-white/70 tracking-wide",children:"Audit Logs"}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Track all system activities and changes"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"neo-btn flex items-center gap-2",onClick:()=>C(),disabled:_,children:[e.jsx(E,{className:se("h-4 w-4 mr-2",_&&"animate-spin")}),"Refresh"]}),e.jsxs("button",{className:`
               px-5 py-2
    rounded-lg
    text-sm font-semibold
    text-white
    bg-[linear-gradient(180deg,rgba(90,110,255,0.45),rgba(36,46,151,0.35))]
    border border-white/15
    shadow-[0_2px_5px_rgba(90,110,255,0.45)]
    hover:shadow-[0_5px_10px_rgba(90,110,255,0.65)]
    hover:bg-[linear-gradient(180deg,rgba(90,110,255,0.6),rgba(36,46,151,0.45))]
    disabled:opacity-40
    disabled:cursor-not-allowed
    transition-all
    flex items-center gap-2
            
            `,onClick:B,disabled:L,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),L?"Exporting...":"Export"]}),e.jsxs("button",{className:"neo-btn flex items-center gap-2 text-red-300 hover:text-red-200",style:{background:"linear-gradient(180deg, rgba(255,77,79,0.25), rgba(168,14,34,0.25))",borderColor:"rgba(255,77,79,0.35)"},onClick:J,disabled:F,children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),F?"Cleaning...":"Cleanup Old"]})]})]}),(h==null?void 0:h.data)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(p,{className:"neo-card border-none",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white",children:"Total Operations"}),e.jsx("p",{className:"text-2xl text-white font-bold",children:h.data.operationStats.reduce((s,c)=>s+c.count,0)})]})]})})}),e.jsx(p,{className:"neo-card border-none",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white",children:"Active Users"}),e.jsx("p",{className:"text-2xl text-white font-bold",children:h.data.userStats.length})]})]})})}),e.jsx(p,{className:"neo-card border-none",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white",children:"Tables Affected"}),e.jsx("p",{className:"text-2xl text-white font-bold",children:h.data.tableStats.length})]})]})})}),e.jsx(p,{className:"neo-card border-none",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white",children:"Days Tracked"}),e.jsx("p",{className:"text-2xl text-white font-bold",children:h.data.dailyActivity.length})]})]})})})]}),e.jsxs(p,{className:"neo-card border-none",children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(V,{className:"flex items-center gap-2 text-white",children:[e.jsx(Y,{className:"h-5 w-5 text-white"}),"Filters & Search"]}),e.jsxs("button",{className:"neo-btn flex items-center gap-2",onClick:()=>m(!d),children:[d?"Hide":"Show"," Advanced Filters"]})]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(A,{placeholder:"Search by user email...",value:i,onChange:s=>t(s.target.value),className:`
    pl-10
    bg-black/30
    border-white/10
    text-white
    placeholder:text-slate-500
    focus:border-cyan-400/50
    focus:ring-cyan-400/30
  `})]}),d&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 pt-4 border-t",children:[e.jsxs(ae,{value:r.operation_type||"",onValueChange:s=>S("operation_type",s||void 0),children:[e.jsx(te,{children:e.jsx(re,{placeholder:"Operation Type"})}),e.jsxs(ne,{children:[e.jsx(y,{value:"",children:"All Operations"}),e.jsx(y,{value:"CREATE",children:"Create"}),e.jsx(y,{value:"UPDATE",children:"Update"}),e.jsx(y,{value:"DELETE",children:"Delete"}),e.jsx(y,{value:"READ",children:"Read"})]})]}),e.jsx(A,{placeholder:"Table name...",value:r.table_name||"",onChange:s=>S("table_name",s.target.value||void 0)}),e.jsx(A,{placeholder:"Record ID...",value:r.record_id||"",onChange:s=>S("record_id",s.target.value||void 0)}),e.jsxs(he,{children:[e.jsx(ge,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:`
    bg-black/30
    border-white/10
    text-slate-200
    hover:border-cyan-400/40
    hover:shadow-[0_0_16px_rgba(34,211,238,0.25)]
  `,children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),a.from?a.to?e.jsxs(e.Fragment,{children:[f(a.from,"LLL dd, y")," -"," ",f(a.to,"LLL dd, y")]}):f(a.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date range"})]})}),e.jsx(pe,{className:"w-auto p-0",align:"start",children:e.jsx(me,{initialFocus:!0,mode:"range",defaultMonth:a.from,selected:a.from?a:void 0,onSelect:$,numberOfMonths:2})})]})]})]})]}),e.jsxs(p,{className:"neo-card border-none",children:[e.jsx(M,{children:e.jsxs(V,{className:"flex items-center gap-2 text-white",children:[e.jsx(w,{className:"h-5 w-5 text-white"}),"Audit Log Entries",(l==null?void 0:l.pagination)&&e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["(",l.pagination.total," total)"]})]})}),e.jsx(u,{children:_?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(E,{className:"h-8 w-8 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-white",children:"Loading audit logs..."})]}):l!=null&&l.data&&l.data.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-xl border border-white/10 overflow-hidden",children:e.jsxs(ue,{children:[e.jsx(be,{children:e.jsxs(P,{children:[e.jsx(b,{className:"text-slate-300",children:"Timestamp"}),e.jsx(b,{className:"text-slate-300",children:"User"}),e.jsx(b,{className:"text-slate-300",children:"Operation"}),e.jsx(b,{className:"text-slate-300",children:"Table"}),e.jsx(b,{className:"text-slate-300",children:"IP Address"}),e.jsx(b,{className:"text-slate-300",children:"Browser"}),e.jsx(b,{className:"text-slate-300",children:"Values"})]})}),e.jsx(je,{children:l.data.map(s=>e.jsxs(P,{className:`
                      hover:bg-cyan-500/5
                      transition
                    `,children:[e.jsx(j,{className:"font-mono text-sm text-white",children:R(s.created_at)}),e.jsx(j,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.user_name||"Unknown"}),e.jsx("p",{className:"text-sm text-gray-500 text-white/70",children:s.user_email||"N/A"})]})}),e.jsx(j,{children:e.jsx(le,{className:Ce(s.display_operation||s.operation_type),children:s.display_operation||ve(s.operation_type)})}),e.jsx(j,{children:e.jsx("code",{className:"text-sm bg-gray-100 px-2 py-1 rounded",children:_e(s.table_name)})}),e.jsx(j,{children:e.jsx("span",{className:"text-sm font-mono text-white",children:s.ip_address||"N/A"})}),e.jsx(j,{children:e.jsx("span",{className:"text-sm text-white",children:s.browser_info||"Unknown"})}),e.jsx(j,{children:e.jsx("div",{className:"max-w-xs",children:s.old_values||s.new_values?e.jsxs(ie,{children:[e.jsx(de,{asChild:!0,children:e.jsx(T,{variant:"outline",size:"sm",className:`
    bg-cyan-500/10
    text-cyan-300
    border border-cyan-400/30
    hover:bg-cyan-500/25
    hover:shadow-[0_0_16px_rgba(34,211,238,0.45)]
  `,onClick:()=>H({id:s.id,oldValues:s.old_values,newValues:s.new_values,operation:s.display_operation||s.operation_type,table:s.table_name,timestamp:s.created_at}),children:"View Values"})}),e.jsxs(ce,{className:`
    max-w-4xl max-h-[80vh] overflow-y-auto
    bg-[#020617]
    border border-cyan-400/30
    text-slate-200
    shadow-[0_0_60px_rgba(34,211,238,0.35)]
  `,children:[e.jsxs(oe,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),"Audit Log Values -"," ",s.display_operation||s.operation_type]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:["Table:"," ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:s.table_name})]}),e.jsxs("p",{children:["Timestamp:"," ",R(s.created_at)]}),e.jsxs("p",{children:["User: ",s.user_email||"Unknown"]})]})]}),e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-red-700 mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),"Old Values"]}),s.old_values?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("pre",{className:"text-sm text-red-800 whitespace-pre-wrap overflow-auto",children:JSON.stringify(s.old_values,null,2)})}):e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-gray-500 italic",children:"No old values"})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-green-700 mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),"New Values"]}),s.new_values?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsx("pre",{className:"text-sm text-green-800 whitespace-pre-wrap overflow-auto",children:JSON.stringify(s.new_values,null,2)})}):e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-gray-500 italic",children:"No new values"})})]}),s.changed_fields&&s.changed_fields.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-700 mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),"Changed Fields"]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("div",{className:"space-y-2",children:s.changed_fields.map((c,g)=>e.jsxs("div",{className:"border-b border-blue-200 pb-2 last:border-b-0",children:[e.jsx("p",{className:"font-medium text-blue-800",children:c.field}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"Old:"}),e.jsx("p",{className:"text-sm text-red-700 bg-red-100 p-1 rounded",children:JSON.stringify(c.oldValue)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"New:"}),e.jsx("p",{className:"text-sm text-green-700 bg-green-100 p-1 rounded",children:JSON.stringify(c.newValue)})]})]})]},g))})})]})]})]})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"No values"})})})]},s.id))})]})}),l.pagination&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",l.pagination.offset+1," to"," ",Math.min(l.pagination.offset+l.pagination.limit,l.pagination.total)," ","of ",l.pagination.total," entries"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>O("prev"),disabled:l.pagination.offset===0,className:`
                      px-5 py-2
    rounded-lg
    text-sm font-semibold
    text-white
    bg-[linear-gradient(180deg,rgba(90,110,255,0.45),rgba(36,46,151,0.35))]
    border border-white/15
    shadow-[0_2px_5px_rgba(90,110,255,0.45)]
    hover:shadow-[0_5px_10px_rgba(90,110,255,0.65)]
    hover:bg-[linear-gradient(180deg,rgba(90,110,255,0.6),rgba(36,46,151,0.45))]
    disabled:opacity-40
    disabled:cursor-not-allowed
    transition-all
    flex items-center gap-2
                    `,children:"Previous"}),e.jsx("button",{onClick:()=>O("next"),disabled:!l.pagination.hasMore,className:`
                      px-5 py-2
    rounded-lg
    text-sm font-semibold
    text-white
    bg-[linear-gradient(180deg,rgba(90,110,255,0.45),rgba(36,46,151,0.35))]
    border border-white/15
    shadow-[0_2px_5px_rgba(90,110,255,0.45)]
    hover:shadow-[0_5px_10px_rgba(90,110,255,0.65)]
    hover:bg-[linear-gradient(180deg,rgba(90,110,255,0.6),rgba(36,46,151,0.45))]
    disabled:opacity-40
    disabled:cursor-not-allowed
    transition-all
    flex items-center gap-2
                    `,children:"Next"})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Audit Logs Found"}),e.jsx("p",{className:"text-gray-600",children:"No audit log entries match your current filters."})]})})]})]})};export{Ue as default};
//# sourceMappingURL=AuditLogs-DuZn3Qmb.js.map
