import{j as e,bT as Is,aI as it,T as Ls,ax as ee,K as nt,X as Tt,d as Ds,bJ as $t,N as _s,bG as Ms,aC as Q,aw as Ut,F as Ts,aS as ue,bU as $s,bz as Ht,C as Us,ba as Hs,bV as Rs,aB as qs,bW as zs,bX as Os,bY as Bs,aP as Vs,bZ as Ws,bL as Xs}from"./ui-h9OBLyTx.js";import{r as a}from"./vendor-DG599jyl.js";import{P as Ys}from"./Page-UYQEDYff.js";import{a as $,t as r,u as Ot,E as Js,L as E,I as v,T as Ks,g as Qs,h as Zs,i as ea,j as ta,k as ge,B as u,F as sa,G as aa,H as la,J as ra,s as ct,v as ot,w as dt,x as mt,K as ia,M as na,p as et,D as ca,l as oa,n as da,o as tt,N as Rt,O as ma,P as ha,Q as xa,R as ua,U as st,V as at,W as ga,y as fa,X as ba}from"./index-1Kut4QPD.js";import{createOutboundCall as wa,unmuteCall as pa,muteCall as Na,endCallViaControl as ja}from"./outboundService-BXuCOYcJ.js";import{f as va}from"./agentService-XBEBl7PS.js";import{g as Ca}from"./phoneNumberService-6YBpulmz.js";import{g as ya,f as Sa,h as qt,a as Ea,b as ka,c as Aa,C as Fa}from"./CallRecordingPlayer-Cg1NNuG3.js";import{d as Pa,u as Ga}from"./router-BnJytTjr.js";import{u as Ia,c as La,C as Da}from"./resolvers-BTaHPCFs.js";import{o as _a,c as zt,b as Ma,a as Z}from"./index.esm-Vx42pWrl.js";import{P as Ta,C as $a}from"./ChatSidebar-DSJZyVSc.js";import{S as Ua,a as Ha,b as Ra,c as qa,d as za}from"./sheet-CZUPNC9s.js";import{A as lt,a as rt}from"./avatar-B7TUH61l.js";import{u as Oa}from"./usePermissions-DU0PmiEf.js";import{A as Ba,a as Va,b as Wa,c as Xa,d as Ya,e as Ja,f as Ka,g as Qa}from"./alert-dialog-ghUcSW01.js";import"./query-B7U7fZu0.js";import"./slider-Dd63EwNc.js";import"./messagingService-4sU173uo.js";import"./CreatePhoneNumberForm-BAv4dmAZ.js";async function Bt(){try{const d=await $.get("/api/contact-gmail/auth/status");if(d.data.success)return d.data.data;throw new Error(d.data.message||"Failed to get Contact Gmail status")}catch(d){return console.error("Error getting Contact Gmail status:",d),{isConnected:!1,email:null}}}async function Za(){var d,f;try{const i=await $.get("/api/contact-gmail/auth/url");if(i.data.success){const n=window.open(i.data.data.authUrl,"contact_gmail_oauth","width=500,height=600,scrollbars=yes,resizable=yes");if(!n){r.error("Popup blocked. Please allow popups and try again.");return}return new Promise((l,M)=>{let p=!1;const k=c=>{if(console.log("ðŸ“¨ Received postMessage:",c.data,"from origin:",c.origin),!c.data||!c.data.type||!c.data.type.startsWith("CONTACT_GMAIL_")){console.log("âŒ Ignoring non-Contact Gmail message");return}p||(c.data.type==="CONTACT_GMAIL_SUCCESS"?(console.log("âœ… Contact Gmail success received"),p=!0,window.removeEventListener("message",k),r.success(`Contact Gmail connected successfully! (${c.data.email})`),l()):c.data.type==="CONTACT_GMAIL_ERROR"&&(console.log("âŒ Contact Gmail error received:",c.data.error),p=!0,window.removeEventListener("message",k),r.error(`Failed to connect Contact Gmail: ${c.data.error}`),M(new Error(c.data.error))))};window.addEventListener("message",k);const o=setInterval(()=>{if(n.closed){if(clearInterval(o),console.log("ðŸ”’ OAuth tab was closed"),p)return;window.removeEventListener("message",k),setTimeout(async()=>{if(!p){console.log("ðŸ” Checking Contact Gmail status after tab close...");try{(await Bt()).isConnected?(console.log("âœ… Contact Gmail is connected despite no postMessage"),p=!0,r.success("Contact Gmail connected successfully!"),l()):(console.log("âŒ Contact Gmail is not connected"),p=!0,M(new Error("Contact Gmail connection was cancelled")))}catch(c){console.log("âŒ Error checking Contact Gmail status:",c),p=!0,M(new Error("Contact Gmail connection was cancelled"))}}},2e3)}},1e3);setTimeout(()=>{p||(clearInterval(o),window.removeEventListener("message",k),n.closed||n.close(),p=!0,M(new Error("Contact Gmail connection timeout")))},3e5)})}else throw new Error(i.data.message||"Failed to generate Contact Gmail auth URL")}catch(i){console.error("Error connecting Contact Gmail:",i);const n=((f=(d=i.response)==null?void 0:d.data)==null?void 0:f.message)||"Failed to connect Contact Gmail";throw r.error(n),i}}async function el(){var d,f;try{const i=await $.delete("/api/contact-gmail/auth/disconnect");if(i.data.success){r.success("Contact Gmail disconnected successfully!");return}throw new Error(i.data.message||"Failed to disconnect Contact Gmail")}catch(i){console.error("Error disconnecting Contact Gmail:",i);const n=((f=(d=i.response)==null?void 0:d.data)==null?void 0:f.message)||"Failed to disconnect Contact Gmail";throw r.error(n),i}}async function tl(d){var f,i;try{const n=await $.post("/api/contact-gmail/send",d);if(n.data.success)return r.success("Email sent successfully via Contact Gmail!"),n.data.data;throw new Error(n.data.message||"Failed to send email via Contact Gmail")}catch(n){console.error("Error sending Contact Gmail email:",n);const l=((i=(f=n.response)==null?void 0:f.data)==null?void 0:i.message)||"Failed to send email via Contact Gmail";throw r.error(l),n}}async function sl(d){var f,i;try{const n=await $.post("/api/email/send",d);if(n.data.success){const l=n.data.data;return l.testMode?r.success("Email logged successfully (Test Mode)"):r.success(`Email sent successfully via ${l.provider}!`),n.data.data}throw new Error(n.data.message||"Failed to send email")}catch(n){console.error("Error sending email:",n);const l=((i=(f=n.response)==null?void 0:f.data)==null?void 0:i.message)||"Failed to send email";throw r.error(l),n}}async function al(){var d,f;try{const i=await $.get("/api/email/status");if(i.data.success)return i.data.data;throw new Error(i.data.message||"Failed to get email service status")}catch(i){throw console.error("Error getting email service status:",i),(f=(d=i.response)==null?void 0:d.data)!=null&&f.message,i}}const ll=zt().shape({listName:Z().required("List Name is required").min(2,"List Name must be at least 2 characters"),description:Z().required("Description is required"),type:Z().required("Type is required"),contacts:Ma().of(zt().shape({fullName:Z().required("Full Name is required").min(2,"Full Name must be at least 2 characters"),email:Z().required("Email is required").email("Email is invalid"),phoneNumber:Z().required("Phone Number is required").min(10,"Phone Number must be at least 10 digits")})).required("Contacts are required").min(1,"At least one contact is required")});function rl(){a.useRef(null);const[d,f]=a.useState(!1),[i,n]=a.useState(0),{user:l}=Ot(),{isSuperAdmin:M}=Js(),{register:p,control:k,handleSubmit:o,formState:{errors:c,isSubmitting:fe},reset:be,watch:Ie,setValue:we}=Ia({resolver:_a(ll),defaultValues:{listName:"",description:"",type:"General",contacts:[{fullName:"",email:"",phoneNumber:""}]}}),{fields:U,append:Le,remove:H}=La({control:k,name:"contacts"}),De=()=>{var m,A;const C=sa.getItem("token");if(!C)return console.log("No token found in storage"),null;try{const h=aa(C);console.log("Decoded token:",h);let y=null;return(m=h.user)!=null&&m.id?y=h.user.id:(A=h.user)!=null&&A.user_id?y=h.user.user_id:h.id?y=h.id:h.user_id&&(y=h.user_id),console.log("Extracted userId:",y),y}catch(h){return console.error("Error decoding token:",h),null}},ht=async C=>{if(!M)try{const h=(await $.get("/api/credits/balance")).data.data;if(!h||parseFloat(h.available_credits)<1){n((h==null?void 0:h.available_credits)||0),f(!0);return}}catch(A){console.error("Error checking credit balance:",A),r.error("Unable to verify credit balance. Please try again.");return}const m=De();if(!m){r.error("User ID not found. Please log in again.");return}try{const A=await la({listName:C.listName,description:C.description,type:C.type}),h=C.contacts.map(R=>({email:R.email,contact_number:R.phoneNumber,first_name:R.fullName})),y={user_id:m,list_name:C.listName,list_description:C.description,contacts:h};await ra(y),be({listName:"",description:"",type:"General",contacts:[{fullName:"",email:"",phoneNumber:""}]}),r.success("Contact List created successfully!"),typeof window<"u"&&window.location.reload()}catch(A){console.error("Error submitting form:",A),r.error("Failed to create contact list. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(Ua,{className:"text-xl font-semibold jakarta text-white mb-1",children:"Create Contact List"}),e.jsx(Ha,{className:"text-white/60 mb-6",children:"Create a new contact list for your voice AI agents to use for campaigns."}),e.jsxs("form",{onSubmit:o(ht),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4 bg-white/5 border border-white/10 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Is,{className:"h-5 w-5 text-indigo-400"}),e.jsx("h3",{className:"text-sm font-medium text-white",children:"List Information"})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"listName",className:"text-sm font-medium text-white mb-1.5 block",children:["List Name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(v,{id:"listName",placeholder:"Enter contact list name",className:"w-full bg-white/5 border-white/20 text-white placeholder:text-white/40 focus:border-indigo-500/50",...p("listName")}),c.listName&&e.jsx("p",{className:"mt-1 text-xs text-red-400",children:c.listName.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"description",className:"text-sm font-medium text-white mb-1.5 block",children:["Description",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Ks,{id:"description",placeholder:"Enter contact list description",className:"w-full min-h-[80px] bg-white/5 border-white/20 text-white placeholder:text-white/40 focus:border-indigo-500/50",...p("description")}),c.description&&e.jsx("p",{className:"mt-1 text-xs text-red-400",children:c.description.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"type",className:"text-sm font-medium text-white mb-1.5 block",children:["Type",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(Qs,{value:Ie("type"),onValueChange:C=>we("type",C),children:[e.jsx(Zs,{className:"w-full bg-white/5 border-white/20 text-white focus:border-indigo-500/50",children:e.jsx(ea,{placeholder:"Select list type"})}),e.jsxs(ta,{className:"bg-[#0e1340] border-white/10",children:[e.jsx(ge,{value:"General",className:"text-white hover:bg-white/10 focus:bg-white/10",children:"General"}),e.jsx(ge,{value:"Marketing",className:"text-white hover:bg-white/10 focus:bg-white/10",children:"Marketing"}),e.jsx(ge,{value:"Sales",className:"text-white hover:bg-white/10 focus:bg-white/10",children:"Sales"}),e.jsx(ge,{value:"Event",className:"text-white hover:bg-white/10 focus:bg-white/10",children:"Event"}),e.jsx(ge,{value:"Customer",className:"text-white hover:bg-white/10 focus:bg-white/10",children:"Customer"})]})]}),c.type&&e.jsx("p",{className:"mt-1 text-xs text-red-400",children:c.type.message})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(it,{className:"h-5 w-5 text-indigo-400"}),e.jsx("h3",{className:"text-sm font-medium text-white",children:"Contacts"}),e.jsx("span",{className:"text-xs text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-4",children:[U.map((C,m)=>{var A,h,y,R,pe,Ne,W,je,q;return e.jsxs("div",{className:"border border-indigo-500/30 rounded-lg p-4 mb-4 relative bg-indigo-500/10",children:[U.length>1&&e.jsx("button",{type:"button",onClick:()=>H(m),className:"absolute top-3 right-3 text-white/40 hover:text-red-400 transition-colors",title:"Remove Contact",children:e.jsx(Ls,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx("div",{className:"h-6 w-6 bg-indigo-500/20 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-indigo-400",children:m+1})}),e.jsxs("h4",{className:"text-sm font-medium text-white",children:["Contact ",m+1]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs(E,{htmlFor:`contacts.${m}.fullName`,className:"text-sm font-medium text-white mb-1.5 block",children:["Full Name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"relative",children:e.jsx(v,{id:`contacts.${m}.fullName`,type:"text",placeholder:"Enter full name",className:"w-full bg-white/5 border-white/20 text-white placeholder:text-white/40 focus:border-indigo-500/50",...p(`contacts.${m}.fullName`)})}),((h=(A=c.contacts)==null?void 0:A[m])==null?void 0:h.fullName)&&e.jsx("p",{className:"mt-1 text-xs text-red-400",children:(y=c.contacts[m].fullName)==null?void 0:y.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:`contacts.${m}.email`,className:"text-sm font-medium text-white mb-1.5 block",children:["Email",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-white/40"}),e.jsx(v,{id:`contacts.${m}.email`,type:"email",placeholder:"Enter contact email",className:"w-full pl-10 bg-white/5 border-white/20 text-white placeholder:text-white/40 focus:border-indigo-500/50",...p(`contacts.${m}.email`)})]}),((pe=(R=c.contacts)==null?void 0:R[m])==null?void 0:pe.email)&&e.jsx("p",{className:"mt-1 text-xs text-red-400",children:(Ne=c.contacts[m].email)==null?void 0:Ne.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:`contacts.${m}.phoneNumber`,className:"text-sm font-medium text-white mb-1.5 block",children:["Phone Number",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Da,{name:`contacts.${m}.phoneNumber`,control:k,render:({field:{onChange:_e,value:Me}})=>e.jsx(Ta,{country:"us",value:Me,onChange:X=>_e(`+${X}`),containerClass:"w-full neo-phone-container",inputClass:"neo-phone-input",buttonClass:"neo-phone-flag",dropdownClass:"neo-phone-dropdown",searchClass:"neo-phone-search",inputProps:{name:`contacts.${m}.phoneNumber`,required:!0,autoFocus:!1},placeholder:"Enter phone number",enableSearch:!0,disableSearchIcon:!0})}),((je=(W=c.contacts)==null?void 0:W[m])==null?void 0:je.phoneNumber)&&e.jsx("p",{className:"mt-1 text-xs text-red-400",children:(q=c.contacts[m].phoneNumber)==null?void 0:q.message})]})]})]},C.id)}),e.jsxs("button",{type:"button",className:"w-full bg-white/5 border-dashed border-white/20 text-white hover:bg-white/10 flex items-center justify-center gap-2 py-6",onClick:()=>Le({fullName:"",email:"",phoneNumber:""}),children:[e.jsx(nt,{className:"w-4 h-4"}),"Add Another Contact"]})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-3",children:[e.jsx(Ra,{asChild:!0,children:e.jsx(u,{type:"button",variant:"outline",className:"border-white/20 text-white hover:bg-white/10",children:"Cancel"})}),e.jsx(u,{type:"submit",className:"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white",disabled:fe,children:fe?"Creating...":"Create List"})]})]}),e.jsx(ct,{open:d,onOpenChange:f,children:e.jsxs(ot,{className:"sm:max-w-md bg-[#0e1340] border-white/10",children:[e.jsx(dt,{children:e.jsxs(mt,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Insufficient Credits"}),e.jsx("p",{className:"text-sm text-white/60 font-normal",children:"You need credits to create contact lists"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white/5 p-4 rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-white/60",children:"Current Balance:"}),e.jsxs("span",{className:"font-semibold text-white",children:[i," credits"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-sm text-white/60",children:"Required:"}),e.jsx("span",{className:"font-semibold text-red-400",children:"1 credit minimum"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{variant:"outline",onClick:()=>f(!1),className:"flex-1 border-white/20 text-white hover:bg-white/10",children:"Cancel"}),e.jsx(u,{onClick:()=>{f(!1),window.location.href="/credits"},className:"flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white",children:"Buy Credits"})]})]})]})})]})}const Al=()=>{Pa(),Ga();const{isSuperAdmin:d}=Oa(),{user:f}=Ot(),[i,n]=a.useState([]),[l,M]=a.useState(null),[p,k]=a.useState([]),[o,c]=a.useState(null),[fe,be]=a.useState(!0),[Ie,we]=a.useState(!1),[U,Le]=a.useState(""),[H,De]=a.useState(""),[ht,C]=a.useState("list"),[m,A]=a.useState("list"),[h,y]=a.useState(1),[R,pe]=a.useState(0),[Ne,W]=a.useState(!1),[je,q]=a.useState(!1),[_e,Me]=a.useState(0),[X,te]=a.useState(!1),[F,se]=a.useState({fullName:"",email:"",phoneNumber:""}),[Vt,ve]=a.useState(!1),[G,Y]=a.useState({fullName:"",email:"",phoneNumber:""}),[Wt,ae]=a.useState(!1),[S,Xt]=a.useState(null),[z,Yt]=a.useState([]),[xt,Jt]=a.useState([]),[O,Te]=a.useState(""),[J,$e]=a.useState(""),[ut,gt]=a.useState(!1),[I,Ue]=a.useState(null),[T,He]=a.useState(!1),[le,Ce]=a.useState(!1),[B,Re]=a.useState(!1),[L,qe]=a.useState(null),[Kt,ye]=a.useState(0),[Se,ze]=a.useState(null),[D,Oe]=a.useState(null),[ft,Be]=a.useState(null),[Ve,We]=a.useState([]),[Qt,bt]=a.useState(!1),[wt,pt]=a.useState(1),[Nt,Xe]=a.useState(0),[Zt,jt]=a.useState(null),[es,vt]=a.useState(!1),[ts,Ct]=a.useState(!1),[Ee,yt]=a.useState(null),[ss,ke]=a.useState(!1),[K,as]=a.useState(null),[g,V]=a.useState({to:"",cc:"",bcc:"",subject:"",body:"",attachments:[]}),[Ye,St]=a.useState(!1),[Ae,Et]=a.useState(!1),[il,kt]=a.useState(!1),[Je,At]=a.useState(!1),[ls,Ft]=a.useState(!1),[rs,Ke]=a.useState(""),[Pt,Gt]=a.useState(!1),[It,Lt]=a.useState(!1),re=async()=>{Ft(!0);try{kt(!0);try{const t=await Bt();Et(t.isConnected),t.isConnected&&t.email?Ke(t.email):Ke("")}catch(t){console.error("Error checking Contact Gmail status:",t),Et(!1),Ke("")}finally{kt(!1)}try{const t=await al();At(t.isConfigured)}catch(t){console.error("Error checking SMTP status:",t),At(!1)}return{gmailConnected:Ae,smtpAvailable:Je}}finally{Ft(!1)}},is=async()=>{Gt(!0);try{await Za(),await re()}catch(t){console.error("Error connecting Contact Gmail:",t)}finally{Gt(!1)}},ns=async()=>{Lt(!0);try{await el(),await re()}catch(t){console.error("Error unlinking Contact Gmail:",t)}finally{Lt(!1)}},cs=async()=>{if(d){W(!0);return}try{const s=(await $.get("/api/credits/balance")).data.data;if(!s||parseFloat(s.available_credits)<1){Me((s==null?void 0:s.available_credits)||0),q(!0);return}W(!0)}catch(t){console.error("Error checking credit balance:",t),r.error("Unable to verify credit balance. Please try again.")}},Dt=async()=>{try{be(!0);const t=await ia(1,U,d);if(t.success){const s=Array.isArray(t.data)?t.data:[];n(s)}else n([])}catch(t){console.error("Error fetching lists:",t),n([])}finally{be(!1)}};a.useEffect(()=>{re()},[]),a.useEffect(()=>{const t=()=>{re()};return window.addEventListener("focus",t),()=>window.removeEventListener("focus",t)},[]);const Fe=async t=>{var s,N,b,P,ie,ne,ce,oe,de,w,j,me,he,Ge;try{we(!0);const x=await na(t.toString(),h,H);if(console.log("Full API response:",x),x.success){const xe=Array.isArray((s=x.data)==null?void 0:s.contacts)?x.data.contacts:[];console.log("Extracted contacts:",xe),k(xe),pe(((b=(N=x.data)==null?void 0:N.pagination)==null?void 0:b.totalPages)||1)}else console.log("Response not successful:",x),k([])}catch(x){console.error("Error fetching contacts:",x);const xe=_=>typeof _=="object"&&_!==null,Gs=_=>typeof _=="object"&&_!==null&&"message"in _&&typeof _.message=="string";if(xe(x)&&(((P=x.response)==null?void 0:P.status)===404||((ce=(ne=(ie=x.response)==null?void 0:ie.data)==null?void 0:ne.message)==null?void 0:ce.toLowerCase().includes("not found"))||((w=(de=(oe=x.response)==null?void 0:oe.data)==null?void 0:de.error)==null?void 0:w.toLowerCase().includes("not found"))))console.error("Error details:",((Ge=x.response)==null?void 0:Ge.data)||x.message);else if(xe(x)){console.error("Error details:",((j=x.response)==null?void 0:j.data)||x.message);const _=((he=(me=x.response)==null?void 0:me.data)==null?void 0:he.error)||x.message||"Unknown error occurred";r.error(`Failed to fetch contacts: ${_}`)}else Gs(x)?(console.error("Error details:",x.message),r.error(`Failed to fetch contacts: ${x.message}`)):(console.error("Error details:",String(x)),r.error("Failed to fetch contacts: Unknown error occurred"));k([])}finally{we(!1)}};a.useEffect(()=>{Dt()},[U,d]),a.useEffect(()=>{l&&Fe(l.id)},[l,h,H]),a.useEffect(()=>{o&&o.phoneNumber&&ms(o)},[o,wt]);const os=t=>{if(t.is_deleted&&!d){r.error("This list has been disabled and is not accessible.");return}console.log("Selected list:",t),M(t),c(null),te(!1),ve(!1),y(1)},ds=t=>{c(t),We([]),pt(1),Xe(0)},ms=async t=>{if(t.phoneNumber)try{bt(!0);const s=await ya(t.phoneNumber,wt,10);We(s.calls),Xe(s.totalCalls)}catch(s){console.error("Error fetching call history:",s),We([]),Xe(0)}finally{bt(!1)}},hs=async t=>{if(qt(t))try{jt(t),vt(!0)}catch(s){console.error("Error playing recording:",s),r.error("Failed to play recording")}},xs=t=>{se({fullName:t.fullName||"",email:t.email||"",phoneNumber:t.phoneNumber||""}),te(!0)},us=async()=>{if(!o)return;const t=/^\+1[0-9]{10}$/;if(F.phoneNumber&&!t.test(F.phoneNumber)){r.error("Phone Number must start with +1 followed by 10 digits (e.g., +1234567890)");return}try{await ha(o.id.toString(),F),r.success("Contact updated successfully"),te(!1),l&&Fe(l.id),c({...o,...F})}catch(s){console.error("Error updating contact:",s)}},gs=()=>{te(!1),se({fullName:"",email:"",phoneNumber:""})},fs=async()=>{if(!l||!G.fullName||!G.email||!G.phoneNumber){r.error("Please fill in all required fields");return}if(!/^\+1[0-9]{10}$/.test(G.phoneNumber)){r.error("Phone Number must start with +1 followed by 10 digits (e.g., +1234567890)");return}try{await ma(l.id.toString(),{fullName:G.fullName,email:G.email,contact_number:G.phoneNumber,phoneNumber:G.phoneNumber}),r.success("Contact added successfully"),Fe(l.id),n(s=>s.map(N=>N.id===l.id?{...N,contactCount:N.contactCount+1}:N)),ve(!1),Y({fullName:"",email:"",phoneNumber:""})}catch(s){console.error("Error adding contact:",s)}},bs=()=>{ve(!1),Y({fullName:"",email:"",phoneNumber:""})},ws=async()=>{var t,s,N;try{const[b,P]=await Promise.all([va(""),Ca()]);console.log("ðŸ” Debug - Loaded dialer data:",{agentsCount:((t=b==null?void 0:b.data)==null?void 0:t.length)||0,phoneNumbersCount:((s=P==null?void 0:P.data)==null?void 0:s.length)||0,sampleAgent:(N=b==null?void 0:b.data)!=null&&N[0]?{id:b.data[0].id,assistant_id:b.data[0].assistant_id,name:b.data[0].name}:null}),Yt((b==null?void 0:b.data)||[]),Jt((P==null?void 0:P.data)||[])}catch(b){console.error("Error loading dialer data:",b)}},_t=async t=>{if(!t.phoneNumber){r.error("Contact has no phone number");return}Xt(t),ae(!0),(z.length===0||xt.length===0)&&await ws()},ps=t=>{if(!t.phoneNumber){r.error("Contact has no phone number for messaging");return}yt(t),Ct(!0)},Ns=t=>{if(!t.email){r.error("Contact has no email address");return}as(t),V({to:t.email,cc:"",bcc:"",subject:"",body:"",attachments:[]}),ke(!0)},js=async()=>{if(!g.to||!g.subject||!g.body){r.error("Please fill in To, Subject, and Body fields");return}const t=await re();if(!t.gmailConnected&&!t.smtpAvailable){r.error("No email service available. Please connect Gmail or configure SMTP.");return}St(!0);try{t.gmailConnected?await tl({to:g.to,cc:g.cc||void 0,bcc:g.bcc||void 0,subject:g.subject,body:g.body,isHtml:!1}):t.smtpAvailable&&await sl({to:g.to,cc:g.cc||void 0,bcc:g.bcc||void 0,subject:g.subject,body:g.body,isHtml:!1}),ke(!1),V({to:"",cc:"",bcc:"",subject:"",body:"",attachments:[]})}catch(s){console.error("Error sending email:",s)}finally{St(!1)}},vs=t=>{let s=t.replace(/\D/g,"");if(s.length===10)s="1"+s;else if(!(s.length===11&&s.startsWith("1"))){if(s.length<10)throw new Error("Phone number is too short")}return"+"+s},Cs=async()=>{var N,b,P,ie,ne,ce,oe,de;if(!S||!O||!J){r.error("Please select an agent and from number");return}console.log("ðŸ” Debug - Making call with:",{selectedAgent:O,availableAgents:z.map(w=>({id:w.id,assistant_id:w.assistant_id,name:w.name})),dialerContact:S.fullName,selectedFromNumber:J});let t=z.find(w=>w.id===O);if(t||(t=z.find(w=>w.assistant_id===O)),!t){console.error("âŒ Selected agent not found in agents array:",{selectedAgent:O,availableAgentIds:z.map(w=>w.id),availableAssistantIds:z.map(w=>w.assistant_id)}),r.error("Selected agent not found");return}const s=t.assistant_id||t.id;console.log("Making call with:",{selectedAgentData:t,assistantUUID:s,originalPhoneNumber:S.phoneNumber,selectedFromNumber:J}),gt(!0);try{const w=vs(S.phoneNumber);console.log("Formatted phone number:",w);const j=await wa({assistantId:s,phoneNumber:w,phoneNumberId:J,metadata:{contactId:S.id,contactName:S.fullName,listId:l==null?void 0:l.id,listName:l==null?void 0:l.list_name}});console.log("ðŸ“ž Call response:",j),console.log("ðŸ“ž Call response structure:",{id:j.id,callId:j.callId,data:j.data,monitor:j.monitor,dataMonitor:(N=j.data)==null?void 0:N.monitor,controlUrl:((b=j.monitor)==null?void 0:b.controlUrl)||((ie=(P=j.data)==null?void 0:P.monitor)==null?void 0:ie.controlUrl)}),r.success(`Call initiated to ${S.fullName}`),Be(j);const me=j.id||j.callId||((ne=j.data)==null?void 0:ne.id),he=((ce=j.monitor)==null?void 0:ce.controlUrl)||((de=(oe=j.data)==null?void 0:oe.monitor)==null?void 0:de.controlUrl);console.log("ðŸ“ž Extracted call control data:",{callId:me,controlUrl:he}),qe(me),Oe(he),He(!0),ye(0);const Ge=setInterval(()=>{ye(x=>x+1)},1e3);ze(Ge)}catch(w){console.error("Error making call:",w)}finally{gt(!1)}},ys=async()=>{if(console.log("ðŸ”‡ Mute toggle - Call control data:",{currentCallId:L,callControlUrl:D,isMuted:le,callData:ft}),!L||!D){console.error("âŒ Call control not available:",{currentCallId:L,callControlUrl:D}),r.error("Call control not available - missing call ID or control URL");return}try{le?(await pa(L,D),Ce(!1)):(await Na(L,D),Ce(!0))}catch(t){console.error("Error toggling mute:",t)}},Ss=()=>{Re(!B),r.success(B?"Call resumed":"Call on hold")},Es=async()=>{if(console.log("ðŸ“ž End call - Call control data:",{currentCallId:L,callControlUrl:D,callData:ft}),!L||!D){console.error("âŒ Call control not available:",{currentCallId:L,callControlUrl:D}),Se&&(clearInterval(Se),ze(null)),He(!1),Ce(!1),Re(!1),qe(null),Oe(null),Be(null),ye(0),ae(!1),Te(""),$e("");return}Se&&(clearInterval(Se),ze(null)),He(!1),Ce(!1),Re(!1),qe(null),Oe(null),Be(null),ye(0),ae(!1),Te(""),$e("");try{ja(L,D).catch(t=>{console.error("Background call ending failed:",t)})}catch(t){console.error("Error initiating call end:",t)}},ks=t=>{const s=Math.floor(t/60),N=t%60;return`${s.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`},As=()=>{l&&(c(null),te(!1),ve(!0),Y({fullName:"",email:"",phoneNumber:""}))},Fs=t=>{Ue(t)},Ps=async()=>{if(!(!l||!I))try{await ga(l.id.toString(),I.id.toString()),r.success("Contact removed from list successfully"),Fe(l.id),n(t=>t.map(s=>s.id===l.id?{...s,contactCount:Math.max(0,s.contactCount-1)}:s)),(o==null?void 0:o.id)===I.id&&c(null),Ue(null)}catch(t){console.error("Error removing contact:",t)}},Mt=t=>t.substring(0,2).toUpperCase(),Qe=t=>t?t.replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3"):"N/A",Pe=Array.isArray(i)?i.filter(t=>t.list_name.toLowerCase().includes(U.toLowerCase())):[],Ze=Array.isArray(p)?p.filter(t=>{var s;return t.email.toLowerCase().includes(H.toLowerCase())||((s=t.fullName)==null?void 0:s.toLowerCase().includes(H.toLowerCase()))}):[];return e.jsxs(Ys,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Contacts"}),e.jsx(et,{variant:"secondary",className:"px-3 py-1 bg-indigo-500/20 text-indigo-300 border border-indigo-500/30",children:e.jsx("span",{children:Pe.length})}),e.jsxs("span",{className:"text-sm text-white/65",children:["Total Contact groups: ",Pe.length]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("button",{onClick:cs,className:` px-5 py-2\r
    rounded-lg\r
    text-sm font-semibold\r
    text-white\r
    bg-[linear-gradient(180deg,rgba(90,110,255,0.45),rgba(36,46,151,0.35))]\r
    border border-white/15\r
    shadow-[0_2px_5px_rgba(90,110,255,0.45)]\r
    hover:shadow-[0_5px_10px_rgba(90,110,255,0.65)]\r
    hover:bg-[linear-gradient(180deg,rgba(90,110,255,0.6),rgba(36,46,151,0.45))]\r
    disabled:opacity-40\r
    disabled:cursor-not-allowed\r
    transition-all\r
    flex items-center gap-2`,children:[e.jsx(nt,{className:"h-4 w-8 mr-2"}),"Add Contacts in List"]})})]}),e.jsxs("div",{className:"flex h-[calc(100vh-200px)]  gap-4",children:[e.jsxs("div",{className:"w-80  bg-[#0b0f2e]/90 backdrop-blur-sm border border-white/10 rounded-lg flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 ",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 text-white",children:"Contact Groups"}),e.jsxs("div",{className:"relative",children:[e.jsx(Tt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-white/50"}),e.jsx(v,{placeholder:"Search",value:U,onChange:t=>Le(t.target.value),className:"pl-10 bg-white/5 border-white/20 text-white placeholder:text-white/40"})]})]}),e.jsx("div",{className:"flex-1 neon-fire-scroll  overflow-y-auto",children:fe?e.jsx("div",{className:"p-4 text-center text-white/50",children:"Loading..."}):Pe.length===0?e.jsx("div",{className:"p-4 text-center text-white/50",children:"No groups found"}):e.jsx("div",{className:"p-2",children:Pe.map(t=>e.jsx("div",{onClick:()=>os(t),className:`flex items-center p-3 rounded-lg cursor-pointer mb-1 transition-colors ${(l==null?void 0:l.id)===t.id?"bg-indigo-600/30 border border-indigo-500/50 text-white":"hover:bg-white/5 text-white/80"} ${t.is_deleted?"opacity-50":""}`,children:e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx(lt,{className:"h-8 w-8",children:e.jsx(rt,{className:(l==null?void 0:l.id)===t.id?"bg-indigo-600 text-white":"bg-white/10 text-white",children:t.list_name.substring(0,2).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate text-white",children:t.list_name}),e.jsxs("div",{className:`text-xs ${(l==null?void 0:l.id)===t.id?"text-white/70":"text-white/50"}`,children:[t.contactCount," contacts"]})]}),e.jsx(et,{variant:"secondary",className:"text-xs bg-white/10 text-white/70 border-white/20",children:t.contactCount})]})},t.id))})})]}),e.jsxs("div",{className:"flex-1 bg-[#0b0f2e]/90 backdrop-blur-sm border border-white/10 rounded-lg flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:l?l.list_name:"Default"}),l&&e.jsxs("p",{className:"text-sm text-white/50",children:[Ze.length," contacts"]})]}),e.jsxs(ca,{modal:!1,children:[e.jsx(oa,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"sm","aria-label":"Contact options",className:"text-white/70 hover:text-white hover:bg-white/10",children:e.jsx(Ds,{className:"h-4 w-4"})})}),e.jsxs(da,{align:"end",side:"bottom",sideOffset:5,className:"bg-[#0e1340] border-white/10 text-white",children:[e.jsxs(tt,{onClick:()=>As(),className:"text-white hover:bg-white/10 focus:bg-white/10",children:[e.jsx($t,{className:"h-4 w-4 mr-2"}),"Add Contacts"]}),e.jsx(Rt,{className:"bg-white/10"}),e.jsxs(tt,{onClick:()=>o&&xs(o),disabled:!o,className:"text-white hover:bg-white/10 focus:bg-white/10",children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"Edit Contact"]}),e.jsx(Rt,{className:"bg-white/10"}),e.jsxs(tt,{onClick:()=>o&&Fs(o),className:"text-red-400 focus:text-red-400 hover:bg-white/10 focus:bg-white/10",disabled:!o,children:[e.jsx(Ms,{className:"h-4 w-4 mr-2"}),"Remove from List"]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Tt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-white/50"}),e.jsx(v,{placeholder:"Search",value:H,onChange:t=>De(t.target.value),className:"pl-10 bg-white/5 border-white/20 text-white placeholder:text-white/40"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:l?Ie?e.jsx("div",{className:"p-4 text-center text-white/50",children:"Loading contacts..."}):Ze.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-white/50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"h-12 w-12 mx-auto mb-4 text-white/30"}),e.jsx("p",{children:"No contacts found in this group"})]})}):e.jsx("div",{className:"p-2",children:Ze.map(t=>e.jsx("div",{onClick:()=>ds(t),className:`flex items-center p-3 rounded-lg cursor-pointer mb-1 transition-colors ${(o==null?void 0:o.id)===t.id?"bg-indigo-600/30 border border-indigo-500/50":"hover:bg-white/5"}`,children:e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx(lt,{className:"h-10 w-10",children:e.jsx(rt,{className:"bg-green-600/20 text-green-400",children:Mt(t.email)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white",children:t.fullName||"No Name"}),e.jsx("div",{className:"text-sm text-white/50 truncate",children:t.email})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{size:"sm",className:"rounded-full bg-green-600 hover:bg-green-700 text-white shadow-md p-2",onClick:s=>{s.stopPropagation(),_t(t)},children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx(u,{size:"sm",className:"rounded-full bg-orange-600 hover:bg-orange-700 text-white shadow-md p-2",onClick:s=>{s.stopPropagation(),Ns(t)},children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx(u,{size:"sm",className:"rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-md p-2",onClick:s=>{s.stopPropagation(),ps(t)},children:e.jsx(Ut,{className:"h-4 w-4"})})]})]})},t.id))}):e.jsx("div",{className:"flex items-center justify-center h-full text-white/50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(it,{className:"h-12 w-12 mx-auto mb-4 text-white/30"}),e.jsx("p",{children:"Select a contact group to view contacts"})]})})})]}),e.jsx("div",{className:"w-96 bg-[#0b0f2e]/90 backdrop-blur-sm border border-white/10 rounded-lg flex flex-col",children:Vt?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-6 border-b border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-16 w-16 bg-indigo-600/20 rounded-full flex items-center justify-center",children:e.jsx($t,{className:"h-8 w-8 text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Add New Contact"}),e.jsxs("p",{className:"text-sm text-white/50",children:["Add contact to ",l==null?void 0:l.list_name]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:bs,className:"border-white/20 text-white hover:bg-white/10",children:"Cancel"}),e.jsx(u,{size:"sm",onClick:fs,className:"bg-gradient-to-r from-indigo-600 to-purple-600",children:"Save"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-white mb-3",children:"Contact Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/70 mb-1",children:"Full Name *"}),e.jsx(v,{value:G.fullName,onChange:t=>Y(s=>({...s,fullName:t.target.value})),placeholder:"Enter full name",className:"w-full bg-white/5 border-white/20 text-white placeholder:text-white/40"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/70 mb-1",children:"Email Address *"}),e.jsx(v,{type:"email",value:G.email,onChange:t=>Y(s=>({...s,email:t.target.value})),placeholder:"Enter email address",className:"w-full bg-white/5 border-white/20 text-white placeholder:text-white/40"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white/70 mb-1",children:"Phone Number *"}),e.jsx(v,{type:"tel",value:G.phoneNumber,onChange:t=>Y(s=>({...s,phoneNumber:t.target.value})),placeholder:"Enter phone number with +1 (e.g., +1234567890)",className:"w-full bg-white/5 border-white/20 text-white placeholder:text-white/40"})]})]})]})})})]}):o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(lt,{className:"h-16 w-16",children:e.jsx(rt,{className:"bg-green-600/20 text-green-400 text-xl",children:Mt(o.email)})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(u,{size:"sm",className:"rounded-full bg-green-600 hover:bg-green-700 text-white shadow-md p-2",onClick:()=>o&&_t(o),children:e.jsx(Q,{className:"h-4 w-4"})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-1",children:X?F.fullName||"No Name":o.fullName||"No Name"}),e.jsx("p",{className:"text-sm text-white/50",children:Qe(X?F.phoneNumber:o.phoneNumber)})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-white",children:"General Info"}),X&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:gs,className:"border-white/20 text-white hover:bg-white/10",children:"Cancel"}),e.jsx(u,{size:"sm",onClick:us,className:"bg-gradient-to-r from-indigo-600 to-purple-600",children:"Save"})]})]}),X?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-white/70 block mb-1",children:"Full Name"}),e.jsx(v,{value:F.fullName,onChange:t=>se({...F,fullName:t.target.value}),placeholder:"Enter full name",className:"bg-white/5 border-white/20 text-white placeholder:text-white/40"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-white/70 block mb-1",children:"Phone Number"}),e.jsx(v,{value:F.phoneNumber,onChange:t=>se({...F,phoneNumber:t.target.value}),placeholder:"Enter phone number with +1 (e.g., +1234567890)",className:"bg-white/5 border-white/20 text-white placeholder:text-white/40"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-white/70 block mb-1",children:"Email Address"}),e.jsx(v,{value:F.email,onChange:t=>se({...F,email:t.target.value}),placeholder:"Enter email address",type:"email",className:"bg-white/5 border-white/20 text-white placeholder:text-white/40"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Q,{className:"h-4 w-4 text-white/50"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"Phone Number"}),e.jsx("p",{className:"text-sm text-white/50",children:Qe(o.phoneNumber)})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ee,{className:"h-4 w-4 text-white/50"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"Email Address"}),e.jsx("p",{className:"text-sm text-white/50",children:o.email})]})]})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-white",children:"Labels"}),e.jsx(u,{variant:"ghost",size:"sm",className:"text-white/70 hover:text-white hover:bg-white/10",children:e.jsx(nt,{className:"h-4 w-4"})})]})}),e.jsx("div",{children:e.jsxs(xa,{defaultValue:"notes",className:"w-full",children:[e.jsxs(ua,{className:"grid w-full grid-cols-3 bg-white/5",children:[e.jsx(st,{value:"notes",className:"text-xs text-white/70 data-[state=active]:bg-white/10 data-[state=active]:text-white",children:"Notes"}),e.jsx(st,{value:"calls",className:"text-xs text-white/70 data-[state=active]:bg-white/10 data-[state=active]:text-white",children:"Call History"}),e.jsx(st,{value:"chats",className:"text-xs text-white/70 data-[state=active]:bg-white/10 data-[state=active]:text-white",children:"Chat History"})]}),e.jsx(at,{value:"notes",className:"mt-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ts,{className:"h-12 w-12 mx-auto mb-4 text-white/30"}),e.jsx("p",{className:"text-sm text-white/50 mb-4",children:"No notes yet"}),e.jsx("p",{className:"text-xs text-white/40",children:"Add your first note using the text area above"})]})}),e.jsx(at,{value:"calls",className:"mt-4",children:Qt?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{className:"h-8 w-8 mx-auto mb-4 text-white/50 animate-spin"}),e.jsx("p",{className:"text-sm text-white/50",children:"Loading call history..."})]}):Ve.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-4 text-white/30"}),e.jsx("p",{className:"text-sm text-white/50",children:"No call history"})]}):e.jsxs("div",{className:"space-y-3",children:[Ve.map(t=>{const s=Sa(t.status),N=qt(t);return e.jsxs("div",{className:"border border-white/10 rounded-lg p-4 hover:bg-white/5 bg-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-4 w-4 text-white/50"}),e.jsx("span",{className:"text-sm font-medium text-white",children:Ea(t.created_at)}),e.jsx(et,{variant:"secondary",className:`text-xs ${s.color}`,children:s.text})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[N&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>hs(t),className:"h-6 w-6 p-0 text-white/70 hover:text-white hover:bg-white/10",children:e.jsx($s,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs text-white/50",children:ka(t.duration)})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-white/50",children:[e.jsx("span",{children:t.assistant_name||"Unknown Assistant"}),e.jsx("span",{children:Aa(t.cost)})]})]},t.call_id)}),Nt>10&&e.jsx("div",{className:"text-center pt-4",children:e.jsx(u,{variant:"outline",size:"sm",onClick:()=>pt(t=>t+1),disabled:Ve.length>=Nt,className:"border-white/20 text-white hover:bg-white/10",children:"Load More"})})]})}),e.jsx(at,{value:"chats",className:"mt-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ut,{className:"h-12 w-12 mx-auto mb-4 text-white/30"}),e.jsx("p",{className:"text-sm text-white/50",children:"No chat history"})]})})]})})]})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-white/50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(it,{className:"h-12 w-12 mx-auto mb-4 text-white/30"}),e.jsx("p",{children:"Select a contact to view details"})]})})})]}),e.jsx(ct,{open:je,onOpenChange:q,children:e.jsxs(ot,{className:"sm:max-w-md bg-[#0e1340] border-white/10 text-white",children:[e.jsx(dt,{children:e.jsxs(mt,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx(Ht,{className:"w-4 h-4 text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Insufficient Credits"}),e.jsx("p",{className:"text-sm text-white/50 font-normal",children:"You need credits to create contact lists"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white/5 p-4 rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Current Balance:"}),e.jsxs("span",{className:"font-semibold text-white",children:[_e," credits"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-sm text-white/70",children:"Required:"}),e.jsx("span",{className:"font-semibold text-red-400",children:"1 credit minimum"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{variant:"outline",onClick:()=>q(!1),className:"flex-1 border-white/20 text-white hover:bg-white/10",children:"Cancel"}),e.jsx(u,{onClick:()=>{q(!1),window.location.href="/credits"},className:"flex-1 bg-gradient-to-r from-indigo-600 to-purple-600",children:"Buy Credits"})]})]})]})}),e.jsx(qa,{open:Ne,onOpenChange:t=>{W(t),t||Dt()},children:e.jsx(za,{size:"half",className:"bg-[#0e1340] border-white/10",children:e.jsx(rl,{})})}),e.jsx(Ba,{open:!!I,onOpenChange:()=>Ue(null),children:e.jsxs(Va,{className:"bg-[#0e1340] border-white/10 text-white",children:[e.jsxs(Wa,{children:[e.jsx(Xa,{className:"text-white",children:"Remove Contact from List"}),e.jsxs(Ya,{className:"text-white/70",children:['Are you sure you want to remove "',(I==null?void 0:I.fullName)||(I==null?void 0:I.email),'" from this list? This action cannot be undone.']})]}),e.jsxs(Ja,{children:[e.jsx(Ka,{className:"border-white/20 text-white hover:bg-white/10 bg-transparent",children:"Cancel"}),e.jsx(Qa,{onClick:Ps,className:"bg-red-600 hover:bg-red-700",children:"Remove Contact"})]})]})}),Wt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-[#0e1340] border border-white/10 rounded-3xl shadow-2xl w-full max-w-sm mx-auto overflow-hidden",children:[e.jsx("div",{className:`px-6 py-4 text-white ${T?"bg-green-600":"bg-gradient-to-r from-indigo-600 to-purple-600"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),T?"Active Call":"Make Call"]}),!T&&e.jsx("button",{onClick:()=>ae(!1),className:"text-white hover:text-gray-200 transition-colors text-2xl leading-none",children:"Ã—"}),T&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Us,{className:"h-4 w-4"}),ks(Kt)]})]})}),e.jsx("div",{className:"px-6 py-6 bg-[#0b0f2e]",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-16 h-16 border-2 border-white/20 rounded-full flex items-center justify-center shadow-sm ${T?"bg-green-500 animate-pulse":"bg-green-500"}`,children:e.jsx(Hs,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"rounded px-3 mb-2 bg-white/5 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-white/50 mb-1",children:"Name"}),e.jsx("p",{className:"font-medium text-white",children:S==null?void 0:S.fullName})]}),e.jsxs("div",{className:"rounded px-3 bg-white/5 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-white/50 mb-1",children:"Number"}),e.jsx("p",{className:"font-medium text-white",children:S==null?void 0:S.phoneNumber})]}),T&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${B?"bg-yellow-500/20 text-yellow-400":"bg-green-500/20 text-green-400"}`,children:B?"On Hold":"Connected"})})]})]})}),!T&&e.jsxs("div",{className:"px-6 py-4 space-y-4 bg-[#0b0f2e] border-t border-white/10",children:[e.jsx("div",{className:"border border-white/20 rounded-lg bg-white/5",children:e.jsxs("select",{value:O,onChange:t=>Te(t.target.value),className:"w-full bg-transparent text-white px-4 py-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent appearance-none",children:[e.jsx("option",{value:"",className:"bg-[#0e1340] text-white",children:"Agent"}),z.map(t=>e.jsx("option",{value:t.assistant_id||t.id,className:"bg-[#0e1340] text-white",children:t.name||t.id},t.id))]})}),e.jsx("div",{className:"border border-white/20 rounded-lg bg-white/5",children:e.jsxs("select",{value:J,onChange:t=>$e(t.target.value),className:"w-full bg-transparent text-white px-4 py-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent appearance-none",children:[e.jsx("option",{value:"",className:"bg-[#0e1340] text-white",children:"From Number"}),xt.map(t=>e.jsx("option",{value:t.id,className:"bg-[#0e1340] text-white",children:t.number||t.friendlyName},t.id))]})})]}),e.jsx("div",{className:"px-6 py-6 bg-[#0b0f2e] border-t border-white/10",children:T?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-6",children:[e.jsx("button",{onClick:ys,className:`w-16 h-16 rounded-full flex items-center justify-center transition-all ${le?"bg-red-500 hover:bg-red-600 text-white":"bg-white/10 hover:bg-white/20 text-white"}`,children:le?e.jsx(Rs,{className:"h-6 w-6"}):e.jsx(qs,{className:"h-6 w-6"})}),e.jsx("button",{onClick:Es,className:"w-20 h-20 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-colors shadow-lg",children:e.jsx(zs,{className:"h-8 w-8"})}),e.jsx("button",{onClick:Ss,className:`w-16 h-16 rounded-full flex items-center justify-center transition-all ${B?"bg-yellow-500 hover:bg-yellow-600 text-white":"bg-white/10 hover:bg-white/20 text-white"}`,children:B?e.jsx(Os,{className:"h-6 w-6"}):e.jsx(Bs,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-6 text-xs text-white/50",children:[e.jsx("span",{className:"w-16 text-center",children:le?"Unmute":"Mute"}),e.jsx("span",{className:"w-20 text-center",children:"End Call"}),e.jsx("span",{className:"w-16 text-center",children:B?"Resume":"Hold"})]})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsx("button",{onClick:()=>ae(!1),className:"flex-1 py-3 px-6 bg-red-600 text-white hover:bg-red-700 rounded-full font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Cs,disabled:!O||!J||ut,className:"flex-1 py-3 bg-green-600 hover:bg-green-700 text-white px-6 rounded-full font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:ut?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/40 border-t-transparent rounded-full animate-spin mr-2"}),"Calling..."]}):"Call"})]})})]})}),e.jsx(Fa,{call:Zt,isOpen:es,onClose:()=>{vt(!1),jt(null)}}),Ee&&e.jsx($a,{isOpen:ts,contact:{id:Ee.id.toString(),email:Ee.email,contact_number:Ee.phoneNumber,list_name:l==null?void 0:l.list_name},onClose:()=>{Ct(!1),yt(null)}}),e.jsx(ct,{open:ss,onOpenChange:ke,children:e.jsxs(ot,{className:"max-w-7xl max-h-[80vh] flex flex-col",children:[e.jsxs(dt,{children:[e.jsxs(mt,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-orange-600"}),"Compose Email"]}),e.jsxs(fa,{children:["Send an email to ",(K==null?void 0:K.fullName)||(K==null?void 0:K.email)]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"from",className:"text-sm font-medium text-gray-700 mb-1 block",children:"From"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{id:"from",value:rs||"",disabled:!0,className:"bg-gray-50",placeholder:"Connect Gmail to send emails"}),e.jsx("div",{className:"flex items-center gap-3",children:Ae?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full"}),"Gmail Connected"]}),e.jsx(u,{variant:"outline",size:"sm",onClick:ns,disabled:It,className:"text-red-600 border-red-600 hover:bg-red-50",children:It?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Unlinking..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Vs,{className:"h-4 w-4 mr-2"}),"Unlink Gmail"]})})]}):e.jsx(u,{variant:"outline",size:"sm",onClick:is,disabled:Pt,className:"text-blue-600 border-blue-600 hover:bg-blue-50",children:Pt?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Link Gmail"]})})})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"to",className:"text-sm font-medium text-gray-700 mb-1 block",children:"To *"}),e.jsx(v,{id:"to",value:g.to,onChange:t=>V(s=>({...s,to:t.target.value})),placeholder:"Enter recipient email"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"cc",className:"text-sm font-medium text-gray-700 mb-1 block",children:"CC"}),e.jsx(v,{id:"cc",value:g.cc,onChange:t=>V(s=>({...s,cc:t.target.value})),placeholder:"Enter CC emails (comma separated)"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"bcc",className:"text-sm font-medium text-gray-700 mb-1 block",children:"BCC"}),e.jsx(v,{id:"bcc",value:g.bcc,onChange:t=>V(s=>({...s,bcc:t.target.value})),placeholder:"Enter BCC emails (comma separated)"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"subject",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Subject *"}),e.jsx(v,{id:"subject",value:g.subject,onChange:t=>V(s=>({...s,subject:t.target.value})),placeholder:"Enter email subject"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"body",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Message *"}),e.jsx("textarea",{id:"body",value:g.body,onChange:t=>V(s=>({...s,body:t.target.value})),placeholder:"Enter your message...",className:"w-full min-h-[200px] p-3 border border-gray-300 rounded-md resize-y focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Attachments"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx(Ws,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Attachment support coming soon"})]})]})]}),e.jsxs(ba,{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{variant:"outline",onClick:()=>ke(!1),disabled:Ye,children:"Cancel"}),e.jsx("div",{className:"flex items-center gap-2",children:ls?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(ue,{className:"h-4 w-4 animate-spin"}),"Checking email services..."]}):Ae?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full"}),"Ready to send via Gmail"]}):Je?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"}),"Ready to send via SMTP"]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(Ht,{className:"h-4 w-4"}),"No email service available"]})})]}),e.jsx(u,{onClick:js,disabled:Ye||!g.to||!g.subject||!g.body||!Ae&&!Je,className:"bg-orange-600 hover:bg-orange-700",children:Ye?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xs,{className:"h-4 w-4 mr-2"}),"Send Email"]})})]})]})})]})};export{Al as default};
//# sourceMappingURL=Lists-Db4jK0W2.js.map
