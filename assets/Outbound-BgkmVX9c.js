import{j as e,aT as p,aV as I,bb as O,C as se,aA as ae,an as ne,av as U,y as te,J as pe,aW as Q,aX as X,D as fe,ba as Ne,f as Ce,T as ve}from"./ui-U5SHHdCN.js";import{r as E}from"./vendor-DG599jyl.js";import{b as z,u as be,c as D}from"./query-09wH2FJs.js";import{C as o,b as u,c as h,a as m,d as ie}from"./card-BJD3nNZo.js";import{B as r}from"./button-Dzxhr_xW.js";import{B as $}from"./badge-Cpm2XFEm.js";import{T as le,a as re,b,c,d as ce,e as i}from"./table-B1EjfQnr.js";import{b as R,c as B,d as ye,D as G,a as Z}from"./dialog-L06_4tY7.js";import{u as we,a as Se,t as A,d as Pe}from"./index-E85mAFiC.js";import{P as ee}from"./Page-Bkq40qIk.js";import{T as De,a as Ae,b as V,c as K}from"./tabs-D83kt50N.js";import{g as Ee,a as Te,b as ke,l as Ie,p as Me,r as Le,c as qe,d as Fe}from"./campaignService-BmV_eN4j.js";import{u as Qe}from"./router-BavLd_S0.js";import"./scroll-area-CZ_bn1oj.js";import"./index-DaFIz4sE.js";import"./index-DVJtLwEJ.js";function Re({campaignId:j,onClose:M}){var g;const[y,T]=E.useState("overview"),{data:w,isLoading:L}=z({queryKey:["campaign",j],queryFn:()=>Ee(j),retry:1}),{data:f,isLoading:q}=z({queryKey:["campaignCalls",j],queryFn:()=>Te(j),retry:1}),a=w==null?void 0:w.data,x=(f==null?void 0:f.data)||{},N=Object.values(x),F=n=>{const d={scheduled:{variant:"outline",icon:e.jsx(se,{className:"h-3 w-3 mr-1"})},"in-progress":{variant:"default",icon:e.jsx(O,{className:"h-3 w-3 mr-1"})},ended:{variant:"secondary",icon:e.jsx(I,{className:"h-3 w-3 mr-1"})}}[n]||{variant:"outline",icon:null};return e.jsxs($,{variant:d.variant,className:"flex items-center",children:[d.icon,n==="in-progress"?"Running":n.charAt(0).toUpperCase()+n.slice(1)]})},C=n=>{const l={queued:"outline",ringing:"secondary","in-progress":"default",ended:"secondary",failed:"destructive"};return e.jsx($,{variant:l[n]||"outline",children:n})},k=n=>{if(!n)return"0:00";const l=Math.floor(n/60),d=n%60;return`${l}:${d.toString().padStart(2,"0")}`};return L?e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsx(B,{children:"Campaign Details"})}),e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(p,{className:"h-8 w-8 animate-spin"})})]}):a?e.jsxs(e.Fragment,{children:[e.jsxs(R,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[a.name,F(a.status)]}),e.jsxs(ye,{children:["Created on ",new Date(a.createdAt).toLocaleDateString()]})]}),e.jsxs(De,{value:y,onValueChange:T,className:"w-full",children:[e.jsxs(Ae,{className:"grid w-full grid-cols-3",children:[e.jsx(V,{value:"overview",children:"Overview"}),e.jsx(V,{value:"calls",children:"Calls"}),e.jsx(V,{value:"analytics",children:"Analytics"})]}),e.jsxs(K,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(o,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(h,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Total Calls"]})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:(a.callsCounterScheduled||0)+(a.callsCounterQueued||0)+(a.callsCounterInProgress||0)+(a.callsCounterEnded||0)})})]}),e.jsxs(o,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(h,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Completed"]})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:a.callsCounterEnded||0})})]}),e.jsxs(o,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(h,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Pick Up"]})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:a.callsCounterEnded>0?`${Math.round((a.callsCounterEnded-a.callsCounterEndedVoicemail)/a.callsCounterEnded*100)}%`:"0%"})})]}),e.jsxs(o,{children:[e.jsx(u,{className:"pb-2",children:e.jsxs(h,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Voicemail"]})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:a.callsCounterEndedVoicemail||0})})]})]}),e.jsxs(o,{children:[e.jsx(u,{children:e.jsx(h,{children:"Campaign Information"})}),e.jsx(m,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone Number ID"}),e.jsx("p",{className:"text-sm",children:a.phoneNumberId})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Assistant ID"}),e.jsx("p",{className:"text-sm",children:a.assistantId||a.workflowId||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Created"}),e.jsx("p",{className:"text-sm",children:new Date(a.createdAt).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Last Updated"}),e.jsx("p",{className:"text-sm",children:new Date(a.updatedAt).toLocaleString()})]})]})})]})]}),e.jsx(K,{value:"calls",className:"space-y-4",children:e.jsxs(o,{children:[e.jsxs(u,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Campaign Calls"]}),e.jsx(ie,{children:"Individual call details and outcomes"})]}),e.jsx(m,{children:q?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(p,{className:"h-8 w-8 animate-spin"})}):e.jsxs(le,{children:[e.jsx(re,{children:e.jsxs(b,{children:[e.jsx(c,{children:"Customer"}),e.jsx(c,{children:"Phone Number"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Duration"}),e.jsx(c,{children:"Started"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(ce,{children:N.length===0?e.jsx(b,{children:e.jsx(i,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No calls found for this campaign"})}):N.map(n=>{var l,d,v;return e.jsxs(b,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((l=n.customer)==null?void 0:l.name)||"Unknown"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:((d=n.customer)==null?void 0:d.email)||"-"})]})}),e.jsx(i,{className:"font-mono",children:((v=n.customer)==null?void 0:v.number)||"-"}),e.jsx(i,{children:C(n.status)}),e.jsx(i,{children:k(n.duration)}),e.jsx(i,{children:n.startedAt?new Date(n.startedAt).toLocaleString():"-"}),e.jsx(i,{children:e.jsxs("div",{className:"flex gap-2",children:[n.transcript&&e.jsx(r,{size:"sm",variant:"outline",title:"View Transcript",children:e.jsx(te,{className:"h-3 w-3"})}),n.recording&&e.jsx(r,{size:"sm",variant:"outline",title:"Download Recording",children:e.jsx(pe,{className:"h-3 w-3"})})]})})]},n.id)})})]})})]})}),e.jsx(K,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(o,{children:[e.jsx(u,{children:e.jsx(h,{children:"Call Status Distribution"})}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Scheduled"}),e.jsx("span",{className:"text-sm font-medium",children:a.callsCounterScheduled||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Queued"}),e.jsx("span",{className:"text-sm font-medium",children:a.callsCounterQueued||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"In Progress"}),e.jsx("span",{className:"text-sm font-medium",children:a.callsCounterInProgress||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Completed"}),e.jsx("span",{className:"text-sm font-medium",children:a.callsCounterEnded||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Voicemail"}),e.jsx("span",{className:"text-sm font-medium",children:a.callsCounterEndedVoicemail||0})]})]})})]}),e.jsxs(o,{children:[e.jsx(u,{children:e.jsx(h,{children:"Performance Metrics"})}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Success Rate"}),e.jsx("span",{className:"text-sm font-medium",children:a.callsCounterEnded>0?`${Math.round((a.callsCounterEnded-a.callsCounterEndedVoicemail)/a.callsCounterEnded*100)}%`:"0%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Completion Rate"}),e.jsx("span",{className:"text-sm font-medium",children:((g=a.customers)==null?void 0:g.length)>0?`${Math.round(a.callsCounterEnded/a.customers.length*100)}%`:"0%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Avg Duration"}),e.jsx("span",{className:"text-sm font-medium",children:N.length>0?k(Math.round(N.reduce((n,l)=>n+(l.duration||0),0)/N.length)):"0:00"})]})]})})]})]})})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsx(r,{onClick:M,children:"Close"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsx(B,{children:"Campaign Details"})}),e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Campaign not found"})})]})}const ss=()=>{var Y;const j=Qe(),[M,y]=E.useState(!1),[T,w]=E.useState(null),[L,f]=E.useState(!1),[q,a]=E.useState(0),x=be(),{user:N}=we(),{isSuperAdmin:F}=Se(),{data:C,isLoading:k,error:g}=z({queryKey:["outboundCampaigns"],queryFn:()=>ke(),retry:(s,t)=>{var P;return[404,204,402].includes((P=t==null?void 0:t.response)==null?void 0:P.status)?!1:s<1}}),n=D({mutationFn:Ie,onSuccess:()=>{x.invalidateQueries({queryKey:["outboundCampaigns"]}),A.success("Campaign launched successfully")},onError:s=>{var P,_,J,W;const t=((_=(P=s.response)==null?void 0:P.data)==null?void 0:_.message)||"Failed to launch campaign";((W=(J=s.response)==null?void 0:J.data)==null?void 0:W.currentStatus)==="in-progress"?A.info("Campaign is already running"):A.error(t),x.invalidateQueries({queryKey:["outboundCampaigns"]})}}),l=D({mutationFn:Me,onSuccess:()=>{x.invalidateQueries({queryKey:["outboundCampaigns"]})}});D({mutationFn:Le,onSuccess:()=>{x.invalidateQueries({queryKey:["outboundCampaigns"]})}});const d=D({mutationFn:qe,onSuccess:()=>{x.invalidateQueries({queryKey:["outboundCampaigns"]})}}),v=D({mutationFn:Fe,onSuccess:()=>{x.invalidateQueries({queryKey:["outboundCampaigns"]})}}),de=s=>{n.mutate(s)},oe=s=>{l.mutate(s)},me=s=>{confirm("Are you sure you want to cancel this campaign?")&&d.mutate(s)},xe=s=>{confirm("Are you sure you want to delete this campaign? This action cannot be undone.")&&v.mutate(s)},ue=s=>{w(s),y(!0)},he=()=>{x.invalidateQueries({queryKey:["outboundCampaigns"]}),A.success("Campaigns refreshed")},je=async()=>{if(F){j("/outbound/create-campaign");return}try{const t=(await Pe.get("/api/credits/balance")).data.data;if(!t||parseFloat(t.available_credits)<1){a((t==null?void 0:t.available_credits)||0),f(!0);return}j("/outbound/create-campaign")}catch(s){console.error("Error checking credit balance:",s),A.error("Unable to verify credit balance. Please try again.")}},ge=s=>{const S={scheduled:{variant:"outline",icon:e.jsx(se,{className:"h-3 w-3 mr-1"}),label:"Scheduled"},"in-progress":{variant:"default",icon:e.jsx(O,{className:"h-3 w-3 mr-1"}),label:"Running"},ended:{variant:"secondary",icon:e.jsx(I,{className:"h-3 w-3 mr-1"}),label:"Ended"}}[s]||{variant:"outline",icon:e.jsx(Q,{className:"h-3 w-3 mr-1"}),label:s.charAt(0).toUpperCase()+s.slice(1)};return e.jsxs($,{variant:S.variant,className:"flex items-center",children:[S.icon,S.label]})},H=Array.isArray(C==null?void 0:C.data)?C.data:[];if(g){const t=((Y=g==null?void 0:g.response)==null?void 0:Y.status)===402;return e.jsx(ee,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Outbound"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage outbound campaigns"})]}),e.jsx(o,{children:e.jsx(m,{className:"pt-6",children:e.jsx("div",{className:"text-center",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-12 w-12 text-orange-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Insufficient Credits"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"You need credits to access campaign features. Please purchase credits to continue."}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(r,{onClick:()=>j("/credits/purchase"),className:"bg-orange-500 hover:bg-orange-600",children:"Purchase Credits"}),e.jsxs(r,{variant:"outline",onClick:()=>window.location.reload(),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Unable to connect to the backend API. Please ensure the backend server is running."}),e.jsx(r,{onClick:()=>window.location.reload(),children:"Retry Connection"})]})})})})]})})}return e.jsx(ee,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Outbound"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage outbound campaigns"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{variant:"outline",onClick:he,title:"Refresh Campaigns",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(r,{className:"bg-teal-600 hover:bg-teal-700 text-white",onClick:je,children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Create Campaign"]})]})]}),e.jsxs(o,{children:[e.jsxs(u,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Campaigns"]}),e.jsx(ie,{children:"Manage your outbound call campaigns"})]}),e.jsx(m,{children:k?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(p,{className:"h-8 w-8 animate-spin"})}):e.jsxs(le,{children:[e.jsx(re,{children:e.jsxs(b,{children:[e.jsx(c,{children:"Campaign Name"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Total Calls"}),e.jsx(c,{children:"Completed"}),e.jsx(c,{children:"Pick Up"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(ce,{children:H.length===0?e.jsx(b,{children:e.jsx(i,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No campaigns found. Create your first campaign to get started."})}):H.map(s=>e.jsxs(b,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Created on ",new Date(s.createdAt).toLocaleDateString()]})]})}),e.jsx(i,{children:ge(s.status)}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-3 w-3"}),(s.callsCounterScheduled||0)+(s.callsCounterQueued||0)+(s.callsCounterInProgress||0)+(s.callsCounterEnded||0),s.status==="in-progress"&&e.jsxs("span",{className:"ml-2 text-xs text-green-600 font-medium",children:["(",s.callsCounterInProgress||0," active)"]})]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"h-3 w-3"}),s.callsCounterEnded||0]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"h-3 w-3"}),s.callsCounterEnded>0?`${Math.round((s.callsCounterEnded-s.callsCounterEndedVoicemail)/s.callsCounterEnded*100)}%`:"0%"]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex gap-2",children:[s.status==="scheduled"&&e.jsx(r,{size:"sm",variant:"outline",onClick:()=>de(s.id),disabled:n.isPending,title:"Launch Campaign",children:n.isPending?e.jsx(p,{className:"h-3 w-3 animate-spin"}):e.jsx(O,{className:"h-3 w-3"})}),s.status==="in-progress"&&e.jsx(r,{size:"sm",variant:"outline",onClick:()=>oe(s.id),disabled:l.isPending,title:"Pause Campaign",children:l.isPending?e.jsx(p,{className:"h-3 w-3 animate-spin"}):e.jsx(Ne,{className:"h-3 w-3"})}),(s.status==="scheduled"||s.status==="in-progress")&&e.jsx(r,{size:"sm",variant:"outline",onClick:()=>me(s.id),disabled:d.isPending,title:"Cancel Campaign",children:d.isPending?e.jsx(p,{className:"h-3 w-3 animate-spin"}):e.jsx(Ce,{className:"h-3 w-3"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>ue(s),title:"View Details",children:e.jsx(te,{className:"h-3 w-3"})}),s.status==="ended"&&e.jsx(r,{size:"sm",variant:"outline",onClick:()=>xe(s.id),disabled:v.isPending,title:"Delete Campaign",children:v.isPending?e.jsx(p,{className:"h-3 w-3 animate-spin"}):e.jsx(ve,{className:"h-3 w-3"})})]})})]},s.id))})]})})]}),T&&e.jsx(G,{open:M,onOpenChange:y,children:e.jsx(Z,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:e.jsx(Re,{campaignId:T.id,onClose:()=>y(!1)})})}),e.jsx(G,{open:L,onOpenChange:f,children:e.jsx(Z,{className:"max-w-md",children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"p-3 bg-orange-100 rounded-full",children:e.jsx(Q,{className:"h-8 w-8 text-orange-600"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Insufficient Credits"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["You need at least 1 credit to use campaign creation.",e.jsxs("span",{className:"block mt-1",children:["Current balance: ",q," credits"]})]}),e.jsx("div",{className:"space-y-3",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Credits are added instantly after purchase"})})]})})})]})})};export{ss as default};
//# sourceMappingURL=Outbound-BgkmVX9c.js.map
