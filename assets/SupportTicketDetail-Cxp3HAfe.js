import{j as e,aW as G,k as M,aV as q,aU as B,b5 as O,bk as R,ak as W,C as X}from"./ui-C7wuVsKo.js";import{r as D}from"./vendor-DG599jyl.js";import{u as H,b as U,c as I}from"./query-BI4h7QWD.js";import{B as x}from"./badge-DTmq5TA0.js";import{B as l}from"./button-DAfv1lEn.js";import{T as J}from"./textarea-DHW21YBW.js";import{A as y,a as p}from"./avatar-CwBYu1bQ.js";import{t as m}from"./index-CUjvNcD6.js";import{b as Y,e as Z,f as $,u as ee}from"./supportService-CYROvaH8.js";import{d as se,u as ae}from"./router-BavLd_S0.js";import"./client-DJpfVFE2.js";function he(){var v,w,k,_,C,T,S,A;const{ticketId:r}=se(),j=ae(),d=H(),[n,N]=D.useState(""),[o,b]=D.useState(!1),{data:g,isLoading:F,error:K}=U({queryKey:["supportTicket",r],queryFn:()=>Y(r),enabled:!!r}),{data:h,isLoading:Q}=U({queryKey:["supportTicketMessages",r],queryFn:()=>Z(r),enabled:!!r}),s=g==null?void 0:g.data,t=h==null?void 0:h.data,z=I({mutationFn:a=>$(r,a),onSuccess:()=>{m.success("Message sent successfully!"),N(""),d.invalidateQueries({queryKey:["supportTicketMessages",r]}),d.invalidateQueries({queryKey:["supportTicket",r]}),d.invalidateQueries({queryKey:["supportTickets"]})},onError:a=>{m.error(a.message||"Failed to send message")}}),u=I({mutationFn:a=>ee(r,{status:a}),onSuccess:()=>{m.success("Ticket status updated successfully!"),d.invalidateQueries({queryKey:["supportTicket",r]}),d.invalidateQueries({queryKey:["supportTickets"]})},onError:a=>{m.error(a.message||"Failed to update ticket status")}}),E=async()=>{if(n.trim()){b(!0);try{await z.mutateAsync({message:n.trim()})}finally{b(!1)}}},f=a=>{u.mutate(a)},P=a=>{switch(a){case"open":return"default";case"in_progress":return"secondary";case"waiting_response":return"outline";case"resolved":return"success";case"closed":return"destructive";default:return"default"}},V=a=>{switch(a){case"urgent":return"destructive";case"high":return"secondary";case"medium":return"outline";case"low":return"default";default:return"default"}},i=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return F?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):K||!s?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col items-center justify-center space-y-4",children:[e.jsx(G,{className:"h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Ticket not found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"The support ticket you're looking for doesn't exist or you don't have access to it."})]}),e.jsxs(l,{onClick:()=>j("/support"),variant:"outline",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Back to Support"]})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-w-6xl mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(l,{onClick:()=>j("/support"),variant:"outline",size:"sm",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:(s==null?void 0:s.title)||"Loading..."}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["#",((v=s==null?void 0:s.ticket_id)==null?void 0:v.slice(-8).toUpperCase())||"Loading..."]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[(s==null?void 0:s.status)!=="resolved"&&e.jsxs(l,{onClick:()=>f("resolved"),size:"sm",disabled:u.isPending,children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Mark Resolved"]}),(s==null?void 0:s.status)!=="closed"&&e.jsxs(l,{onClick:()=>f("closed"),variant:"outline",size:"sm",disabled:u.isPending,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Close"]})]})]})})}),e.jsx("div",{className:"max-w-6xl mx-auto px-6 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Description"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap leading-relaxed",children:(s==null?void 0:s.description)||"Loading..."})]}),(s==null?void 0:s.tags)&&s.tags.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map((a,c)=>e.jsx(x,{variant:"secondary",children:a},c))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Messages"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(t==null?void 0:t.length)||0," messages"]})]}),Q?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):t&&t.length>0?e.jsx("div",{className:"space-y-4",children:t.map(a=>{var c,L;return e.jsx("div",{className:"border-b border-gray-100 dark:border-gray-700 pb-4 last:border-b-0",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(y,{className:"h-8 w-8",children:e.jsxs(p,{className:"bg-blue-100 text-blue-600 text-sm",children:[((c=a.first_name)==null?void 0:c.charAt(0))||"U",((L=a.last_name)==null?void 0:L.charAt(0))||"N"]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[a.first_name," ",a.last_name]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:i(a.created_at)})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm whitespace-pre-wrap",children:a.message})]})]})},a.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(O,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No messages yet"})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(J,{placeholder:"Type your message...",value:n,onChange:a=>N(a.target.value),rows:3,disabled:o,className:"resize-none"}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(l,{onClick:E,disabled:!n.trim()||o,size:"sm",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),o?"Sending...":"Send"]})})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Ticket Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Status"}),e.jsx(x,{variant:P((s==null?void 0:s.status)||"open"),children:((w=s==null?void 0:s.status)==null?void 0:w.replace("_"," "))||"Loading..."})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Priority"}),e.jsx(x,{variant:V((s==null?void 0:s.priority)||"medium"),children:((k=s==null?void 0:s.priority)==null?void 0:k.toUpperCase())||"LOADING..."})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Category"}),e.jsx(x,{variant:"outline",children:((_=s==null?void 0:s.category)==null?void 0:_.replace("_"," "))||"Loading..."})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Messages"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:(s==null?void 0:s.message_count)||0})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Timeline"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(W,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Created"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:s!=null&&s.created_at?i(s.created_at):"Loading..."})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(X,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Last Updated"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:s!=null&&s.updated_at?i(s.updated_at):"Loading..."})]})]}),(s==null?void 0:s.resolved_at)&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Resolved"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:i(s.resolved_at)})]})]}),(s==null?void 0:s.closed_at)&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"h-4 w-4 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Closed"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:i(s.closed_at)})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Created By"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{className:"h-10 w-10",children:e.jsxs(p,{className:"bg-blue-100 text-blue-600",children:[((C=s==null?void 0:s.user_first_name)==null?void 0:C.charAt(0))||"U",((T=s==null?void 0:s.user_last_name)==null?void 0:T.charAt(0))||"N"]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[(s==null?void 0:s.user_first_name)||"Unknown"," ",(s==null?void 0:s.user_last_name)||"User"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:(s==null?void 0:s.user_email)||"No email provided"})]})]})]}),(s==null?void 0:s.assigned_first_name)&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Assigned To"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{className:"h-10 w-10",children:e.jsxs(p,{className:"bg-green-100 text-green-600",children:[((S=s==null?void 0:s.assigned_first_name)==null?void 0:S.charAt(0))||"A",((A=s==null?void 0:s.assigned_last_name)==null?void 0:A.charAt(0))||"S"]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[s==null?void 0:s.assigned_first_name," ",s==null?void 0:s.assigned_last_name]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s==null?void 0:s.assigned_email})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:"Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Ticket ID"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-mono",children:(s==null?void 0:s.ticket_id)||"Loading..."})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Database ID"}),e.jsxs("span",{className:"text-gray-900 dark:text-white",children:["#",(s==null?void 0:s.id)||"N/A"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"User ID"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:(s==null?void 0:s.user_id)||"N/A"})]})]})]})]})]})})]})}export{he as SupportTicketDetail};
//# sourceMappingURL=SupportTicketDetail-Cxp3HAfe.js.map
