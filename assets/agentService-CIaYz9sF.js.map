{"version":3,"file":"agentService-CIaYz9sF.js","sources":["../../src/api/services/agents/agentService.ts"],"sourcesContent":["import axiosInstance from \"@/api/axios/axiosInstance\";\r\nimport { toast } from \"sonner\";\r\nimport { VapiAssistant } from \"@/types/vapi\";\r\n\r\n// Types\r\nexport interface AssistantConfig {\r\n  name: string;\r\n  firstMessage: string;\r\n  transcriber: {\r\n    provider: string;\r\n    model: string;\r\n  };\r\n  model: {\r\n    provider: string;\r\n    model: string;\r\n    temperature?: number;\r\n  };\r\n  voice: {\r\n    provider: string;\r\n    voiceId: string;\r\n  };\r\n  systemMessage?: string;\r\n  functions?: any[];\r\n  endCallMessage?: string;\r\n  endCallPhrases?: string[];\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface Assistant {\r\n  id: string;\r\n  assistant_id?: string;\r\n  name: string;\r\n  firstMessage: string;\r\n  transcriber: any;\r\n  model: any;\r\n  voice: any;\r\n  systemMessage?: string;\r\n  functions?: any[];\r\n  endCallMessage?: string;\r\n  endCallPhrases?: string[];\r\n  metadata?: Record<string, any>;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\n// Get all assistants with pagination\r\nexport async function fetchAllAgents(page: number, search: string) {\r\n  try {\r\n    const res = await axiosInstance.get(\"/api/assistant/get_all_assistants\", {\r\n      params: { page, search },\r\n    });\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching agents:\", error);\r\n\r\n    // Don't show toast error for expected scenarios:\r\n    // - 404: No agents found (normal for new users)\r\n    // - 204: Empty results\r\n    // - 402: Payment required (normal for users without credits)\r\n    const expectedStatuses = [404, 204, 402];\r\n    if (!expectedStatuses.includes(error?.response?.status)) {\r\n      toast.error(\"Failed to fetch agents\");\r\n    }\r\n\r\n    // Return empty result instead of throwing for expected scenarios\r\n    if (expectedStatuses.includes(error?.response?.status)) {\r\n      return { data: [], totalAssistant: 0, currentPage: 1, totalPages: 0 };\r\n    }\r\n\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Get all assistants without pagination (fetch all pages)\r\nexport async function fetchAllAgentsComplete(search: string = \"\") {\r\n  try {\r\n    let allAssistants: Assistant[] = [];\r\n    let currentPage = 1;\r\n    let totalPages = 1;\r\n\r\n    do {\r\n      const res = await axiosInstance.get(\"/api/assistant/get_all_assistants\", {\r\n        params: { page: currentPage, search, limit: 50 }, // Increase limit for efficiency\r\n      });\r\n\r\n      const { data, totalPages: total } = res.data;\r\n      allAssistants = [...allAssistants, ...data];\r\n      totalPages = total;\r\n      currentPage++;\r\n    } while (currentPage <= totalPages);\r\n\r\n    return { data: allAssistants, total: allAssistants.length };\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching all agents:\", error);\r\n\r\n    // Don't show toast error for expected scenarios:\r\n    // - 404: No agents found (normal for new users)\r\n    // - 204: Empty results\r\n    // - 402: Payment required (normal for users without credits)\r\n    const expectedStatuses = [404, 204, 402];\r\n    if (!expectedStatuses.includes(error?.response?.status)) {\r\n      toast.error(\"Failed to fetch all agents\");\r\n    }\r\n\r\n    // Return empty result instead of throwing for expected scenarios\r\n    if (expectedStatuses.includes(error?.response?.status)) {\r\n      return { data: [], total: 0 };\r\n    }\r\n\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Get all assistants from VAPI directly\r\nexport async function fetchAllAgentsFromVapi() {\r\n  try {\r\n    const res = await axiosInstance.get(\"/api/assistant/list-all-assistants-from-vapi\");\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching agents from VAPI:\", error);\r\n\r\n    // Don't show toast error for expected scenarios:\r\n    // - 404: No agents found (normal for new users)\r\n    // - 204: Empty results\r\n    // - 402: Payment required (normal for users without credits)\r\n    const expectedStatuses = [404, 204, 402];\r\n    if (!expectedStatuses.includes(error?.response?.status)) {\r\n      toast.error(\"Failed to fetch agents from VAPI\");\r\n    }\r\n\r\n    // Return empty result instead of throwing for expected scenarios\r\n    if (expectedStatuses.includes(error?.response?.status)) {\r\n      return { data: [], total: 0 };\r\n    }\r\n\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Get assistants that exist in both local DB and VAPI (fully synced)\r\nexport async function fetchSyncedAgents(page: number = 1, search: string = \"\") {\r\n  try {\r\n    const res = await axiosInstance.get(\"/api/assistant/get-synced-assistants\", {\r\n      params: { page, search, limit: 50 },\r\n    });\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching synced agents:\", error);\r\n\r\n    // Don't show toast error for expected scenarios:\r\n    // - 404: No agents found (normal for new users)\r\n    // - 204: Empty results\r\n    // - 402: Payment required (normal for users without credits)\r\n    const expectedStatuses = [404, 204, 402];\r\n    if (!expectedStatuses.includes(error?.response?.status)) {\r\n      toast.error(\"Failed to fetch synced agents\");\r\n    }\r\n\r\n    // Return empty result instead of throwing for expected scenarios\r\n    if (expectedStatuses.includes(error?.response?.status)) {\r\n      return { data: [], totalPages: 0, currentPage: 1, total: 0 };\r\n    }\r\n\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Get all synced assistants without pagination (fetch all pages)\r\nexport async function fetchAllSyncedAgents(search: string = \"\") {\r\n  try {\r\n    let allAssistants: Assistant[] = [];\r\n    let currentPage = 1;\r\n    let totalPages = 1;\r\n\r\n    do {\r\n      const res = await axiosInstance.get(\"/api/assistant/get-synced-assistants\", {\r\n        params: { page: currentPage, search, limit: 50 },\r\n      });\r\n\r\n      const { data, totalPages: total } = res.data;\r\n      allAssistants = [...allAssistants, ...data];\r\n      totalPages = total;\r\n      currentPage++;\r\n    } while (currentPage <= totalPages);\r\n\r\n    return { data: allAssistants, total: allAssistants.length };\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching all synced agents:\", error);\r\n\r\n    // Don't show toast error for expected scenarios:\r\n    // - 404: No agents found (normal for new users)\r\n    // - 204: Empty results\r\n    // - 402: Payment required (normal for users without credits)\r\n    const expectedStatuses = [404, 204, 402];\r\n    if (!expectedStatuses.includes(error?.response?.status)) {\r\n      toast.error(\"Failed to fetch all synced agents\");\r\n    }\r\n\r\n    // Return empty result instead of throwing for expected scenarios\r\n    if (expectedStatuses.includes(error?.response?.status)) {\r\n      return { data: [], total: 0 };\r\n    }\r\n\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Get assistant by ID\r\nexport async function getAssistantById(id: string) {\r\n  try {\r\n    const res = await axiosInstance.get(`/api/assistant/get-assistants/${id}`);\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching assistant:\", error);\r\n\r\n    // Don't show toast error for expected scenarios:\r\n    // - 404: Assistant not found (normal for new users or invalid IDs)\r\n    // - 204: Empty results\r\n    // - 402: Payment required (normal for users without credits)\r\n    const expectedStatuses = [404, 204, 402];\r\n    if (!expectedStatuses.includes(error?.response?.status)) {\r\n      toast.error(\"Failed to fetch assistant\");\r\n    }\r\n\r\n    // Return null instead of throwing for expected scenarios\r\n    if (expectedStatuses.includes(error?.response?.status)) {\r\n      return null;\r\n    }\r\n\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Get complete assistant details from VAPI directly\r\nexport async function getVapiAssistantById(id: string) {\r\n  try {\r\n    const res = await axiosInstance.get(`/api/assistant/get-assistants/${id}`);\r\n    return res.data;\r\n  } catch (error) {\r\n    console.error(\"Error fetching VAPI assistant:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Create new assistant\r\nexport async function createAssistant(data: VapiAssistant) {\r\n  try {\r\n    const res = await axiosInstance.post(\"/api/assistant/create_assistant\", data);\r\n    toast.success(\"Assistant created successfully\");\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error creating assistant:\", error);\r\n    const message = error.response?.data?.message || \"Failed to create assistant\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Update assistant\r\nexport async function updateAssistant(id: string, data: Partial<VapiAssistant>) {\r\n  try {\r\n    const res = await axiosInstance.put(`/api/assistant/update-assistant/${id}`, data);\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error updating assistant:\", error);\r\n    const message = error.response?.data?.message || \"Failed to update assistant\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Delete assistant\r\nexport async function deleteAssistant(id: string) {\r\n  try {\r\n    console.log('üóëÔ∏è Deleting assistant with ID:', id);\r\n    const res = await axiosInstance.delete(`/api/assistant/delete-assistant/${id}`);\r\n    toast.success(\"Assistant deleted successfully\");\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error deleting assistant:\", error);\r\n    const message = error.response?.data?.message || \"Failed to delete assistant\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Get all Retell agents\r\nexport async function fetchRetellAgents() {\r\n  try {\r\n    const res = await axiosInstance.get(\"/api/retell/agents\");\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching Retell agents:\", error);\r\n    // Don't throw, just return empty list so Vapi agents still load\r\n    return { data: [] };\r\n  }\r\n}\r\n\r\n// Get Retell agent by ID\r\nexport async function getRetellAgentById(id: string) {\r\n  try {\r\n    const res = await axiosInstance.get(`/api/retell/agents/${id}`);\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching Retell agent:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Update Retell agent\r\nexport async function updateRetellAgent(id: string, data: any) {\r\n  try {\r\n    const res = await axiosInstance.patch(`/api/retell/agents/${id}`, data);\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error updating Retell agent:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Delete Retell agent\r\nexport async function deleteRetellAgent(id: string) {\r\n  try {\r\n    const res = await axiosInstance.delete(`/api/retell/agents/${id}`);\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error deleting Retell agent:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Update Retell LLM\r\nexport async function updateRetellLLM(id: string, data: any) {\r\n  try {\r\n    const res = await axiosInstance.put(`/api/retell/llms/${id}`, data);\r\n    return res.data;\r\n  } catch (error: any) {\r\n    console.error(\"Error updating Retell LLM:\", error);\r\n    const message = error.response?.data?.message || \"Failed to update Retell LLM\";\r\n    toast.error(message);\r\n    throw error;\r\n  }\r\n}\r\n"],"names":["fetchAllAgentsComplete","search","allAssistants","currentPage","totalPages","res","axiosInstance","data","total","error","expectedStatuses","_a","toast","_b","fetchAllAgentsFromVapi","fetchAllSyncedAgents","getAssistantById","id","getVapiAssistantById","createAssistant","message","updateAssistant","deleteAssistant","fetchRetellAgents","getRetellAgentById","updateRetellAgent","deleteRetellAgent","updateRetellLLM"],"mappings":"+CA0EsB,eAAAA,EAAuBC,EAAiB,GAAI,SAC5D,GAAA,CACF,IAAIC,EAA6B,CAAC,EAC9BC,EAAc,EACdC,EAAa,EAEd,EAAA,CACD,MAAMC,EAAM,MAAMC,EAAc,IAAI,oCAAqC,CACvE,OAAQ,CAAE,KAAMH,EAAa,OAAAF,EAAQ,MAAO,EAAG,CAAA,CAChD,EAEK,CAAE,KAAAM,EAAM,WAAYC,GAAUH,EAAI,KACxCH,EAAgB,CAAC,GAAGA,EAAe,GAAGK,CAAI,EAC7BH,EAAAI,EACbL,UACOA,GAAeC,GAExB,MAAO,CAAE,KAAMF,EAAe,MAAOA,EAAc,MAAO,QACnDO,EAAY,CACX,QAAA,MAAM,6BAA8BA,CAAK,EAMjD,MAAMC,EAAmB,CAAC,IAAK,IAAK,GAAG,EAMvC,GALKA,EAAiB,UAASC,EAAAF,GAAA,YAAAA,EAAO,WAAP,YAAAE,EAAiB,MAAM,GACpDC,EAAM,MAAM,4BAA4B,EAItCF,EAAiB,UAASG,EAAAJ,GAAA,YAAAA,EAAO,WAAP,YAAAI,EAAiB,MAAM,EACnD,MAAO,CAAE,KAAM,GAAI,MAAO,CAAE,EAGxB,MAAAJ,CAAA,CAEV,CAGA,eAAsBK,GAAyB,SACzC,GAAA,CAEF,OADY,MAAMR,EAAc,IAAI,8CAA8C,GACvE,WACJG,EAAY,CACX,QAAA,MAAM,mCAAoCA,CAAK,EAMvD,MAAMC,EAAmB,CAAC,IAAK,IAAK,GAAG,EAMvC,GALKA,EAAiB,UAASC,EAAAF,GAAA,YAAAA,EAAO,WAAP,YAAAE,EAAiB,MAAM,GACpDC,EAAM,MAAM,kCAAkC,EAI5CF,EAAiB,UAASG,EAAAJ,GAAA,YAAAA,EAAO,WAAP,YAAAI,EAAiB,MAAM,EACnD,MAAO,CAAE,KAAM,GAAI,MAAO,CAAE,EAGxB,MAAAJ,CAAA,CAEV,CA+BsB,eAAAM,EAAqBd,EAAiB,GAAI,SAC1D,GAAA,CACF,IAAIC,EAA6B,CAAC,EAC9BC,EAAc,EACdC,EAAa,EAEd,EAAA,CACD,MAAMC,EAAM,MAAMC,EAAc,IAAI,uCAAwC,CAC1E,OAAQ,CAAE,KAAMH,EAAa,OAAAF,EAAQ,MAAO,EAAG,CAAA,CAChD,EAEK,CAAE,KAAAM,EAAM,WAAYC,GAAUH,EAAI,KACxCH,EAAgB,CAAC,GAAGA,EAAe,GAAGK,CAAI,EAC7BH,EAAAI,EACbL,UACOA,GAAeC,GAExB,MAAO,CAAE,KAAMF,EAAe,MAAOA,EAAc,MAAO,QACnDO,EAAY,CACX,QAAA,MAAM,oCAAqCA,CAAK,EAMxD,MAAMC,EAAmB,CAAC,IAAK,IAAK,GAAG,EAMvC,GALKA,EAAiB,UAASC,EAAAF,GAAA,YAAAA,EAAO,WAAP,YAAAE,EAAiB,MAAM,GACpDC,EAAM,MAAM,mCAAmC,EAI7CF,EAAiB,UAASG,EAAAJ,GAAA,YAAAA,EAAO,WAAP,YAAAI,EAAiB,MAAM,EACnD,MAAO,CAAE,KAAM,GAAI,MAAO,CAAE,EAGxB,MAAAJ,CAAA,CAEV,CAGA,eAAsBO,EAAiBC,EAAY,SAC7C,GAAA,CAEF,OADY,MAAMX,EAAc,IAAI,iCAAiCW,CAAE,EAAE,GAC9D,WACJR,EAAY,CACX,QAAA,MAAM,4BAA6BA,CAAK,EAMhD,MAAMC,EAAmB,CAAC,IAAK,IAAK,GAAG,EAMvC,GALKA,EAAiB,UAASC,EAAAF,GAAA,YAAAA,EAAO,WAAP,YAAAE,EAAiB,MAAM,GACpDC,EAAM,MAAM,2BAA2B,EAIrCF,EAAiB,UAASG,EAAAJ,GAAA,YAAAA,EAAO,WAAP,YAAAI,EAAiB,MAAM,EAC5C,OAAA,KAGH,MAAAJ,CAAA,CAEV,CAGA,eAAsBS,EAAqBD,EAAY,CACjD,GAAA,CAEF,OADY,MAAMX,EAAc,IAAI,iCAAiCW,CAAE,EAAE,GAC9D,WACJR,EAAO,CACN,cAAA,MAAM,iCAAkCA,CAAK,EAC/CA,CAAA,CAEV,CAGA,eAAsBU,EAAgBZ,EAAqB,SACrD,GAAA,CACF,MAAMF,EAAM,MAAMC,EAAc,KAAK,kCAAmCC,CAAI,EAC5EK,OAAAA,EAAM,QAAQ,gCAAgC,EACvCP,EAAI,WACJI,EAAY,CACX,QAAA,MAAM,4BAA6BA,CAAK,EAChD,MAAMW,IAAUP,GAAAF,EAAAF,EAAM,WAAN,YAAAE,EAAgB,OAAhB,YAAAE,EAAsB,UAAW,6BACjDD,MAAAA,EAAM,MAAMQ,CAAO,EACbX,CAAA,CAEV,CAGsB,eAAAY,EAAgBJ,EAAYV,EAA8B,SAC1E,GAAA,CAEF,OADY,MAAMD,EAAc,IAAI,mCAAmCW,CAAE,GAAIV,CAAI,GACtE,WACJE,EAAY,CACX,QAAA,MAAM,4BAA6BA,CAAK,EAChD,MAAMW,IAAUP,GAAAF,EAAAF,EAAM,WAAN,YAAAE,EAAgB,OAAhB,YAAAE,EAAsB,UAAW,6BACjDD,MAAAA,EAAM,MAAMQ,CAAO,EACbX,CAAA,CAEV,CAGA,eAAsBa,EAAgBL,EAAY,SAC5C,GAAA,CACM,QAAA,IAAI,kCAAmCA,CAAE,EACjD,MAAMZ,EAAM,MAAMC,EAAc,OAAO,mCAAmCW,CAAE,EAAE,EAC9EL,OAAAA,EAAM,QAAQ,gCAAgC,EACvCP,EAAI,WACJI,EAAY,CACX,QAAA,MAAM,4BAA6BA,CAAK,EAChD,MAAMW,IAAUP,GAAAF,EAAAF,EAAM,WAAN,YAAAE,EAAgB,OAAhB,YAAAE,EAAsB,UAAW,6BACjDD,MAAAA,EAAM,MAAMQ,CAAO,EACbX,CAAA,CAEV,CAGA,eAAsBc,GAAoB,CACpC,GAAA,CAEF,OADY,MAAMjB,EAAc,IAAI,oBAAoB,GAC7C,WACJG,EAAY,CACX,eAAA,MAAM,gCAAiCA,CAAK,EAE7C,CAAE,KAAM,EAAG,CAAA,CAEtB,CAGA,eAAsBe,EAAmBP,EAAY,CAC/C,GAAA,CAEF,OADY,MAAMX,EAAc,IAAI,sBAAsBW,CAAE,EAAE,GACnD,WACJR,EAAY,CACX,cAAA,MAAM,+BAAgCA,CAAK,EAC7CA,CAAA,CAEV,CAGsB,eAAAgB,EAAkBR,EAAYV,EAAW,CACzD,GAAA,CAEF,OADY,MAAMD,EAAc,MAAM,sBAAsBW,CAAE,GAAIV,CAAI,GAC3D,WACJE,EAAY,CACX,cAAA,MAAM,+BAAgCA,CAAK,EAC7CA,CAAA,CAEV,CAGA,eAAsBiB,EAAkBT,EAAY,CAC9C,GAAA,CAEF,OADY,MAAMX,EAAc,OAAO,sBAAsBW,CAAE,EAAE,GACtD,WACJR,EAAY,CACX,cAAA,MAAM,+BAAgCA,CAAK,EAC7CA,CAAA,CAEV,CAGsB,eAAAkB,EAAgBV,EAAYV,EAAW,SACvD,GAAA,CAEF,OADY,MAAMD,EAAc,IAAI,oBAAoBW,CAAE,GAAIV,CAAI,GACvD,WACJE,EAAY,CACX,QAAA,MAAM,6BAA8BA,CAAK,EACjD,MAAMW,IAAUP,GAAAF,EAAAF,EAAM,WAAN,YAAAE,EAAgB,OAAhB,YAAAE,EAAsB,UAAW,8BACjDD,MAAAA,EAAM,MAAMQ,CAAO,EACbX,CAAA,CAEV"}