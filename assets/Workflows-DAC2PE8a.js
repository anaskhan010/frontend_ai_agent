import{j as e,cl as S,a5 as fe,aU as I,b9 as je,F as ae,aX as Ne,aY as re,N as ye,U as be,b as we,H as ve,J as Ce,T as ke}from"./ui-S570Xcny.js";import{r as c}from"./vendor-DG599jyl.js";import{u as ne,b as Q,c as R}from"./query-Cab5P5bd.js";import{t as U}from"./index-YNP4OU4_.js";import{P as te}from"./Page-BJWqKr2O.js";import{H as Se}from"./Header-BSPv7FNt.js";import{C,b as z,c as G,d as Y,a as k}from"./card-DMfGhRm1.js";import{T as De,a as Ae,b as P,c as y,d as Fe,e as g}from"./table-Beiyegzh.js";import{B as f}from"./button-BSd9MMPp.js";import{B as A}from"./badge-ij7fArnn.js";import{D as Te,a as We,b as Ie,e as V}from"./dropdown-menu-Bxst4dXB.js";import{A as Pe,a as Ve,b as Ee,c as qe,d as Me,e as Be,f as Le,g as Ke}from"./alert-dialog-CmVht1cJ.js";import{I as le}from"./input-jxB46izN.js";import{S as E}from"./skeleton-DCCxw5XX.js";import{g as $e,a as Oe,t as He,i as Qe,e as Re}from"./workflowService-rxiFacV1.js";import{V as oe}from"./vapiService-Dd3ng0ju.js";import{u as Ue}from"./resolvers-BzctgYTE.js";import{t as ze,o as Ge,s as D,F as Ye,a as q,b as M,c as B,d as L,f as K,e as $}from"./index-C85ukgKc.js";import{T as Je}from"./textarea-Cw4zrZDH.js";import{S as Xe,a as _e,b as Ze,c as es,d as O}from"./select-D0_OqHwT.js";import{f as ss}from"./agentService-5ehuwXL9.js";import{C as as}from"./CreditGuard-Bq9_PpTi.js";import{u as ie}from"./router-BavLd_S0.js";import"./scroll-area-C-pzVjaj.js";import"./index-BHBJ6RT-.js";import"./index-CWMUKvWL.js";import"./sheet-C7DsuPAk.js";import"./label-C1-UM1F-.js";import"./index-HDeFwIcs.js";function rs(n,i){const[o,h]=c.useState(n);return c.useEffect(()=>{const t=setTimeout(()=>{h(n)},i);return()=>{clearTimeout(t)}},[n,i]),o}function ts(){const n=c.useRef(null),i=c.useCallback(t=>{t.preventDefault()},[]),o=c.useCallback(t=>{t.preventDefault(),n.current&&n.current.focus()},[]),h=c.useCallback(t=>{t.key==="Escape"&&(t.preventDefault(),n.current&&n.current.focus())},[]);return{triggerRef:n,handleOpenAutoFocus:i,handleCloseAutoFocus:o,handleKeyDown:h,contentProps:{onOpenAutoFocus:i,onCloseAutoFocus:o,onKeyDown:h},triggerProps:{ref:n}}}function H(n,i="activate"){return{"aria-label":`${i} ${n}`,role:"menuitem"}}function ns(n){return{"aria-label":`Actions for ${n}`,"aria-haspopup":"menu","aria-expanded":!1}}const ls=Ge({name:D().min(1,"Name is required").max(80,"Name must be 80 characters or less"),description:D().optional(),template:D().optional(),assistantId:D().optional()}),os=()=>{const n=ie(),i=ne(),[o,h]=c.useState(null),t=Ue({resolver:ze(ls),defaultValues:{name:"",description:"",template:""}}),{data:x,isLoading:u}=Q({queryKey:["workflow-templates"],queryFn:$e}),{data:j,isLoading:F}=Q({queryKey:["agents-all"],queryFn:()=>ss("")}),b=R({mutationFn:oe.createWorkflow,onSuccess:a=>{console.log("VAPI Workflow creation response:",a),i.invalidateQueries({queryKey:["workflows"]}),U.success("Workflow created successfully");const r=a==null?void 0:a.id;console.log("Navigating to workflow:",r),n(`/workflows/${r}/edit`)},onError:a=>{var r,d;console.error("VAPI Workflow creation error:",a),U.error(((d=(r=a.response)==null?void 0:r.data)==null?void 0:d.message)||"Failed to create workflow")}}),T=a=>{let r={name:a.name,description:a.description,assistantId:a.assistantId==="none"?void 0:a.assistantId};o?r={...r,nodes:o.nodes,edges:o.edges}:r={...r,nodes:[{type:"conversation",name:"start",isStart:!0,prompt:"You are a helpful AI assistant. Greet the user and ask how you can help them today."}],edges:[]},b.mutate(r)},p=a=>{var d;const r=(d=x==null?void 0:x.data)==null?void 0:d.find(N=>N.id===a);h(r||null),t.setValue("template",a),r&&(t.getValues("name")||t.setValue("name",r.name),t.getValues("description")||t.setValue("description",r.description))},w=(x==null?void 0:x.data)||[];return e.jsx(as,{requiredCredits:1,feature:"workflow creation",showUpgradeButton:!0,children:e.jsxs("div",{className:"space-y-6 h-full overflow-y-auto p-1",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-4 border-b border-gray-200",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(S,{className:"h-4 w-4 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Create New Workflow"})]}),e.jsx(Ye,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(T),className:"space-y-6",children:[e.jsxs(C,{className:"border border-gray-200 shadow-sm",children:[e.jsxs(z,{className:"pb-4",children:[e.jsx(G,{className:"text-lg font-medium text-gray-900",children:"Basic Information"}),e.jsx(Y,{className:"text-gray-600",children:"Provide basic details for your workflow"})]}),e.jsxs(k,{className:"space-y-4 pt-0",children:[e.jsx(q,{control:t.control,name:"name",render:({field:a})=>e.jsxs(M,{children:[e.jsx(B,{children:"Name *"}),e.jsx(L,{children:e.jsx(le,{placeholder:"Enter workflow name",...a})}),e.jsx(K,{children:"A descriptive name for your workflow (max 80 characters)"}),e.jsx($,{})]})}),e.jsx(q,{control:t.control,name:"description",render:({field:a})=>e.jsxs(M,{children:[e.jsx(B,{children:"Description"}),e.jsx(L,{children:e.jsx(Je,{placeholder:"Describe what this workflow does...",className:"resize-none",rows:3,...a})}),e.jsx(K,{children:"Optional description to help you remember the workflow's purpose"}),e.jsx($,{})]})}),e.jsx(q,{control:t.control,name:"assistantId",render:({field:a})=>{var r;return e.jsxs(M,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4 text-primary"}),"Select Agent (Optional)"]}),e.jsxs(Xe,{onValueChange:a.onChange,value:a.value,children:[e.jsx(L,{children:e.jsx(_e,{children:e.jsx(Ze,{placeholder:"Choose an agent for this workflow"})})}),e.jsxs(es,{children:[e.jsx(O,{value:"none",children:"No Agent (Create from workflow)"}),F?e.jsxs(O,{value:"loading",disabled:!0,children:[e.jsx(I,{className:"h-4 w-4 animate-spin mr-2"}),"Loading agents..."]}):(r=j==null?void 0:j.data)==null?void 0:r.map(d=>e.jsx(O,{value:d.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4 text-green-600"}),d.name]})},d.id))]})]}),e.jsx(K,{children:"Select an existing agent to use with this workflow, or leave empty to create one automatically"}),e.jsx($,{})]})}})]})]}),e.jsxs(C,{className:"border border-gray-200 shadow-sm",children:[e.jsxs(z,{className:"pb-4",children:[e.jsxs(G,{className:"flex items-center gap-2 text-lg font-medium text-gray-900",children:[e.jsx(ae,{className:"h-4 w-4 text-gray-600"}),"Choose Template"]}),e.jsx(Y,{className:"text-gray-600",children:"Start with a pre-built template or create from scratch"})]}),e.jsx(k,{className:"pt-0",children:u?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(I,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading templates..."})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(C,{className:`cursor-pointer transition-all duration-200 border ${o?"hover:bg-gray-50 hover:border-gray-300 border-gray-200":"ring-2 ring-blue-500 bg-blue-50 border-blue-200"}`,onClick:()=>{h(null),t.setValue("template","")},children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(S,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium",children:"Blank Workflow"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Start from scratch"})]})]})})}),w.map(a=>{var r;return e.jsx(C,{className:`cursor-pointer transition-all duration-200 border ${(o==null?void 0:o.id)===a.id?"ring-2 ring-blue-500 bg-blue-50 border-blue-200":"hover:bg-gray-50 hover:border-gray-300 border-gray-200"}`,onClick:()=>p(a.id),children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(ae,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium",children:a.name}),e.jsx(A,{variant:"outline",className:"text-xs",children:a.category})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.description}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsxs(A,{variant:"secondary",className:"text-xs",children:[((r=a.nodes)==null?void 0:r.length)||0," nodes"]})})]})]})})},a.id)})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>t.reset(),className:"px-6",children:"Reset"}),e.jsx(f,{type:"submit",disabled:b.isPending,className:"min-w-[140px] px-6 bg-blue-600 hover:bg-blue-700",children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Workflow"})]})]})})]})})},Ms=()=>{var X,_,Z,ee,se;const n=ie(),i=ne(),[o,h]=c.useState(""),[t,x]=c.useState(!1),[u,j]=c.useState(null),[F,b]=c.useState("list"),[T,p]=c.useState(null),w=rs(o,300),a=ts();c.useEffect(()=>{t&&p(null)},[t]);const{data:r,isLoading:d,error:N}=Q({queryKey:["workflows",w],queryFn:()=>Oe(1,w)}),W=R({mutationFn:oe.deleteWorkflow,onSuccess:()=>{i.invalidateQueries({queryKey:["workflows"]}),x(!1),j(null),p(null)},onError:()=>{p(null)}});R({mutationFn:({id:s})=>He(s),onSuccess:()=>{U.success("Workflow test initiated successfully")}});const J=s=>{h(s)},ce=s=>{p(null),j(s),x(!0)},de=()=>{u!=null&&u.id&&W.mutate(u.id)},me=s=>{n(`/workflows/${s.id}/edit`)},xe=s=>{n(`/workflows/${s.id}`)},he=async s=>{if(s.id)try{await Re(s.id)}catch(l){console.error("Export failed:",l)}},ue=async s=>{var v;const l=(v=s.target.files)==null?void 0:v[0];if(l)try{await Qe(l),i.invalidateQueries({queryKey:["workflows"]})}catch(m){console.error("Import failed:",m)}s.target.value=""},pe=s=>{const l={active:"bg-green-100 text-green-800",inactive:"bg-gray-100 text-gray-800",draft:"bg-yellow-100 text-yellow-800",archived:"bg-red-100 text-red-800"};return e.jsx(A,{className:l[s]||l.inactive,children:s})},ge=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});if(N){const l=((X=N==null?void 0:N.response)==null?void 0:X.status)===402;return e.jsx(te,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:`p-3 rounded-full ${l?"bg-orange-100":"bg-red-100"}`,children:e.jsx(Ne,{className:`h-8 w-8 ${l?"text-orange-600":"text-red-600"}`})})}),l?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Insufficient Credits"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"You need credits to access workflow features. Please purchase credits to continue."}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(f,{onClick:()=>n("/credits/purchase"),children:"Purchase Credits"}),e.jsxs(f,{variant:"outline",onClick:()=>i.invalidateQueries({queryKey:["workflows"]}),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Failed to load workflows"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Unable to connect to the backend API. Please ensure the backend server is running."}),e.jsxs(f,{onClick:()=>i.invalidateQueries({queryKey:["workflows"]}),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})]})})})}return e.jsxs(te,{children:[e.jsx(Se,{title:"Workflows",buttonText:"Create Workflow",filterByName:!0,filterWord:w,onFilterChange:J,useSheet:!0,sheetContent:e.jsx(os,{}),sheetSize:"xl",viewMode:F,onViewModeChange:b,showViewToggle:!0}),e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(le,{placeholder:"Search workflows...",value:o,onChange:s=>J(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",accept:".json",onChange:ue,className:"hidden",id:"import-workflow"}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{var s;return(s=document.getElementById("import-workflow"))==null?void 0:s.click()},children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Import"]})]})]}),e.jsxs(C,{className:"border-0 shadow-none bg-transparent",children:[e.jsxs(z,{className:"px-0 pb-4",children:[e.jsxs(G,{className:"flex items-center gap-2 text-xl font-semibold",children:[e.jsx(S,{className:"h-5 w-5"}),"Workflows"]}),e.jsx(Y,{className:"text-gray-500",children:"Manage your voice AI workflows and conversation flows"})]}),e.jsx(k,{className:"px-0",children:d?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,l)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(E,{className:"h-12 w-12 rounded"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(E,{className:"h-4 w-[250px]"}),e.jsx(E,{className:"h-4 w-[200px]"})]})]},l))}):e.jsx("div",{className:"rounded-lg border bg-white",children:e.jsxs(De,{children:[e.jsx(Ae,{children:e.jsxs(P,{className:"border-b bg-gray-50/50",children:[e.jsx(y,{className:"font-medium text-gray-900",children:"Name"}),e.jsx(y,{className:"font-medium text-gray-900",children:"Description"}),e.jsx(y,{className:"font-medium text-gray-900",children:"Nodes"}),e.jsx(y,{className:"font-medium text-gray-900",children:"Status"}),e.jsx(y,{className:"font-medium text-gray-900",children:"Last Modified"}),e.jsx(y,{className:"text-right font-medium text-gray-900",children:"Actions"})]})}),e.jsxs(Fe,{children:[(Z=(_=r==null?void 0:r.data)==null?void 0:_.workflows)==null?void 0:Z.map(s=>{var l,v;return e.jsxs(P,{className:"cursor-pointer hover:bg-gray-50/50",onClick:()=>xe(s),children:[e.jsx(g,{className:"font-medium py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(S,{className:"h-4 w-4 text-blue-600"})}),e.jsx("span",{className:"text-gray-900",children:s.name})]})}),e.jsx(g,{className:"text-gray-600 py-4",children:s.description||"No description"}),e.jsx(g,{className:"py-4",children:e.jsxs(A,{variant:"secondary",className:"bg-gray-100 text-gray-700 hover:bg-gray-100",children:[((l=s.nodes)==null?void 0:l.length)||0," nodes"]})}),e.jsx(g,{className:"py-4",children:pe(((v=s.localData)==null?void 0:v.status)||"active")}),e.jsx(g,{className:"text-gray-600 py-4",children:s.updatedAt?ge(s.updatedAt):"N/A"}),e.jsx(g,{className:"text-right py-4",children:e.jsxs(Te,{open:T===s.id,onOpenChange:m=>p(m&&s.id||null),children:[e.jsx(We,{asChild:!0,onClick:m=>m.stopPropagation(),...a.triggerProps,children:e.jsx(f,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-gray-100",...ns(s.name),children:e.jsx(we,{className:"h-4 w-4"})})}),e.jsxs(Ie,{align:"end",...a.contentProps,children:[e.jsxs(V,{onClick:m=>{m.stopPropagation(),me(s)},...H(s.name,"Edit"),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(V,{onClick:m=>{m.stopPropagation(),he(s)},...H(s.name,"Export"),children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Export"]}),e.jsxs(V,{onClick:m=>{m.stopPropagation(),ce(s)},className:"text-red-600",...H(s.name,"Delete"),children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},s.id)}),((se=(ee=r==null?void 0:r.data)==null?void 0:ee.workflows)==null?void 0:se.length)===0&&e.jsx(P,{children:e.jsx(g,{colSpan:6,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(S,{className:"h-8 w-8 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No workflows found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Create your first workflow to get started"})]})})})]})]})})})]}),e.jsx(Pe,{open:t,onOpenChange:x,children:e.jsxs(Ve,{children:[e.jsxs(Ee,{children:[e.jsx(qe,{children:"Delete Workflow"}),e.jsxs(Me,{children:['Are you sure you want to delete "',u==null?void 0:u.name,'"? This action cannot be undone.']})]}),e.jsxs(Be,{children:[e.jsx(Le,{children:"Cancel"}),e.jsx(Ke,{onClick:de,className:"bg-red-600 hover:bg-red-700",disabled:W.isPending,children:W.isPending?"Deleting...":"Delete"})]})]})}),!1]})};export{Ms as default};
//# sourceMappingURL=Workflows-DAC2PE8a.js.map
