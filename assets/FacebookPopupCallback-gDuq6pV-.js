import{j as e}from"./ui-D0JisYOU.js";import{r as p}from"./vendor-D6QveUxv.js";import{d as x}from"./router-jXXg-8rg.js";const k=()=>{const[s]=x(),[i,a]=p.useState("loading"),[d,n]=p.useState("Processing Facebook authentication...");return p.useEffect(()=>{(async()=>{var w;try{console.log("üöÄ FacebookPopupCallback component loaded!"),console.log("üîç Current URL:",window.location.href),console.log("üîç Search params:",window.location.search),console.log("üîç Hash:",window.location.hash),document.title="Facebook OAuth Callback - Processing...";const m=s.get("success"),g=s.get("name"),u=s.get("email"),h=s.get("id"),c=s.get("error");if(console.log("üîç Facebook popup callback parameters:",{success:m,name:g,email:u,id:h,error:c}),console.log("üîç All search params:",Object.fromEntries(s.entries())),m==="true"&&(g||u)){a("success"),n("Facebook Lead Ads connected successfully!"),console.log("üéâ Facebook OAuth success in popup, notifying parent window"),console.log("üîç Checking parent window...",{hasOpener:!!window.opener,openerClosed:(w=window.opener)==null?void 0:w.closed,origin:window.location.origin});const l={type:"facebook_oauth_success",data:{isConnected:!0,facebookUser:{name:decodeURIComponent(g||"Facebook User"),email:decodeURIComponent(u||""),id:decodeURIComponent(h||"facebook_user")}}};console.log("üì§ Message being sent:",l);const r=()=>{let t=!1;if(window.opener&&!window.opener.closed)try{console.log("üì§ Sending message via window.opener.postMessage"),window.opener.postMessage(l,"*"),t=!0}catch(o){console.log("‚ö†Ô∏è window.opener.postMessage failed:",o)}try{const o=new BroadcastChannel("facebook_oauth_channel");console.log("üì§ Sending message via BroadcastChannel"),o.postMessage(l),o.close(),t=!0}catch(o){console.log("‚ö†Ô∏è BroadcastChannel failed:",o)}try{console.log("üì§ Storing message in localStorage"),localStorage.setItem("facebook_oauth_result",JSON.stringify({...l,timestamp:Date.now()})),t=!0}catch(o){console.log("‚ö†Ô∏è localStorage failed:",o)}return t};r(),setTimeout(r,100),setTimeout(r,500),setTimeout(r,1e3),setTimeout(()=>{console.log("üîí Closing Facebook popup window");try{window.close()}catch(t){console.log("‚ö†Ô∏è Error closing popup:",t)}},3e3)}else c?(a("error"),n(`Authentication failed: ${decodeURIComponent(c)}`),window.opener&&!window.opener.closed?(window.opener.postMessage({type:"facebook_oauth_error",message:decodeURIComponent(c)},window.location.origin),setTimeout(()=>{window.close()},3e3)):setTimeout(()=>{window.close()},3e3)):(a("error"),n("Invalid callback parameters"),setTimeout(()=>{window.close()},3e3))}catch{a("error"),n("An unexpected error occurred"),setTimeout(()=>{window.close()},3e3)}})()},[s]),e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[i==="loading"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{role:"img","aria-label":"Facebook",children:"üìò"})}),e.jsx("div",{className:"text-lg font-semibold text-blue-900",children:"Connecting Facebook..."}),e.jsx("div",{className:"text-sm text-gray-500",children:d})]}),i==="success"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{role:"img","aria-label":"Success",children:"‚úÖ"})}),e.jsx("div",{className:"text-lg font-semibold text-green-900",children:"Successfully Connected!"}),e.jsx("div",{className:"text-sm text-green-700",children:d}),e.jsx("div",{className:"text-xs text-gray-500",children:"This window will close automatically..."})]}),i==="error"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{role:"img","aria-label":"Error",children:"‚ùå"})}),e.jsx("div",{className:"text-lg font-semibold text-red-900",children:"Connection Failed"}),e.jsx("div",{className:"text-sm text-red-700",children:d}),e.jsx("div",{className:"text-xs text-gray-500",children:"This window will close automatically..."})]})]})})};export{k as default};
//# sourceMappingURL=FacebookPopupCallback-gDuq6pV-.js.map
