import{j as e,n as W,N as $,aP as q,aQ as V,aw as B,cj as H}from"./ui-B8VyAbFl.js";import{r,b as T}from"./vendor-DG599jyl.js";import{P as J}from"./Page-DzlDDSku.js";import{a as w,t as p,C as D,b as G,a8 as K,B as F,s as z,v as Q,w as X,x as Y,y as Z,Q as R,R as U,U as M,V as P,L as S,I,X as ee}from"./index-BQqu6sK2.js";import"./sheet-qVAPaj3K.js";import{g as te,G as ae}from"./gmail-shwwmzyD.js";import"./router-BnJytTjr.js";import"./query-CWB_8EHL.js";const se=({isConnected:f,onDisconnect:x})=>{const[d,l]=r.useState(""),[v,b]=r.useState([]),[j,y]=r.useState([]),[k,i]=r.useState(!1),[n,u]=r.useState(!1),[N,g]=r.useState(null),[h,m]=r.useState({}),C=[{value:"email",label:"Email"},{value:"full_name",label:"Full name"},{value:"first_name",label:"First name"},{value:"last_name",label:"Last name"},{value:"phone",label:"Phone"},{value:"company",label:"Company"},{value:"job_title",label:"Job Title"},{value:"address",label:"Address"},{value:"city",label:"City"},{value:"state",label:"State"},{value:"zip_code",label:"Zip Code"},{value:"country",label:"Country"}];r.useEffect(()=>{f&&A()},[f]),r.useEffect(()=>{d&&_(d)},[d]);const A=async()=>{try{i(!0);const t=await w.get("/api/facebook/pages/stored");t.data.success&&(b(t.data.data||[]),t.data.data&&t.data.data.length>0&&l(t.data.data[0].id))}catch(t){console.error("Error fetching pages:",t)}finally{i(!1)}},_=async t=>{try{i(!0);const c=await w.get(`/api/facebook/forms/stored/${t}`);c.data.success&&y(c.data.data||[])}catch(c){console.error("Error fetching forms:",c)}finally{i(!1)}},E=t=>{g(t),m(t.field_mapping||{}),u(!0)},a=async()=>{try{(await w.put(`/api/facebook/forms/${N.id}/field-mapping`,{field_mapping:h})).data.success&&(y(j.map(c=>c.id===N.id?{...c,field_mapping:h}:c)),u(!1),g(null))}catch(t){console.error("Error saving field mapping:",t)}},s=async(t,c)=>{try{const o=!c;(await w.put(`/api/facebook/forms/${t}/toggle`,{is_enabled:o})).data.success&&y(j.map(O=>O.id===t?{...O,is_enabled:o}:O))}catch(o){console.error("Error toggling form status:",o)}};return f?e.jsxs("div",{className:" rounded-lg border neo-card border-none \\ p-6",children:[e.jsxs("div",{className:"flex items-center  justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Facebook Form Fields Mapping"}),e.jsx("button",{onClick:x,className:`px-4 py-2 rounded-lg text-sm font-medium
          bg-red-500/20 text-red-400
          border border-red-500/30
          hover:bg-red-500/30 hover:text-red-300
          transition`,children:"Disconnect"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-2",children:"Select Page"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:d,onChange:t=>l(t.target.value),className:`
    w-full px-3 py-2 pr-10 rounded-lg
    bg-white/5 text-white
    border border-white/20
    focus:outline-none
    focus:ring-2 focus:ring-indigo-500/50
    focus:border-indigo-500/50
    appearance-none
  `,children:[e.jsx("option",{value:"",className:"bg-[#0b0f2e] text-white",children:"Select a page..."}),v.map(t=>e.jsx("option",{value:t.id,className:"bg-[#0b0f2e] text-white",children:t.name},t.id))]}),e.jsx(W,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-white/40 pointer-events-none"})]})]}),d&&e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:`grid grid-cols-4 gap-4 px-4 py-3
  bg-white/5
  border-b border-white/10
  rounded-lg
  text-sm font-medium text-white/70`,children:[e.jsx("div",{children:"Page Name"}),e.jsx("div",{children:"Form Name"}),e.jsx("div",{children:"Map Fields"}),e.jsx("div",{children:"Status"})]}),k?e.jsx("div",{className:"py-8 text-center text-gray-500",children:"Loading forms..."}):j.length===0?e.jsx("div",{className:"py-8 text-center text-gray-500",children:"No forms found for this page"}):j.map(t=>{const c=v.find(o=>o.id===d);return e.jsxs("div",{className:`
                grid grid-cols-4 gap-4 px-4 py-4 items-center
                border-b border-white/5
                text-white/80
                hover:bg-white/5
                transition
              `,children:[e.jsx("div",{className:"text-sm text-white",children:(c==null?void 0:c.name)||"Unknown Page"}),e.jsx("div",{className:"text-sm text-white",children:t.form_name||t.name}),e.jsx("div",{children:e.jsxs("button",{onClick:()=>E(t),className:`
    inline-flex items-center gap-1
    px-3 py-1.5 text-sm
    rounded-md
    bg-indigo-500/20 text-indigo-300
    border border-indigo-500/30
    hover:bg-indigo-500/30
    transition`,children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"Edit Fields"]})}),e.jsx("div",{children:e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.is_enabled||!1,onChange:()=>s(t.id,t.is_enabled),className:"sr-only peer"}),e.jsx("div",{className:`
  w-11 h-6 rounded-full
  bg-white/10
  peer-checked:bg-indigo-500/70
  transition
  relative
`})]})})]},t.id)})]}),n&&N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Map Fields"}),e.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(q,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-6",children:["Map the fields in your form to the CRM fields. If you have any questions, we recommend checking out the"," ",e.jsx("a",{href:"#",className:"text-blue-600 hover:underline",children:"support article by clicking here"}),"."]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsx("div",{children:e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Form Fields"})}),e.jsx("div",{children:e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"CRM Fields"})})]}),N.questions&&N.questions.length>0?N.questions.map((t,c)=>e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"text-sm text-gray-900",children:[t.label,t.type==="EMAIL"&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})}),e.jsx("div",{children:e.jsxs("select",{value:h[t.key]||"",onChange:o=>m({...h,[t.key]:o.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select CRM field..."}),C.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]})})]},c)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No form fields available for mapping"}),e.jsxs("div",{className:"flex items-center p-4 bg-orange-50 border border-orange-200 rounded-lg mb-6",children:[e.jsx(V,{className:"h-5 w-5 text-orange-500 mr-3 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-orange-700",children:"Map any of the above mandatory fields to receive leads into your account successfully."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Confirm"})]})]})]})})]}):null},oe=()=>{const[f,x]=r.useState(!1),[d,l]=r.useState(null),[v,b]=r.useState(!0),j=async()=>{try{b(!0);const n=await w.get("/api/linkedin/auth/status");n.data.success&&n.data.data.isConnected?(x(!0),l(n.data.data.profile)):(x(!1),l(null))}catch(n){console.error("Error checking LinkedIn connection:",n)}finally{b(!1)}};r.useEffect(()=>{j()},[]);const y=async()=>{try{const n=await w.get("/api/linkedin/auth/url");n.data.success&&n.data.data.authUrl&&window.open(n.data.data.authUrl,"linkedin-auth","width=600,height=600")}catch(n){console.error("Error initiating LinkedIn OAuth:",n),p.error("Failed to start LinkedIn authentication")}},k=async()=>{try{(await w.delete("/api/linkedin/auth/disconnect")).data.success&&(x(!1),l(null),p.success("LinkedIn disconnected successfully"))}catch(n){console.error("Error disconnecting LinkedIn:",n),p.error("Failed to disconnect LinkedIn")}},i=r.useCallback(n=>{n.type==="LINKEDIN_AUTH_SUCCESS"?(x(!0),n.data&&l({email:n.data.email}),p.success("LinkedIn connected successfully!"),j()):n.type==="LINKEDIN_AUTH_ERROR"&&p.error(n.message||"Failed to connect LinkedIn")},[]);return r.useEffect(()=>{const n=h=>{var m,C;(((m=h.data)==null?void 0:m.type)==="LINKEDIN_AUTH_SUCCESS"||((C=h.data)==null?void 0:C.type)==="LINKEDIN_AUTH_ERROR")&&i(h.data)};let u=null;try{u=new BroadcastChannel("linkedin_oauth_channel"),u.onmessage=h=>{h.data&&i(h.data)}}catch{}const g=setInterval(()=>{try{const h=localStorage.getItem("linkedin_oauth_result");if(h){const m=JSON.parse(h);m.timestamp&&Date.now()-m.timestamp<3e4&&(localStorage.removeItem("linkedin_oauth_result"),i(m))}}catch{}},500);return window.addEventListener("message",n),()=>{window.removeEventListener("message",n),u&&u.close(),clearInterval(g)}},[i]),e.jsx(D,{className:"w-full max-w-sm bg-white/5 backdrop-blur-md border border-white/10 rounded-lg shadow-sm hover:shadow-md hover:border-indigo-500/30 transition-all duration-200",children:e.jsxs(G,{className:"flex flex-col items-center text-center p-2 space-y-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden flex items-center justify-center bg-white/10 border-2 border-white/20",children:e.jsx("img",{src:K,alt:"LinkedIn",className:"w-full h-full object-cover"})}),e.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:f&&(d!=null&&d.email)?`Connected: ${d.email}`:"Connect your location's LinkedIn Account"}),e.jsx(F,{onClick:f?k:y,className:`w-full py-3 rounded-md font-medium transition-colors duration-200 ${f?"bg-gradient-to-r from-red-500 via-red-500 to-red-500 text-white border-0":"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white border-0"}`,children:f?"Disconnect":"Connect"})]})})},ne="/assets/whatsapp-CLsWtoMc.png",re=({isOpen:f,onClose:x,onConnect:d})=>{const[l,v]=r.useState("meta"),[b,j]=r.useState(!1),[y,k]=r.useState(!1),[i,n]=r.useState("credentials"),[u,N]=r.useState(""),[g,h]=r.useState({phoneNumberId:"",accessToken:"",wabaId:"",displayPhoneNumber:""}),[m,C]=r.useState({accountSid:"",authToken:"",whatsappNumber:""}),A=async()=>{var s,t;k(!0);try{const c=l==="meta"?g:m,o=await w.post("/api/whatsapp/auth/send-otp",{provider:l,credentials:c});o.data.success?(n("otp"),p.success(`OTP sent to your phone via ${l==="meta"?"WhatsApp":"SMS"}!`)):p.error(o.data.message||"Failed to send OTP")}catch(c){console.error("OTP send error:",c),p.error(((t=(s=c.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to send OTP. Please check credentials.")}finally{k(!1)}},_=async()=>{var s,t;j(!0);try{const c=await w.post("/api/whatsapp/auth/verify-otp",{code:u});c.data.success?(p.success("WhatsApp connected successfully!"),d(),x()):p.error(c.data.message||"Invalid OTP")}catch(c){console.error("OTP verify error:",c),p.error(((t=(s=c.response)==null?void 0:s.data)==null?void 0:t.message)||"Verification failed")}finally{j(!1)}},E=async s=>{s.preventDefault(),i==="otp"?_():A()},a=()=>l==="meta"?g.phoneNumberId&&g.accessToken&&g.wabaId&&g.displayPhoneNumber:m.accountSid&&m.authToken&&m.whatsappNumber;return e.jsx(z,{open:f,onOpenChange:x,children:e.jsxs(Q,{className:"sm:max-w-[1000px] bg-[#0b0f2e] text-white border-white/10 p-0 overflow-hidden",children:[e.jsx("div",{className:"p-6 pb-0",children:e.jsxs(X,{children:[e.jsxs(Y,{className:"flex items-center gap-2 text-xl",children:[e.jsx(B,{className:"w-6 h-6 text-green-500"}),"Connect WhatsApp Business"]}),e.jsx(Z,{className:"text-gray-400 mt-2",children:i==="otp"?`Enter the verification code sent to your phone via ${l==="meta"?"WhatsApp":"SMS"}.`:"Choose your provider and enter credentials to enable automated messaging."})]})}),e.jsxs("form",{onSubmit:E,children:[i==="credentials"?e.jsxs(R,{defaultValue:"meta",className:"w-full mt-4",onValueChange:s=>v(s),children:[e.jsxs(U,{className:"grid w-full grid-cols-2 bg-white/5 mx-6 w-auto border border-white/10",children:[e.jsx(M,{value:"meta",className:"data-[state=active]:bg-green-600/20 data-[state=active]:text-green-400",children:"Meta Cloud API"}),e.jsx(M,{value:"twilio",className:"data-[state=active]:bg-blue-600/20 data-[state=active]:text-blue-400",children:"Twilio API"})]}),e.jsxs("div",{className:"p-6 pt-4",children:[e.jsxs(P,{value:"meta",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"text-gray-300",children:"Phone Number ID"}),e.jsx(I,{placeholder:"e.g. 106312345678901",autoComplete:"off",value:g.phoneNumberId,onChange:s=>h({...g,phoneNumberId:s.target.value}),className:"bg-white/5 border-white/10 text-white focus:border-green-500/50",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"text-gray-300",children:"WABA ID"}),e.jsx(I,{placeholder:"WhatsApp Business Account ID",value:g.wabaId,autoComplete:"off",onChange:s=>h({...g,wabaId:s.target.value}),className:"bg-white/5 border-white/10 text-white focus:border-green-500/50",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"text-gray-300",children:"Permanent Access Token"}),e.jsx(I,{type:"password",placeholder:"EAAGxxxxxxxx...",autoComplete:"off",value:g.accessToken,onChange:s=>h({...g,accessToken:s.target.value}),className:"bg-white/5 border-white/10 text-white focus:border-green-500/50",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"text-gray-300",children:"Your Phone Number (for WhatsApp OTP)"}),e.jsx(I,{placeholder:"+1 234 567 8900",value:g.displayPhoneNumber,autoComplete:"off",onChange:s=>h({...g,displayPhoneNumber:s.target.value}),className:"bg-white/5 border-white/10 text-white focus:border-green-500/50",required:!0})]})]}),e.jsxs(P,{value:"twilio",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"text-gray-300",children:"WhatsApp Number to Connect"}),e.jsx(I,{placeholder:"+14155238886",value:m.whatsappNumber,autoComplete:"off",onChange:s=>C({...m,whatsappNumber:s.target.value}),className:"bg-white/5 border-white/10 text-white focus:border-blue-500/50",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"text-gray-300",children:"Twilio Account SID"}),e.jsx(I,{placeholder:"ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",value:m.accountSid,autoComplete:"off",onChange:s=>C({...m,accountSid:s.target.value}),className:"bg-white/5 border-white/10 text-white focus:border-blue-500/50",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"text-gray-300",children:"Twilio Auth Token"}),e.jsx(I,{type:"password",placeholder:"Auth Token",value:m.authToken,autoComplete:"off",onChange:s=>C({...m,authToken:s.target.value}),className:"bg-white/5 border-white/10 text-white focus:border-blue-500/50",required:!0})]})]})]})]}):e.jsx("div",{className:"p-6 space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"text-gray-300",children:"6-Digit Verification Code"}),e.jsx(I,{placeholder:"Â· Â· Â· Â· Â· Â·",value:u,onChange:s=>N(s.target.value.replace(/\D/g,"").slice(0,6)),className:"bg-white/5 border-white/10 text-white text-center text-3xl tracking-[0.5em] h-16 focus:border-green-500/50",required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["Enter the code sent to ",l==="meta"?g.displayPhoneNumber:m.whatsappNumber," via ",l==="meta"?"WhatsApp":"SMS"]})]})}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-3 flex items-start gap-3 mb-4",children:[e.jsx(H,{className:`w-5 h-5 mt-0.5 shrink-0 ${i==="otp"?"text-blue-500":"text-amber-500"}`}),e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:`font-medium ${i==="otp"?"text-blue-400":"text-amber-400"}`,children:i==="otp"?"Verification Step":"Configuration Step"}),e.jsx("p",{className:"text-gray-500 mt-0.5",children:i==="otp"?`Enter the code received on your phone (${l==="meta"?"WhatsApp":"SMS"}) to verify.`:`We will send a code to your phone via ${l==="meta"?"WhatsApp":"SMS"} to verify ownership.`})]})]}),e.jsx(ee,{className:"gap-2 sm:gap-0",children:i==="otp"?e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsx(F,{type:"button",variant:"ghost",onClick:()=>n("credentials"),className:"text-gray-400 hover:text-white hover:bg-white/5 flex-1",children:"Back"}),e.jsx(F,{type:"submit",disabled:b||u.length!==6,className:"bg-green-600 hover:bg-green-500 text-white flex-1 transition-all",children:b?"Connecting...":"Confirm & Connect"})]}):e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsx(F,{type:"button",variant:"ghost",onClick:x,className:"text-gray-400 hover:text-white hover:bg-white/5 flex-1",children:"Cancel"}),e.jsx(F,{type:"submit",disabled:y||!a(),className:"bg-indigo-600 hover:bg-indigo-500 text-white flex-1 transition-all",children:y?"Sending...":"Send Verification Code"})]})})]})]})]})})},le=()=>{const[f,x]=r.useState(!1),[d,l]=r.useState(null),[v,b]=r.useState(!0),[j,y]=r.useState(!1),k=async()=>{try{b(!0);const u=await w.get("/api/whatsapp/auth/status");u.data.success&&u.data.data.isConnected?(x(!0),l(u.data.data.profile)):(x(!1),l(null))}catch(u){console.error("Error checking WhatsApp connection:",u)}finally{b(!1)}};r.useEffect(()=>{k()},[]);const i=()=>{p.success("WhatsApp status refreshed"),k()},n=async()=>{try{(await w.delete("/api/whatsapp/auth/disconnect")).data.success&&(x(!1),l(null),p.success("WhatsApp disconnected successfully"))}catch(u){console.error("Error disconnecting WhatsApp:",u),p.error("Failed to disconnect WhatsApp")}};return e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-full max-w-sm bg-white/5 backdrop-blur-md border border-white/10 rounded-lg shadow-sm hover:shadow-md hover:border-indigo-500/30 transition-all duration-200",children:e.jsxs(G,{className:"flex flex-col items-center text-center p-2 space-y-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden flex items-center justify-center bg-white/10 border-2 border-white/20",children:e.jsx("img",{src:ne,alt:"WhatsApp",className:"w-full h-full object-cover"})}),e.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:f&&(d!=null&&d.email)?`Connected: ${d.email}`:"Connect your WhatsApp Account"}),e.jsx(F,{onClick:f?n:()=>y(!0),disabled:v,className:`w-full py-3 rounded-md font-medium transition-colors duration-200 ${f?"bg-gradient-to-r from-red-500 via-red-500 to-red-500 text-white border-0":"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white border-0"}`,children:v?"Checking...":f?"Disconnect":"Connect"})]})}),e.jsx(re,{isOpen:j,onClose:()=>y(!1),onConnect:i})]})},fe=()=>{const[f,x]=r.useState(!1),[d,l]=r.useState(!1),[v,b]=r.useState(null),[j,y]=r.useState("integrations"),[k,i]=r.useState(!1),n=async()=>{try{console.log("ðŸ” Checking Integration Gmail connection status...");const a=await w.get("/api/integration-gmail/auth/status");a.data.success&&a.data.data.isConnected?(console.log("âœ… Integration Gmail is connected:",a.data.data.profile),l(!0),b(a.data.data.profile)):(console.log("âŒ Integration Gmail is not connected"),l(!1),b(null))}catch(a){console.error("âŒ Error checking Integration Gmail connection:",a),l(!1),b(null)}},u=async()=>{var a,s;try{console.log("ðŸ” Checking Facebook connection status...");const t=await w.get("/api/facebook/connection-status");console.log("ðŸ“Š Facebook connection status response:",t.data),console.log("ðŸ“Š Facebook connection data details:",JSON.stringify(t.data.data,null,2)),t.data.success&&t.data.data.connected?(console.log("âœ… Facebook is connected, updating state to true"),x(!0)):(console.log("âŒ Facebook is not connected, updating state to false"),console.log("ðŸ“Š credentials_count:",(a=t.data.data)==null?void 0:a.credentials_count),console.log("ðŸ“Š connected_pages_count:",(s=t.data.data)==null?void 0:s.connected_pages_count),x(!1))}catch(t){console.error("âŒ Error checking Facebook connection:",t)}};T.useEffect(()=>{u(),n(),localStorage.removeItem("facebook_oauth_result"),localStorage.removeItem("gmail_oauth_result")},[]);const N=T.useCallback(a=>{a.type==="facebook_oauth_success"&&(console.log("ðŸŽ‰ Facebook auth success received!",a),x(!0),console.log("âœ… setFacebookConnected(true) called - button should change now!"),p.success("Facebook connected successfully!"),y("facebook-pages"),console.log("âœ… Switched to facebook-pages tab"))},[]),g=T.useCallback(a=>{var s;a.type==="GMAIL_AUTH_SUCCESS"?(console.log("ðŸŽ‰ Gmail auth success received!",a),l(!0),a.data&&b({email:a.data.email}),console.log("âœ… setGmailConnected(true) called - button should change now!"),p.success(`Gmail connected successfully! (${((s=a.data)==null?void 0:s.email)||"Connected"})`),i(!1)):a.type==="GMAIL_AUTH_ERROR"&&(console.log("âŒ Gmail auth error received:",a),p.error(a.message||"Failed to connect Gmail"),i(!1))},[]);T.useEffect(()=>{const a=o=>{console.log("ðŸ”” Message received:",o.data,"from origin:",o.origin),!(!o.data||typeof o.data!="object")&&(o.data.type==="facebook_oauth_success"?N(o.data):(o.data.type==="GMAIL_AUTH_SUCCESS"||o.data.type==="GMAIL_AUTH_ERROR")&&g(o.data))};let s=null;try{s=new BroadcastChannel("facebook_oauth_channel"),s.onmessage=o=>{console.log("ðŸ” Received Facebook BroadcastChannel message:",o.data),o.data&&typeof o.data=="object"&&N(o.data)}}catch{console.log("âš ï¸ Facebook BroadcastChannel not supported")}const c=setInterval(()=>{try{const o=localStorage.getItem("facebook_oauth_result");if(o){const L=JSON.parse(o);L.timestamp&&Date.now()-L.timestamp<3e4&&(console.log("ðŸ” Found Facebook localStorage result:",L),localStorage.removeItem("facebook_oauth_result"),N(L))}}catch{}},500);return window.addEventListener("message",a),console.log("âœ… Message listeners added for OAuth"),()=>{window.removeEventListener("message",a),s&&s.close(),clearInterval(c),console.log("ðŸ§¹ Message listeners removed")}},[N,g]);const h=async()=>{try{(await w.delete("/api/facebook/disconnect")).data.success&&(x(!1),y("integrations"),p.success("Facebook disconnected successfully"),console.log("Facebook disconnected successfully"))}catch(a){console.error("Error disconnecting Facebook:",a),p.error("Failed to disconnect Facebook")}},m=async()=>{var a,s;try{console.log("ðŸ” Debug - Initiating Facebook OAuth...");const t=await w.get("/api/auth/facebook/oauth-url");if(console.log("ðŸ” Debug - Response data:",t.data),t.data.success&&t.data.data.authUrl)console.log("ðŸ” Debug - Opening OAuth URL:",t.data.data.authUrl),window.open(t.data.data.authUrl,"facebook-auth","width=600,height=600");else throw new Error(`Invalid OAuth URL response: ${t.data.message||"No auth URL received"}`)}catch(t){if(console.error("âŒ Error initiating Facebook OAuth:",t),((a=t.response)==null?void 0:a.status)===401||((s=t.response)==null?void 0:s.status)===403){alert("Your session has expired. Please log in again."),window.location.href="/#/login";return}alert(`Failed to start Facebook authentication: ${t.message}`)}},C=()=>{console.log("ðŸ”„ Opening Gmail OAuth modal..."),i(!0)},A=async()=>{try{console.log("ðŸ”„ Disconnecting Integration Gmail...");const a=await w.delete("/api/integration-gmail/auth/disconnect");a.data.success?(l(!1),b(null),p.success("Gmail disconnected successfully"),console.log("âœ… Integration Gmail disconnected successfully")):p.error(a.data.message||"Failed to disconnect Gmail")}catch(a){console.error("âŒ Error disconnecting Integration Gmail:",a),p.error("Failed to disconnect Gmail")}},_=a=>{console.log("ðŸŽ‰ Gmail OAuth success callback:",a),l(!0),a!=null&&a.email&&b({email:a.email}),i(!1),setTimeout(()=>{n()},1e3)},E=[{description:"Connect your location's Facebook Account",image:"https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg",isConnected:f,onConnect:m,onManage:h},{description:d&&(v!=null&&v.email)?`Connected: ${v.email}`:"Connect your location's Gmail Account",image:te,isConnected:d,onConnect:C,onManage:A}];return e.jsxs(J,{className:"app-shell-bg relative overflow-hidden",children:[e.jsx("div",{"aria-hidden":!0,className:"absolute inset-0 pointer-events-none bg-gradient-to-r from-indigo-500/10 via-purple-500/10 to-pink-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h4",{className:"text-2xl font-bold text-white mb-4",children:"Integrations"}),e.jsx("div",{className:"space-y-6",children:e.jsxs(R,{value:j,onValueChange:y,className:"w-full bg-transparent text-white",children:[e.jsxs(U,{className:"flex w-auto bg-transparent p-8",children:[e.jsx(M,{value:"integrations",className:"flag-tab ",children:"Integrations"}),e.jsx(M,{value:"facebook-pages",className:"flag-tab",children:"Facebook Connected Pages"})]}),e.jsx(P,{value:"integrations",className:"space-y-10",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 ",children:[E.map((a,s)=>e.jsx(ce,{...a},s)),e.jsx(oe,{}),e.jsx(le,{})]})}),e.jsx(P,{value:"facebook-pages",className:"space-y-6",children:e.jsx(se,{isConnected:f,onDisconnect:h})})]})}),e.jsx(ae,{isOpen:k,onClose:()=>i(!1),onSuccess:_,redirectPath:"/integrations",useIntegrationApi:!0})]})]})},ce=({description:f,image:x,isConnected:d,onConnect:l,onManage:v})=>e.jsx(D,{className:"w-full max-w-sm bg-white/5 backdrop-blur-md border border-white/10 rounded-lg shadow-sm hover:shadow-md hover:border-indigo-500/30 transition-all duration-200",children:e.jsxs(G,{className:"flex flex-col items-center text-center p-2 space-y-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden flex items-center justify-center bg-white/10 border-2 border-white/20",children:e.jsx("img",{src:x,alt:"Integration logo",className:"w-full h-full object-cover"})}),e.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:f}),e.jsx(F,{onClick:d?v:l,className:`w-full py-3 rounded-md font-medium transition-colors duration-200 ${d?`bg-gradient-to-r 
        from-red-500
        via-red-500 
        to-red-500 text-white border-0`:"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white border-0"}`,children:d?"Disconnect":"Connect"})]})});export{fe as default};
//# sourceMappingURL=Integrations-ryeqRiyZ.js.map
