import{j as e,av as G,a5 as je,aT as q,S as H,aW as Se,cg as Pe,b4 as ge,aA as Ie,ch as _e,aP as Ue,D as Fe,N as Te,ci as ke,H as De,T as qe}from"./ui-BZ34e_bG.js";import{r as C,b as pe}from"./vendor-DG599jyl.js";import{u as de,b as M,c as z}from"./query-BwaCLewj.js";import{C as F,b as O,c as V,d as le,a as K}from"./card-BYrCuzD5.js";import{B as p}from"./button-Cm3qqFtR.js";import{B as j}from"./badge-CiNZHaLO.js";import{I as A}from"./input-DmGou_SQ.js";import{L as f}from"./label-C6Ng9AKs.js";import{S as W,a as J,b as X,c as Z,d as R}from"./select-DZgTcSvR.js";import{D as ee,b as se,c as ne,d as ae,e as re,a as Ke}from"./dialog-Dr0dXxlM.js";import{T as Y,a as Q,b as y,c as t,d as $,e as l}from"./table-C6M1Val8.js";import{u as Me,a as Le,t as d,d as ie}from"./index-DWPNxztX.js";import{P as Ee}from"./Page-RlnDfmDi.js";import{A as Re,a as Be}from"./alert-D9nrEz5p.js";import{c as Oe,a as Ve,b as ze,u as Ye,g as Qe,s as $e,d as Ge,e as He,f as We}from"./phoneNumberService-DUWl0Q64.js";import{f as Je,a as Xe}from"./agentService-DYqi_QtR.js";import{C as Ze}from"./CreditGuard-D_DdTGk6.js";import{g as es}from"./userService-BGNxKfv9.js";import{u as ve}from"./usePermissions-Bihy-2qQ.js";import"./index-3J7IwK8P.js";import"./index-HDeFwIcs.js";import"./router-BavLd_S0.js";import"./scroll-area-sAMvAiol.js";import"./index-DwBQLlhe.js";const ss=({onSuccess:h,onCancel:b})=>{const{user:v}=Me(),{isSuperAdmin:L}=Le(),[a,P]=C.useState({provider:"vapi",phoneNumber:"",name:"",assistantId:"",squadId:"",workflowId:"",fallbackDestination:"",serverUrl:"",serverUrlSecret:"",twilioAccountSid:"",twilioAuthToken:"",vonageApiKey:"",vonageApiSecret:"",telnyxApiKey:"",telnyxApiSecret:"",areaCode:""}),[T,m]=C.useState(!1),B=de(),{data:I,isLoading:N}=M({queryKey:["assistants","complete",v==null?void 0:v.id],queryFn:()=>Je(""),retry:(s,r)=>{var D;return[404,204,402].includes((D=r==null?void 0:r.response)==null?void 0:D.status)?!1:s<1},enabled:!!(v!=null&&v.id)}),_=(I==null?void 0:I.data)||[],g=z({mutationFn:Oe,onSuccess:()=>{d.success("Phone number created successfully!"),B.invalidateQueries({queryKey:["phoneNumbers"]}),h==null||h()},onError:s=>{var r,x;d.error(((x=(r=s.response)==null?void 0:r.data)==null?void 0:x.message)||"Failed to create phone number")}}),o=(s,r)=>{P(x=>({...x,[s]:r}))},U=s=>{const r=s.replace(/\D/g,"");return r.length===10?`+1${r}`:r.length===11&&r.startsWith("1")?`+${r}`:s},E=s=>{const r=U(s);o("phoneNumber",r)},u=()=>{if(!a.provider)return d.error("Please select a provider"),!1;if(!a.phoneNumber)return d.error("Please enter a phone number"),!1;if(a.provider!=="vapi"){if(!/^\+[1-9]\d{1,14}$/.test(a.phoneNumber))return d.error("Phone number must be in E.164 format (e.g., +1234567890)"),!1}else if(!a.areaCode||a.areaCode.length!==3)return d.error("Please enter a valid 3-digit area code"),!1;if(!a.assistantId||a.assistantId==="unassigned")return d.error("Please select an assistant"),!1;if(a.serverUrl)try{new URL(a.serverUrl)}catch{return d.error("Server URL must be a valid URL"),!1}if(a.fallbackDestination)try{JSON.parse(a.fallbackDestination)}catch{return d.error("Fallback destination must be valid JSON"),!1}switch(a.provider){case"vapi":break;case"twilio":if(!a.twilioAccountSid||!a.twilioAuthToken)return d.error("Twilio Account SID and Auth Token are required"),!1;if(!a.twilioAccountSid.startsWith("AC"))return d.error("Twilio Account SID should start with 'AC'"),!1;if(a.twilioAccountSid.length!==34)return d.error("Twilio Account SID should be 34 characters long"),!1;break;case"vonage":if(!a.vonageApiKey||!a.vonageApiSecret)return d.error("Vonage API Key and Secret are required"),!1;break;case"telnyx":if(!a.telnyxApiKey)return d.error("Telnyx API Key is required"),!1;break}return!0},k=s=>{if(s.preventDefault(),!u())return;const r={...a};g.mutate(r)},w=()=>{switch(a.provider){case"vapi":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",style:{color:"#12a594"},children:[e.jsx(H,{className:"h-4 w-4"}),"AI CRUITMENT Free Phone Number"]}),e.jsx("div",{className:"rounded-lg p-4 border",style:{backgroundColor:"#fafefd",borderColor:"#12a594"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5",style:{color:"#12a594"},viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:"#008071"},children:"No credentials required!"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"#008071"},children:"AI CRUITMENT provides free US phone numbers instantly. Just enter your desired area code and we'll assign you a random number in that area."}),e.jsxs("ul",{className:"text-xs mt-2 space-y-1",style:{color:"#12a594"},children:[e.jsx("li",{children:"• Up to 10 free numbers per account"}),e.jsx("li",{children:"• Instant activation (2-3 minutes)"}),e.jsx("li",{children:"• US numbers only"}),e.jsx("li",{children:"• No monthly fees"})]})]})]})})]});case"twilio":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-blue-600",children:[e.jsx(H,{className:"h-4 w-4"}),"Twilio Credentials"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"twilioAccountSid",children:"Account SID *"}),e.jsx(A,{id:"twilioAccountSid",type:"text",placeholder:"ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",value:a.twilioAccountSid,onChange:s=>o("twilioAccountSid",s.target.value),className:"font-mono text-sm"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"twilioAuthToken",children:"Auth Token *"}),e.jsx(A,{id:"twilioAuthToken",type:"password",placeholder:"Your Twilio Auth Token",value:a.twilioAuthToken,onChange:s=>o("twilioAuthToken",s.target.value),className:"font-mono text-sm"})]})]})]});case"vonage":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-orange-600",children:[e.jsx(H,{className:"h-4 w-4"}),"Vonage Credentials"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"vonageApiKey",children:"API Key *"}),e.jsx(A,{id:"vonageApiKey",type:"text",placeholder:"Your Vonage API Key",value:a.vonageApiKey,onChange:s=>o("vonageApiKey",s.target.value),className:"font-mono text-sm"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"vonageApiSecret",children:"API Secret *"}),e.jsx(A,{id:"vonageApiSecret",type:"password",placeholder:"Your Vonage API Secret",value:a.vonageApiSecret,onChange:s=>o("vonageApiSecret",s.target.value),className:"font-mono text-sm"})]})]})]});case"telnyx":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-purple-600",children:[e.jsx(H,{className:"h-4 w-4"}),"Telnyx Credentials"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"telnyxApiKey",children:"API Key *"}),e.jsx(A,{id:"telnyxApiKey",type:"password",placeholder:"Your Telnyx API Key",value:a.telnyxApiKey,onChange:s=>o("telnyxApiKey",s.target.value),className:"font-mono text-sm"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"telnyxApiSecret",children:"API Secret (Optional)"}),e.jsx(A,{id:"telnyxApiSecret",type:"password",placeholder:"Your Telnyx API Secret (if required)",value:a.telnyxApiSecret,onChange:s=>o("telnyxApiSecret",s.target.value),className:"font-mono text-sm"})]})]})]});default:return null}};return e.jsx(Ze,{requiredCredits:1,feature:"phone number creation",showUpgradeButton:!0,children:e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs(F,{children:[e.jsxs(O,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-blue-600"}),"Create Phone Number"]}),e.jsx(le,{children:"Get a free AI CRUITMENT phone number."})]}),e.jsxs(K,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"provider",children:"Provider *"}),e.jsxs(W,{value:a.provider,onValueChange:s=>o("provider",s),children:[e.jsx(J,{children:e.jsx(X,{placeholder:"Select a provider"})}),e.jsx(Z,{children:e.jsx(R,{value:"vapi",className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:"#12a594"}}),"AI CRUITMENT (Free US Number)"]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.provider==="vapi"?e.jsxs("div",{children:[e.jsxs(f,{htmlFor:"areaCode",className:"flex items-center gap-2",children:["Area Code *",e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full text-white font-medium",style:{backgroundColor:"#12a594"},children:"Free"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{id:"areaCode",type:"text",placeholder:"000",value:a.areaCode,onChange:s=>{const r=s.target.value.replace(/\D/g,"").slice(0,3);o("areaCode",r),o("phoneNumber",r)},className:"font-mono text-lg text-center border-2 focus:border-[#12a594] focus:ring-[#12a594]",style:{borderColor:a.areaCode?"#12a594":void 0},maxLength:3}),a.areaCode&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("svg",{className:"h-4 w-4",style:{color:"#12a594"},fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("p",{className:"text-xs mt-1",style:{color:"#12a594"},children:"Enter a 3-digit US area code (e.g., 415, 212, 310)"})]}):e.jsxs("div",{children:[e.jsx(f,{htmlFor:"phoneNumber",children:"Phone Number *"}),e.jsx(A,{id:"phoneNumber",type:"tel",placeholder:"+1 (555) 123-4567",value:a.phoneNumber,onChange:s=>E(s.target.value),className:"font-mono"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the phone number in E.164 format"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"name",children:"Friendly Name"}),e.jsx(A,{id:"name",type:"text",placeholder:a.provider==="vapi"?"My AI CRUITMENT Number":"My Business Number",value:a.name,onChange:s=>o("name",s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{htmlFor:"assistantId",className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Assistant *"]}),e.jsxs(W,{value:a.assistantId,onValueChange:s=>o("assistantId",s),children:[e.jsx(J,{children:e.jsx(X,{placeholder:"Select an assistant"})}),e.jsx(Z,{children:N?e.jsxs("div",{className:"flex items-center justify-center p-2",children:[e.jsx(q,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading assistants..."})]}):_.length===0?e.jsx("div",{className:"flex items-center justify-center p-2 text-gray-500",children:"No assistants available"}):e.jsx(e.Fragment,{children:_.map(s=>e.jsx(R,{value:s.assistant_id||s.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-3 w-3"}),s.name]})},s.id))})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:L?"Super admin can see all assistants":"You can only see your own assistants"})]}),a.provider&&e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50",children:w()}),a.provider&&a.provider!=="vapi"&&e.jsxs(Re,{children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsxs(Be,{children:["Your credentials are securely stored and encrypted. They are only used to authenticate with ",a.provider," for phone number management."]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(p,{type:"button",variant:"outline",onClick:b,disabled:g.isPending,children:"Cancel"}),e.jsx(p,{type:"submit",disabled:g.isPending,className:"min-w-[120px]",style:a.provider==="vapi"?{backgroundColor:"#12a594",borderColor:"#12a594",color:"white"}:void 0,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),a.provider==="vapi"?"Getting Free Number...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),a.provider==="vapi"?"Get Free Number":"Create Phone Number"]})})]})]})})},ns=()=>{const[h,b]=C.useState(null),[v,L]=C.useState(""),[a,P]=C.useState(!1),T=de(),{data:m,isLoading:B,error:I}=M({queryKey:["admin-vapi-phone-numbers"],queryFn:()=>Ve(),retry:1}),{data:N,isLoading:_}=M({queryKey:["all-users"],queryFn:()=>es(),retry:1}),g=z({mutationFn:({phoneNumberId:s,userId:r,vapiId:x})=>x?ie.post(`/api/phone-numbers/${x}/assign`,{user_id:r,vapi_id:x}):ze(s,r),onSuccess:()=>{T.invalidateQueries({queryKey:["admin-vapi-phone-numbers"]}),T.invalidateQueries({queryKey:["admin-phone-numbers"]}),d.success("Phone number assigned successfully!"),P(!1),b(null),L("")},onError:s=>{var r,x;d.error("Failed to assign phone number: "+(((x=(r=s.response)==null?void 0:r.data)==null?void 0:x.message)||s.message))}}),o=z({mutationFn:s=>Ye(s),onSuccess:()=>{T.invalidateQueries({queryKey:["admin-vapi-phone-numbers"]}),T.invalidateQueries({queryKey:["admin-phone-numbers"]}),d.success("Phone number unassigned successfully!")},onError:s=>{var r,x;d.error("Failed to unassign phone number: "+(((x=(r=s.response)==null?void 0:r.data)==null?void 0:x.message)||s.message))}}),U=s=>{b(s),P(!0)},E=()=>{if(!h||!v){d.error("Please select a user to assign the phone number to.");return}g.mutate({phoneNumberId:h.local_id||h.id,userId:v,vapiId:h.vapi_id||h.id})},u=s=>{if(!s.local_id){d.error("Cannot unassign phone number that is not in local database.");return}window.confirm(`Are you sure you want to unassign phone number ${s.number}?`)&&o.mutate(s.local_id)},k=(m==null?void 0:m.data)||[],w=(N==null?void 0:N.data)||[];return B?e.jsx(F,{children:e.jsx(K,{className:"flex items-center justify-center h-32",children:e.jsx(q,{className:"h-8 w-8 animate-spin"})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{children:[e.jsxs(O,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-blue-600"}),e.jsx(V,{children:"Super Admin - Phone Number Management"})]}),e.jsx(le,{children:"Manage phone number assignments for all users. Shows all VAPI phone numbers including Twilio numbers. Assign any available phone number to specific users to control access."}),(m==null?void 0:m.debug_info)&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-900",children:"Total VAPI Numbers:"}),e.jsx("div",{className:"text-blue-700",children:m.debug_info.total_vapi_numbers})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-green-900",children:"Assigned:"}),e.jsx("div",{className:"text-green-700",children:m.debug_info.assigned_numbers})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-orange-900",children:"Available:"}),e.jsx("div",{className:"text-orange-700",children:m.debug_info.unassigned_numbers})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-purple-900",children:"In Local DB:"}),e.jsx("div",{className:"text-purple-700",children:m.debug_info.in_local_db})]})]})})]}),e.jsx(K,{children:k.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(G,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No phone numbers found"}),e.jsx("p",{className:"text-muted-foreground",children:"No phone numbers are available for assignment."})]}):e.jsxs(Y,{children:[e.jsx(Q,{children:e.jsxs(y,{children:[e.jsx(t,{children:"Phone Number"}),e.jsx(t,{children:"Provider"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Assigned User"}),e.jsx(t,{children:"Actions"})]})}),e.jsx($,{children:k.map(s=>{var r;return e.jsxs(y,{children:[e.jsx(l,{className:"font-mono",children:s.number||"Unknown"}),e.jsx(l,{children:e.jsx(j,{variant:"outline",className:s.provider==="vapi"?"bg-blue-50 text-blue-700":"bg-gray-50 text-gray-700",children:((r=s.provider)==null?void 0:r.toUpperCase())||"VAPI"})}),e.jsx(l,{children:e.jsxs("div",{className:"flex gap-2",children:[s.is_assigned?e.jsx(j,{variant:"default",className:"bg-green-100 text-green-800",children:"Assigned"}):e.jsx(j,{variant:"outline",className:"text-orange-600",children:"Available"}),s.is_in_local_db?e.jsx(j,{variant:"secondary",className:"text-xs",children:"In DB"}):e.jsx(j,{variant:"outline",className:"text-xs text-blue-600",children:"VAPI Only"})]})}),e.jsx(l,{children:s.user_name?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.user_name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.user_email})]}):e.jsx(j,{variant:"outline",className:"text-orange-600",children:"Unassigned"})}),e.jsx(l,{children:e.jsx("div",{className:"flex gap-2",children:s.is_assigned?e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>u(s),disabled:o.isPending||!s.is_in_local_db,title:s.is_in_local_db?"":"Cannot unassign phone number not in local database",children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),"Unassign"]}):e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>U(s),disabled:g.isPending,children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),"Assign"]})})})]},s.id)})})]})})]}),e.jsx(ee,{open:a,onOpenChange:P,children:e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Assign Phone Number"}),e.jsxs(re,{children:["Assign phone number ",h==null?void 0:h.number," to a user. Only the assigned user will be able to see and use this phone number."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Select User"}),e.jsxs(W,{value:v,onValueChange:L,children:[e.jsx(J,{children:e.jsx(X,{placeholder:"Choose a user to assign the phone number to"})}),e.jsx(Z,{children:w.map(s=>e.jsx(R,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.first_name||""," ",s.last_name||""]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.email})]})]})},s.id))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(p,{variant:"outline",onClick:()=>P(!1),children:"Cancel"}),e.jsx(p,{onClick:E,disabled:!v||g.isPending,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Assigning..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Assign Phone Number"]})})]})]})]})})]})},as=()=>{var _,g,o,U,E,u,k,w,s,r,x,D;const{isSuperAdmin:h}=ve(),{data:b,isLoading:v,refetch:L}=M({queryKey:["debug-assignments"],queryFn:async()=>(await ie.get("/api/phone-numbers/debug/assignments")).data,retry:1}),{data:a,isLoading:P,refetch:T}=M({queryKey:["debug-user-numbers"],queryFn:async()=>(await ie.get("/api/phone-numbers/debug/user-numbers")).data,retry:1}),{data:m,isLoading:B,refetch:I}=M({queryKey:["regular-phone-numbers"],queryFn:async()=>(await ie.get("/api/phone-numbers")).data,retry:1}),N=()=>{L(),T(),I()};return v||P||B?e.jsx(F,{children:e.jsx(K,{className:"flex items-center justify-center h-32",children:e.jsx(q,{className:"h-8 w-8 animate-spin"})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{children:e.jsxs(O,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5 text-orange-600"}),e.jsx(V,{children:"Phone Number Assignment Debug"})]}),e.jsx(p,{onClick:N,variant:"outline",size:"sm",children:"Refresh All"})]}),e.jsx(le,{children:"Debug information for phone number assignments. This helps identify why assigned phone numbers might not be showing up for users."})]})}),e.jsxs(F,{children:[e.jsx(O,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4"}),"Current User Debug Info"]})}),e.jsx(K,{children:a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"User ID:"})," ",(_=a.debug_info)==null?void 0:_.user_id]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Is Super Admin:"})," ",(g=a.debug_info)!=null&&g.is_super_admin?"Yes":"No"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone Count:"})," ",(o=a.debug_info)==null?void 0:o.phone_count]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Is Super Admin (Hook):"})," ",h?"Yes":"No"]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone Number IDs:"}),e.jsx("div",{className:"mt-2",children:((E=(U=a.debug_info)==null?void 0:U.phone_number_ids)==null?void 0:E.length)>0?a.debug_info.phone_number_ids.map(i=>e.jsx(j,{variant:"outline",className:"mr-2 mb-2",children:i},i)):e.jsx(j,{variant:"destructive",children:"No phone number IDs found"})})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"User's Phone Numbers:"}),((u=a.data)==null?void 0:u.length)>0?e.jsxs(Y,{className:"mt-2",children:[e.jsx(Q,{children:e.jsxs(y,{children:[e.jsx(t,{children:"DB ID"}),e.jsx(t,{children:"Phone Number ID"}),e.jsx(t,{children:"Number"}),e.jsx(t,{children:"User ID"})]})}),e.jsx($,{children:a.data.map(i=>e.jsxs(y,{children:[e.jsx(l,{children:i.id}),e.jsx(l,{children:i.phone_number_id||"N/A"}),e.jsx(l,{children:i.number||"N/A"}),e.jsx(l,{children:i.user_id})]},i.id))})]}):e.jsx(j,{variant:"destructive",className:"mt-2",children:"No phone numbers found for user"})]})]})})]}),h&&e.jsxs(F,{children:[e.jsx(O,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"All Phone Number Assignments"]})}),e.jsx(K,{children:b&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Total:"})," ",(k=b.debug_info)==null?void 0:k.total_count]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Assigned:"})," ",(w=b.debug_info)==null?void 0:w.assigned_count]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Unassigned:"})," ",(s=b.debug_info)==null?void 0:s.unassigned_count]})]}),((r=b.data)==null?void 0:r.length)>0?e.jsxs(Y,{children:[e.jsx(Q,{children:e.jsxs(y,{children:[e.jsx(t,{children:"DB ID"}),e.jsx(t,{children:"Phone Number ID"}),e.jsx(t,{children:"Number"}),e.jsx(t,{children:"Assigned User"}),e.jsx(t,{children:"User ID"})]})}),e.jsx($,{children:b.data.map(i=>e.jsxs(y,{children:[e.jsx(l,{children:i.id}),e.jsx(l,{children:i.phone_number_id||"N/A"}),e.jsx(l,{children:i.number||"N/A"}),e.jsx(l,{children:i.user_name?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:i.user_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:i.user_email})]}):e.jsx(j,{variant:"outline",children:"Unassigned"})}),e.jsx(l,{children:i.user_id||"NULL"})]},i.id))})]}):e.jsx(j,{variant:"destructive",children:"No phone numbers found in database"})]})})]}),e.jsxs(F,{children:[e.jsx(O,{children:e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Regular Phone Numbers API Response"]})}),e.jsx(K,{children:m&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Success:"})," ",m.success?"Yes":"No"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Count:"})," ",((x=m.data)==null?void 0:x.length)||0]}),((D=m.data)==null?void 0:D.length)>0?e.jsxs(Y,{children:[e.jsx(Q,{children:e.jsxs(y,{children:[e.jsx(t,{children:"ID"}),e.jsx(t,{children:"Number"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Created By"})]})}),e.jsx($,{children:m.data.map(i=>e.jsxs(y,{children:[e.jsx(l,{children:i.id}),e.jsx(l,{children:i.number||"N/A"}),e.jsx(l,{children:i.status||"N/A"}),e.jsx(l,{children:i.created_by||i.user_name||"N/A"})]},i.id))})]}):e.jsx(j,{variant:"destructive",children:"No phone numbers returned by regular API"})]})})]})]})},Is=()=>{var oe,he,me,ue;const[h,b]=C.useState({country:"US",limit:10}),[v,L]=C.useState(null),[a,P]=C.useState(!1),[T,m]=C.useState(!1),[B,I]=C.useState(!1),[N,_]=C.useState("user"),[g,o]=C.useState({friendlyName:"",assistantId:""}),U=de(),{isSuperAdmin:E}=ve(),{data:u,isLoading:k,error:w}=M({queryKey:["phoneNumbers"],queryFn:()=>Qe(),retry:1});pe.useEffect(()=>{var n;u&&(console.log("Phone numbers data received:",u),((n=u==null?void 0:u.data)==null?void 0:n.length)>0&&console.log("First phone number structure:",u.data[0]))},[u]),pe.useEffect(()=>{w&&console.error("Phone numbers fetch error:",w)},[w]);const{data:s,isLoading:r,refetch:x}=M({queryKey:["phoneNumbers","available",h],queryFn:()=>$e(h),enabled:!1}),{data:D}=M({queryKey:["assistants"],queryFn:()=>Xe(1,""),retry:1}),i=z({mutationFn:Ge,onSuccess:()=>{U.invalidateQueries({queryKey:["phoneNumbers"]}),d.success("Phone number purchased successfully")},onError:n=>{var c,S;d.error(((S=(c=n.response)==null?void 0:c.data)==null?void 0:S.message)||"Failed to purchase phone number")}}),te=z({mutationFn:({id:n,data:c})=>He(n,c),onSuccess:()=>{U.invalidateQueries({queryKey:["phoneNumbers"]}),m(!1),d.success("Phone number updated successfully")},onError:n=>{var c,S;d.error(((S=(c=n.response)==null?void 0:c.data)==null?void 0:S.message)||"Failed to update phone number")}}),ce=z({mutationFn:We,onSuccess:()=>{U.invalidateQueries({queryKey:["phoneNumbers"]}),d.success("Phone number deleted successfully")},onError:n=>{var c,S;d.error(((S=(c=n.response)==null?void 0:c.data)==null?void 0:S.message)||"Failed to delete phone number")}}),fe=()=>{x()},be=n=>{i.mutate({number:n.number,friendlyName:n.friendlyName})},Ne=n=>{L(n),o({friendlyName:n.friendlyName||"",assistantId:n.assistantId||"unassigned"}),m(!0)},ye=()=>{v&&te.mutate({id:v.id,data:{...g,assistantId:g.assistantId==="unassigned"?"":g.assistantId}})},Ae=n=>{confirm("Are you sure you want to delete this phone number?")&&ce.mutate(n)},Ce=n=>{const c={active:"default",inactive:"secondary",pending:"outline"};return e.jsx(j,{variant:c[n]||"outline",children:n})},we=((oe=D==null?void 0:D.data)==null?void 0:oe.assistants)||[];return w?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Phone Numbers"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your phone numbers and purchase new ones"})]}),e.jsx(F,{children:e.jsx(K,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Unable to connect to the backend API. Please ensure the backend server is running."}),e.jsx(p,{onClick:()=>window.location.reload(),children:"Retry Connection"})]})})})]}):e.jsx(Ee,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Phone Numbers"}),e.jsx("p",{className:"text-muted-foreground",children:N==="admin"?"Manage phone number assignments for all users":"Get free AI CRUITMENT phone numbers."})]}),E&&e.jsxs("div",{className:"flex gap-2 mr-4",children:[e.jsx(p,{variant:N==="user"?"default":"outline",onClick:()=>_("user"),size:"sm",children:"User View"}),e.jsx(p,{variant:N==="admin"?"default":"outline",onClick:()=>_("admin"),size:"sm",children:"Admin Management"}),e.jsx(p,{variant:N==="debug"?"default":"outline",onClick:()=>_("debug"),size:"sm",children:"Debug"})]}),N==="user"&&e.jsxs(ee,{open:B,onOpenChange:I,children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(p,{children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Create Phone Number"]})}),e.jsxs(se,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Create New Phone Number"}),e.jsx(re,{children:"Get a free AI CRUITMENT phone number."})]}),e.jsx(ss,{onSuccess:()=>I(!1),onCancel:()=>I(!1)})]})]})]}),N==="admin"?e.jsx(ns,{}):N==="debug"?e.jsx(as,{}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{open:a,onOpenChange:P,children:e.jsxs(se,{className:"max-w-4xl",children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Search & Buy Phone Numbers"}),e.jsx(re,{children:"Search for available phone numbers to purchase"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"country",children:"Country"}),e.jsxs(W,{value:h.country,onValueChange:n=>b(c=>({...c,country:n})),children:[e.jsx(J,{children:e.jsx(X,{})}),e.jsxs(Z,{children:[e.jsx(R,{value:"US",children:"United States"}),e.jsx(R,{value:"CA",children:"Canada"}),e.jsx(R,{value:"GB",children:"United Kingdom"})]})]})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"areaCode",children:"Area Code"}),e.jsx(A,{id:"areaCode",value:h.areaCode||"",onChange:n=>b(c=>({...c,areaCode:n.target.value})),placeholder:"e.g., 415"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"contains",children:"Contains"}),e.jsx(A,{id:"contains",value:h.contains||"",onChange:n=>b(c=>({...c,contains:n.target.value})),placeholder:"e.g., 1234"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(p,{onClick:fe,disabled:r,className:"w-full",children:[r?e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Search"]})})]}),s&&e.jsx("div",{className:"border rounded-lg",children:e.jsxs(Y,{children:[e.jsx(Q,{children:e.jsxs(y,{children:[e.jsx(t,{children:"Number"}),e.jsx(t,{children:"Location"}),e.jsx(t,{children:"Capabilities"}),e.jsx(t,{children:"Price/Month"}),e.jsx(t,{children:"Action"})]})}),e.jsx($,{children:(he=s.data)==null?void 0:he.map(n=>{var c,S,xe;return e.jsxs(y,{children:[e.jsx(l,{className:"font-mono",children:n.number}),e.jsx(l,{children:n.locality&&n.region?`${n.locality}, ${n.region}`:n.locality||n.region||"Unknown Location"}),e.jsx(l,{children:e.jsxs("div",{className:"flex gap-1",children:[((c=n.capabilities)==null?void 0:c.voice)&&e.jsx(j,{variant:"outline",children:"Voice"}),((S=n.capabilities)==null?void 0:S.sms)&&e.jsx(j,{variant:"outline",children:"SMS"}),((xe=n.capabilities)==null?void 0:xe.mms)&&e.jsx(j,{variant:"outline",children:"MMS"}),!n.capabilities&&e.jsx(j,{variant:"outline",children:"Unknown"})]})}),e.jsx(l,{children:n.monthlyPrice!==void 0?`$${n.monthlyPrice}`:"Contact for pricing"}),e.jsx(l,{children:e.jsxs(p,{size:"sm",onClick:()=>be(n),disabled:i.isPending,children:[i.isPending?e.jsx(q,{className:"h-3 w-3 mr-1 animate-spin"}):e.jsx(ke,{className:"h-3 w-3 mr-1"}),"Buy"]})})]},n.number)})})]})})]})]})}),e.jsxs(F,{children:[e.jsxs(O,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Your Phone Numbers"]}),e.jsx(le,{children:"Manage your purchased phone numbers and their assignments"})]}),e.jsx(K,{children:k?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(q,{className:"h-8 w-8 animate-spin"})}):e.jsxs(Y,{children:[e.jsx(Q,{children:e.jsxs(y,{children:[e.jsx(t,{children:"Number"}),e.jsx(t,{children:"Created By"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Assigned Assistant"}),e.jsx(t,{children:"Actions"})]})}),e.jsx($,{children:((me=u==null?void 0:u.data)==null?void 0:me.length)===0?e.jsx(y,{children:e.jsx(l,{colSpan:6,className:"text-center text-muted-foreground",children:"No phone numbers found. Purchase your first number to get started."})}):(ue=u==null?void 0:u.data)==null?void 0:ue.map(n=>e.jsxs(y,{children:[e.jsx(l,{className:"font-mono",children:n.number||"Unknown"}),e.jsx(l,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:n.created_by||n.user_name||"Unknown User"}),n.user_email&&e.jsx("span",{className:"text-xs text-muted-foreground",children:n.user_email})]})}),e.jsx(l,{children:Ce(n.status||"inactive")}),e.jsx(l,{children:n.assistantId?e.jsx(j,{variant:"secondary",children:"Assigned"}):e.jsx(j,{variant:"outline",children:"Unassigned"})}),e.jsx(l,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{size:"sm",variant:"outline",onClick:()=>Ne(n),children:e.jsx(De,{className:"h-3 w-3"})}),e.jsx(p,{size:"sm",variant:"outline",onClick:()=>Ae(n.id),disabled:ce.isPending,children:e.jsx(qe,{className:"h-3 w-3"})})]})})]},n.id))})]})})]}),e.jsx(ee,{open:T,onOpenChange:m,children:e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Edit Phone Number"}),e.jsx(re,{children:"Update the phone number settings"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"friendlyName",children:"Friendly Name"}),e.jsx(A,{id:"friendlyName",value:g.friendlyName,onChange:n=>o(c=>({...c,friendlyName:n.target.value})),placeholder:"Enter a friendly name..."})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"assistantId",children:"Assign to Assistant"}),e.jsxs(W,{value:g.assistantId,onValueChange:n=>o(c=>({...c,assistantId:n})),children:[e.jsx(J,{children:e.jsx(X,{placeholder:"Select an assistant"})}),e.jsxs(Z,{children:[e.jsx(R,{value:"unassigned",children:"Unassigned"}),we.map(n=>e.jsx(R,{value:n.id,children:n.name},n.id))]})]})]}),e.jsxs(p,{onClick:ye,disabled:te.isPending,className:"w-full",children:[te.isPending&&e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Update Phone Number"]})]})]})})]})]})})};export{Is as default};
//# sourceMappingURL=PhoneNumbers-BMbaz7HS.js.map
