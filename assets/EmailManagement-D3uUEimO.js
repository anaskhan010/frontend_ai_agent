import{j as t}from"./ui-B8VyAbFl.js";import{r as s}from"./vendor-DG599jyl.js";import{a as o}from"./index-BJQAqHy1.js";import"./router-BnJytTjr.js";import"./query-CWB_8EHL.js";const ne=()=>{const[L,T]=s.useState([]),[R,Y]=s.useState([]),[N,M]=s.useState([]),[y,v]=s.useState([]),[V,P]=s.useState(null),[h,U]=s.useState(""),[$,b]=s.useState(!1),[f,X]=s.useState(null),[z,W]=s.useState([]),[A,F]=s.useState([]),[S,u]=s.useState([]),[C,x]=s.useState([]),[p,w]=s.useState(null),[n,d]=s.useState({rule_name:"",location_text:"",condition_text:"",frequency_code:""});s.useEffect(()=>{o.get("/api/email-management/email-types").then(e=>T(e.data.data)),o.get("/api/email-management/frequencies").then(e=>Y(e.data.data)),o.get("/api/email-management/users").then(e=>M(e.data.data)),o.get("/api/email-management/study-phases").then(e=>W(e.data.data)),o.get("/api/email-management/study-conditions").then(e=>F(e.data.data))},[]);const I=e=>{e.code==="STUDY"&&(P(e),b(!0))},g=e=>{o.get(`/api/email-management/rules/${e}`).then(l=>v(l.data.data))},H=async()=>{if(!h){alert("Please select a user first");return}p?await o.put(`/api/email-management/rules/${p.id}`,{location_text:n.location_text||null,phase:S,condition_text:C,frequency_code:n.frequency_code,timezone:"America/Chicago",schedule_day_of_week:n.schedule_day_of_week,schedule_day_of_month:n.schedule_day_of_month,schedule_time:n.schedule_time,is_enabled:1}):await o.post("/api/email-management/rules",{email_type_code:"STUDY",target_user_id:h,...n}),w(null),d({location_text:"",condition_text:"",frequency_code:""}),u([]),x([]),g(h)},K=async e=>{confirm("Are you sure you want to delete this rule?")&&(await o.delete(`/api/email-management/rules/${e}`),g(h))},c=e=>{try{return e?JSON.parse(e):[]}catch{return[]}},J=e=>e.frequency_code==="DAILY"?"Daily":e.frequency_code==="WEEKLY"?`Weekly (Day ${e.schedule_day_of_week})`:e.frequency_code==="MONTHLY"?`Monthly (Day ${e.schedule_day_of_month})`:e.frequency_code,B=e=>{if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}};s.useEffect(()=>{const e=()=>setOpen(!1);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);const k=({label:e,options:l=[],value:i=[],onChange:m,placeholder:r="Select..."})=>{const[G,E]=s.useState(!1),[q,Q]=s.useState(""),_=s.useRef(null),D=a=>{i.includes(a)?m(i.filter(j=>j!==a)):m([...i,a])},O=l.filter(a=>a.toLowerCase().includes(q.toLowerCase()));return s.useEffect(()=>{const a=j=>{_.current&&!_.current.contains(j.target)&&E(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),t.jsxs("div",{ref:_,className:"relative mb-6",children:[t.jsx("label",{className:"block text-sm font-semibold mb-1 text-white",children:e}),t.jsxs("div",{className:"border border-white/20 rounded-md p-3 flex justify-between items-center cursor-pointer bg-white/5",onClick:()=>E(!0),children:[t.jsx("span",{className:"text-sm text-white/60",children:i.length?`${i.length} selected`:r}),t.jsx("span",{className:"text-white/40",children:"▾"})]}),G&&t.jsxs("div",{className:"absolute z-50 w-full bg-[#0e1340] border border-white/10 rounded-lg shadow-lg mt-2",children:[t.jsx("div",{className:"p-2 border-b border-white/10",children:t.jsx("input",{type:"text",className:"w-full bg-white/5 border border-white/20 rounded p-2 text-sm text-white placeholder:text-white/40",placeholder:"Search...",value:q,onChange:a=>Q(a.target.value)})}),t.jsxs("div",{className:"max-h-60 overflow-y-auto p-2",children:[O.length===0&&t.jsx("p",{className:"text-xs text-white/40 p-2",children:"No results found"}),O.map(a=>t.jsxs("div",{className:"flex items-center gap-2 p-2 rounded hover:bg-white/5 cursor-pointer text-white",onClick:()=>D(a),children:[t.jsx("input",{type:"checkbox",checked:i.includes(a),readOnly:!0,className:"bg-white/5 border-white/30"}),t.jsx("span",{className:"text-sm",children:a})]},a))]})]}),i.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:i.map(a=>t.jsxs("span",{className:"bg-indigo-500/20 border border-indigo-500/30 text-indigo-300 rounded-full px-3 py-1 text-xs flex items-center gap-2",children:[a,t.jsx("button",{className:"text-indigo-300 hover:text-white",onClick:()=>D(a),children:"×"})]},a))})]})};return t.jsxs("div",{className:"min-h-screen app-shell-bg p-6",children:[t.jsxs("div",{className:"pointer-events-none fixed inset-0 z-0",children:[t.jsx("div",{className:"absolute left-1/4 top-0 h-[500px] w-[500px] rounded-full bg-indigo-600/20 blur-[120px]"}),t.jsx("div",{className:"absolute right-1/4 bottom-0 h-[400px] w-[400px] rounded-full bg-purple-600/20 blur-[100px]"})]}),t.jsxs("div",{className:"relative z-10 bg-[#0b0f2e]/90 backdrop-blur-sm rounded-lg border border-white/10 p-6",children:[t.jsx("h2",{className:"text-2xl font-bold mb-4 text-white",children:"Email Management"}),t.jsxs("table",{className:"w-full border border-white/10 mb-6 rounded-lg overflow-hidden",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-white/10 bg-white/5",children:[t.jsx("th",{className:"p-3 text-left text-white/70",children:"Email Type"}),t.jsx("th",{className:"p-3 text-left text-white/70",children:"Description"}),t.jsx("th",{className:"p-3 text-left text-white/70",children:"Status"})]})}),t.jsx("tbody",{children:L.map(e=>t.jsxs("tr",{className:"border-b border-white/5 cursor-pointer hover:bg-white/5 text-white",onClick:()=>I(e),children:[t.jsx("td",{className:"p-3",children:e.name}),t.jsx("td",{className:"p-3 text-white/70",children:e.description}),t.jsx("td",{className:"p-3",children:t.jsx("span",{className:e.is_active?"text-green-400":"text-red-400",children:e.is_active?"Enabled":"Disabled"})})]},e.id))})]})]}),$&&t.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60]",onClick:()=>b(!1),children:t.jsxs("div",{className:"absolute right-0 top-0 h-full w-[1200px] bg-[#0b0f2e] border-l border-white/10 p-6 overflow-auto shadow-2xl",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex justify-between mb-4",children:[t.jsx("h3",{className:"font-bold text-white",children:f==null?void 0:f.name}),t.jsx("button",{onClick:()=>b(!1),className:"text-white/70 hover:text-white px-3 py-1 border border-white/20 rounded hover:bg-white/10",children:"Close"})]}),t.jsxs("select",{className:"w-full bg-white/5 border border-white/20 text-white p-2 mb-4 rounded",onChange:e=>{const l=e.target.value;U(l),v([]),g(l)},children:[t.jsx("option",{className:"bg-[#0e1340] text-white",children:"Select user"}),N.map(e=>t.jsx("option",{value:e.id,className:"bg-[#0e1340] text-white",children:e.name},e.id))]}),t.jsx(k,{label:"ClinicalTrials.gov Study Phase",options:z,value:S,placeholder:"Select study phase(s)",onChange:e=>{u(e),d(l=>({...l,phase:e}))}}),t.jsx(k,{label:"ClinicalTrials.gov Condition",options:A,value:C,placeholder:"Select condition(s)",onChange:e=>{x(e),d(l=>({...l,condition_text:e}))}}),t.jsxs("select",{className:"w-full bg-white/5 border border-white/20 text-white p-2 mb-4 rounded",onChange:e=>d({...n,frequency_code:e.target.value}),children:[t.jsx("option",{className:"bg-[#0e1340] text-white",children:"Select frequency"}),R.map(e=>t.jsx("option",{value:e.code,className:"bg-[#0e1340] text-white",children:e.label},e.code))]}),["DAILY","WEEKLY","MONTHLY"].includes(n.frequency_code)&&t.jsx("input",{type:"time",className:"w-full bg-white/5 border border-white/20 text-white p-2 mb-4 rounded",onChange:e=>d({...n,schedule_time:e.target.value})}),n.frequency_code==="WEEKLY"&&t.jsxs("select",{className:"w-full bg-white/5 border border-white/20 text-white p-2 mb-4 rounded",onChange:e=>d({...n,schedule_day_of_week:e.target.value}),children:[t.jsx("option",{value:"",className:"bg-[#0e1340] text-white",children:"Select weekday"}),t.jsx("option",{value:"1",className:"bg-[#0e1340] text-white",children:"Monday"}),t.jsx("option",{value:"2",className:"bg-[#0e1340] text-white",children:"Tuesday"}),t.jsx("option",{value:"3",className:"bg-[#0e1340] text-white",children:"Wednesday"}),t.jsx("option",{value:"4",className:"bg-[#0e1340] text-white",children:"Thursday"}),t.jsx("option",{value:"5",className:"bg-[#0e1340] text-white",children:"Friday"})]}),n.frequency_code==="MONTHLY"&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"text-sm text-white/50 block mb-1",children:"Select day of month"}),t.jsx("input",{type:"date",className:"w-full bg-white/5 border border-white/20 text-white p-2 rounded",onChange:e=>{if(!e.target.value)return;const i=new Date(e.target.value).getDate();d({...n,schedule_day_of_month:i})}}),n.schedule_day_of_month&&t.jsxs("p",{className:"text-xs text-white/50 mt-1",children:["Email will be sent on the"," ",t.jsx("b",{className:"text-white",children:n.schedule_day_of_month}),B(n.schedule_day_of_month)," of every month"]})]}),t.jsx("button",{className:"w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-2 rounded mb-2",onClick:H,children:p?"Update Rule":"Save Rule"}),p&&t.jsx("button",{className:"w-full mt-2 border border-white/20 text-white p-2 rounded hover:bg-white/10",onClick:()=>{w(null),d({location_text:"",condition_text:"",frequency_code:""}),u([]),x([])},children:"Cancel Edit"}),t.jsx("div",{className:"mt-4",children:h&&y.length>0&&y.map(e=>{var m;const l=c(e.phase),i=c(e.condition_text);return t.jsxs("div",{className:"border border-white/10 rounded-lg p-4 mb-4 bg-white/5",children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-lg text-white",children:"User"}),t.jsx("p",{className:"text-sm text-white/50",children:(m=N.find(r=>r.id===e.target_user_id))==null?void 0:m.name})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-lg text-white",children:e.rule_name}),t.jsx("p",{className:"text-sm text-white/50",children:J(e)})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"px-3 py-1 text-sm border border-white/20 text-white rounded hover:bg-white/10",onClick:()=>{w(e),d({rule_name:e.rule_name,location_text:e.location_text||"",frequency_code:e.frequency_code,schedule_day_of_week:e.schedule_day_of_week,schedule_day_of_month:e.schedule_day_of_month,schedule_time:e.schedule_time,phase:c(e.phase),condition_text:c(e.condition_text)}),u(c(e.phase)),x(c(e.condition_text))},children:"Edit"}),t.jsx("button",{className:"px-3 py-1 text-sm border border-red-500/30 text-red-400 rounded hover:bg-red-500/10",onClick:()=>K(e.id),children:"Delete"})]})]}),l.length>0&&t.jsxs("div",{className:"mb-2",children:[t.jsx("p",{className:"text-sm font-medium mb-1 text-white",children:"Study Phases"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:l.map(r=>t.jsx("span",{className:"bg-indigo-500/20 text-indigo-300 border border-indigo-500/30 px-2 py-1 rounded text-xs",children:r},r))})]}),i.length>0&&t.jsxs("div",{className:"mb-2",children:[t.jsx("p",{className:"text-sm font-medium mb-1 text-white",children:"Conditions"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(r=>t.jsx("span",{className:"bg-green-500/20 text-green-300 border border-green-500/30 px-2 py-1 rounded text-xs",children:r},r))})]}),t.jsxs("div",{className:"mt-2 text-sm text-white/50",children:["Status:"," ",t.jsx("span",{className:e.is_enabled?"text-green-400 font-medium":"text-red-400",children:e.is_enabled?"Enabled":"Disabled"})]})]},e.id)})})]})})]})};export{ne as default};
//# sourceMappingURL=EmailManagement-D3uUEimO.js.map
