const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/outboundService-BVSoqwz9.js","assets/index-D2HGmCxA.js","assets/ui-CZ40mCLE.js","assets/vendor-DG599jyl.js","assets/router-BnJytTjr.js","assets/query-Dkjx6fBT.js","assets/index-Ujs9Q1-x.css"])))=>i.map(i=>d[i]);
import{u as Ve,t as h,C as x,b as m,B as o,q as te,z as ne,r as ie,s as le,v as re,x as de,L as r,o as oe,S as ce,f as ue,g as he,h as xe,i as me,T as A,I as je,P as Be,Q as $e,R as F,U as P,c as p,d as f,e as B,n as ge,a6 as Ee}from"./index-D2HGmCxA.js";import{j as e,bk as Ke,aS as y,K as ze,aC as Qe,S as _e,Q as $,aU as pe,bC as He,I as Ue,bF as Ge,as as M}from"./ui-CZ40mCLE.js";import{r as b}from"./vendor-DG599jyl.js";import{u as Je,b as v,c as E}from"./query-Dkjx6fBT.js";import{T as fe,a as be,b as w,c as d,d as Ne,e as i}from"./table-Div--8F2.js";import{g as We,A as Ce,a as Xe,s as Ye,d as Ze}from"./recordingService-DbriXWze.js";import{P as es}from"./Page-CvpkpvDq.js";import{getAllOutboundCalls as ss,getCallStats as as,createOutboundCall as ts,createBulkOutboundCalls as ns,endOutboundCall as is,getCallTranscript as ls}from"./outboundService-BVSoqwz9.js";import{f as rs,h as ds}from"./agentService-DUDqqn5e.js";import{g as os}from"./phoneNumberService-BBJqYvzX.js";import"./router-BnJytTjr.js";import"./slider-CYeoaN8n.js";const Ss=()=>{var G,J,W,X,Y,Z,ee,se,ae;const[ye,K]=b.useState(!1),[ve,z]=b.useState(!1),[cs,us]=b.useState(null),[n,c]=b.useState({assistantId:"",phoneNumber:"",firstMessage:"",voicemailMessage:"",maxDurationSeconds:300}),[I,Q]=b.useState(""),[j,_]=b.useState(!1),[hs,S]=b.useState(null),k=Je(),{user:a}=Ve(),{data:D,isLoading:we,error:Se}=v({queryKey:["outboundCalls",a==null?void 0:a.id],queryFn:()=>ss(),retry:1,enabled:!!(a!=null&&a.id)}),{data:R,isLoading:ke}=v({queryKey:["assistants","database",a==null?void 0:a.id],queryFn:()=>rs(""),retry:1,enabled:!j&&!!(a!=null&&a.id)}),{data:T,isLoading:Ae}=v({queryKey:["assistants","vapi",a==null?void 0:a.id],queryFn:()=>ds(),retry:1,enabled:j&&!!(a!=null&&a.id)}),{data:L}=v({queryKey:["phoneNumbers",a==null?void 0:a.id],queryFn:()=>os(),retry:1,enabled:!!(a!=null&&a.id)}),{data:l}=v({queryKey:["callStats",a==null?void 0:a.id],queryFn:()=>as(),retry:1,enabled:!!(a!=null&&a.id)}),{data:N,isLoading:Fe}=v({queryKey:["recordings","outbound",a==null?void 0:a.id],queryFn:()=>We(1,50),retry:1,enabled:!!(a!=null&&a.id)}),O=E({mutationFn:ts,onSuccess:()=>{k.invalidateQueries({queryKey:["outboundCalls",a==null?void 0:a.id]}),K(!1),c({assistantId:"",phoneNumber:"",firstMessage:"",voicemailMessage:"",maxDurationSeconds:300}),h.success("Outbound call initiated successfully")},onError:s=>{var t,u;h.error(((u=(t=s.response)==null?void 0:t.data)==null?void 0:u.message)||"Failed to create outbound call")}}),q=E({mutationFn:ns,onSuccess:()=>{k.invalidateQueries({queryKey:["outboundCalls"]}),z(!1),Q(""),h.success("Bulk outbound calls initiated successfully")},onError:s=>{var t,u;h.error(((u=(t=s.response)==null?void 0:t.data)==null?void 0:u.message)||"Failed to create bulk outbound calls")}}),H=E({mutationFn:is,onSuccess:()=>{k.invalidateQueries({queryKey:["outboundCalls"]}),h.success("Call ended successfully")},onError:s=>{var t,u;h.error(((u=(t=s.response)==null?void 0:t.data)==null?void 0:u.message)||"Failed to end call")}}),Pe=()=>{if(!n.assistantId||!n.phoneNumber){h.error("Please select an assistant and enter a phone number");return}O.mutate(n)},Me=()=>{if(!n.assistantId||!I.trim()){h.error("Please select an assistant and enter phone numbers");return}const s=I.split(`
`).map(t=>t.trim()).filter(t=>t.length>0);if(s.length===0){h.error("Please enter at least one phone number");return}q.mutate({assistantId:n.assistantId,phoneNumbers:s,firstMessage:n.firstMessage,voicemailMessage:n.voicemailMessage,maxDurationSeconds:n.maxDurationSeconds})},Ie=s=>{confirm("Are you sure you want to end this call?")&&H.mutate(s)},De=async s=>{try{await ls(s)}catch(t){console.error("Error downloading transcript:",t)}},Re=async s=>{try{const{downloadCallRecording:t}=await Ee(async()=>{const{downloadCallRecording:u}=await import("./outboundService-BVSoqwz9.js");return{downloadCallRecording:u}},__vite__mapDeps([0,1,2,3,4,5,6]));await t(s)}catch(t){console.error("Error downloading recording:",t)}},Te=s=>{Xe(s.id,`${s.recordingName}.${s.format}`)},Le=s=>{Ye(s.id,{expiresIn:"7d"})},Oe=s=>{confirm(`Are you sure you want to delete "${s.recordingName}"?`)&&Ze(s.id).then(()=>{k.invalidateQueries({queryKey:["recordings"]})})},qe=s=>{const t={queued:"outline",ringing:"secondary","in-progress":"default",forwarding:"secondary",ended:"destructive"};return e.jsx(ge,{variant:t[s]||"outline",children:s})},C=j?(T==null?void 0:T.data)||[]:(R==null?void 0:R.data)||[];L!=null&&L.data;const U=(D==null?void 0:D.data)||[],V=(N==null?void 0:N.recordings)||[],g=j?Ae:ke;return Se?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Outbound Calls"}),e.jsx("p",{className:"text-muted-foreground",children:"Make and manage outbound calls with your AI assistants"})]}),e.jsx(x,{children:e.jsx(m,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Unable to connect to the backend API. Please ensure the backend server is running."}),e.jsx(o,{onClick:()=>window.location.reload(),children:"Retry Connection"})]})})})]}):e.jsx(es,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Outbound Calls"}),e.jsx("p",{className:"text-muted-foreground",children:"Make and manage outbound calls with your AI assistants"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{open:ve,onOpenChange:z,children:[e.jsx(ne,{asChild:!0,children:e.jsxs(o,{variant:"outline",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Bulk Calls"]})}),e.jsxs(ie,{children:[e.jsxs(le,{children:[e.jsx(re,{children:"Create Bulk Outbound Calls"}),e.jsx(de,{children:"Create multiple outbound calls at once"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{htmlFor:"bulk-assistant-source",children:"Assistant Source"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{htmlFor:"bulk-assistant-source",className:"text-sm",children:"Database"}),e.jsx(oe,{id:"bulk-assistant-source",checked:j,onCheckedChange:s=>{_(s),c(t=>({...t,assistantId:""}))}}),e.jsx(r,{htmlFor:"bulk-assistant-source",className:"text-sm",children:"VAPI"})]})]}),e.jsxs("div",{children:[e.jsxs(r,{htmlFor:"bulk-assistant",children:["Assistant ",g&&e.jsx(y,{className:"h-3 w-3 animate-spin inline ml-1"})]}),e.jsxs(ce,{value:n.assistantId,onValueChange:s=>c(t=>({...t,assistantId:s})),disabled:g,children:[e.jsx(ue,{children:e.jsx(he,{placeholder:g?"Loading assistants...":C.length===0?"No assistants found":"Select an assistant"})}),e.jsx(xe,{children:C.map(s=>e.jsx(me,{value:s.id,children:s.name},s.id))})]}),C.length===0&&!g&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:j?"No assistants found in VAPI. Try switching to Database source.":"No assistants found in database. Try creating an assistant first."})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"bulk-numbers",children:"Phone Numbers (one per line)"}),e.jsx(A,{id:"bulk-numbers",value:I,onChange:s=>Q(s.target.value),placeholder:`+1234567890
+1987654321
+1555123456`,rows:5})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"bulk-first-message",children:"First Message (Optional)"}),e.jsx(A,{id:"bulk-first-message",value:n.firstMessage||"",onChange:s=>c(t=>({...t,firstMessage:s.target.value})),placeholder:"Custom greeting message..."})]}),e.jsxs(o,{onClick:Me,disabled:q.isPending,className:"w-full",children:[q.isPending&&e.jsx(y,{className:"h-4 w-4 mr-2 animate-spin"}),"Create Bulk Calls"]})]})]})]}),e.jsxs(te,{open:ye,onOpenChange:K,children:[e.jsx(ne,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Make Call"]})}),e.jsxs(ie,{children:[e.jsxs(le,{children:[e.jsx(re,{children:"Create Outbound Call"}),e.jsx(de,{children:"Start a new outbound call with an AI assistant"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{htmlFor:"assistant-source",children:"Assistant Source"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{htmlFor:"assistant-source",className:"text-sm",children:"Database"}),e.jsx(oe,{id:"assistant-source",checked:j,onCheckedChange:s=>{_(s),c(t=>({...t,assistantId:""}))}}),e.jsx(r,{htmlFor:"assistant-source",className:"text-sm",children:"VAPI"})]})]}),e.jsxs("div",{children:[e.jsxs(r,{htmlFor:"assistant",children:["Assistant ",g&&e.jsx(y,{className:"h-3 w-3 animate-spin inline ml-1"})]}),e.jsxs(ce,{value:n.assistantId,onValueChange:s=>c(t=>({...t,assistantId:s})),disabled:g,children:[e.jsx(ue,{children:e.jsx(he,{placeholder:g?"Loading assistants...":C.length===0?"No assistants found":"Select an assistant"})}),e.jsx(xe,{children:C.map(s=>e.jsx(me,{value:s.id,children:s.name},s.id))})]}),C.length===0&&!g&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:j?"No assistants found in VAPI. Try switching to Database source.":"No assistants found in database. Try creating an assistant first."})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx(je,{id:"phoneNumber",value:n.phoneNumber,onChange:s=>c(t=>({...t,phoneNumber:s.target.value})),placeholder:"+1234567890"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"firstMessage",children:"First Message (Optional)"}),e.jsx(A,{id:"firstMessage",value:n.firstMessage||"",onChange:s=>c(t=>({...t,firstMessage:s.target.value})),placeholder:"Custom greeting message..."})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"voicemailMessage",children:"Voicemail Message (Optional)"}),e.jsx(A,{id:"voicemailMessage",value:n.voicemailMessage||"",onChange:s=>c(t=>({...t,voicemailMessage:s.target.value})),placeholder:"Message to leave if voicemail is detected..."})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"maxDuration",children:"Max Duration (seconds)"}),e.jsx(je,{id:"maxDuration",type:"number",value:n.maxDurationSeconds,onChange:s=>c(t=>({...t,maxDurationSeconds:parseInt(s.target.value)})),min:"30",max:"3600"})]}),e.jsxs(o,{onClick:Pe,disabled:O.isPending,className:"w-full",children:[O.isPending&&e.jsx(y,{className:"h-4 w-4 mr-2 animate-spin"}),"Start Call"]})]})]})]})]})]}),e.jsxs(Be,{defaultValue:"calls",className:"space-y-4",children:[e.jsxs($e,{children:[e.jsx(F,{value:"calls",children:"Active Calls"}),e.jsx(F,{value:"recordings",children:"All Recordings"}),e.jsx(F,{value:"history",children:"Call History"}),e.jsx(F,{value:"stats",children:"Statistics"})]}),e.jsx(P,{value:"calls",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-5 w-5"}),"Outbound Calls"]}),e.jsx(B,{children:"Manage your outbound calls and view their status"})]}),e.jsx(m,{children:we?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(y,{className:"h-8 w-8 animate-spin"})}):e.jsxs(fe,{children:[e.jsx(be,{children:e.jsxs(w,{children:[e.jsx(d,{children:"Phone Number"}),e.jsx(d,{children:"Assistant"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Duration"}),e.jsx(d,{children:"Recording"}),e.jsx(d,{children:"Started"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(Ne,{children:U.length===0?e.jsx(w,{children:e.jsx(i,{colSpan:7,className:"text-center text-muted-foreground",children:"No outbound calls found. Create your first call to get started."})}):U.map(s=>e.jsxs(w,{children:[e.jsx(i,{className:"font-mono",children:s.phoneNumber}),e.jsx(i,{children:s.assistantId}),e.jsx(i,{children:qe(s.status)}),e.jsx(i,{children:s.duration?`${Math.floor(s.duration/60)}:${(s.duration%60).toString().padStart(2,"0")}`:"-"}),e.jsx(i,{children:s.status==="ended"||s.recording?e.jsx(Ce,{src:s.recording||`/api/outboundcall/recording/${s.id}`,title:`Call Recording - ${s.phoneNumber}`,duration:s.duration?`${Math.floor(s.duration/60)}:${(s.duration%60).toString().padStart(2,"0")}`:"0:00",compact:!0,onPlay:()=>S(s.id),onPause:()=>S(null)}):s.status==="in-progress"?e.jsx("span",{className:"text-muted-foreground text-sm",children:"Recording..."}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No recording"})}),e.jsx(i,{children:s.startedAt?new Date(s.startedAt).toLocaleString():"-"}),e.jsx(i,{children:e.jsxs("div",{className:"flex gap-2",children:[s.status==="in-progress"&&e.jsx(o,{size:"sm",variant:"outline",onClick:()=>Ie(s.id),disabled:H.isPending,children:e.jsx(_e,{className:"h-3 w-3"})}),s.transcript&&e.jsx(o,{size:"sm",variant:"outline",onClick:()=>De(s.id),children:e.jsx($,{className:"h-3 w-3"})}),(s.status==="ended"||s.recording)&&e.jsx(o,{size:"sm",variant:"outline",onClick:()=>Re(s.id),title:"Download Recording",children:e.jsx($,{className:"h-3 w-3"})})]})})]},s.id))})]})})]})}),e.jsx(P,{value:"recordings",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5"}),"All Call Recordings"]}),e.jsx(B,{children:"View and manage all call recordings with inline playback"})]}),e.jsx(m,{children:Fe?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(y,{className:"h-8 w-8 animate-spin"})}):e.jsxs(fe,{children:[e.jsx(be,{children:e.jsxs(w,{children:[e.jsx(d,{children:"Recording Name"}),e.jsx(d,{children:"Type"}),e.jsx(d,{children:"Duration"}),e.jsx(d,{children:"Audio Player"}),e.jsx(d,{children:"Date"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(Ne,{children:V.length===0?e.jsx(w,{children:e.jsx(i,{colSpan:6,className:"text-center text-muted-foreground",children:"No recordings found. Recordings will appear here after calls are completed."})}):V.map(s=>e.jsxs(w,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.recordingName}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: ",s.id]})]})}),e.jsx(i,{children:e.jsx(ge,{variant:"outline",children:s.type})}),e.jsx(i,{children:s.duration}),e.jsx(i,{children:e.jsx(Ce,{src:`/api/recordings/${s.id}/stream`,title:s.recordingName,duration:s.duration,compact:!0,onPlay:()=>S(s.id),onPause:()=>S(null)})}),e.jsx(i,{children:new Date(s.date).toLocaleDateString()}),e.jsx(i,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>Te(s),title:"Download Recording",children:e.jsx($,{className:"h-3 w-3"})}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>Le(s),title:"Share Recording",children:e.jsx(He,{className:"h-3 w-3"})}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>window.open(`/recordings/${s.id}`,"_blank"),title:"View Details",children:e.jsx(Ue,{className:"h-3 w-3"})}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>Oe(s),title:"Delete Recording",children:e.jsx(Ge,{className:"h-3 w-3"})})]})})]},s.id))})]})})]})}),e.jsx(P,{value:"history",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsx(f,{children:"Call History"}),e.jsx(B,{children:"View completed and failed calls"})]}),e.jsx(m,{children:e.jsx("p",{className:"text-muted-foreground",children:"Call history will be displayed here."})})]})}),e.jsx(P,{value:"stats",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsxs(x,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Total Calls"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:((J=(G=l==null?void 0:l.data)==null?void 0:G.totalCalls)==null?void 0:J.toLocaleString())||0})})]}),e.jsxs(x,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Successful Calls"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:((X=(W=l==null?void 0:l.data)==null?void 0:W.successfulCalls)==null?void 0:X.toLocaleString())||0})})]}),e.jsxs(x,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Avg Duration"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:(Y=l==null?void 0:l.data)!=null&&Y.averageDuration?`${Math.floor(l.data.averageDuration/60)}:${(l.data.averageDuration%60).toString().padStart(2,"0")}`:"0:00"})})]}),e.jsxs(x,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Total Cost"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsxs("div",{className:"text-2xl font-bold",children:["$",((ee=(Z=l==null?void 0:l.data)==null?void 0:Z.totalCost)==null?void 0:ee.toFixed(2))||"0.00"]})})]}),e.jsxs(x,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(f,{className:"text-sm font-medium",children:"Total Recordings"}),e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:((ae=(se=N==null?void 0:N.pagination)==null?void 0:se.totalRecordings)==null?void 0:ae.toLocaleString())||V.length})})]})]})})]})]})})};export{Ss as default};
//# sourceMappingURL=OutboundCalls-al_Tstjp.js.map
