import{j as e,bQ as Ia,bc as ns,aw as La,b4 as ee,a1 as cs,az as Ts,a7 as Da,bG as $s,av as Ma,bD as _a,a3 as K,b3 as Us,p as Ta,bu as he,bR as $a,bw as Rs,aa as Ua,bq as Ra,bS as qa,M as Ha,bT as za,bU as Oa,bV as Ba,X as Va,bW as Wa,bI as Ya}from"./ui-D0JisYOU.js";import{r as t}from"./vendor-D6QveUxv.js";import{P as Qa}from"./Page-CMDChCTT.js";import{j as $,t as l,u as Os,a as Xa,L as E,I as v,T as Ja,S as Ka,p as Za,q as et,r as st,s as ge,B as h,J as at,K as tt,M as rt,N as lt,y as is,z as os,A as ds,E as ms,O as nt,P as ct,v as es,D as it,e as ot,f as dt,i as ss,h as qs,Q as mt,R as ut,U as xt,V as ht,W as as,X as ts,Y as gt,F as ft,Z as pt}from"./index-D9y2aYC5.js";import{createOutboundCall as bt,unmuteCall as jt,muteCall as Nt,endCallViaControl as yt}from"./outboundService-ftNodRyf.js";import{f as vt}from"./agentService-BksjFfeh.js";import{g as Ct}from"./phoneNumberService-Bcbb38rL.js";import{g as wt,f as St,h as Hs,a as Et,b as kt,c as At,C as Ft}from"./CallRecordingPlayer-oZgj_cma.js";import{d as Pt,u as Gt}from"./router-jXXg-8rg.js";import{u as It,a as Lt,C as Dt}from"./resolvers-BDyAs6MX.js";import{o as Mt,c as zs,b as _t,a as Z}from"./index.esm-2IctsHce.js";import{P as Tt,C as $t}from"./ChatSidebar-DBg9c-dB.js";import{S as Ut,a as Rt,b as qt,c as Ht,d as zt}from"./sheet-CM6-Piu_.js";import{A as rs,a as ls}from"./avatar-kC-cyhMH.js";import{u as Ot}from"./usePermissions-l31Jn2hQ.js";import{A as Bt,a as Vt,b as Wt,c as Yt,d as Qt,e as Xt,f as Jt,g as Kt}from"./alert-dialog-CmgFlzda.js";import"./scroll-area-DyZFf7r4.js";import"./index-BZw056XW.js";import"./query-CXvbhbrr.js";import"./slider-DdI0p9ET.js";import"./messagingService-D_rtVLM0.js";import"./CreatePhoneNumberForm-DJRnPpyb.js";import"./CreditGuard-DCNDFZ-T.js";async function Bs(){try{const d=await $.get("/api/contact-gmail/auth/status");if(d.data.success)return d.data.data;throw new Error(d.data.message||"Failed to get Contact Gmail status")}catch(d){return console.error("Error getting Contact Gmail status:",d),{isConnected:!1,email:null}}}async function Zt(){var d,f;try{const c=await $.get("/api/contact-gmail/auth/url");if(c.data.success){const n=window.open(c.data.data.authUrl,"contact_gmail_oauth","width=500,height=600,scrollbars=yes,resizable=yes");if(!n){l.error("Popup blocked. Please allow popups and try again.");return}return new Promise((r,_)=>{let j=!1;const k=i=>{if(console.log("ðŸ“¨ Received postMessage:",i.data,"from origin:",i.origin),!i.data||!i.data.type||!i.data.type.startsWith("CONTACT_GMAIL_")){console.log("âŒ Ignoring non-Contact Gmail message");return}j||(i.data.type==="CONTACT_GMAIL_SUCCESS"?(console.log("âœ… Contact Gmail success received"),j=!0,window.removeEventListener("message",k),l.success(`Contact Gmail connected successfully! (${i.data.email})`),r()):i.data.type==="CONTACT_GMAIL_ERROR"&&(console.log("âŒ Contact Gmail error received:",i.data.error),j=!0,window.removeEventListener("message",k),l.error(`Failed to connect Contact Gmail: ${i.data.error}`),_(new Error(i.data.error))))};window.addEventListener("message",k);const o=setInterval(()=>{if(n.closed){if(clearInterval(o),console.log("ðŸ”’ OAuth tab was closed"),j)return;window.removeEventListener("message",k),setTimeout(async()=>{if(!j){console.log("ðŸ” Checking Contact Gmail status after tab close...");try{(await Bs()).isConnected?(console.log("âœ… Contact Gmail is connected despite no postMessage"),j=!0,l.success("Contact Gmail connected successfully!"),r()):(console.log("âŒ Contact Gmail is not connected"),j=!0,_(new Error("Contact Gmail connection was cancelled")))}catch(i){console.log("âŒ Error checking Contact Gmail status:",i),j=!0,_(new Error("Contact Gmail connection was cancelled"))}}},2e3)}},1e3);setTimeout(()=>{j||(clearInterval(o),window.removeEventListener("message",k),n.closed||n.close(),j=!0,_(new Error("Contact Gmail connection timeout")))},3e5)})}else throw new Error(c.data.message||"Failed to generate Contact Gmail auth URL")}catch(c){console.error("Error connecting Contact Gmail:",c);const n=((f=(d=c.response)==null?void 0:d.data)==null?void 0:f.message)||"Failed to connect Contact Gmail";throw l.error(n),c}}async function er(){var d,f;try{const c=await $.delete("/api/contact-gmail/auth/disconnect");if(c.data.success){l.success("Contact Gmail disconnected successfully!");return}throw new Error(c.data.message||"Failed to disconnect Contact Gmail")}catch(c){console.error("Error disconnecting Contact Gmail:",c);const n=((f=(d=c.response)==null?void 0:d.data)==null?void 0:f.message)||"Failed to disconnect Contact Gmail";throw l.error(n),c}}async function sr(d){var f,c;try{const n=await $.post("/api/contact-gmail/send",d);if(n.data.success)return l.success("Email sent successfully via Contact Gmail!"),n.data.data;throw new Error(n.data.message||"Failed to send email via Contact Gmail")}catch(n){console.error("Error sending Contact Gmail email:",n);const r=((c=(f=n.response)==null?void 0:f.data)==null?void 0:c.message)||"Failed to send email via Contact Gmail";throw l.error(r),n}}async function ar(d){var f,c;try{const n=await $.post("/api/email/send",d);if(n.data.success){const r=n.data.data;return r.testMode?l.success("Email logged successfully (Test Mode)"):l.success(`Email sent successfully via ${r.provider}!`),n.data.data}throw new Error(n.data.message||"Failed to send email")}catch(n){console.error("Error sending email:",n);const r=((c=(f=n.response)==null?void 0:f.data)==null?void 0:c.message)||"Failed to send email";throw l.error(r),n}}async function tr(){var d,f;try{const c=await $.get("/api/email/status");if(c.data.success)return c.data.data;throw new Error(c.data.message||"Failed to get email service status")}catch(c){console.error("Error getting email service status:",c);const n=((f=(d=c.response)==null?void 0:d.data)==null?void 0:f.message)||"Failed to get email service status";throw l.error(n),c}}const rr=zs().shape({listName:Z().required("List Name is required").min(2,"List Name must be at least 2 characters"),description:Z().required("Description is required"),type:Z().required("Type is required"),contacts:_t().of(zs().shape({fullName:Z().required("Full Name is required").min(2,"Full Name must be at least 2 characters"),email:Z().required("Email is required").email("Email is invalid"),phoneNumber:Z().required("Phone Number is required").min(10,"Phone Number must be at least 10 digits")})).required("Contacts are required").min(1,"At least one contact is required")});function lr(){t.useRef(null);const[d,f]=t.useState(!1),[c,n]=t.useState(0),{user:r}=Os(),{isSuperAdmin:_}=Xa(),{register:j,control:k,handleSubmit:o,formState:{errors:i,isSubmitting:fe},reset:pe,watch:Ie,setValue:be}=It({resolver:Mt(rr),defaultValues:{listName:"",description:"",type:"General",contacts:[{fullName:"",email:"",phoneNumber:""}]}}),{fields:U,append:Le,remove:R}=Lt({control:k,name:"contacts"}),De=()=>{var m,A;const C=at.getItem("token");if(!C)return console.log("No token found in storage"),null;try{const u=tt(C);console.log("Decoded token:",u);let w=null;return(m=u.user)!=null&&m.id?w=u.user.id:(A=u.user)!=null&&A.user_id?w=u.user.user_id:u.id?w=u.id:u.user_id&&(w=u.user_id),console.log("Extracted userId:",w),w}catch(u){return console.error("Error decoding token:",u),null}},us=async C=>{if(!_)try{const u=(await $.get("/api/credits/balance")).data.data;if(!u||parseFloat(u.available_credits)<1){n((u==null?void 0:u.available_credits)||0),f(!0);return}}catch(A){console.error("Error checking credit balance:",A),l.error("Unable to verify credit balance. Please try again.");return}const m=De();if(!m){l.error("User ID not found. Please log in again.");return}try{const A=await rt({listName:C.listName,description:C.description,type:C.type}),u=C.contacts.map(q=>({email:q.email,contact_number:q.phoneNumber,first_name:q.fullName})),w={user_id:m,list_name:C.listName,list_description:C.description,contacts:u};await lt(w),pe({listName:"",description:"",type:"General",contacts:[{fullName:"",email:"",phoneNumber:""}]}),l.success("Contact List created successfully!"),typeof window<"u"&&window.location.reload()}catch(A){console.error("Error submitting form:",A),l.error("Failed to create contact list. Please try again.")}};return e.jsxs(e.Fragment,{children:[e.jsx(Ut,{className:"text-xl font-semibold jakarta bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent mb-1",children:"Create Contact List"}),e.jsx(Rt,{className:"text-muted-foreground mb-6",children:"Create a new contact list for your voice AI agents to use for campaigns."}),e.jsxs("form",{onSubmit:o(us),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Ia,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-sm font-medium",children:"List Information"})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"listName",className:"text-sm font-medium text-foreground mb-1.5 block",children:["List Name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(v,{id:"listName",placeholder:"Enter contact list name",className:"w-full border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20",...j("listName")}),i.listName&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.listName.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"description",className:"text-sm font-medium text-foreground mb-1.5 block",children:["Description",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Ja,{id:"description",placeholder:"Enter contact list description",className:"w-full min-h-[80px] border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20",...j("description")}),i.description&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.description.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"type",className:"text-sm font-medium text-foreground mb-1.5 block",children:["Type",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(Ka,{value:Ie("type"),onValueChange:C=>be("type",C),children:[e.jsx(Za,{className:"w-full border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20",children:e.jsx(et,{placeholder:"Select list type"})}),e.jsxs(st,{children:[e.jsx(ge,{value:"General",children:"General"}),e.jsx(ge,{value:"Marketing",children:"Marketing"}),e.jsx(ge,{value:"Sales",children:"Sales"}),e.jsx(ge,{value:"Event",children:"Event"}),e.jsx(ge,{value:"Customer",children:"Customer"})]})]}),i.type&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.type.message})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ns,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-sm font-medium",children:"Contacts"}),e.jsx("span",{className:"text-xs text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-4",children:[U.map((C,m)=>{var A,u,w,q,je,Ne,W,ye,H;return e.jsxs("div",{className:"border border-border/50 rounded-lg p-4 mb-4 relative bg-card/50",children:[U.length>1&&e.jsx("button",{type:"button",onClick:()=>R(m),className:"absolute top-3 right-3 text-muted-foreground hover:text-red-500 transition-colors",title:"Remove Contact",children:e.jsx(La,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx("div",{className:"h-6 w-6 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-primary",children:m+1})}),e.jsxs("h4",{className:"text-sm font-medium",children:["Contact ",m+1]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs(E,{htmlFor:`contacts.${m}.fullName`,className:"text-sm font-medium text-foreground mb-1.5 block",children:["Full Name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"relative",children:e.jsx(v,{id:`contacts.${m}.fullName`,type:"text",placeholder:"Enter full name",className:"w-full border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20",...j(`contacts.${m}.fullName`)})}),((u=(A=i.contacts)==null?void 0:A[m])==null?void 0:u.fullName)&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:(w=i.contacts[m].fullName)==null?void 0:w.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:`contacts.${m}.email`,className:"text-sm font-medium text-foreground mb-1.5 block",children:["Email",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(v,{id:`contacts.${m}.email`,type:"email",placeholder:"Enter contact email",className:"w-full pl-10 border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20",...j(`contacts.${m}.email`)})]}),((je=(q=i.contacts)==null?void 0:q[m])==null?void 0:je.email)&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:(Ne=i.contacts[m].email)==null?void 0:Ne.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:`contacts.${m}.phoneNumber`,className:"text-sm font-medium text-foreground mb-1.5 block",children:["Phone Number",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Dt,{name:`contacts.${m}.phoneNumber`,control:k,render:({field:{onChange:Me,value:_e}})=>e.jsx(Tt,{country:"us",value:_e,onChange:Y=>Me(`+${Y}`),inputProps:{name:`contacts.${m}.phoneNumber`,required:!0,autoFocus:!1},containerStyle:{width:"100%"},inputStyle:{width:"100%",height:"40px",fontSize:"14px",border:"1px solid hsl(var(--border))",borderRadius:"6px",backgroundColor:"hsl(var(--card))",color:"hsl(var(--foreground))",paddingLeft:"48px"},buttonStyle:{border:"1px solid hsl(var(--border))",borderRight:"none",backgroundColor:"hsl(var(--card))",borderRadius:"6px 0 0 6px"},dropdownStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"6px",color:"hsl(var(--foreground))"},placeholder:"Enter phone number",enableSearch:!0,disableSearchIcon:!0})}),((ye=(W=i.contacts)==null?void 0:W[m])==null?void 0:ye.phoneNumber)&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:(H=i.contacts[m].phoneNumber)==null?void 0:H.message})]})]})]},C.id)}),e.jsxs(h,{type:"button",variant:"outline",className:"w-full border-dashed border-border/50 hover:bg-gray-600 flex items-center justify-center gap-2 py-6",onClick:()=>Le({fullName:"",email:"",phoneNumber:""}),children:[e.jsx(cs,{className:"w-4 h-4"}),"Add Another Contact"]})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-3",children:[e.jsx(qt,{asChild:!0,children:e.jsx(h,{type:"button",variant:"outline",className:"border-border/50 text-foreground hover:bg-muted/20",children:"Cancel"})}),e.jsx(h,{type:"submit",className:"btn-gradient text-white",disabled:fe,children:fe?"Creating...":"Create List"})]})]}),e.jsx(is,{open:d,onOpenChange:f,children:e.jsxs(os,{className:"sm:max-w-md",children:[e.jsx(ds,{children:e.jsxs(ms,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Insufficient Credits"}),e.jsx("p",{className:"text-sm text-gray-500 font-normal",children:"You need credits to create contact lists"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Current Balance:"}),e.jsxs("span",{className:"font-semibold",children:[c," credits"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Required:"}),e.jsx("span",{className:"font-semibold text-red-600",children:"1 credit minimum"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{variant:"outline",onClick:()=>f(!1),className:"flex-1",children:"Cancel"}),e.jsx(h,{onClick:()=>{f(!1),window.location.href="/credits"},className:"flex-1 bg-primary hover:bg-primary/90",children:"Buy Credits"})]})]})]})})]})}const Gr=()=>{Pt(),Gt();const{isSuperAdmin:d}=Ot(),{user:f}=Os(),[c,n]=t.useState([]),[r,_]=t.useState(null),[j,k]=t.useState([]),[o,i]=t.useState(null),[fe,pe]=t.useState(!0),[Ie,be]=t.useState(!1),[U,Le]=t.useState(""),[R,De]=t.useState(""),[us,C]=t.useState("list"),[m,A]=t.useState("list"),[u,w]=t.useState(1),[q,je]=t.useState(0),[Ne,W]=t.useState(!1),[ye,H]=t.useState(!1),[Me,_e]=t.useState(0),[Y,se]=t.useState(!1),[F,ae]=t.useState({fullName:"",email:"",phoneNumber:""}),[Vs,ve]=t.useState(!1),[G,Q]=t.useState({fullName:"",email:"",phoneNumber:""}),[Ws,te]=t.useState(!1),[S,Ys]=t.useState(null),[z,Qs]=t.useState([]),[xs,Xs]=t.useState([]),[O,Te]=t.useState(""),[X,$e]=t.useState(""),[hs,gs]=t.useState(!1),[I,Ue]=t.useState(null),[T,Re]=t.useState(!1),[re,Ce]=t.useState(!1),[B,qe]=t.useState(!1),[L,He]=t.useState(null),[Js,we]=t.useState(0),[Se,ze]=t.useState(null),[D,Oe]=t.useState(null),[fs,Be]=t.useState(null),[Ve,We]=t.useState([]),[Ks,ps]=t.useState(!1),[bs,js]=t.useState(1),[Ns,Ye]=t.useState(0),[Zs,ys]=t.useState(null),[ea,vs]=t.useState(!1),[sa,Cs]=t.useState(!1),[Ee,ws]=t.useState(null),[aa,ke]=t.useState(!1),[J,ta]=t.useState(null),[g,V]=t.useState({to:"",cc:"",bcc:"",subject:"",body:"",attachments:[]}),[Qe,Ss]=t.useState(!1),[Ae,Es]=t.useState(!1),[nr,ks]=t.useState(!1),[Xe,As]=t.useState(!1),[ra,Fs]=t.useState(!1),[la,Je]=t.useState(""),[Ps,Gs]=t.useState(!1),[Is,Ls]=t.useState(!1),le=async()=>{Fs(!0);try{ks(!0);try{const s=await Bs();Es(s.isConnected),s.isConnected&&s.email?Je(s.email):Je("")}catch(s){console.error("Error checking Contact Gmail status:",s),Es(!1),Je("")}finally{ks(!1)}try{const s=await tr();As(s.isConfigured)}catch(s){console.error("Error checking SMTP status:",s),As(!1)}return{gmailConnected:Ae,smtpAvailable:Xe}}finally{Fs(!1)}},na=async()=>{Gs(!0);try{await Zt(),await le()}catch(s){console.error("Error connecting Contact Gmail:",s)}finally{Gs(!1)}},ca=async()=>{Ls(!0);try{await er(),await le()}catch(s){console.error("Error unlinking Contact Gmail:",s)}finally{Ls(!1)}},ia=async()=>{if(d){W(!0);return}try{const a=(await $.get("/api/credits/balance")).data.data;if(!a||parseFloat(a.available_credits)<1){_e((a==null?void 0:a.available_credits)||0),H(!0);return}W(!0)}catch(s){console.error("Error checking credit balance:",s),l.error("Unable to verify credit balance. Please try again.")}},Ds=async()=>{try{pe(!0);const s=await nt(1,U,d);if(s.success){const a=Array.isArray(s.data)?s.data:[];n(a)}else n([])}catch(s){console.error("Error fetching lists:",s),n([])}finally{pe(!1)}};t.useEffect(()=>{le()},[]),t.useEffect(()=>{const s=()=>{le()};return window.addEventListener("focus",s),()=>window.removeEventListener("focus",s)},[]);const Fe=async s=>{var a,N,p,P,ne,ce,ie,oe,de,b,y,me,ue,Ge;try{be(!0);const x=await ct(s.toString(),u,R);if(console.log("Full API response:",x),x.success){const xe=Array.isArray((a=x.data)==null?void 0:a.contacts)?x.data.contacts:[];console.log("Extracted contacts:",xe),k(xe),je(((p=(N=x.data)==null?void 0:N.pagination)==null?void 0:p.totalPages)||1)}else console.log("Response not successful:",x),k([])}catch(x){console.error("Error fetching contacts:",x);const xe=M=>typeof M=="object"&&M!==null,Ga=M=>typeof M=="object"&&M!==null&&"message"in M&&typeof M.message=="string";if(xe(x)&&(((P=x.response)==null?void 0:P.status)===404||((ie=(ce=(ne=x.response)==null?void 0:ne.data)==null?void 0:ce.message)==null?void 0:ie.toLowerCase().includes("not found"))||((b=(de=(oe=x.response)==null?void 0:oe.data)==null?void 0:de.error)==null?void 0:b.toLowerCase().includes("not found"))))console.error("Error details:",((Ge=x.response)==null?void 0:Ge.data)||x.message);else if(xe(x)){console.error("Error details:",((y=x.response)==null?void 0:y.data)||x.message);const M=((ue=(me=x.response)==null?void 0:me.data)==null?void 0:ue.error)||x.message||"Unknown error occurred";l.error(`Failed to fetch contacts: ${M}`)}else Ga(x)?(console.error("Error details:",x.message),l.error(`Failed to fetch contacts: ${x.message}`)):(console.error("Error details:",String(x)),l.error("Failed to fetch contacts: Unknown error occurred"));k([])}finally{be(!1)}};t.useEffect(()=>{Ds()},[U,d]),t.useEffect(()=>{r&&Fe(r.id)},[r,u,R]),t.useEffect(()=>{o&&o.phoneNumber&&ma(o)},[o,bs]);const oa=s=>{if(s.is_deleted&&!d){l.error("This list has been disabled and is not accessible.");return}console.log("Selected list:",s),_(s),i(null),se(!1),ve(!1),w(1)},da=s=>{i(s),We([]),js(1),Ye(0)},ma=async s=>{if(s.phoneNumber)try{ps(!0);const a=await wt(s.phoneNumber,bs,10);We(a.calls),Ye(a.totalCalls)}catch(a){console.error("Error fetching call history:",a),We([]),Ye(0)}finally{ps(!1)}},ua=async s=>{if(Hs(s))try{ys(s),vs(!0)}catch(a){console.error("Error playing recording:",a),l.error("Failed to play recording")}},xa=s=>{ae({fullName:s.fullName||"",email:s.email||"",phoneNumber:s.phoneNumber||""}),se(!0)},ha=async()=>{if(!o)return;const s=/^\+1[0-9]{10}$/;if(F.phoneNumber&&!s.test(F.phoneNumber)){l.error("Phone Number must start with +1 followed by 10 digits (e.g., +1234567890)");return}try{await ut(o.id.toString(),F),l.success("Contact updated successfully"),se(!1),r&&Fe(r.id),i({...o,...F})}catch(a){console.error("Error updating contact:",a)}},ga=()=>{se(!1),ae({fullName:"",email:"",phoneNumber:""})},fa=async()=>{if(!r||!G.fullName||!G.email||!G.phoneNumber){l.error("Please fill in all required fields");return}if(!/^\+1[0-9]{10}$/.test(G.phoneNumber)){l.error("Phone Number must start with +1 followed by 10 digits (e.g., +1234567890)");return}try{await mt(r.id.toString(),{fullName:G.fullName,email:G.email,contact_number:G.phoneNumber,phoneNumber:G.phoneNumber}),l.success("Contact added successfully"),Fe(r.id),n(a=>a.map(N=>N.id===r.id?{...N,contactCount:N.contactCount+1}:N)),ve(!1),Q({fullName:"",email:"",phoneNumber:""})}catch(a){console.error("Error adding contact:",a)}},pa=()=>{ve(!1),Q({fullName:"",email:"",phoneNumber:""})},ba=async()=>{var s,a,N;try{const[p,P]=await Promise.all([vt(""),Ct()]);console.log("ðŸ” Debug - Loaded dialer data:",{agentsCount:((s=p==null?void 0:p.data)==null?void 0:s.length)||0,phoneNumbersCount:((a=P==null?void 0:P.data)==null?void 0:a.length)||0,sampleAgent:(N=p==null?void 0:p.data)!=null&&N[0]?{id:p.data[0].id,assistant_id:p.data[0].assistant_id,name:p.data[0].name}:null}),Qs((p==null?void 0:p.data)||[]),Xs((P==null?void 0:P.data)||[])}catch(p){console.error("Error loading dialer data:",p)}},Ms=async s=>{if(!s.phoneNumber){l.error("Contact has no phone number");return}Ys(s),te(!0),(z.length===0||xs.length===0)&&await ba()},ja=s=>{if(!s.phoneNumber){l.error("Contact has no phone number for messaging");return}ws(s),Cs(!0)},Na=s=>{if(!s.email){l.error("Contact has no email address");return}ta(s),V({to:s.email,cc:"",bcc:"",subject:"",body:"",attachments:[]}),ke(!0)},ya=async()=>{if(!g.to||!g.subject||!g.body){l.error("Please fill in To, Subject, and Body fields");return}const s=await le();if(!s.gmailConnected&&!s.smtpAvailable){l.error("No email service available. Please connect Gmail or configure SMTP.");return}Ss(!0);try{s.gmailConnected?await sr({to:g.to,cc:g.cc||void 0,bcc:g.bcc||void 0,subject:g.subject,body:g.body,isHtml:!1}):s.smtpAvailable&&await ar({to:g.to,cc:g.cc||void 0,bcc:g.bcc||void 0,subject:g.subject,body:g.body,isHtml:!1}),ke(!1),V({to:"",cc:"",bcc:"",subject:"",body:"",attachments:[]})}catch(a){console.error("Error sending email:",a)}finally{Ss(!1)}},va=s=>{let a=s.replace(/\D/g,"");if(a.length===10)a="1"+a;else if(!(a.length===11&&a.startsWith("1"))){if(a.length<10)throw new Error("Phone number is too short")}return"+"+a},Ca=async()=>{var N,p,P,ne,ce,ie,oe,de;if(!S||!O||!X){l.error("Please select an agent and from number");return}console.log("ðŸ” Debug - Making call with:",{selectedAgent:O,availableAgents:z.map(b=>({id:b.id,assistant_id:b.assistant_id,name:b.name})),dialerContact:S.fullName,selectedFromNumber:X});let s=z.find(b=>b.id===O);if(s||(s=z.find(b=>b.assistant_id===O)),!s){console.error("âŒ Selected agent not found in agents array:",{selectedAgent:O,availableAgentIds:z.map(b=>b.id),availableAssistantIds:z.map(b=>b.assistant_id)}),l.error("Selected agent not found");return}const a=s.assistant_id||s.id;console.log("Making call with:",{selectedAgentData:s,assistantUUID:a,originalPhoneNumber:S.phoneNumber,selectedFromNumber:X}),gs(!0);try{const b=va(S.phoneNumber);console.log("Formatted phone number:",b);const y=await bt({assistantId:a,phoneNumber:b,phoneNumberId:X,metadata:{contactId:S.id,contactName:S.fullName,listId:r==null?void 0:r.id,listName:r==null?void 0:r.list_name}});console.log("ðŸ“ž Call response:",y),console.log("ðŸ“ž Call response structure:",{id:y.id,callId:y.callId,data:y.data,monitor:y.monitor,dataMonitor:(N=y.data)==null?void 0:N.monitor,controlUrl:((p=y.monitor)==null?void 0:p.controlUrl)||((ne=(P=y.data)==null?void 0:P.monitor)==null?void 0:ne.controlUrl)}),l.success(`Call initiated to ${S.fullName}`),Be(y);const me=y.id||y.callId||((ce=y.data)==null?void 0:ce.id),ue=((ie=y.monitor)==null?void 0:ie.controlUrl)||((de=(oe=y.data)==null?void 0:oe.monitor)==null?void 0:de.controlUrl);console.log("ðŸ“ž Extracted call control data:",{callId:me,controlUrl:ue}),He(me),Oe(ue),Re(!0),we(0);const Ge=setInterval(()=>{we(x=>x+1)},1e3);ze(Ge)}catch(b){console.error("Error making call:",b)}finally{gs(!1)}},wa=async()=>{if(console.log("ðŸ”‡ Mute toggle - Call control data:",{currentCallId:L,callControlUrl:D,isMuted:re,callData:fs}),!L||!D){console.error("âŒ Call control not available:",{currentCallId:L,callControlUrl:D}),l.error("Call control not available - missing call ID or control URL");return}try{re?(await jt(L,D),Ce(!1)):(await Nt(L,D),Ce(!0))}catch(s){console.error("Error toggling mute:",s)}},Sa=()=>{qe(!B),l.success(B?"Call resumed":"Call on hold")},Ea=async()=>{if(console.log("ðŸ“ž End call - Call control data:",{currentCallId:L,callControlUrl:D,callData:fs}),!L||!D){console.error("âŒ Call control not available:",{currentCallId:L,callControlUrl:D}),Se&&(clearInterval(Se),ze(null)),Re(!1),Ce(!1),qe(!1),He(null),Oe(null),Be(null),we(0),te(!1),Te(""),$e("");return}Se&&(clearInterval(Se),ze(null)),Re(!1),Ce(!1),qe(!1),He(null),Oe(null),Be(null),we(0),te(!1),Te(""),$e("");try{yt(L,D).catch(s=>{console.error("Background call ending failed:",s)})}catch(s){console.error("Error initiating call end:",s)}},ka=s=>{const a=Math.floor(s/60),N=s%60;return`${a.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`},Aa=()=>{r&&(i(null),se(!1),ve(!0),Q({fullName:"",email:"",phoneNumber:""}))},Fa=s=>{Ue(s)},Pa=async()=>{if(!(!r||!I))try{await gt(r.id.toString(),I.id.toString()),l.success("Contact removed from list successfully"),Fe(r.id),n(s=>s.map(a=>a.id===r.id?{...a,contactCount:Math.max(0,a.contactCount-1)}:a)),(o==null?void 0:o.id)===I.id&&i(null),Ue(null)}catch(s){console.error("Error removing contact:",s)}},_s=s=>s.substring(0,2).toUpperCase(),Ke=s=>s?s.replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3"):"N/A",Pe=Array.isArray(c)?c.filter(s=>s.list_name.toLowerCase().includes(U.toLowerCase())):[],Ze=Array.isArray(j)?j.filter(s=>{var a;return s.email.toLowerCase().includes(R.toLowerCase())||((a=s.fullName)==null?void 0:a.toLowerCase().includes(R.toLowerCase()))}):[];return e.jsxs(Qa,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Contacts"}),e.jsx(es,{variant:"secondary",className:"px-3 py-1 bg-red-100 text-red-600",children:e.jsx("span",{children:Pe.length})}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Total Contact groups: ",Pe.length]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(h,{onClick:ia,className:"bg-red-500 hover:bg-red-600",children:[e.jsx(cs,{className:"h-4 w-8 mr-2"}),"Add"]})})]}),e.jsxs("div",{className:"flex h-[calc(100vh-200px)] gap-4",children:[e.jsxs("div",{className:"w-80 bg-white border border-gray-300 rounded-lg flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Contact Groups"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ts,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(v,{placeholder:"Search",value:U,onChange:s=>Le(s.target.value),className:"pl-10"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:fe?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Loading..."}):Pe.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No groups found"}):e.jsx("div",{className:"p-2",children:Pe.map(s=>e.jsx("div",{onClick:()=>oa(s),className:`flex items-center p-3 rounded-lg cursor-pointer mb-1 transition-colors ${(r==null?void 0:r.id)===s.id?"bg-gray-900 text-white":"hover:bg-gray-100"} ${s.is_deleted?"opacity-50":""}`,children:e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx(rs,{className:"h-8 w-8",children:e.jsx(ls,{className:(r==null?void 0:r.id)===s.id?"bg-gray-700":"bg-gray-200",children:s.list_name.substring(0,2).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:s.list_name}),e.jsxs("div",{className:`text-xs ${(r==null?void 0:r.id)===s.id?"text-gray-300":"text-gray-500"}`,children:[s.contactCount," contacts"]})]}),e.jsx(es,{variant:"secondary",className:"text-xs",children:s.contactCount})]})},s.id))})})]}),e.jsxs("div",{className:"flex-1 bg-white border border-gray-300 rounded-lg flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:r?r.list_name:"Default"}),r&&e.jsxs("p",{className:"text-sm text-gray-500",children:[Ze.length," contacts"]})]}),e.jsxs(it,{modal:!1,children:[e.jsx(ot,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm","aria-label":"Contact options",children:e.jsx(Da,{className:"h-4 w-4"})})}),e.jsxs(dt,{align:"end",side:"bottom",sideOffset:5,children:[e.jsxs(ss,{onClick:()=>Aa(),children:[e.jsx($s,{className:"h-4 w-4 mr-2"}),"Add Contacts"]}),e.jsx(qs,{}),e.jsxs(ss,{onClick:()=>o&&xa(o),disabled:!o,children:[e.jsx(Ma,{className:"h-4 w-4 mr-2"}),"Edit Contact"]}),e.jsx(qs,{}),e.jsxs(ss,{onClick:()=>o&&Fa(o),className:"text-red-600 focus:text-red-600",disabled:!o,children:[e.jsx(_a,{className:"h-4 w-4 mr-2"}),"Remove from List"]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ts,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(v,{placeholder:"Search",value:R,onChange:s=>De(s.target.value),className:"pl-10"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:r?Ie?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Loading contacts..."}):Ze.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No contacts found in this group"})]})}):e.jsx("div",{className:"p-2",children:Ze.map(s=>e.jsx("div",{onClick:()=>da(s),className:`flex items-center p-3 rounded-lg cursor-pointer mb-1 transition-colors ${(o==null?void 0:o.id)===s.id?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx(rs,{className:"h-10 w-10",children:e.jsx(ls,{className:"bg-green-100 text-green-600",children:_s(s.email)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.fullName||"No Name"}),e.jsx("div",{className:"text-sm text-gray-500 truncate",children:s.email})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{size:"sm",className:"rounded-full bg-green-600 hover:bg-green-700 text-white shadow-md p-2",onClick:a=>{a.stopPropagation(),Ms(s)},children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx(h,{size:"sm",className:"rounded-full bg-orange-600 hover:bg-orange-700 text-white shadow-md p-2",onClick:a=>{a.stopPropagation(),Na(s)},children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx(h,{size:"sm",className:"rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-md p-2",onClick:a=>{a.stopPropagation(),ja(s)},children:e.jsx(Us,{className:"h-4 w-4"})})]})]})},s.id))}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ns,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Select a contact group to view contacts"})]})})})]}),e.jsx("div",{className:"w-96 bg-white border border-gray-300 rounded-lg flex flex-col",children:Vs?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-16 w-16 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx($s,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Add New Contact"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Add contact to ",r==null?void 0:r.list_name]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:pa,children:"Cancel"}),e.jsx(h,{size:"sm",onClick:fa,children:"Save"})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Contact Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),e.jsx(v,{value:G.fullName,onChange:s=>Q(a=>({...a,fullName:s.target.value})),placeholder:"Enter full name",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),e.jsx(v,{type:"email",value:G.email,onChange:s=>Q(a=>({...a,email:s.target.value})),placeholder:"Enter email address",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number *"}),e.jsx(v,{type:"tel",value:G.phoneNumber,onChange:s=>Q(a=>({...a,phoneNumber:s.target.value})),placeholder:"Enter phone number with +1 (e.g., +1234567890)",className:"w-full"})]})]})]})})})]}):o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(rs,{className:"h-16 w-16",children:e.jsx(ls,{className:"bg-green-100 text-green-600 text-xl",children:_s(o.email)})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(h,{size:"sm",className:"rounded-full bg-green-600 hover:bg-green-700 text-white shadow-md p-2",onClick:()=>o&&Ms(o),children:e.jsx(K,{className:"h-4 w-4"})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-1",children:Y?F.fullName||"No Name":o.fullName||"No Name"}),e.jsx("p",{className:"text-sm text-gray-500",children:Ke(Y?F.phoneNumber:o.phoneNumber)})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"General Info"}),Y&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:ga,children:"Cancel"}),e.jsx(h,{size:"sm",onClick:ha,children:"Save"})]})]}),Y?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-900 block mb-1",children:"Full Name"}),e.jsx(v,{value:F.fullName,onChange:s=>ae({...F,fullName:s.target.value}),placeholder:"Enter full name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-900 block mb-1",children:"Phone Number"}),e.jsx(v,{value:F.phoneNumber,onChange:s=>ae({...F,phoneNumber:s.target.value}),placeholder:"Enter phone number with +1 (e.g., +1234567890)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-900 block mb-1",children:"Email Address"}),e.jsx(v,{value:F.email,onChange:s=>ae({...F,email:s.target.value}),placeholder:"Enter email address",type:"email"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(K,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Phone Number"}),e.jsx("p",{className:"text-sm text-gray-500",children:Ke(o.phoneNumber)})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ee,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Email Address"}),e.jsx("p",{className:"text-sm text-gray-500",children:o.email})]})]})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Labels"}),e.jsx(h,{variant:"ghost",size:"sm",children:e.jsx(cs,{className:"h-4 w-4"})})]})}),e.jsx("div",{children:e.jsxs(xt,{defaultValue:"notes",className:"w-full",children:[e.jsxs(ht,{className:"grid w-full grid-cols-3",children:[e.jsx(as,{value:"notes",className:"text-xs",children:"Notes"}),e.jsx(as,{value:"calls",className:"text-xs",children:"Call History"}),e.jsx(as,{value:"chats",className:"text-xs",children:"Chat History"})]}),e.jsx(ts,{value:"notes",className:"mt-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ta,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"No notes yet"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Add your first note using the text area above"})]})}),e.jsx(ts,{value:"calls",className:"mt-4",children:Ks?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(he,{className:"h-8 w-8 mx-auto mb-4 text-gray-400 animate-spin"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading call history..."})]}):Ve.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(K,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No call history"})]}):e.jsxs("div",{className:"space-y-3",children:[Ve.map(s=>{const a=St(s.status),N=Hs(s);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Et(s.created_at)}),e.jsx(es,{variant:"secondary",className:`text-xs ${a.color}`,children:a.text})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[N&&e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>ua(s),className:"h-6 w-6 p-0",children:e.jsx($a,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs text-gray-500",children:kt(s.duration)})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:s.assistant_name||"Unknown Assistant"}),e.jsx("span",{children:At(s.cost)})]})]},s.call_id)}),Ns>10&&e.jsx("div",{className:"text-center pt-4",children:e.jsx(h,{variant:"outline",size:"sm",onClick:()=>js(s=>s+1),disabled:Ve.length>=Ns,children:"Load More"})})]})}),e.jsx(ts,{value:"chats",className:"mt-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Us,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No chat history"})]})})]})})]})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ns,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Select a contact to view details"})]})})})]}),e.jsx(is,{open:ye,onOpenChange:H,children:e.jsxs(os,{className:"sm:max-w-md",children:[e.jsx(ds,{children:e.jsxs(ms,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx(Rs,{className:"w-4 h-4 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Insufficient Credits"}),e.jsx("p",{className:"text-sm text-gray-500 font-normal",children:"You need credits to create contact lists"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Current Balance:"}),e.jsxs("span",{className:"font-semibold",children:[Me," credits"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Required:"}),e.jsx("span",{className:"font-semibold text-red-600",children:"1 credit minimum"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{variant:"outline",onClick:()=>H(!1),className:"flex-1",children:"Cancel"}),e.jsx(h,{onClick:()=>{H(!1),window.location.href="/credits"},className:"flex-1 bg-primary hover:bg-primary/90",children:"Buy Credits"})]})]})]})}),e.jsx(Ht,{open:Ne,onOpenChange:s=>{W(s),s||Ds()},children:e.jsx(zt,{size:"half",children:e.jsx(lr,{})})}),e.jsx(Bt,{open:!!I,onOpenChange:()=>Ue(null),children:e.jsxs(Vt,{children:[e.jsxs(Wt,{children:[e.jsx(Yt,{children:"Remove Contact from List"}),e.jsxs(Qt,{children:['Are you sure you want to remove "',(I==null?void 0:I.fullName)||(I==null?void 0:I.email),'" from this list? This action cannot be undone.']})]}),e.jsxs(Xt,{children:[e.jsx(Jt,{children:"Cancel"}),e.jsx(Kt,{onClick:Pa,className:"bg-red-600 hover:bg-red-700",children:"Remove Contact"})]})]})}),Ws&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl w-full max-w-sm mx-auto overflow-hidden",children:[e.jsx("div",{className:`px-6 py-4 text-white ${T?"bg-green-600":"bg-primary"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),T?"Active Call":"Make Call"]}),!T&&e.jsx("button",{onClick:()=>te(!1),className:"text-white hover:text-gray-200 transition-colors text-2xl leading-none",children:"Ã—"}),T&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ua,{className:"h-4 w-4"}),ka(Js)]})]})}),e.jsx("div",{className:"px-6 py-6 bg-white",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-16 h-16 border-2 border-gray-300 rounded-full flex items-center justify-center shadow-sm ${T?"bg-green-500 animate-pulse":"bg-green-500"}`,children:e.jsx(Ra,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"rounded px-3 mb-2 bg-gray-50 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Name"}),e.jsx("p",{className:"font-medium text-gray-900",children:S==null?void 0:S.fullName})]}),e.jsxs("div",{className:"rounded px-3 bg-gray-50 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Number"}),e.jsx("p",{className:"font-medium text-gray-900",children:S==null?void 0:S.phoneNumber})]}),T&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${B?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:B?"On Hold":"Connected"})})]})]})}),!T&&e.jsxs("div",{className:"px-6 py-4 space-y-4 bg-white border-t border-gray-200",children:[e.jsx("div",{className:"border border-gray-300 rounded-lg bg-gray-50",children:e.jsxs("select",{value:O,onChange:s=>Te(s.target.value),className:"w-full bg-transparent text-gray-900 px-4 py-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent appearance-none",children:[e.jsx("option",{value:"",children:"Agent"}),z.map(s=>e.jsx("option",{value:s.assistant_id||s.id,children:s.name||s.id},s.id))]})}),e.jsx("div",{className:"border border-gray-300 rounded-lg bg-gray-50",children:e.jsxs("select",{value:X,onChange:s=>$e(s.target.value),className:"w-full bg-transparent text-gray-900 px-4 py-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent appearance-none",children:[e.jsx("option",{value:"",children:"From Number"}),xs.map(s=>e.jsx("option",{value:s.id,children:s.number||s.friendlyName},s.id))]})})]}),e.jsx("div",{className:"px-6 py-6 bg-white border-t border-gray-200",children:T?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-6",children:[e.jsx("button",{onClick:wa,className:`w-16 h-16 rounded-full flex items-center justify-center transition-all ${re?"bg-red-500 hover:bg-red-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:re?e.jsx(qa,{className:"h-6 w-6"}):e.jsx(Ha,{className:"h-6 w-6"})}),e.jsx("button",{onClick:Ea,className:"w-20 h-20 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-colors shadow-lg",children:e.jsx(za,{className:"h-8 w-8"})}),e.jsx("button",{onClick:Sa,className:`w-16 h-16 rounded-full flex items-center justify-center transition-all ${B?"bg-yellow-500 hover:bg-yellow-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700"}`,children:B?e.jsx(Oa,{className:"h-6 w-6"}):e.jsx(Ba,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-6 text-xs text-gray-500",children:[e.jsx("span",{className:"w-16 text-center",children:re?"Unmute":"Mute"}),e.jsx("span",{className:"w-20 text-center",children:"End Call"}),e.jsx("span",{className:"w-16 text-center",children:B?"Resume":"Hold"})]})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsx("button",{onClick:()=>te(!1),className:"flex-1 py-3 px-6 bg-red-700 text-white hover:bg-red-800 rounded-full font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Ca,disabled:!O||!X||hs,className:"flex-1 py-3 bg-green-700 hover:bg-green-800 text-white px-6 rounded-full font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:hs?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin mr-2"}),"Calling..."]}):"Call"})]})})]})}),e.jsx(Ft,{call:Zs,isOpen:ea,onClose:()=>{vs(!1),ys(null)}}),Ee&&e.jsx($t,{isOpen:sa,contact:{id:Ee.id.toString(),email:Ee.email,contact_number:Ee.phoneNumber,list_name:r==null?void 0:r.list_name},onClose:()=>{Cs(!1),ws(null)}}),e.jsx(is,{open:aa,onOpenChange:ke,children:e.jsxs(os,{className:"max-w-7xl max-h-[80vh] flex flex-col",children:[e.jsxs(ds,{children:[e.jsxs(ms,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-orange-600"}),"Compose Email"]}),e.jsxs(ft,{children:["Send an email to ",(J==null?void 0:J.fullName)||(J==null?void 0:J.email)]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"from",className:"text-sm font-medium text-gray-700 mb-1 block",children:"From"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{id:"from",value:la||"",disabled:!0,className:"bg-gray-50",placeholder:"Connect Gmail to send emails"}),e.jsx("div",{className:"flex items-center gap-3",children:Ae?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full"}),"Gmail Connected"]}),e.jsx(h,{variant:"outline",size:"sm",onClick:ca,disabled:Is,className:"text-red-600 border-red-600 hover:bg-red-50",children:Is?e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-4 w-4 mr-2 animate-spin"}),"Unlinking..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Va,{className:"h-4 w-4 mr-2"}),"Unlink Gmail"]})})]}):e.jsx(h,{variant:"outline",size:"sm",onClick:na,disabled:Ps,className:"text-blue-600 border-blue-600 hover:bg-blue-50",children:Ps?e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-4 w-4 mr-2 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Link Gmail"]})})})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"to",className:"text-sm font-medium text-gray-700 mb-1 block",children:"To *"}),e.jsx(v,{id:"to",value:g.to,onChange:s=>V(a=>({...a,to:s.target.value})),placeholder:"Enter recipient email"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"cc",className:"text-sm font-medium text-gray-700 mb-1 block",children:"CC"}),e.jsx(v,{id:"cc",value:g.cc,onChange:s=>V(a=>({...a,cc:s.target.value})),placeholder:"Enter CC emails (comma separated)"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"bcc",className:"text-sm font-medium text-gray-700 mb-1 block",children:"BCC"}),e.jsx(v,{id:"bcc",value:g.bcc,onChange:s=>V(a=>({...a,bcc:s.target.value})),placeholder:"Enter BCC emails (comma separated)"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"subject",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Subject *"}),e.jsx(v,{id:"subject",value:g.subject,onChange:s=>V(a=>({...a,subject:s.target.value})),placeholder:"Enter email subject"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"body",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Message *"}),e.jsx("textarea",{id:"body",value:g.body,onChange:s=>V(a=>({...a,body:s.target.value})),placeholder:"Enter your message...",className:"w-full min-h-[200px] p-3 border border-gray-300 rounded-md resize-y focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Attachments"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border border-gray-300 rounded-md bg-gray-50",children:[e.jsx(Wa,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Attachment support coming soon"})]})]})]}),e.jsxs(pt,{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{variant:"outline",onClick:()=>ke(!1),disabled:Qe,children:"Cancel"}),e.jsx("div",{className:"flex items-center gap-2",children:ra?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(he,{className:"h-4 w-4 animate-spin"}),"Checking email services..."]}):Ae?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full"}),"Ready to send via Gmail"]}):Xe?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"}),"Ready to send via SMTP"]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(Rs,{className:"h-4 w-4"}),"No email service available"]})})]}),e.jsx(h,{onClick:ya,disabled:Qe||!g.to||!g.subject||!g.body||!Ae&&!Xe,className:"bg-orange-600 hover:bg-orange-700",children:Qe?e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ya,{className:"h-4 w-4 mr-2"}),"Send Email"]})})]})]})})]})};export{Gr as default};
//# sourceMappingURL=Lists-ohW6TZW0.js.map
