import{j as e,S as F,aV as H,ay as _,aX as O,bq as A}from"./ui-BZ34e_bG.js";import{r as t}from"./vendor-DG599jyl.js";import{u as V,b as y,c as L}from"./query-BwaCLewj.js";import{P as W}from"./Page-RlnDfmDi.js";import{H as X}from"./Header-z9YYy-Xz.js";import{B as N}from"./badge-CiNZHaLO.js";import{B as C}from"./button-Cm3qqFtR.js";import{C as v,b as q,c as k,d as T,a as w}from"./card-BYrCuzD5.js";import{C as z}from"./checkbox-BMG_Mjtc.js";import{I as B}from"./input-DmGou_SQ.js";import{L as m}from"./label-C6Ng9AKs.js";import{T as G}from"./textarea-CkpLCUXs.js";import{D as J,b as Y,c as Z,d as ee,e as se}from"./dialog-Dr0dXxlM.js";import{P as ae}from"./PermissionRoute-6w3RLMMQ.js";import{d as l,t as p}from"./index-DWPNxztX.js";import"./scroll-area-sAMvAiol.js";import"./index-3J7IwK8P.js";import"./index-DwBQLlhe.js";import"./sheet-Di2b-amD.js";import"./index-HDeFwIcs.js";import"./usePermissions-Bihy-2qQ.js";import"./Loading-BYOLa5uC.js";import"./router-BavLd_S0.js";const ie=async()=>(await l.get("/api/roles")).data,re=async()=>{const a=await l.get("/api/permissions");return a.data.data||a.data},te=async a=>{const o=await l.get(`/api/role-permissions/role/${a}`);return o.data.data||o.data},qe=()=>{const[a,o]=t.useState(null),[b,P]=t.useState([]),[h,S]=t.useState(!1),[x,K]=t.useState(""),[M,c]=t.useState(!1),[n,d]=t.useState({name:"",display_name:"",description:""}),R=V(),{data:u,isLoading:ne}=y({queryKey:["roles"],queryFn:ie}),{data:g,isLoading:le}=y({queryKey:["permissions"],queryFn:re}),{data:j,isLoading:oe}=y({queryKey:["rolePermissions",a==null?void 0:a.id],queryFn:()=>te(a.id),enabled:!!a});t.useEffect(()=>{j&&P(j.map(s=>s.permission_id))},[j]);const Q=L({mutationFn:async({roleId:s,permissionIds:i})=>{await l.post(`/api/role-permissions/role/${s}/bulk`,{permission_ids:i})},onSuccess:()=>{p.success("Role permissions updated successfully"),R.invalidateQueries({queryKey:["rolePermissions"]})},onError:s=>{var i,r;p.error(((r=(i=s.response)==null?void 0:i.data)==null?void 0:r.message)||"Failed to update permissions")}}),f=L({mutationFn:async s=>(await l.post("/api/roles",s)).data,onSuccess:()=>{p.success("Role created successfully"),R.invalidateQueries({queryKey:["roles"]}),c(!1),d({name:"",display_name:"",description:""})},onError:s=>{var i,r;p.error(((r=(i=s.response)==null?void 0:i.data)==null?void 0:r.message)||"Failed to create role")}}),E=s=>{o(s)},I=s=>{P(i=>i.includes(s)?i.filter(r=>r!==s):[...i,s])},U=async()=>{if(a){S(!0);try{await Q.mutateAsync({roleId:a.id,permissionIds:b})}finally{S(!1)}}},$=()=>{f.mutate(n)},D=(u==null?void 0:u.filter(s=>s.display_name.toLowerCase().includes(x.toLowerCase())||s.name.toLowerCase().includes(x.toLowerCase())))||[];return e.jsx(ae,{requireSuperAdmin:!0,children:e.jsxs(W,{children:[e.jsx(X,{title:"Roles & Permissions Management",buttonText:"Create Role",action:()=>c(!0),filterByName:!0,filterWord:x,onFilterChange:K,useSheet:!1,showViewToggle:!1,showFilters:!1}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-200px)]",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(v,{className:"h-full",children:[e.jsxs(q,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Roles (",D.length,")"]}),e.jsx(T,{children:"Select a role to manage its permissions"})]}),e.jsx(w,{className:"p-0",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-y-auto",children:D.map(s=>e.jsx("div",{onClick:()=>E(s),className:`p-4 border-b cursor-pointer hover:bg-gray-50 transition-colors ${(a==null?void 0:a.id)===s.id?"bg-blue-50 border-l-4 border-l-blue-500":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.display_name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(N,{variant:"outline",className:"text-xs",children:["#",s.id]}),s.is_system_role&&e.jsx(N,{variant:"secondary",className:"text-xs",children:"System"})]})]}),(a==null?void 0:a.id)===s.id&&e.jsx(H,{className:"h-5 w-5 text-blue-500"})]})},s.id))})})]})}),e.jsx("div",{className:"lg:col-span-2",children:a?e.jsxs(v,{className:"h-full",children:[e.jsx(q,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Permissions for ",a.display_name]}),e.jsx(T,{children:"Manage permissions for this role"})]}),e.jsxs(C,{onClick:U,disabled:h,className:"flex items-center gap-2",children:[h?e.jsx(O,{className:"h-4 w-4 animate-spin"}):e.jsx(A,{className:"h-4 w-4"}),h?"Updating...":"Update Permissions"]})]})}),e.jsx(w,{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"System Permissions"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-60 overflow-y-auto",children:g==null?void 0:g.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 border rounded",children:[e.jsx(z,{id:`permission-${s.id}`,checked:b.includes(s.id),onCheckedChange:()=>I(s.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{htmlFor:`permission-${s.id}`,className:"text-sm font-medium cursor-pointer",children:s.display_name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.description}),e.jsx(N,{variant:"outline",className:"text-xs mt-1",children:s.category})]})]},s.id))})]})})]}):e.jsx(v,{className:"h-full flex items-center justify-center",children:e.jsxs(w,{className:"text-center",children:[e.jsx(F,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a Role"}),e.jsx("p",{className:"text-gray-500",children:"Choose a role from the left panel to manage its permissions."})]})})})]}),e.jsx(J,{open:M,onOpenChange:c,children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Create New Role"}),e.jsx(se,{children:"Create a new role with custom permissions and access levels."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"role-name",children:"Role Name"}),e.jsx(B,{id:"role-name",placeholder:"e.g., manager",value:n.name,onChange:s=>d(i=>({...i,name:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"role-display-name",children:"Display Name"}),e.jsx(B,{id:"role-display-name",placeholder:"e.g., Manager",value:n.display_name,onChange:s=>d(i=>({...i,display_name:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"role-description",children:"Description"}),e.jsx(G,{id:"role-description",placeholder:"Describe the role's responsibilities...",value:n.description,onChange:s=>d(i=>({...i,description:s.target.value}))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(C,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(C,{onClick:$,disabled:!n.name||!n.display_name||f.isPending,children:f.isPending?"Creating...":"Create Role"})]})]})]})})]})})};export{qe as default};
//# sourceMappingURL=Roles-6dsBr8jq.js.map
