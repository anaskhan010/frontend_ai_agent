import{j as e,as as G,aU as j,aV as k,aW as U}from"./ui-S570Xcny.js";import{r as m}from"./vendor-DG599jyl.js";import{c as v,u as A}from"./router-BavLd_S0.js";import{B as w}from"./button-BSd9MMPp.js";import{t as r}from"./index-C95eVPAi.js";import"./query-Cab5P5bd.js";const $=()=>{const[s]=v(),n=A(),[l,o]=m.useState("loading"),[y,a]=m.useState("Processing Gmail authentication...");m.useEffect(()=>{(async()=>{try{const c=window.self!==window.top,S=s.get("success"),u=s.get("email"),d=s.get("error");if(S==="true"&&u){o("success"),a("Gmail account connected successfully!"),r.success("Gmail account connected successfully!");const x=localStorage.getItem("gmail_oauth_return_state");if(window.opener)window.opener.postMessage({type:"GMAIL_AUTH_SUCCESS",data:{email:decodeURIComponent(u)}},window.location.origin),window.close();else if(c&&window.parent)window.parent.postMessage({type:"GMAIL_AUTH_SUCCESS",data:{email:decodeURIComponent(u)}},window.location.origin);else if(x)try{const t=JSON.parse(x);console.log("🔄 Restoring complete workflow state:",t),localStorage.removeItem("gmail_oauth_return_state"),setTimeout(()=>{if(t.fullUrl)console.log("🎯 Redirecting to exact URL:",t.fullUrl),window.location.href=t.fullUrl;else if(t.pathname&&t.search&&t.hash){const b=`${window.location.origin}${t.pathname}${t.search}${t.hash}`;console.log("🔧 Reconstructing URL:",b),window.location.href=b}else console.log("⚠️ Using fallback path:",t.path||"/webhooks"),window.location.href=t.path||`${window.location.origin}/#/webhooks`},1500)}catch(t){console.error("Error parsing saved state:",t),setTimeout(()=>{n("/webhooks")},2e3)}else setTimeout(()=>{n("/webhooks")},2e3);return}if(d){o("error"),a(decodeURIComponent(d)),r.error(`Gmail connection failed: ${decodeURIComponent(d)}`),c&&window.parent&&window.parent.postMessage({type:"GMAIL_AUTH_ERROR",message:decodeURIComponent(d)},window.location.origin);return}const g=s.get("code"),h=s.get("state"),p=s.get("error");if(p){o("error"),a(`Authentication failed: ${p}`),r.error("Gmail authentication was cancelled or failed");return}if(!g||!h){o("error"),a("Missing authorization code or state parameter"),r.error("Invalid Gmail OAuth response");return}const f=await fetch("/api/gmail/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:g,state:h})}),i=await f.json();f.ok&&i.success?(o("success"),a("Gmail account connected successfully!"),r.success("Gmail account connected successfully!"),window.opener?(window.opener.postMessage({type:"GMAIL_AUTH_SUCCESS",data:i.data},window.location.origin),window.close()):c&&window.parent?window.parent.postMessage({type:"GMAIL_AUTH_SUCCESS",data:i.data},window.location.origin):setTimeout(()=>{n("/webhooks")},2e3)):(o("error"),a(i.message||"Failed to connect Gmail account"),r.error(i.message||"Failed to connect Gmail account"),c&&window.parent&&window.parent.postMessage({type:"GMAIL_AUTH_ERROR",message:i.message||"Failed to connect Gmail account"},window.location.origin))}catch(c){console.error("Gmail callback error:",c),o("error"),a("An unexpected error occurred"),r.error("An unexpected error occurred")}})()},[s,n]);const C=()=>{switch(l){case"loading":return e.jsx(j,{className:"h-12 w-12 text-blue-600 animate-spin"});case"success":return e.jsx(U,{className:"h-12 w-12 text-green-600"});case"error":return e.jsx(k,{className:"h-12 w-12 text-red-600"});default:return e.jsx(j,{className:"h-12 w-12 text-blue-600 animate-spin"})}},N=()=>{switch(l){case"loading":return"text-blue-600";case"success":return"text-green-600";case"error":return"text-red-600";default:return"text-blue-600"}};return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(G,{className:"h-8 w-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Gmail Authentication"}),e.jsx("p",{className:"text-gray-600",children:"Connecting your Gmail account..."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:C()}),e.jsx("p",{className:`text-lg font-medium ${N()}`,children:y})]}),l==="error"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{onClick:()=>n("/webhooks"),className:"w-full bg-red-600 hover:bg-red-700 text-white",children:"Return to Webhooks"}),e.jsx(w,{variant:"outline",onClick:()=>window.location.reload(),className:"w-full",children:"Try Again"})]}),l==="success"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-800",children:"Your Gmail account has been successfully connected. You can now use Gmail triggers and actions in your workflows."})}),e.jsx(w,{onClick:()=>n("/webhooks"),className:"w-full bg-green-600 hover:bg-green-700 text-white",children:"Continue to Webhooks"})]}),l==="loading"&&e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-800",children:"Please wait while we process your Gmail authentication..."})})]})})};export{$ as default};
//# sourceMappingURL=GmailCallback-eMS4CvEp.js.map
