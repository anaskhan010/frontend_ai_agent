import{j as e,ax as h,aS as p,bx as w,bz as f}from"./ui-B8VyAbFl.js";import{r as x}from"./vendor-DG599jyl.js";import{d as j}from"./router-BnJytTjr.js";const v=()=>{const[a]=j(),[i,l]=x.useState("loading"),[d,o]=x.useState("Processing Gmail authentication...");return x.useEffect(()=>{(async()=>{var u;try{const c=a.get("success"),m=a.get("email"),n=a.get("error");console.log("ðŸ” GmailPopupCallback params:",{success:c,email:m,error:n}),console.log("ðŸ” window.opener:",window.opener),console.log("ðŸ” window.opener closed:",(u=window.opener)==null?void 0:u.closed);const g=t=>{let r=!1;if(window.opener&&!window.opener.closed)try{console.log("ðŸ“¤ Sending message via window.opener.postMessage"),window.opener.postMessage(t,"*"),r=!0}catch(s){console.log("âš ï¸ window.opener.postMessage failed:",s)}try{const s=new BroadcastChannel("gmail_oauth_channel");console.log("ðŸ“¤ Sending message via BroadcastChannel"),s.postMessage(t),s.close(),r=!0}catch(s){console.log("âš ï¸ BroadcastChannel failed:",s)}try{console.log("ðŸ“¤ Storing message in localStorage"),localStorage.setItem("gmail_oauth_result",JSON.stringify({...t,timestamp:Date.now()})),r=!0}catch(s){console.log("âš ï¸ localStorage failed:",s)}return r};if(c==="true"&&m){l("success"),o("Gmail account connected successfully!"),console.log("ðŸŽ‰ Gmail OAuth success in popup, notifying parent window");const t={type:"GMAIL_AUTH_SUCCESS",data:{email:decodeURIComponent(m),isConnected:!0}};g(t),setTimeout(()=>{console.log("ðŸ”’ Closing popup window"),window.close()},2e3)}else if(n){l("error"),o(`Authentication failed: ${decodeURIComponent(n)}`);const t={type:"GMAIL_AUTH_ERROR",message:decodeURIComponent(n)};g(t),setTimeout(()=>{window.close()},3e3)}else l("error"),o("Invalid callback parameters"),setTimeout(()=>{window.close()},3e3)}catch(c){console.error("Error handling Gmail popup callback:",c),l("error"),o("An unexpected error occurred"),setTimeout(()=>{window.close()},3e3)}})()},[a]),e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[i==="loading"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(h,{className:"h-8 w-8 text-blue-600"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(p,{className:"h-3 w-3 text-white animate-spin"})})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Processing Authentication"}),e.jsx("p",{className:"text-sm text-gray-600",children:d})]})]}),i==="success"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(w,{className:"h-16 w-16 text-green-600"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-900",children:"Successfully Connected!"}),e.jsx("p",{className:"text-sm text-green-700",children:d}),e.jsx("p",{className:"text-xs text-gray-500",children:"This window will close automatically..."})]})]}),i==="error"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(f,{className:"h-16 w-16 text-red-600"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900",children:"Connection Failed"}),e.jsx("p",{className:"text-sm text-red-700",children:d}),e.jsx("p",{className:"text-xs text-gray-500",children:"This window will close automatically..."})]})]})]})})};export{v as default};
//# sourceMappingURL=GmailPopupCallback-CMYO3I3E.js.map
