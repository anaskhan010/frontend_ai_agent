import{j as e,au as Q,F as De,bz as be,ao as ye,bY as Ae,d as Fe,aw as qe,aq as ve,C as ee,V as Me,aP as Z,b3 as Qe,by as he,I as Ee,N as Ie,bF as $e,e as ge,bx as Oe}from"./ui-CZ40mCLE.js";import{r as f}from"./vendor-DG599jyl.js";import{u as Ue,d as Ke}from"./router-BnJytTjr.js";import{M as Ve}from"./ModernTable-1tRPzRHJ.js";import{H as Re}from"./Header-Di3ZFMcs.js";import{P as fe}from"./Page-CvpkpvDq.js";import{u as Le}from"./resolvers-BzctgYTE.js";import{o as ze,c as Be,b as Ge,a as K}from"./index.esm-C7RSptL2.js";import{t as I,L as E,I as je,T as He,S as V,f as R,g as L,h as z,i as A,B as F,D as se,j as te,k as ae,l as re,n as j,u as We}from"./index-D2HGmCxA.js";import{S as Xe,a as Je,b as Ye}from"./sheet-Dhmg5bMZ.js";import{u as Ne,b as we,c as le}from"./query-Dkjx6fBT.js";import{g as Ze,c as es,a as ss,d as ts,u as as}from"./supportService-CDEp_tVz.js";import{A as rs,a as ls}from"./avatar-DgnSVKvc.js";import{P as is,a as ns,b as cs}from"./popover-BiEK3dqk.js";import{A as os,a as ds,b as us,c as ms,d as xs,e as ps,f as hs,g as gs}from"./alert-dialog-BOlrot8H.js";import"./table-Div--8F2.js";import"./client-bTxzlCZ4.js";const fs=Be().shape({title:K().required("Title is required").min(5,"Title must be at least 5 characters").max(500,"Title cannot exceed 500 characters"),description:K().required("Description is required").min(10,"Description must be at least 10 characters"),category:K().required("Category is required"),priority:K().required("Priority is required"),tags:Ge().of(K().required()).optional()});function js({onTicketCreated:v}={}){const i=f.useRef(null),N=f.useRef(null),[h,C]=f.useState(""),[b,w]=f.useState([]),x=Ne(),{data:y}=we({queryKey:["supportCategories"],queryFn:Ze}),g=(y==null?void 0:y.data)||[],{register:P,handleSubmit:S,formState:{errors:u,isSubmitting:k},reset:r,setValue:n,watch:a}=Le({resolver:ze(fs),defaultValues:{category:"general",priority:"medium",tags:[]}}),o=le({mutationFn:es,onMutate:async t=>(console.log("ðŸš€ Starting ticket creation mutation...",t),await x.cancelQueries({queryKey:["supportTickets"]}),{previousTickets:x.getQueriesData({queryKey:["supportTickets"]})}),onSuccess:async(t,d)=>{if(console.log("âœ… Support ticket created successfully:",t),I.success("Support ticket created successfully!"),v){console.log("ðŸ”„ Calling onTicketCreated to refetch tickets...");try{const p=v();console.log("âœ… Refetch initiated:",p)}catch(p){console.error("âŒ Error refetching tickets:",p)}}else console.warn("âš ï¸ onTicketCreated callback not provided");r(),w([]),C(""),setTimeout(()=>{var p;(p=N.current)==null||p.click()},100)},onError:(t,d,p)=>{console.error("âŒ Failed to create support ticket:",t),I.error(t.message||"Failed to create support ticket"),p!=null&&p.previousTickets&&p.previousTickets.forEach(([O,U])=>{x.setQueryData(O,U)})},onSettled:()=>{console.log("ðŸ Mutation settled - clearing cache and refetching queries"),x.removeQueries({queryKey:["supportTickets"],exact:!1}),x.removeQueries({queryKey:["admin-support-tickets"],exact:!1}),x.invalidateQueries({queryKey:["supportTickets"],exact:!1}),x.invalidateQueries({queryKey:["admin-support-tickets"],exact:!1}),x.refetchQueries({queryKey:["supportTickets"],exact:!1})}}),_=async t=>{try{const d={...t,tags:b};await o.mutateAsync(d)}catch(d){console.error("Error submitting form:",d)}},B=t=>{(t.key==="Enter"||t.key===",")&&(t.preventDefault(),$())},$=()=>{const t=h.trim();if(t&&!b.includes(t)){const d=[...b,t];w(d),n("tags",d),C("")}},H=t=>{const d=b.filter(p=>p!==t);w(d),n("tags",d)},D=()=>{var t;(t=i.current)==null||t.click()},W=[{value:"low",label:"Low",color:"text-green-600"},{value:"medium",label:"Medium",color:"text-yellow-600"},{value:"high",label:"High",color:"text-orange-600"},{value:"urgent",label:"Urgent",color:"text-red-600"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(Xe,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-5 w-5 text-primary"}),e.jsx("span",{children:"Create Support Ticket"})]}),e.jsx(Je,{children:"Submit a new support ticket and we'll get back to you as soon as possible."})]}),e.jsxs("form",{onSubmit:S(_),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(De,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-sm font-medium",children:"Ticket Information"})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"title",className:"text-sm font-medium text-foreground mb-1.5 block",children:["Title",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(je,{id:"title",placeholder:"Brief description of your issue",className:"w-full border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20",...P("title")}),u.title&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:u.title.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"description",className:"text-sm font-medium text-foreground mb-1.5 block",children:["Description",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(He,{id:"description",placeholder:"Please provide detailed information about your issue...",rows:6,className:"w-full border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20 resize-none",...P("description")}),u.description&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:u.description.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"category",className:"text-sm font-medium text-foreground mb-1.5 block",children:["Category",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(V,{onValueChange:t=>n("category",t),defaultValue:"general",children:[e.jsx(R,{className:"w-full border-border/50 bg-card focus:border-primary/50",children:e.jsx(L,{placeholder:"Select a category"})}),e.jsx(z,{children:g.map(t=>e.jsx(A,{value:t.category_id,children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{children:t.name})})},t.category_id))})]}),u.category&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:u.category.message})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"priority",className:"text-sm font-medium text-foreground mb-1.5 block",children:["Priority",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(V,{onValueChange:t=>n("priority",t),defaultValue:"medium",children:[e.jsx(R,{className:"w-full border-border/50 bg-card focus:border-primary/50",children:e.jsx(L,{placeholder:"Select priority level"})}),e.jsx(z,{children:W.map(t=>e.jsx(A,{value:t.value,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:`h-4 w-4 ${t.color}`}),e.jsx("span",{children:t.label})]})},t.value))})]}),u.priority&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:u.priority.message})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"tags",className:"text-sm font-medium text-foreground mb-1.5 block",children:"Tags (Optional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(je,{value:h,onChange:t=>C(t.target.value),onKeyDown:B,placeholder:"Add tags (press Enter or comma to add)",className:"w-full pl-10 border-border/50 bg-card focus:border-primary/50 focus:ring-primary/20"})]}),e.jsx(F,{type:"button",variant:"outline",size:"sm",onClick:$,disabled:!h.trim(),children:"Add"})]}),b.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map((t,d)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-primary/10 text-primary border border-primary/20",children:[t,e.jsx("button",{type:"button",onClick:()=>H(t),className:"ml-1 text-primary/60 hover:text-primary",children:"Ã—"})]},d))})]})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-foreground mb-1.5 block",children:"Attachments (Optional)"}),e.jsxs("div",{onClick:D,className:"border-2 border-dashed border-border/50 rounded-lg p-4 text-center cursor-pointer hover:border-primary/50 transition-colors",children:[e.jsx(Ae,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to attach files or drag and drop"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Supported formats: PDF, DOC, DOCX, TXT, PNG, JPG (Max 10MB)"})]}),e.jsx("input",{ref:i,type:"file",multiple:!0,accept:".pdf,.doc,.docx,.txt,.png,.jpg,.jpeg",className:"hidden",onChange:t=>{console.log("Files selected:",t.target.files)}})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-border/50",children:[e.jsx(Ye,{asChild:!0,children:e.jsx(F,{ref:N,type:"button",variant:"outline",className:"border-border/50 hover:bg-secondary/80",children:"Cancel"})}),e.jsx(F,{type:"submit",disabled:k||o.isPending,className:"bg-primary hover:bg-primary/90 text-primary-foreground",children:k||o.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Create Ticket"]})})]})]})]})}const bs=({data:v,onItemClick:i,actions:N,getStatusBadgeVariant:h,getPriorityBadgeVariant:C,getCategoryBadgeVariant:b,getStatusIcon:w,formatDate:x,isSuperAdmin:y=!1,onStatusUpdate:g,isUpdatingStatus:P=!1})=>{const S=(r,n)=>r.length<=n?r:r.substring(0,n)+"...",u=r=>`#${r.slice(-8).toUpperCase()}`,k=({ticket:r})=>{const n=a=>[{value:"open",label:"Open",disabled:!1},{value:"in_progress",label:"Under Process",disabled:!1},{value:"waiting_response",label:"Waiting Response",disabled:!1},{value:"resolved",label:"Complete",disabled:!1},{value:"closed",label:"Closed",disabled:!1}].filter(_=>_.value!==a);return e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsx("div",{className:"cursor-pointer",onClick:a=>a.stopPropagation(),children:e.jsxs(j,{variant:h(r.status),className:"flex items-center gap-1",children:[w(r.status),r.status==="in_progress"?"Under Process":r.status==="resolved"?"Complete":r.status.replace("_"," ")]})})}),e.jsx(ae,{align:"start",className:"w-48",children:n(r.status).map(a=>e.jsx(re,{onClick:o=>{o.stopPropagation(),g==null||g(r.ticket_id,a.value)},disabled:P,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[w(a.value),e.jsx("span",{children:a.label})]})},a.value))})]})};return v.length===0?e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"h-16 w-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Q,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"No support tickets found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by creating your first support ticket"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map(r=>e.jsxs("div",{className:"bg-card border border-border/50 rounded-lg p-6 hover:shadow-md transition-all duration-200 cursor-pointer group",onClick:()=>i(r),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-10 w-10 bg-gradient-to-br from-primary/20 to-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(Q,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground line-clamp-1",children:S(r.title,30)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:u(r.ticket_id)})]})]}),e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsx(F,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:n=>n.stopPropagation(),children:e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsx(ae,{align:"end",className:"w-48",children:N.map((n,a)=>e.jsxs(re,{onClick:o=>{o.stopPropagation(),n.onClick(r)},className:n.variant==="destructive"?"text-red-600 focus:text-red-600":"",children:[n.icon,e.jsx("span",{className:"ml-2",children:n.label})]},a))})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:S(r.description,100)}),e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[y?e.jsx(k,{ticket:r}):e.jsxs(j,{variant:h(r.status),className:"flex items-center gap-1",children:[w(r.status),r.status==="in_progress"?"Under Process":r.status==="resolved"?"Complete":r.status.replace("_"," ")]}),e.jsx(j,{variant:C(r.priority),children:r.priority.toUpperCase()}),e.jsx(j,{variant:b(r.category),children:r.category.replace("_"," ")})]}),r.tags&&r.tags.length>0&&e.jsxs("div",{className:"flex items-center space-x-1 mb-4",children:[e.jsx(ye,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[r.tags.slice(0,2).map((n,a)=>e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-secondary text-secondary-foreground",children:n},a)),r.tags.length>2&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",r.tags.length-2," more"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground pt-4 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(qe,{className:"h-3 w-3"}),e.jsx("span",{children:r.message_count})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ve,{className:"h-3 w-3"}),e.jsx("span",{children:x(r.created_at)})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ee,{className:"h-3 w-3"}),e.jsx("span",{children:x(r.updated_at)})]})]})]},r.id))})},ys=({onFilterChange:v})=>{var k,r,n;const[i,N]=f.useState({}),[h,C]=f.useState(!1),b=[{value:"open",label:"Open"},{value:"in_progress",label:"In Progress"},{value:"waiting_response",label:"Waiting Response"},{value:"resolved",label:"Resolved"},{value:"closed",label:"Closed"}],w=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"urgent",label:"Urgent"}],x=[{value:"technical",label:"Technical Support"},{value:"billing",label:"Billing & Payments"},{value:"feature_request",label:"Feature Request"},{value:"bug_report",label:"Bug Report"},{value:"general",label:"General Inquiry"}],y=(a,o)=>{const _={...i};o?_[a]=o:delete _[a],N(_)},g=()=>{v(i),C(!1)},P=()=>{N({}),v({})},S=Object.keys(i).length>0,u=Object.keys(i).length;return e.jsxs(is,{open:h,onOpenChange:C,children:[e.jsx(ns,{asChild:!0,children:e.jsxs(F,{variant:"outline",size:"sm",className:"relative border-border/50 hover:bg-secondary/80",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Filters",u>0&&e.jsx(j,{variant:"secondary",className:"ml-2 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs",children:u})]})}),e.jsx(cs,{className:"w-80 p-4",align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Filter Tickets"}),S&&e.jsx(F,{variant:"ghost",size:"sm",onClick:P,className:"h-auto p-1 text-xs text-muted-foreground hover:text-foreground",children:"Clear all"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Status"}),e.jsxs(V,{value:i.status||"",onValueChange:a=>y("status",a==="all"?void 0:a),children:[e.jsx(R,{className:"w-full border-border/50 bg-card",children:e.jsx(L,{placeholder:"All statuses"})}),e.jsxs(z,{children:[e.jsx(A,{value:"all",children:"All statuses"}),b.map(a=>e.jsx(A,{value:a.value,children:a.label},a.value))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Priority"}),e.jsxs(V,{value:i.priority||"",onValueChange:a=>y("priority",a==="all"?void 0:a),children:[e.jsx(R,{className:"w-full border-border/50 bg-card",children:e.jsx(L,{placeholder:"All priorities"})}),e.jsxs(z,{children:[e.jsx(A,{value:"all",children:"All priorities"}),w.map(a=>e.jsx(A,{value:a.value,children:a.label},a.value))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Category"}),e.jsxs(V,{value:i.category||"",onValueChange:a=>y("category",a==="all"?void 0:a),children:[e.jsx(R,{className:"w-full border-border/50 bg-card",children:e.jsx(L,{placeholder:"All categories"})}),e.jsxs(z,{children:[e.jsx(A,{value:"all",children:"All categories"}),x.map(a=>e.jsx(A,{value:a.value,children:a.label},a.value))]})]})]}),S&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Active Filters"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.status&&e.jsxs(j,{variant:"secondary",className:"text-xs",children:["Status: ",(k=b.find(a=>a.value===i.status))==null?void 0:k.label,e.jsx("button",{onClick:()=>y("status",void 0),className:"ml-1 hover:text-foreground",children:e.jsx(Z,{className:"h-3 w-3"})})]}),i.priority&&e.jsxs(j,{variant:"secondary",className:"text-xs",children:["Priority: ",(r=w.find(a=>a.value===i.priority))==null?void 0:r.label,e.jsx("button",{onClick:()=>y("priority",void 0),className:"ml-1 hover:text-foreground",children:e.jsx(Z,{className:"h-3 w-3"})})]}),i.category&&e.jsxs(j,{variant:"secondary",className:"text-xs",children:["Category: ",(n=x.find(a=>a.value===i.category))==null?void 0:n.label,e.jsx("button",{onClick:()=>y("category",void 0),className:"ml-1 hover:text-foreground",children:e.jsx(Z,{className:"h-3 w-3"})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 pt-2 border-t border-border/50",children:[e.jsx(F,{variant:"outline",size:"sm",onClick:()=>C(!1),className:"border-border/50",children:"Cancel"}),e.jsxs(F,{size:"sm",onClick:g,className:"bg-primary hover:bg-primary/90",children:[e.jsx(Qe,{className:"h-4 w-4 mr-1"}),"Apply"]})]})]})})]})},$s=()=>{var de,ue,me;const v=Ue(),[i,N]=Ke(),[h,C]=f.useState(i.get("search")||""),[b,w]=f.useState(h),[x,y]=f.useState(i.get("view")==="grid"?"grid":"list"),[g,P]=f.useState({}),[S,u]=f.useState(null),[k,r]=f.useState(!1),[n,a]=f.useState(!1),o=Ne(),{login:_,isLoggedIn:B}=We(),$=parseInt(i.get("page")||"1"),H=10;f.useEffect(()=>{!B&&!n&&!k&&a(!0)},[B,n,k]),f.useEffect(()=>{const s=setTimeout(()=>{C(b)},300);return()=>clearTimeout(s)},[b]),f.useEffect(()=>{const s=new URLSearchParams(i);h?s.set("search",h):s.delete("search"),s.set("page","1"),N(s)},[h,N]);const{data:D,isLoading:W,error:t,refetch:d}=we({queryKey:["supportTickets",h,g,$],queryFn:()=>ss({search:h,...g,page:$,limit:H}),staleTime:0,gcTime:5*60*1e3,placeholderData:s=>s}),p=le({mutationFn:ts,onSuccess:()=>{I.success("Support ticket deleted successfully"),o.invalidateQueries({queryKey:["supportTickets"]}),u(null)},onError:s=>{I.error(s.message||"Failed to delete support ticket"),u(null)}}),O=le({mutationFn:({ticketId:s,status:l})=>as(s,{status:l}),onMutate:async({ticketId:s,status:l})=>{console.log(`ðŸ”„ Starting optimistic update for ticket ${s} to status ${l}`),await o.cancelQueries({queryKey:["supportTickets"]});const m=o.getQueriesData({queryKey:["supportTickets"]}),T=o.getQueriesData({queryKey:["supportTickets"]});return console.log("ðŸ” All support ticket queries:",T.map(([c])=>c)),o.setQueriesData({queryKey:["supportTickets"]},c=>{var pe;if(console.log("ðŸ” Processing query data:",{hasData:!!(c!=null&&c.data),dataLength:(pe=c==null?void 0:c.data)==null?void 0:pe.length,dataType:typeof(c==null?void 0:c.data)}),!(c!=null&&c.data))return console.log("âŒ No data found for optimistic update"),c;const Y=c.data.findIndex(M=>M.ticket_id===s);if(console.log(`ðŸŽ¯ Found ticket at index ${Y} for ID ${s}`),Y===-1)return console.log("âŒ Ticket not found in current data"),c;console.log(`âœ… Optimistically updating ticket ${s} status from ${c.data[Y].status} to ${l}`);const xe={...c,data:c.data.map(M=>M.ticket_id===s?{...M,status:l,updated_at:new Date().toISOString()}:M)};return console.log("ðŸ“Š Updated ticket:",xe.data.find(M=>M.ticket_id===s)),xe}),{previousData:m}},onSuccess:(s,l)=>{console.log(`âœ… Status update successful for ticket ${l.ticketId}`),I.success("Ticket status updated successfully"),o.invalidateQueries({queryKey:["supportTickets"]}),d(),setTimeout(()=>{v("/support")},1500)},onError:(s,l,m)=>{console.log(`âŒ Status update failed for ticket ${l.ticketId}:`,s),I.error(s.message||"Failed to update ticket status"),m!=null&&m.previousData&&m.previousData.forEach(([T,c])=>{o.setQueryData(T,c)})},onSettled:()=>{console.log("ðŸ Mutation settled - refreshing data"),o.invalidateQueries({queryKey:["supportTickets"]}),d()}}),U=(D==null?void 0:D.data)||[],q=(D==null?void 0:D.is_super_admin)||!1,Ce=s=>{w(s)},Se=s=>{y(s);const l=new URLSearchParams(i);l.set("view",s),N(l)},ke=s=>{P(s);const l=new URLSearchParams(i);l.set("page","1"),N(l)},Te=s=>{u(s)},ie=(s,l)=>{console.log(`ðŸš€ Initiating status update for ticket ${s} to ${l}`),O.mutate({ticketId:s,status:l}),setTimeout(()=>{console.log("ðŸ”„ Triggering immediate refresh after status update"),d()},500)},Pe=()=>{S&&p.mutate(S)},X=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),_e=({ticket:s})=>{if(!q)return e.jsxs(j,{variant:J(s.status),className:"flex items-center gap-1",children:[G(s.status),s.status==="in_progress"?"Under Process":s.status==="resolved"?"Complete":s.status.replace("_"," ")]});const l=m=>[{value:"open",label:"Open",disabled:!1},{value:"in_progress",label:"Under Process",disabled:!1},{value:"waiting_response",label:"Waiting Response",disabled:!1},{value:"resolved",label:"Complete",disabled:!1},{value:"closed",label:"Closed",disabled:!1}].filter(c=>c.value!==m);return e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsx("div",{className:"cursor-pointer",onClick:m=>m.stopPropagation(),children:e.jsxs(j,{variant:J(s.status),className:"flex items-center gap-1",children:[G(s.status),s.status==="in_progress"?"Under Process":s.status==="resolved"?"Complete":s.status.replace("_"," ")]})})}),e.jsx(ae,{align:"start",className:"w-48",children:l(s.status).map(m=>e.jsx(re,{onClick:T=>{T.stopPropagation(),ie(s.ticket_id,m.value)},disabled:O.isPending,className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[G(m.value),e.jsx("span",{children:m.label})]})},m.value))})]})},J=s=>{switch(s){case"open":return"default";case"in_progress":return"secondary";case"waiting_response":return"outline";case"resolved":return"success";case"closed":return"destructive";default:return"default"}},ne=s=>{switch(s){case"low":return"secondary";case"medium":return"default";case"high":return"destructive";case"urgent":return"destructive";default:return"default"}},ce=s=>{switch(s){case"technical":return"default";case"billing":return"secondary";case"feature_request":return"outline";case"bug_report":return"destructive";case"general":return"secondary";default:return"default"}},G=s=>{switch(s){case"open":return e.jsx(ge,{className:"h-3 w-3"});case"in_progress":return e.jsx(ee,{className:"h-3 w-3"});case"waiting_response":return e.jsx(be,{className:"h-3 w-3"});case"resolved":return e.jsx(Oe,{className:"h-3 w-3"});case"closed":return e.jsx(he,{className:"h-3 w-3"});default:return e.jsx(ge,{className:"h-3 w-3"})}};if(t){const s=((de=t.message)==null?void 0:de.includes("token"))||((ue=t.message)==null?void 0:ue.includes("authentication"))||((me=t.message)==null?void 0:me.includes("unauthorized"));return e.jsx(fe,{children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"h-16 w-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(he,{className:"h-8 w-8 text-red-600"})}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"Error loading support tickets"}),e.jsx("p",{className:"text-gray-500 mb-4",children:t.message||"Something went wrong"}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:e.jsx("button",{className:"bg-primary px-4 py-2 rounded-md text-white hover:bg-primary/90 transition-colors",onClick:()=>d(),disabled:k,children:"Try Again"})}),s&&e.jsx("p",{className:"text-sm text-gray-400 mt-3",children:"It looks like you're not authenticated. Try the demo login to access support tickets."})]})})}const oe=[{label:"View Details",icon:e.jsx(Ee,{className:"h-4 w-4"}),onClick:s=>{v(`/support/ticket/${s.ticket_id}`)}},...q?[{label:"Edit Ticket",icon:e.jsx(Ie,{className:"h-4 w-4"}),onClick:s=>{console.log("Editing ticket",s.ticket_id)}},{label:"Delete Ticket",icon:e.jsx($e,{className:"h-4 w-4"}),onClick:s=>Te(s.ticket_id),variant:"destructive"}]:[]];return e.jsxs(fe,{children:[e.jsx("div",{"aria-hidden":!0,className:"absolute inset-0 pointer-events-none bg-gradient-to-r from-indigo-500/10 via-purple-500/10 to-pink-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(Re,{title:"Support Center",buttonText:"New Ticket",filterByName:!0,filterWord:h,onFilterChange:Ce,useSheet:!0,sheetContent:e.jsx(js,{onTicketCreated:()=>(N(s=>{const l=new URLSearchParams(s);return l.set("page","1"),l}),d())}),sheetSize:"half",viewMode:x,onViewModeChange:Se,showViewToggle:!0,showFilters:!1}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(j,{variant:"secondary",className:"px-3 py-1 bg-indigo-500/20 text-indigo-300 border border-indigo-500/30",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),e.jsxs("span",{children:[U.length," Tickets"]})]}),g.status&&e.jsxs(j,{variant:"outline",className:"px-3 py-1 bg-white/5 border-white/20 text-gray-300",children:["Status: ",g.status]}),g.priority&&e.jsxs(j,{variant:"outline",className:"px-3 py-1 bg-white/5 border-white/20 text-gray-300",children:["Priority: ",g.priority]}),g.category&&e.jsxs(j,{variant:"outline",className:"px-3 py-1 bg-white/5 border-white/20 text-gray-300",children:["Category: ",g.category]})]}),e.jsx(ys,{onFilterChange:ke})]}),x==="list"?e.jsx(Ve,{data:U,isLoading:W,isSelectable:!0,showColumnSelection:!0,onRowClick:s=>v(`/support/ticket/${s.ticket_id}`),columns:[{header:"Ticket",accessor:"title",className:"min-w-[300px]",cell:(s,l)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-9 w-9 bg-gradient-to-br from-indigo-500/20 to-purple-500/10 rounded-lg flex items-center justify-center",children:e.jsx(Q,{className:"h-5 w-5 text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white line-clamp-1",children:String(s)}),e.jsxs("div",{className:"text-xs text-gray-400",children:["#",String(l.ticket_id).slice(-8).toUpperCase()]})]})]}),sortable:!0},...q?[{header:"User",accessor:"user_email",className:"min-w-[200px]",cell:(s,l)=>{var m,T;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rs,{className:"h-8 w-8 border-2 border-white/20",children:e.jsxs(ls,{className:"text-xs bg-indigo-500/20 text-indigo-300",children:[(m=l.user_first_name)==null?void 0:m.charAt(0),(T=l.user_last_name)==null?void 0:T.charAt(0)]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-white text-sm",children:[l.user_first_name," ",l.user_last_name]}),e.jsx("div",{className:"text-xs text-gray-400",children:String(s)})]})]})},sortable:!0}]:[],{header:"Status",accessor:"status",className:"min-w-[120px]",cell:(s,l)=>e.jsx(_e,{ticket:l}),sortable:!0},{header:"Priority",accessor:"priority",className:"min-w-[100px]",cell:s=>e.jsx(j,{variant:ne(String(s)),children:String(s).toUpperCase()}),sortable:!0},{header:"Category",accessor:"category",className:"min-w-[120px]",cell:s=>e.jsx(j,{variant:ce(String(s)),children:String(s).replace("_"," ")}),sortable:!0},{header:"Description",accessor:"description",className:"min-w-[200px]",cell:s=>e.jsx("div",{className:"max-w-xs",children:e.jsx("span",{className:"text-sm text-gray-300 line-clamp-2",children:String(s).length>100?`${String(s).substring(0,100)}...`:String(s)})}),sortable:!0},{header:"Created",accessor:"created_at",className:"min-w-[120px]",cell:s=>e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ve,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:X(String(s))})]}),sortable:!0},{header:"Updated",accessor:"updated_at",className:"min-w-[120px]",cell:s=>e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ee,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:X(String(s))})]}),sortable:!0}],actions:oe,emptyState:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"h-16 w-16 bg-indigo-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Q,{className:"h-8 w-8 text-indigo-400"})}),e.jsx("h3",{className:"text-lg font-medium mb-1 text-white",children:"No support tickets found"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Get started by creating your first support ticket"})]})}):e.jsx(bs,{data:U,onItemClick:s=>v(`/support/ticket/${s.ticket_id}`),actions:oe,getStatusBadgeVariant:J,getPriorityBadgeVariant:ne,getCategoryBadgeVariant:ce,getStatusIcon:G,formatDate:X,isSuperAdmin:q,onStatusUpdate:q?ie:void 0,isUpdatingStatus:q?O.isPending:!1}),e.jsx(os,{open:!!S,onOpenChange:()=>u(null),children:e.jsxs(ds,{className:"bg-[#0e1340] border border-white/10 text-white",children:[e.jsxs(us,{children:[e.jsx(ms,{className:"text-white",children:"Delete Support Ticket"}),e.jsx(xs,{className:"text-gray-400",children:"Are you sure you want to delete this support ticket? This action cannot be undone."})]}),e.jsxs(ps,{children:[e.jsx(hs,{className:"bg-transparent border-white/20 text-white hover:bg-white/10",children:"Cancel"}),e.jsx(gs,{onClick:Pe,className:"bg-red-600 hover:bg-red-700 text-white border-0",disabled:p.isPending,children:p.isPending?"Deleting...":"Delete"})]})]})})]})]})};export{$s as default};
//# sourceMappingURL=Support-BU-nDhhE.js.map
