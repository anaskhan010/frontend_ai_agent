import{j as e,cq as C,aF as k,K as U,Y as I,aI as Y,aG as z,N as M,T as E}from"./ui-h9OBLyTx.js";import{r as _}from"./vendor-DG599jyl.js";import{a as G,u as O}from"./query-B7U7fZu0.js";import{P as W}from"./Page-Cenu6ej1.js";import{H as X}from"./Header-BY38dDH8.js";import{c as Q,a0 as J,u as Z,E as V,B as H,a as $,p as A,C as T,d as S,e as q,b as L,f as ee,Q as se,R as ae,U as R,V as re,t as K}from"./index-CzOkn7Aq.js";import{S as x}from"./skeleton-BLqxInac.js";import{T as te,a as ie,b as B,c as p,d as ne,e as c}from"./table-Bk-epEiU.js";import{a as le,N}from"./router-BnJytTjr.js";import"./sheet-D24wHiWO.js";const ce=J("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),y=_.forwardRef(({className:t,variant:n,...r},h)=>e.jsx("div",{ref:h,role:"alert",className:Q(ce({variant:n}),t),...r}));y.displayName="Alert";const de=_.forwardRef(({className:t,...n},r)=>e.jsx("h5",{ref:r,className:Q("mb-1 font-medium leading-none tracking-tight",t),...n}));de.displayName="AlertTitle";const w=_.forwardRef(({className:t,...n},r)=>e.jsx("div",{ref:r,className:Q("text-sm [&_p]:leading-relaxed",t),...n}));w.displayName="AlertDescription";const oe=({children:t,permission:n,permissions:r,requireAll:h=!1,role:a,roles:d,requireSuperAdmin:j=!1,redirectTo:b="/login",showError:o=!0})=>{const{isLoggedIn:f,loading:u}=Z(),{hasPermission:m,hasAnyPermission:P,hasAllPermissions:s,role:l,isSuperAdmin:g,loading:v}=V(),i=le();return!u&&!f?e.jsx(N,{to:b,state:{from:i},replace:!0}):u||v?e.jsx(e.Fragment,{children:t}):j&&!g?o?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(y,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(w,{children:"Super admin privileges required to access this page."})]})}):e.jsx(N,{to:"/dashboard",replace:!0}):a&&(!l||l.name!==a)?o?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(y,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(w,{children:`${a} role required to access this page.`})]})}):e.jsx(N,{to:"/dashboard",replace:!0}):d&&d.length>0&&(!l||!d.includes(l.name))?o?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(y,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(w,{children:`One of the following roles required: ${d.join(", ")}`})]})}):e.jsx(N,{to:"/dashboard",replace:!0}):n&&!m(n)?o?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(y,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(w,{children:"You don't have permission to access this page."})]})}):e.jsx(N,{to:"/dashboard",replace:!0}):r&&r.length>0&&!(h?s(r):P(r))?o?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(y,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(w,{children:"You don't have the required permissions to access this page."})]})}):e.jsx(N,{to:"/dashboard",replace:!0}):e.jsx(e.Fragment,{children:t})},F=({children:t,permission:n,permissions:r,requireAll:h=!1,role:a,roles:d,requireSuperAdmin:j=!1,fallback:b,hideWhenNoAccess:o=!1,disabled:f,...u})=>{const{hasPermission:m,hasAnyPermission:P,hasAllPermissions:s,role:l,isSuperAdmin:g,loading:v}=V();if(v)return e.jsx(H,{disabled:!0,...u,children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-300"})});let i=!0;return j&&!g&&(i=!1),i&&a&&(!l||l.name!==a)&&(i=!1),i&&d&&d.length>0&&(!l||!d.includes(l.name))&&(i=!1),i&&n&&!m(n)&&(i=!1),i&&r&&r.length>0&&((h?s(r):P(r))||(i=!1)),!i&&o?null:!i&&b?e.jsx(e.Fragment,{children:b}):e.jsx(H,{disabled:f||!i,...u,children:t})},me=async()=>(await $.get("/api/permissions")).data.data,we=()=>{const[t,n]=_.useState(""),[r,h]=_.useState("all"),{data:a,isLoading:d,error:j,refetch:b}=G({queryKey:["permissions"],queryFn:me}),o=s=>{n(s)},f=O(),u=async(s,l)=>{var g,v;if(window.confirm(`Are you sure you want to delete the permission "${l}"?`))try{await $.delete(`/api/permissions/${s}`),K.success("Permission deleted successfully"),f.invalidateQueries({queryKey:["permissions"]}),f.invalidateQueries({queryKey:["pagePermissions"]})}catch(i){K.error(((v=(g=i.response)==null?void 0:g.data)==null?void 0:v.message)||"Failed to delete permission")}};if(j)return console.error("Error fetching permissions",j),e.jsx("div",{children:"Error loading permissions"});let m=(a==null?void 0:a.filter(s=>s.name.toLowerCase().includes(t.toLowerCase())||s.display_name.toLowerCase().includes(t.toLowerCase())||s.description.toLowerCase().includes(t.toLowerCase())||s.category.toLowerCase().includes(t.toLowerCase())))||[];r!=="all"&&(m=m.filter(s=>s.category.toLowerCase()===r.toLowerCase()));const P=[...new Set((a==null?void 0:a.map(s=>s.category))||[])];return e.jsx(oe,{requireSuperAdmin:!0,children:e.jsxs(W,{children:[e.jsx(X,{title:"Permission Management",buttonText:"Create Permission",filterByName:!0,filterWord:t,onFilterChange:o,useSheet:!1,showViewToggle:!1,showFilters:!1}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(A,{variant:"secondary",className:"px-3 py-1",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),e.jsxs("span",{children:[m.length," Permissions"]})]})}),e.jsxs(F,{requireSuperAdmin:!0,className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Create Permission"]})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(T,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(q,{className:"text-sm font-medium",children:"Total Permissions"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All permissions"})]})]}),e.jsxs(T,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(q,{className:"text-sm font-medium",children:"System Permissions"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.filter(s=>s.is_system_permission).length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Built-in permissions"})]})]}),e.jsxs(T,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(q,{className:"text-sm font-medium",children:"Custom Permissions"}),e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.filter(s=>!s.is_system_permission).length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"User-created permissions"})]})]}),e.jsxs(T,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(q,{className:"text-sm font-medium",children:"Categories"}),e.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:P.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Permission categories"})]})]})]}),e.jsxs(T,{children:[e.jsxs(S,{children:[e.jsx(q,{children:"Permissions"}),e.jsx(ee,{children:"Manage system permissions and their assignments"})]}),e.jsx(L,{children:e.jsxs(se,{value:r,onValueChange:h,children:[e.jsxs(ae,{className:"grid w-full grid-cols-5",children:[e.jsx(R,{value:"all",children:"All"}),e.jsx(R,{value:"pages",children:"Pages"}),e.jsx(R,{value:"users",children:"Users"}),e.jsx(R,{value:"roles",children:"Roles"}),e.jsx(R,{value:"system",children:"System"})]}),e.jsx(re,{value:r,className:"mt-4",children:e.jsxs(te,{children:[e.jsx(ie,{children:e.jsxs(B,{children:[e.jsx(p,{children:"Permission"}),e.jsx(p,{children:"Resource"}),e.jsx(p,{children:"Action"}),e.jsx(p,{children:"Category"}),e.jsx(p,{children:"Type"}),e.jsx(p,{children:"Actions"})]})}),e.jsx(ne,{children:d?Array.from({length:8}).map((s,l)=>e.jsxs(B,{children:[e.jsx(c,{children:e.jsxs("div",{children:[e.jsx(x,{className:"h-4 w-32 mb-1"}),e.jsx(x,{className:"h-3 w-24"})]})}),e.jsx(c,{children:e.jsx(x,{className:"h-6 w-16"})}),e.jsx(c,{children:e.jsx(x,{className:"h-6 w-16"})}),e.jsx(c,{children:e.jsx(x,{className:"h-4 w-20"})}),e.jsx(c,{children:e.jsx(x,{className:"h-6 w-20"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-8 w-8"}),e.jsx(x,{className:"h-8 w-8"})]})})]},`permission-skeleton-${l}`)):m.map(s=>e.jsxs(B,{children:[e.jsx(c,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.display_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.name})]})}),e.jsx(c,{children:e.jsx(A,{variant:"outline",children:s.resource})}),e.jsx(c,{children:e.jsx(A,{variant:"secondary",children:s.action})}),e.jsx(c,{children:e.jsx(A,{variant:"default",children:s.category})}),e.jsx(c,{children:e.jsx(A,{variant:s.is_system_permission?"secondary":"default",children:s.is_system_permission?"System":"Custom"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{requireSuperAdmin:!0,size:"sm",variant:"outline",children:e.jsx(M,{className:"h-3 w-3"})}),!s.is_system_permission&&e.jsx(F,{requireSuperAdmin:!0,size:"sm",variant:"outline",onClick:()=>u(s.id,s.display_name),children:e.jsx(E,{className:"h-3 w-3"})})]})})]},s.id))})]})})]})})]})]})]})})};export{we as default};
//# sourceMappingURL=Permissions-DhmFffpl.js.map
