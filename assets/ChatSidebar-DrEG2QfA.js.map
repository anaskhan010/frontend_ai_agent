{"version":3,"file":"ChatSidebar-DrEG2QfA.js","sources":["../../src/components/ContactMessaging/ChatSidebar.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from '@/components/ui/dialog';\nimport {\n  Send,\n  Phone,\n  Mail,\n  X,\n  MessageSquare,\n  Check,\n  CheckCheck,\n  AlertCircle,\n  Loader2,\n  Minimize2,\n  Maximize2,\n  Plus\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { toast } from 'sonner';\nimport {\n  sendSMSToContact,\n  getContactMessages,\n  checkNewIncomingMessages,\n  formatPhoneToE164,\n  formatPhoneForDisplay\n} from '@/api/services/messaging/messagingService';\nimport { getAllPhoneNumbers } from '@/api/services/phoneNumbers/phoneNumberService';\nimport CreatePhoneNumberForm from '@/components/PhoneNumbers/CreatePhoneNumberForm';\n\ninterface Message {\n  id: string;\n  content: string;\n  sender: 'user' | 'contact';\n  timestamp: Date;\n  status: 'sending' | 'sent' | 'delivered' | 'failed' | 'read';\n  messageId?: string;\n}\n\ninterface Contact {\n  id: string;\n  email: string;\n  contact_number: string;\n  list_name?: string;\n}\n\ninterface ChatSidebarProps {\n  isOpen: boolean;\n  contact: Contact | null;\n  onClose: () => void;\n}\n\nconst ChatSidebar: React.FC<ChatSidebarProps> = ({ isOpen, contact, onClose }) => {\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [isSending, setIsSending] = useState(false);\n  const [isMinimized, setIsMinimized] = useState(false);\n  const [phoneNumbers, setPhoneNumbers] = useState<any[]>([]);\n  const [selectedFromNumber, setSelectedFromNumber] = useState<string>('');\n  const [isCreatePhoneModalOpen, setIsCreatePhoneModalOpen] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Auto-scroll to bottom when new messages arrive\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  // Load message history when contact changes\n  useEffect(() => {\n    if (contact && isOpen) {\n      loadMessageHistory();\n    }\n  }, [contact, isOpen]);\n\n  // Set up efficient polling for incoming messages only\n  useEffect(() => {\n    if (!contact || !isOpen || !contact.id) return;\n\n    // Set up polling every 2 seconds for new incoming messages only\n    const pollInterval = setInterval(async () => {\n      try {\n        // Get the last message ID to check for new messages after it\n        const lastMessage = messages[messages.length - 1];\n        const lastMessageId = lastMessage?.id;\n\n        console.log(`ðŸ” Polling for new incoming messages for contact ${contact.id} after ID: ${lastMessageId}`);\n\n        const response = await checkNewIncomingMessages(contact.id, lastMessageId);\n\n        if (response.success && response.hasNewMessages && response.messages.length > 0) {\n          console.log(`ðŸ“¨ Found ${response.messages.length} new incoming messages`);\n\n          // Add new incoming messages to the existing messages\n          const newMessages = response.messages.map(msg => ({\n            id: msg.id.toString(),\n            content: msg.content,\n            sender: msg.sender as 'user' | 'contact',\n            timestamp: new Date(msg.timestamp),\n            status: msg.status as 'sending' | 'sent' | 'delivered' | 'failed' | 'read',\n            messageId: msg.messageId\n          }));\n\n          setMessages(prev => [...prev, ...newMessages]);\n\n          // Show notification for new messages\n          toast.success(`New message from ${contact.email?.split('@')[0] || 'Contact'}`);\n        }\n      } catch (error) {\n        console.error('Error polling for new messages:', error);\n        // Don't show error toast to avoid spam\n      }\n    }, 2000);\n\n    return () => {\n      clearInterval(pollInterval);\n    };\n  }, [contact?.id, isOpen, messages]);\n\n  // Load user's phone numbers\n  const loadPhoneNumbers = async () => {\n    try {\n      const response = await getAllPhoneNumbers();\n      if (response.success && response.data) {\n        setPhoneNumbers(response.data);\n        // Auto-select first phone number if available\n        if (response.data.length > 0 && !selectedFromNumber) {\n          setSelectedFromNumber(response.data[0].number);\n        }\n      }\n    } catch (error) {\n      console.error('Failed to load phone numbers:', error);\n    }\n  };\n\n  // Load phone numbers when component mounts\n  useEffect(() => {\n    if (isOpen) {\n      loadPhoneNumbers();\n    }\n  }, [isOpen]);\n\n  // Reset state when sidebar closes\n  useEffect(() => {\n    if (!isOpen) {\n      setMessages([]);\n      setNewMessage('');\n      setIsMinimized(false);\n    }\n  }, [isOpen]);\n\n  const loadMessageHistory = async () => {\n    if (!contact) return;\n    \n    setIsLoading(true);\n    try {\n      const response = await getContactMessages(contact.id);\n      if (response.success) {\n        const formattedMessages: Message[] = response.messages.map((msg: any) => ({\n          id: msg.id.toString(),\n          content: msg.content,\n          sender: msg.sender,\n          timestamp: new Date(msg.timestamp),\n          status: msg.status,\n          messageId: msg.message_id\n        }));\n        setMessages(formattedMessages);\n      } else {\n        setMessages([]);\n      }\n    } catch (error) {\n      console.error('Failed to load message history:', error);\n      toast.error('Failed to load message history');\n      setMessages([]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const sendMessage = async () => {\n    if (!newMessage.trim() || !contact || isSending) return;\n\n    const messageContent = newMessage.trim();\n    setNewMessage('');\n    setIsSending(true);\n\n    // Create temporary message with sending status\n    const tempMessage: Message = {\n      id: Date.now().toString(),\n      content: messageContent,\n      sender: 'user',\n      timestamp: new Date(),\n      status: 'sending'\n    };\n\n    setMessages(prev => [...prev, tempMessage]);\n\n    try {\n      // Format phone number to E.164 format\n      const formattedPhone = formatPhoneToE164(contact.contact_number);\n      \n      // Send SMS using the messaging service with selected phone number\n      const result = await sendSMSToContact({\n        toPhoneNumber: formattedPhone,\n        message: messageContent,\n        contactId: contact.id,\n        fromPhoneNumber: selectedFromNumber || undefined\n      });\n      \n      if (result.success) {\n        // Update message status to sent\n        setMessages(prev => \n          prev.map(msg => \n            msg.id === tempMessage.id \n              ? { ...msg, status: 'sent', messageId: result.messageId }\n              : msg\n          )\n        );\n        toast.success('Message sent successfully');\n      } else {\n        throw new Error(result.error || 'Failed to send message');\n      }\n    } catch (error) {\n      console.error('Failed to send message:', error);\n      \n      // Update message status to failed\n      setMessages(prev => \n        prev.map(msg => \n          msg.id === tempMessage.id \n            ? { ...msg, status: 'failed' }\n            : msg\n        )\n      );\n      \n      toast.error('Failed to send message');\n    } finally {\n      setIsSending(false);\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      sendMessage();\n    }\n  };\n\n  const getInitials = (email: string) => {\n    const name = email.split('@')[0];\n    return name.substring(0, 2).toUpperCase();\n  };\n\n  const formatTime = (date: Date) => {\n    const now = new Date();\n    const messageDate = new Date(date);\n\n    // Check if the message is from today\n    const isToday = now.toDateString() === messageDate.toDateString();\n\n    // Check if the message is from yesterday\n    const yesterday = new Date(now);\n    yesterday.setDate(yesterday.getDate() - 1);\n    const isYesterday = yesterday.toDateString() === messageDate.toDateString();\n\n    if (isToday) {\n      return messageDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    } else if (isYesterday) {\n      return `Yesterday ${messageDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;\n    } else {\n      // For older messages, show date and time\n      return messageDate.toLocaleDateString([], {\n        month: 'short',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    }\n  };\n\n  const getMessageStatusIcon = (status: Message['status']) => {\n    switch (status) {\n      case 'sending':\n        return <Loader2 className=\"h-3 w-3 animate-spin text-gray-400\" />;\n      case 'sent':\n        return <Check className=\"h-3 w-3 text-gray-400\" />;\n      case 'delivered':\n        return <CheckCheck className=\"h-3 w-3 text-blue-500\" />;\n      case 'failed':\n        return <AlertCircle className=\"h-3 w-3 text-red-500\" />;\n      default:\n        return null;\n    }\n  };\n\n  if (!contact) return null;\n\n  return (\n    <>\n      {/* Overlay */}\n      {isOpen && (\n        <div \n          className=\"fixed inset-0 bg-black/20 z-40 lg:hidden\"\n          onClick={onClose}\n        />\n      )}\n\n      {/* Sidebar */}\n      <div className={cn(\n        \"fixed top-0 right-0 h-full w-full sm:w-3/5 lg:w-1/2 xl:w-2/5 bg-white shadow-2xl z-50 transform transition-transform duration-300 ease-in-out flex flex-col border-l border-gray-200\",\n        isOpen ? \"translate-x-0\" : \"translate-x-full\"\n      )}>\n        {/* Header */}\n        <div className=\"p-6 border-b bg-gradient-to-r from-slate-50 via-blue-50 to-indigo-50 flex-shrink-0 shadow-sm\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"relative\">\n                <Avatar className=\"h-16 w-16 bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-600 shadow-lg ring-2 ring-white\">\n                  <AvatarFallback className=\"text-white font-bold text-xl\">\n                    {getInitials(contact.email)}\n                  </AvatarFallback>\n                </Avatar>\n                <div className=\"absolute -bottom-1 -right-1 h-5 w-5 bg-green-500 border-2 border-white rounded-full shadow-sm\"></div>\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <h3 className=\"font-bold text-gray-900 text-xl mb-1 truncate\">\n                  {contact.email.split('@')[0]}\n                </h3>\n                <div className=\"space-y-1.5\">\n                  <div className=\"flex items-center space-x-2 text-sm\">\n                    <div className=\"flex items-center space-x-1.5 bg-white/70 backdrop-blur-sm rounded-full px-2.5 py-1 shadow-sm\">\n                      <Mail className=\"h-3.5 w-3.5 text-blue-500\" />\n                      <span className=\"truncate font-medium text-gray-700 max-w-[200px]\">{contact.email}</span>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center space-x-2 text-sm\">\n                    <div className=\"flex items-center space-x-1.5 bg-white/70 backdrop-blur-sm rounded-full px-2.5 py-1 shadow-sm\">\n                      <Phone className=\"h-3.5 w-3.5 text-green-500\" />\n                      <span className=\"font-medium text-gray-700\">{formatPhoneForDisplay(contact.contact_number)}</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              {contact.list_name && (\n                <Badge variant=\"secondary\" className=\"text-xs bg-gradient-to-r from-blue-100 to-indigo-100 text-blue-700 border-blue-200 shadow-sm\">\n                  {contact.list_name}\n                </Badge>\n              )}\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setIsMinimized(!isMinimized)}\n                className=\"h-9 w-9 p-0 hover:bg-white/80 hover:shadow-sm rounded-full transition-all duration-200\"\n              >\n                {isMinimized ? <Maximize2 className=\"h-4 w-4 text-gray-600\" /> : <Minimize2 className=\"h-4 w-4 text-gray-600\" />}\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={onClose}\n                className=\"h-9 w-9 p-0 hover:bg-red-50 hover:shadow-sm text-gray-600 hover:text-red-600 rounded-full transition-all duration-200\"\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        {!isMinimized && (\n          <>\n            {/* Messages Area */}\n            <div className=\"flex-1 flex flex-col min-h-0\">\n              <div className=\"flex-1 overflow-y-auto p-6 bg-gradient-to-b from-gray-50/50 to-white\" style={{ maxHeight: 'calc(100vh - 280px)' }}>\n                {isLoading ? (\n                  <div className=\"flex flex-col items-center justify-center h-full text-gray-400\">\n                    <Loader2 className=\"h-8 w-8 animate-spin mb-4 text-blue-500\" />\n                    <p className=\"text-center text-sm\">Loading messages...</p>\n                  </div>\n                ) : messages.length === 0 ? (\n                  <div className=\"flex flex-col items-center justify-center h-full text-gray-400\">\n                    <div className=\"w-20 h-20 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mb-4 shadow-sm\">\n                      <MessageSquare className=\"h-10 w-10 text-blue-500\" />\n                    </div>\n                    <p className=\"text-center text-sm font-medium text-gray-600\">\n                      No messages yet\n                    </p>\n                    <p className=\"text-center text-xs text-gray-400 mt-1\">\n                      Start a conversation with {contact.email.split('@')[0]}!\n                    </p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {messages.map((message) => (\n                      <div\n                        key={message.id}\n                        className={cn(\n                          'flex',\n                          message.sender === 'user' ? 'justify-end' : 'justify-start'\n                        )}\n                      >\n                        <div\n                          className={cn(\n                            'max-w-[85%] rounded-2xl px-4 py-3 shadow-sm relative',\n                            message.sender === 'user'\n                              ? 'bg-gradient-to-r from-blue-500 to-indigo-600 text-white'\n                              : 'bg-white text-gray-900 border border-gray-200 shadow-md'\n                          )}\n                        >\n                          <p className=\"text-sm leading-relaxed\">{message.content}</p>\n                          <div className={cn(\n                            'flex items-center justify-end space-x-1.5 mt-2',\n                            message.sender === 'user' ? 'text-white/80' : 'text-gray-500'\n                          )}>\n                            <span className=\"text-xs font-medium\">{formatTime(message.timestamp)}</span>\n                            {message.sender === 'user' && getMessageStatusIcon(message.status)}\n                          </div>\n                          {/* Message tail */}\n                          <div className={cn(\n                            'absolute top-3 w-3 h-3 transform rotate-45',\n                            message.sender === 'user'\n                              ? 'bg-gradient-to-r from-blue-500 to-indigo-600 -right-1.5'\n                              : 'bg-white border-r border-b border-gray-200 -left-1.5'\n                          )} />\n                        </div>\n                      </div>\n                    ))}\n                    <div ref={messagesEndRef} />\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Message Input */}\n            <div className=\"p-6 border-t bg-gradient-to-r from-gray-50 to-white flex-shrink-0 shadow-lg\">\n              {/* Phone Number Selector or Add Phone Number Link */}\n              {phoneNumbers.length > 0 ? (\n                <div className=\"mb-4\">\n                  <label className=\"block text-sm font-semibold text-gray-700 mb-2 flex items-center space-x-2\">\n                    <Phone className=\"h-4 w-4 text-blue-500\" />\n                    <span>Send from phone number:</span>\n                  </label>\n                  <Select value={selectedFromNumber} onValueChange={setSelectedFromNumber}>\n                    <SelectTrigger className=\"w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500 rounded-lg shadow-sm\">\n                      <SelectValue placeholder=\"Select phone number\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {phoneNumbers.map((phone) => (\n                        <SelectItem key={phone.id} value={phone.number}>\n                          <div className=\"flex items-center space-x-2\">\n                            <span className=\"font-medium\">{formatPhoneForDisplay(phone.number)}</span>\n                            {phone.friendlyName && (\n                              <span className=\"text-gray-500 text-sm\">({phone.friendlyName})</span>\n                            )}\n                          </div>\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              ) : (\n                <div className=\"mb-4\">\n                  <label className=\"block text-sm font-semibold text-gray-700 mb-2 flex items-center space-x-2\">\n                    <Phone className=\"h-4 w-4 text-blue-500\" />\n                    <span>Phone number required to send SMS:</span>\n                  </label>\n                  <div className=\"flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors\">\n                    <Button\n                      onClick={() => setIsCreatePhoneModalOpen(true)}\n                      variant=\"ghost\"\n                      className=\"flex items-center space-x-2 text-blue-600 hover:text-blue-700 font-medium\"\n                    >\n                      <Plus className=\"h-4 w-4\" />\n                      <span>Add Phone Number</span>\n                    </Button>\n                  </div>\n                </div>\n              )}\n\n              <div className=\"flex items-end space-x-3\">\n                <div className=\"flex-1\">\n                  <Input\n                    value={newMessage}\n                    onChange={(e) => setNewMessage(e.target.value)}\n                    onKeyPress={handleKeyPress}\n                    placeholder={phoneNumbers.length === 0 ? \"Add a phone number to send messages...\" : \"Type your message...\"}\n                    className=\"w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500 rounded-xl px-4 py-3 shadow-sm resize-none\"\n                    disabled={isSending || phoneNumbers.length === 0}\n                  />\n                </div>\n                <Button\n                  onClick={sendMessage}\n                  disabled={!newMessage.trim() || isSending || !selectedFromNumber || phoneNumbers.length === 0}\n                  size=\"sm\"\n                  className=\"px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl shadow-md transition-all duration-200 hover:shadow-lg\"\n                >\n                  {isSending ? (\n                    <Loader2 className=\"h-5 w-5 animate-spin\" />\n                  ) : (\n                    <Send className=\"h-5 w-5\" />\n                  )}\n                </Button>\n              </div>\n              <div className=\"mt-3 flex items-center justify-between\">\n                <p className=\"text-xs text-gray-500 flex items-center space-x-1\">\n                  <MessageSquare className=\"h-3 w-3\" />\n                  <span>\n                    {selectedFromNumber\n                      ? `From ${formatPhoneForDisplay(selectedFromNumber)} to ${formatPhoneForDisplay(contact.contact_number)}`\n                      : `SMS to ${formatPhoneForDisplay(contact.contact_number)}`\n                    }\n                  </span>\n                </p>\n                {messages.length > 0 && (\n                  <p className=\"text-xs text-gray-400\">\n                    {messages.length} message{messages.length !== 1 ? 's' : ''}\n                  </p>\n                )}\n              </div>\n            </div>\n          </>\n        )}\n      </div>\n\n      {/* Create Phone Number Modal */}\n      <Dialog open={isCreatePhoneModalOpen} onOpenChange={setIsCreatePhoneModalOpen}>\n        <DialogContent className=\"max-w-7xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Create New Phone Number</DialogTitle>\n            <DialogDescription>\n              Get a free AI CRUITMENT phone number to send SMS messages.\n            </DialogDescription>\n          </DialogHeader>\n          <CreatePhoneNumberForm\n            onSuccess={() => {\n              setIsCreatePhoneModalOpen(false);\n              // Reload phone numbers after successful creation\n              loadPhoneNumbers();\n            }}\n            onCancel={() => setIsCreatePhoneModalOpen(false)}\n          />\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n};\n\nexport default ChatSidebar;\n"],"names":["ChatSidebar","isOpen","contact","onClose","messages","setMessages","useState","newMessage","setNewMessage","isLoading","setIsLoading","isSending","setIsSending","isMinimized","setIsMinimized","phoneNumbers","setPhoneNumbers","selectedFromNumber","setSelectedFromNumber","isCreatePhoneModalOpen","setIsCreatePhoneModalOpen","messagesEndRef","useRef","scrollToBottom","_a","useEffect","loadMessageHistory","pollInterval","lastMessage","lastMessageId","response","checkNewIncomingMessages","newMessages","msg","prev","toast","error","loadPhoneNumbers","getAllPhoneNumbers","getContactMessages","formattedMessages","sendMessage","messageContent","tempMessage","formattedPhone","formatPhoneToE164","result","sendSMSToContact","handleKeyPress","e","getInitials","email","formatTime","date","now","messageDate","isToday","yesterday","isYesterday","getMessageStatusIcon","status","jsx","Loader2","Check","CheckCheck","AlertCircle","jsxs","Fragment","cn","Avatar","AvatarFallback","Mail","Phone","formatPhoneForDisplay","Badge","Button","Maximize2","Minimize2","X","MessageSquare","message","Select","SelectTrigger","SelectValue","SelectContent","phone","SelectItem","Plus","Input","Send","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","CreatePhoneNumberForm"],"mappings":"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"}