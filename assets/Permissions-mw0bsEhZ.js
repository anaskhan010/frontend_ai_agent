import{j as e,cu as C,az as k,D as U,O as I,aB as K,S as M,H as O,T as Y}from"./ui-S570Xcny.js";import{r as _}from"./vendor-DG599jyl.js";import{b as W}from"./query-Cab5P5bd.js";import{P as X}from"./Page-BJWqKr2O.js";import{H as E}from"./Header-BSPv7FNt.js";import{B as A}from"./badge-ij7fArnn.js";import{S as x}from"./skeleton-DCCxw5XX.js";import{C as T,b as S,c as L,a as q,d as G}from"./card-DMfGhRm1.js";import{T as J,a as Z,b as B,c as p,d as ee,e as c}from"./table-Beiyegzh.js";import{T as se,a as re,b as R,c as ae}from"./tabs-CbOWgAXT.js";import{u as te,a as V,d as z,t as D}from"./index-YNP4OU4_.js";import{L as ie}from"./Loading-DqfgU-VE.js";import{c as H,b as ne,B as $}from"./button-BSd9MMPp.js";import{a as le,N as v}from"./router-BavLd_S0.js";import"./scroll-area-C-pzVjaj.js";import"./index-BHBJ6RT-.js";import"./index-CWMUKvWL.js";import"./sheet-C7DsuPAk.js";const ce=ne("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),N=_.forwardRef(({className:t,variant:n,...a},h)=>e.jsx("div",{ref:h,role:"alert",className:H(ce({variant:n}),t),...a}));N.displayName="Alert";const de=_.forwardRef(({className:t,...n},a)=>e.jsx("h5",{ref:a,className:H("mb-1 font-medium leading-none tracking-tight",t),...n}));de.displayName="AlertTitle";const y=_.forwardRef(({className:t,...n},a)=>e.jsx("div",{ref:a,className:H("text-sm [&_p]:leading-relaxed",t),...n}));y.displayName="AlertDescription";const oe=({children:t,permission:n,permissions:a,requireAll:h=!1,role:r,roles:d,requireSuperAdmin:j=!1,redirectTo:f="/login",showError:o=!0})=>{const{isLoggedIn:w,loading:m}=te(),{hasPermission:b,hasAnyPermission:s,hasAllPermissions:u,role:l,isSuperAdmin:g,loading:P}=V(),i=le();return m||P?e.jsx(ie,{}):w?j&&!g?o?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(N,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(y,{children:"Super admin privileges required to access this page."})]})}):e.jsx(v,{to:"/dashboard",replace:!0}):r&&(!l||l.name!==r)?o?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(N,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(y,{children:`${r} role required to access this page.`})]})}):e.jsx(v,{to:"/dashboard",replace:!0}):d&&d.length>0&&(!l||!d.includes(l.name))?o?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(N,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(y,{children:`One of the following roles required: ${d.join(", ")}`})]})}):e.jsx(v,{to:"/dashboard",replace:!0}):n&&!b(n)?o?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(N,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(y,{children:"You don't have permission to access this page."})]})}):e.jsx(v,{to:"/dashboard",replace:!0}):a&&a.length>0&&!(h?u(a):s(a))?o?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs(N,{variant:"destructive",className:"max-w-md",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx(y,{children:"You don't have the required permissions to access this page."})]})}):e.jsx(v,{to:"/dashboard",replace:!0}):e.jsx(e.Fragment,{children:t}):e.jsx(v,{to:f,state:{from:i},replace:!0})},F=({children:t,permission:n,permissions:a,requireAll:h=!1,role:r,roles:d,requireSuperAdmin:j=!1,fallback:f,hideWhenNoAccess:o=!1,disabled:w,...m})=>{const{hasPermission:b,hasAnyPermission:s,hasAllPermissions:u,role:l,isSuperAdmin:g,loading:P}=V();if(P)return e.jsx($,{disabled:!0,...m,children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-300"})});let i=!0;return j&&!g&&(i=!1),i&&r&&(!l||l.name!==r)&&(i=!1),i&&d&&d.length>0&&(!l||!d.includes(l.name))&&(i=!1),i&&n&&!b(n)&&(i=!1),i&&a&&a.length>0&&((h?u(a):s(a))||(i=!1)),!i&&o?null:!i&&f?e.jsx(e.Fragment,{children:f}):e.jsx($,{disabled:w||!i,...m,children:t})},me=async()=>(await z.get("/api/permissions")).data.data,qe=()=>{const[t,n]=_.useState(""),[a,h]=_.useState("all"),{data:r,isLoading:d,error:j,refetch:f}=W({queryKey:["permissions"],queryFn:me}),o=s=>{n(s)},w=async(s,u)=>{var l,g;if(window.confirm(`Are you sure you want to delete the permission "${u}"?`))try{await z.delete(`/api/permissions/${s}`),D.success("Permission deleted successfully"),f()}catch(P){D.error(((g=(l=P.response)==null?void 0:l.data)==null?void 0:g.message)||"Failed to delete permission")}};if(j)return console.error("Error fetching permissions",j),e.jsx("div",{children:"Error loading permissions"});let m=(r==null?void 0:r.filter(s=>s.name.toLowerCase().includes(t.toLowerCase())||s.display_name.toLowerCase().includes(t.toLowerCase())||s.description.toLowerCase().includes(t.toLowerCase())||s.category.toLowerCase().includes(t.toLowerCase())))||[];a!=="all"&&(m=m.filter(s=>s.category.toLowerCase()===a.toLowerCase()));const b=[...new Set((r==null?void 0:r.map(s=>s.category))||[])];return e.jsx(oe,{requireSuperAdmin:!0,children:e.jsxs(X,{children:[e.jsx(E,{title:"Permission Management",buttonText:"Create Permission",filterByName:!0,filterWord:t,onFilterChange:o,useSheet:!1,showViewToggle:!1,showFilters:!1}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(A,{variant:"secondary",className:"px-3 py-1",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),e.jsxs("span",{children:[m.length," Permissions"]})]})}),e.jsxs(F,{requireSuperAdmin:!0,className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Create Permission"]})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(T,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Total Permissions"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(q,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All permissions"})]})]}),e.jsxs(T,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"System Permissions"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(q,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.filter(s=>s.is_system_permission).length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Built-in permissions"})]})]}),e.jsxs(T,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Custom Permissions"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(q,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.filter(s=>!s.is_system_permission).length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"User-created permissions"})]})]}),e.jsxs(T,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Categories"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(q,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Permission categories"})]})]})]}),e.jsxs(T,{children:[e.jsxs(S,{children:[e.jsx(L,{children:"Permissions"}),e.jsx(G,{children:"Manage system permissions and their assignments"})]}),e.jsx(q,{children:e.jsxs(se,{value:a,onValueChange:h,children:[e.jsxs(re,{className:"grid w-full grid-cols-5",children:[e.jsx(R,{value:"all",children:"All"}),e.jsx(R,{value:"pages",children:"Pages"}),e.jsx(R,{value:"users",children:"Users"}),e.jsx(R,{value:"roles",children:"Roles"}),e.jsx(R,{value:"system",children:"System"})]}),e.jsx(ae,{value:a,className:"mt-4",children:e.jsxs(J,{children:[e.jsx(Z,{children:e.jsxs(B,{children:[e.jsx(p,{children:"Permission"}),e.jsx(p,{children:"Resource"}),e.jsx(p,{children:"Action"}),e.jsx(p,{children:"Category"}),e.jsx(p,{children:"Type"}),e.jsx(p,{children:"Actions"})]})}),e.jsx(ee,{children:d?Array.from({length:8}).map((s,u)=>e.jsxs(B,{children:[e.jsx(c,{children:e.jsxs("div",{children:[e.jsx(x,{className:"h-4 w-32 mb-1"}),e.jsx(x,{className:"h-3 w-24"})]})}),e.jsx(c,{children:e.jsx(x,{className:"h-6 w-16"})}),e.jsx(c,{children:e.jsx(x,{className:"h-6 w-16"})}),e.jsx(c,{children:e.jsx(x,{className:"h-4 w-20"})}),e.jsx(c,{children:e.jsx(x,{className:"h-6 w-20"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-8 w-8"}),e.jsx(x,{className:"h-8 w-8"})]})})]},`permission-skeleton-${u}`)):m.map(s=>e.jsxs(B,{children:[e.jsx(c,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.display_name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.name})]})}),e.jsx(c,{children:e.jsx(A,{variant:"outline",children:s.resource})}),e.jsx(c,{children:e.jsx(A,{variant:"secondary",children:s.action})}),e.jsx(c,{children:e.jsx(A,{variant:"default",children:s.category})}),e.jsx(c,{children:e.jsx(A,{variant:s.is_system_permission?"secondary":"default",children:s.is_system_permission?"System":"Custom"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{requireSuperAdmin:!0,size:"sm",variant:"outline",children:e.jsx(O,{className:"h-3 w-3"})}),!s.is_system_permission&&e.jsx(F,{requireSuperAdmin:!0,size:"sm",variant:"outline",onClick:()=>w(s.id,s.display_name),children:e.jsx(Y,{className:"h-3 w-3"})})]})})]},s.id))})]})})]})})]})]})]})})};export{qe as default};
//# sourceMappingURL=Permissions-mw0bsEhZ.js.map
