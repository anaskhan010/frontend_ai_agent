import{j as e,bB as C,aM as pe,aT as I,bl as ge,F as se,N as fe,U as je,b as ye,H as Ne,J as be,T as we}from"./ui-C7wuVsKo.js";import{r as i}from"./vendor-DG599jyl.js";import{u as re,b as Q,c as R}from"./query-BI4h7QWD.js";import{t as U}from"./index-DMttttgJ.js";import{P as ae}from"./Page-CldTp-5P.js";import{H as ve}from"./Header-BRJJ4ZAA.js";import{C as w,b as z,c as G,d as J,a as v}from"./card-aEf8HYk2.js";import{T as Ce,a as ke,b as V,c as j,d as Se,e as g}from"./table-D230vnLP.js";import{B as k}from"./button-DAfv1lEn.js";import{B as D}from"./badge-DTmq5TA0.js";import{D as De,a as Ae,b as Te,e as P}from"./dropdown-menu-owisP8lR.js";import{A as Fe,a as We,b as Ie,c as Ve,d as Pe,e as Ee,f as Me,g as qe}from"./alert-dialog-DD7FFbNx.js";import{I as te}from"./input-qfwdyloT.js";import{S as E}from"./skeleton-ZzkV4DK4.js";import{g as Be,a as Le,t as Ke,i as Oe,e as $e}from"./workflowService-BsufutIu.js";import{V as ne}from"./vapiService-CUqbHbWk.js";import{u as He}from"./resolvers-BzctgYTE.js";import{t as Qe,o as Re,s as S,F as Ue,a as M,b as q,c as B,d as L,f as K,e as O}from"./index-BiIeOYtX.js";import{T as ze}from"./textarea-DHW21YBW.js";import{S as Ge,a as Je,b as Ye,c as _e,d as $}from"./select-CsZI97Jz.js";import{e as Xe}from"./agentService-DBoSe9hF.js";import{u as le}from"./router-BavLd_S0.js";import"./scroll-area-DnO9GNsc.js";import"./index-DUGBtJKR.js";import"./index-CyKAHSi_.js";import"./sheet-Co2P1ukb.js";import"./label-BXa85Llt.js";import"./index-HDeFwIcs.js";function Ze(n,o){const[l,h]=i.useState(n);return i.useEffect(()=>{const t=setTimeout(()=>{h(n)},o);return()=>{clearTimeout(t)}},[n,o]),l}function es(){const n=i.useRef(null),o=i.useCallback(t=>{t.preventDefault()},[]),l=i.useCallback(t=>{t.preventDefault(),n.current&&n.current.focus()},[]),h=i.useCallback(t=>{t.key==="Escape"&&(t.preventDefault(),n.current&&n.current.focus())},[]);return{triggerRef:n,handleOpenAutoFocus:o,handleCloseAutoFocus:l,handleKeyDown:h,contentProps:{onOpenAutoFocus:o,onCloseAutoFocus:l,onKeyDown:h},triggerProps:{ref:n}}}function H(n,o="activate"){return{"aria-label":`${o} ${n}`,role:"menuitem"}}function ss(n){return{"aria-label":`Actions for ${n}`,"aria-haspopup":"menu","aria-expanded":!1}}const as=Re({name:S().min(1,"Name is required").max(80,"Name must be 80 characters or less"),description:S().optional(),template:S().optional(),assistantId:S().optional()}),rs=()=>{const n=le(),o=re(),[l,h]=i.useState(null),t=He({resolver:Qe(as),defaultValues:{name:"",description:"",template:""}}),{data:x,isLoading:u}=Q({queryKey:["workflow-templates"],queryFn:Be}),{data:f,isLoading:A}=Q({queryKey:["agents-all"],queryFn:()=>Xe("")}),y=R({mutationFn:ne.createWorkflow,onSuccess:a=>{console.log("VAPI Workflow creation response:",a),o.invalidateQueries({queryKey:["workflows"]}),U.success("Workflow created successfully");const r=a==null?void 0:a.id;console.log("Navigating to workflow:",r),n(`/workflows/${r}/edit`)},onError:a=>{var r,d;console.error("VAPI Workflow creation error:",a),U.error(((d=(r=a.response)==null?void 0:r.data)==null?void 0:d.message)||"Failed to create workflow")}}),T=a=>{let r={name:a.name,description:a.description,assistantId:a.assistantId==="none"?void 0:a.assistantId};l?r={...r,nodes:l.nodes,edges:l.edges}:r={...r,nodes:[{type:"conversation",name:"start",isStart:!0,prompt:"You are a helpful AI assistant. Greet the user and ask how you can help them today."}],edges:[]},y.mutate(r)},p=a=>{var d;const r=(d=x==null?void 0:x.data)==null?void 0:d.find(F=>F.id===a);h(r||null),t.setValue("template",a),r&&(t.getValues("name")||t.setValue("name",r.name),t.getValues("description")||t.setValue("description",r.description))},N=(x==null?void 0:x.data)||[];return e.jsxs("div",{className:"space-y-6 h-full overflow-y-auto p-1",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-4 border-b border-gray-200",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(C,{className:"h-4 w-4 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Create New Workflow"})]}),e.jsx(Ue,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(T),className:"space-y-6",children:[e.jsxs(w,{className:"border border-gray-200 shadow-sm",children:[e.jsxs(z,{className:"pb-4",children:[e.jsx(G,{className:"text-lg font-medium text-gray-900",children:"Basic Information"}),e.jsx(J,{className:"text-gray-600",children:"Provide basic details for your workflow"})]}),e.jsxs(v,{className:"space-y-4 pt-0",children:[e.jsx(M,{control:t.control,name:"name",render:({field:a})=>e.jsxs(q,{children:[e.jsx(B,{children:"Name *"}),e.jsx(L,{children:e.jsx(te,{placeholder:"Enter workflow name",...a})}),e.jsx(K,{children:"A descriptive name for your workflow (max 80 characters)"}),e.jsx(O,{})]})}),e.jsx(M,{control:t.control,name:"description",render:({field:a})=>e.jsxs(q,{children:[e.jsx(B,{children:"Description"}),e.jsx(L,{children:e.jsx(ze,{placeholder:"Describe what this workflow does...",className:"resize-none",rows:3,...a})}),e.jsx(K,{children:"Optional description to help you remember the workflow's purpose"}),e.jsx(O,{})]})}),e.jsx(M,{control:t.control,name:"assistantId",render:({field:a})=>{var r;return e.jsxs(q,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-primary"}),"Select Agent (Optional)"]}),e.jsxs(Ge,{onValueChange:a.onChange,value:a.value,children:[e.jsx(L,{children:e.jsx(Je,{children:e.jsx(Ye,{placeholder:"Choose an agent for this workflow"})})}),e.jsxs(_e,{children:[e.jsx($,{value:"none",children:"No Agent (Create from workflow)"}),A?e.jsxs($,{value:"loading",disabled:!0,children:[e.jsx(I,{className:"h-4 w-4 animate-spin mr-2"}),"Loading agents..."]}):(r=f==null?void 0:f.data)==null?void 0:r.map(d=>e.jsx($,{value:d.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4 text-green-600"}),d.name]})},d.id))]})]}),e.jsx(K,{children:"Select an existing agent to use with this workflow, or leave empty to create one automatically"}),e.jsx(O,{})]})}})]})]}),e.jsxs(w,{className:"border border-gray-200 shadow-sm",children:[e.jsxs(z,{className:"pb-4",children:[e.jsxs(G,{className:"flex items-center gap-2 text-lg font-medium text-gray-900",children:[e.jsx(se,{className:"h-4 w-4 text-gray-600"}),"Choose Template"]}),e.jsx(J,{className:"text-gray-600",children:"Start with a pre-built template or create from scratch"})]}),e.jsx(v,{className:"pt-0",children:u?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(I,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading templates..."})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(w,{className:`cursor-pointer transition-all duration-200 border ${l?"hover:bg-gray-50 hover:border-gray-300 border-gray-200":"ring-2 ring-blue-500 bg-blue-50 border-blue-200"}`,onClick:()=>{h(null),t.setValue("template","")},children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(C,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium",children:"Blank Workflow"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Start from scratch"})]})]})})}),N.map(a=>{var r;return e.jsx(w,{className:`cursor-pointer transition-all duration-200 border ${(l==null?void 0:l.id)===a.id?"ring-2 ring-blue-500 bg-blue-50 border-blue-200":"hover:bg-gray-50 hover:border-gray-300 border-gray-200"}`,onClick:()=>p(a.id),children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium",children:a.name}),e.jsx(D,{variant:"outline",className:"text-xs",children:a.category})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.description}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:e.jsxs(D,{variant:"secondary",className:"text-xs",children:[((r=a.nodes)==null?void 0:r.length)||0," nodes"]})})]})]})})},a.id)})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>t.reset(),className:"px-6",children:"Reset"}),e.jsx(k,{type:"submit",disabled:y.isPending,className:"min-w-[140px] px-6 bg-blue-600 hover:bg-blue-700",children:y.isPending?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Workflow"})]})]})})]})},Is=()=>{var _,X,Z,ee;const n=le(),o=re(),[l,h]=i.useState(""),[t,x]=i.useState(!1),[u,f]=i.useState(null),[A,y]=i.useState("list"),[T,p]=i.useState(null),N=Ze(l,300),a=es();i.useEffect(()=>{t&&p(null)},[t]);const{data:r,isLoading:d,error:F}=Q({queryKey:["workflows",N],queryFn:()=>Le(1,N)}),W=R({mutationFn:ne.deleteWorkflow,onSuccess:()=>{o.invalidateQueries({queryKey:["workflows"]}),x(!1),f(null),p(null)},onError:()=>{p(null)}});R({mutationFn:({id:s})=>Ke(s),onSuccess:()=>{U.success("Workflow test initiated successfully")}});const Y=s=>{h(s)},oe=s=>{p(null),f(s),x(!0)},ie=()=>{u!=null&&u.id&&W.mutate(u.id)},ce=s=>{n(`/workflows/${s.id}/edit`)},de=s=>{n(`/workflows/${s.id}`)},me=async s=>{if(s.id)try{await $e(s.id)}catch(c){console.error("Export failed:",c)}},xe=async s=>{var b;const c=(b=s.target.files)==null?void 0:b[0];if(c)try{await Oe(c),o.invalidateQueries({queryKey:["workflows"]})}catch(m){console.error("Import failed:",m)}s.target.value=""},he=s=>{const c={active:"bg-green-100 text-green-800",inactive:"bg-gray-100 text-gray-800",draft:"bg-yellow-100 text-yellow-800",archived:"bg-red-100 text-red-800"};return e.jsx(D,{className:c[s]||c.inactive,children:s})},ue=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return F?e.jsx(ae,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-2",children:"Failed to load workflows"}),e.jsx(k,{onClick:()=>o.invalidateQueries({queryKey:["workflows"]}),children:"Try Again"})]})})}):e.jsxs(ae,{children:[e.jsx(ve,{title:"Workflows",buttonText:"Create Workflow",filterByName:!0,filterWord:N,onFilterChange:Y,useSheet:!0,sheetContent:e.jsx(rs,{}),sheetSize:"xl",viewMode:A,onViewModeChange:y,showViewToggle:!0}),e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(te,{placeholder:"Search workflows...",value:l,onChange:s=>Y(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",accept:".json",onChange:xe,className:"hidden",id:"import-workflow"}),e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{var s;return(s=document.getElementById("import-workflow"))==null?void 0:s.click()},children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Import"]})]})]}),e.jsxs(w,{className:"border-0 shadow-none bg-transparent",children:[e.jsxs(z,{className:"px-0 pb-4",children:[e.jsxs(G,{className:"flex items-center gap-2 text-xl font-semibold",children:[e.jsx(C,{className:"h-5 w-5"}),"Workflows"]}),e.jsx(J,{className:"text-gray-500",children:"Manage your voice AI workflows and conversation flows"})]}),e.jsx(v,{className:"px-0",children:d?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,c)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(E,{className:"h-12 w-12 rounded"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(E,{className:"h-4 w-[250px]"}),e.jsx(E,{className:"h-4 w-[200px]"})]})]},c))}):e.jsx("div",{className:"rounded-lg border bg-white",children:e.jsxs(Ce,{children:[e.jsx(ke,{children:e.jsxs(V,{className:"border-b bg-gray-50/50",children:[e.jsx(j,{className:"font-medium text-gray-900",children:"Name"}),e.jsx(j,{className:"font-medium text-gray-900",children:"Description"}),e.jsx(j,{className:"font-medium text-gray-900",children:"Nodes"}),e.jsx(j,{className:"font-medium text-gray-900",children:"Status"}),e.jsx(j,{className:"font-medium text-gray-900",children:"Last Modified"}),e.jsx(j,{className:"text-right font-medium text-gray-900",children:"Actions"})]})}),e.jsxs(Se,{children:[(X=(_=r==null?void 0:r.data)==null?void 0:_.workflows)==null?void 0:X.map(s=>{var c,b;return e.jsxs(V,{className:"cursor-pointer hover:bg-gray-50/50",onClick:()=>de(s),children:[e.jsx(g,{className:"font-medium py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(C,{className:"h-4 w-4 text-blue-600"})}),e.jsx("span",{className:"text-gray-900",children:s.name})]})}),e.jsx(g,{className:"text-gray-600 py-4",children:s.description||"No description"}),e.jsx(g,{className:"py-4",children:e.jsxs(D,{variant:"secondary",className:"bg-gray-100 text-gray-700 hover:bg-gray-100",children:[((c=s.nodes)==null?void 0:c.length)||0," nodes"]})}),e.jsx(g,{className:"py-4",children:he(((b=s.localData)==null?void 0:b.status)||"active")}),e.jsx(g,{className:"text-gray-600 py-4",children:s.updatedAt?ue(s.updatedAt):"N/A"}),e.jsx(g,{className:"text-right py-4",children:e.jsxs(De,{open:T===s.id,onOpenChange:m=>p(m&&s.id||null),children:[e.jsx(Ae,{asChild:!0,onClick:m=>m.stopPropagation(),...a.triggerProps,children:e.jsx(k,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-gray-100",...ss(s.name),children:e.jsx(ye,{className:"h-4 w-4"})})}),e.jsxs(Te,{align:"end",...a.contentProps,children:[e.jsxs(P,{onClick:m=>{m.stopPropagation(),ce(s)},...H(s.name,"Edit"),children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(P,{onClick:m=>{m.stopPropagation(),me(s)},...H(s.name,"Export"),children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Export"]}),e.jsxs(P,{onClick:m=>{m.stopPropagation(),oe(s)},className:"text-red-600",...H(s.name,"Delete"),children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},s.id)}),((ee=(Z=r==null?void 0:r.data)==null?void 0:Z.workflows)==null?void 0:ee.length)===0&&e.jsx(V,{children:e.jsx(g,{colSpan:6,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(C,{className:"h-8 w-8 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No workflows found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Create your first workflow to get started"})]})})})]})]})})})]}),e.jsx(Fe,{open:t,onOpenChange:x,children:e.jsxs(We,{children:[e.jsxs(Ie,{children:[e.jsx(Ve,{children:"Delete Workflow"}),e.jsxs(Pe,{children:['Are you sure you want to delete "',u==null?void 0:u.name,'"? This action cannot be undone.']})]}),e.jsxs(Ee,{children:[e.jsx(Me,{children:"Cancel"}),e.jsx(qe,{onClick:ie,className:"bg-red-600 hover:bg-red-700",disabled:W.isPending,children:W.isPending?"Deleting...":"Delete"})]})]})}),!1]})};export{Is as default};
//# sourceMappingURL=Workflows-By1dtCgL.js.map
