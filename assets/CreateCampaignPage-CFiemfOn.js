import{j as e,k as re,b7 as B,aT as u,b6 as le,az as O,y as ne}from"./ui-C7wuVsKo.js";import{r as c}from"./vendor-DG599jyl.js";import{u as ie,b as j,c as ce}from"./query-BI4h7QWD.js";import{B as Q}from"./button-DAfv1lEn.js";import{I as de}from"./input-qfwdyloT.js";import{L as l}from"./label-BXa85Llt.js";import{S as F,a as I,b as P,c as A,d}from"./select-CsZI97Jz.js";import{R as z,a as N}from"./radio-group-C8CCrMBB.js";import{u as me,t as o}from"./index-CUjvNcD6.js";import{P as oe}from"./Page-CldTp-5P.js";import{e as xe}from"./campaignService-BpwqbK_I.js";import{h as ue}from"./agentService-iu3dQ7HS.js";import{g as he}from"./phoneNumberService-snmx0IUq.js";import{b as ge,e as pe}from"./contactService-CRX7Ny9R.js";import{u as je}from"./router-BavLd_S0.js";import"./index-DUGBtJKR.js";import"./index-HDeFwIcs.js";import"./scroll-area-DnO9GNsc.js";import"./index-CyKAHSi_.js";function Me(){var R,K,U,$;const q=je(),[f,G]=c.useState(""),[W,H]=c.useState("manual"),[b,J]=c.useState(""),[y,X]=c.useState(""),[x,p]=c.useState([]),[a,Y]=c.useState(""),[Z,D]=c.useState("now"),[k,ee]=c.useState(!1),se=ie(),{user:h}=me(),{data:v,isLoading:E}=j({queryKey:["assistants","vapi",h==null?void 0:h.id],queryFn:()=>ue(),retry:1,enabled:!!(h!=null&&h.id)}),{data:w,isLoading:T}=j({queryKey:["phoneNumbers"],queryFn:()=>he(),retry:1}),{data:C,isLoading:V}=j({queryKey:["contactLists"],queryFn:()=>ge(),retry:1}),{data:t,isLoading:L}=j({queryKey:["listContacts",a],queryFn:()=>pe(a),enabled:!!a,retry:1});c.useEffect(()=>{var s,r;if(console.log("Contacts data received:",t),t!=null&&t.success&&((s=t==null?void 0:t.data)!=null&&s.contacts)){const n=t.data.contacts;console.log("Processing contacts array:",n);const g=n.map(i=>({name:`${i.firstName||i.first_name||""} ${i.lastName||i.last_name||""}`.trim()||i.fullName||i.email||"Unknown",number:i.contact_number||i.phoneNumber||i.phone,email:i.email||""}));console.log("Mapped contacts:",g),p(g)}else t&&!t.success?(console.log("API error response:",t),p([])):a&&t&&t.success&&(!((r=t.data)!=null&&r.contacts)||t.data.contacts.length===0)&&(console.log("Empty list detected"),p([]))},[t,a]);const S=ce({mutationFn:xe,onSuccess:s=>{se.invalidateQueries({queryKey:["outboundCampaigns"]});const r=(s==null?void 0:s.message)||"Campaign created successfully";o.success(r),q("/outbound")},onError:s=>{var r,n;o.error(((n=(r=s.response)==null?void 0:r.data)==null?void 0:n.message)||"Failed to create campaign")}}),ae=s=>{Y(s),p([])},te=()=>{if(!f.trim()){o.error("Campaign name is required");return}if(!b){o.error("Phone number is required");return}if(!y){o.error("Assistant is required");return}if(!a){o.error("Please select a contact list");return}if(x.length===0){o.error("Selected list has no contacts");return}const s=x.filter(n=>{const g=n.number;return!g||!g.startsWith("+")||!/^\+[1-9]\d{1,14}$/.test(g)});if(s.length>0){o.error(`Invalid phone numbers found. Please ensure all numbers are in E.164 format (e.g., +1234567890). Found ${s.length} invalid numbers.`);return}const r={name:f,phoneNumberId:b,assistantId:y,customers:x,autoLaunch:k};console.log("Creating campaign with data:",r),S.mutate(r)},_=(v==null?void 0:v.data)||[],M=(w==null?void 0:w.data)||[],m=(C==null?void 0:C.data)||[];return e.jsx(oe,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Q,{variant:"ghost",size:"sm",onClick:()=>q("/outbound"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[e.jsx(re,{className:"h-4 w-4"}),"Back to Outbound"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Create Campaign"}),e.jsxs("p",{className:"text-muted-foreground",children:["Create a new outbound campaign • Contacts loaded: ",x.length,a&&m.length>0&&e.jsxs("span",{className:"ml-2",children:['from "',((R=m.find(s=>s.id===a))==null?void 0:R.listName)||((K=m.find(s=>s.id===a))==null?void 0:K.list_name),'"']})]})]})]})}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-1/2",children:e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"campaign-name",className:"text-sm font-medium text-gray-700",children:"Campaign Name"}),e.jsx(de,{id:"campaign-name",placeholder:"Campaign Name",value:f,onChange:s=>G(s.target.value),className:"w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex flex-col space-y-3",children:[e.jsx(l,{className:"text-sm font-medium text-gray-700",children:"Campaign Type"}),e.jsxs(z,{value:W,onValueChange:H,className:"flex items-start space-x-8 border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:" flex items-start space-x-2",children:[e.jsx(N,{value:"manual",id:"manual",className:"mt-1 text-blue-600"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{htmlFor:"manual",className:"font-medium cursor-pointer text-gray-900",children:"Manual"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Start campaign now or schedule for later"})]})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(N,{value:"live",id:"live",className:"mt-1 text-blue-600"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{htmlFor:"live",className:"font-medium cursor-pointer text-gray-900",children:"Live"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Triggered via webhooks from your website or forms"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{htmlFor:"phone-number",className:"text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:"From AI CRUITMENT"})]})]}),e.jsxs(F,{value:b,onValueChange:J,children:[e.jsx(I,{className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(P,{placeholder:T?"Loading...":"Select phone number"})}),e.jsx(A,{children:T?e.jsxs(d,{value:"loading",disabled:!0,children:[e.jsx(u,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):M.length===0?e.jsx(d,{value:"no-numbers",disabled:!0,children:"No phone numbers available"}):M.map(s=>e.jsx(d,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.number||s.twilioPhoneNumber}),s.name&&e.jsx("span",{className:"text-xs text-gray-500",children:s.name})]})},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{htmlFor:"contact-list",className:"text-sm font-medium text-gray-700",children:"Contact List"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:"From Lists"})]})]}),e.jsxs(F,{value:a,onValueChange:ae,children:[e.jsx(I,{className:"border-gray-300 ",children:e.jsx(P,{placeholder:V?"Loading...":"Select contact list"})}),e.jsx(A,{children:V?e.jsxs(d,{value:"loading",disabled:!0,children:[e.jsx(u,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):m.length===0?e.jsx(d,{value:"no-lists",disabled:!0,children:"No contact lists available"}):m.map(s=>e.jsx(d,{value:s.id,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-6 w-6 bg-gradient-to-br from-primary/20 to-primary/10 rounded flex items-center justify-center",children:e.jsx(le,{className:"h-3 w-3 text-primary"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.listName||s.list_name}),e.jsxs("span",{className:"text-xs text-gray-500",children:[e.jsx(O,{className:"h-3 w-3 inline mr-1"}),s.contactCount||s.contacts_count||0," contacts"]})]})]})},s.id))})]}),a&&L&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsx(u,{className:"h-4 w-4 animate-spin text-blue-600"}),e.jsx("span",{className:"text-sm text-blue-800",children:"Loading contacts..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{htmlFor:"assistant",className:"text-sm font-medium text-gray-700",children:"Assistant"}),e.jsx("span",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:"From AI CRUITMENT"})]}),e.jsxs(F,{value:y,onValueChange:X,children:[e.jsx(I,{className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",children:e.jsx(P,{placeholder:E?"Loading...":"Select assistant"})}),e.jsx(A,{children:E?e.jsxs(d,{value:"loading",disabled:!0,children:[e.jsx(u,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):_.length===0?e.jsx(d,{value:"no-assistants",disabled:!0,children:"No assistants available"}):_.map(s=>{var r,n;return e.jsx(d,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),((r=s.model)==null?void 0:r.model)&&e.jsxs("span",{className:"text-xs text-gray-500",children:[s.model.model," • ",((n=s.voice)==null?void 0:n.voiceId)||"Default Voice"]})]})},s.id)})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{className:"text-sm font-medium text-gray-700",children:"Choose when to send"}),e.jsxs(z,{value:Z,onValueChange:D,className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{value:"now",id:"send-now",className:"text-blue-600"}),e.jsx(l,{htmlFor:"send-now",className:"cursor-pointer text-gray-900",children:"Send Now"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{value:"later",id:"send-later",className:"text-blue-600"}),e.jsx(l,{htmlFor:"send-later",className:"cursor-pointer text-gray-900",children:"Schedule for later"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4 border-t border-gray-200",children:[e.jsx("input",{type:"checkbox",id:"auto-launch",checked:k,onChange:s=>ee(s.target.checked),className:"h-4 w-4 text-teal-600 focus:ring-teal-500 border-gray-300 rounded"}),e.jsx(l,{htmlFor:"auto-launch",className:"text-sm text-gray-700 cursor-pointer",children:"Automatically launch campaign after creation"})]}),e.jsxs(Q,{onClick:te,disabled:S.isPending,className:"w-full bg-teal-600 hover:bg-teal-700 text-white py-3 text-base font-medium rounded-lg",children:[S.isPending&&e.jsx(u,{className:"h-4 w-4 mr-2 animate-spin"}),"Launch campaign"]})]})})}),e.jsx("div",{className:"w-1/2",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Contact Preview"}),e.jsx("p",{className:"text-sm text-gray-500",children:a?L?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-4 w-4 animate-spin"}),"Loading contacts..."]}):e.jsxs(e.Fragment,{children:[x.length," contacts from selected list",a&&m.length>0&&e.jsxs("span",{className:"ml-1 font-medium",children:['"',((U=m.find(s=>s.id===a))==null?void 0:U.listName)||(($=m.find(s=>s.id===a))==null?void 0:$.list_name),'"']})]}):"Select a list to preview contacts"})]}),e.jsx("div",{className:"p-6",children:a?L?e.jsx("div",{className:"h-96 flex items-center justify-center border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(u,{className:"h-8 w-8 animate-spin text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading contacts..."})]})}):x.length===0?e.jsx("div",{className:"h-96 flex items-center justify-center border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"h-8 w-8 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No contacts found in this list"})]})}):e.jsx("div",{className:"h-96 overflow-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Phone Number"}),e.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-700",children:"Email"})]})}),e.jsx("tbody",{children:x.map((s,r)=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.number}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:s.email})]},r))})]})}):e.jsx("div",{className:"h-96 flex items-center justify-center border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{className:"h-8 w-8 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select List for Preview Contacts"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose a contact list from the form to preview contacts here"})]})})})]})})]})]})})}export{Me as CreateCampaignPage};
//# sourceMappingURL=CreateCampaignPage-CFiemfOn.js.map
