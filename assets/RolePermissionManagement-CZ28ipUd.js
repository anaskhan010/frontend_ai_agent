import{j as e,aG as D,aF as W,bB as X,c2 as Y,I as Z,bJ as ee,cq as se,bG as ae}from"./ui-B8VyAbFl.js";import{r as d}from"./vendor-DG599jyl.js";import{u as te,a as F,c as A}from"./query-CWB_8EHL.js";import{P as ie}from"./Page-DzlDDSku.js";import{H as re}from"./Header-DgrYN-BE.js";import{a as m,t as o,C as v,d as q,e as L,f as E,b as _,p as I,B as ne,q as b,s as le,v as de,w as ce,x as oe,y as me,L as C,I as T,T as he}from"./index-BQqu6sK2.js";import{S as l}from"./skeleton-BqOynWFB.js";import{C as xe}from"./checkbox-B8qXsOy5.js";import{P as pe}from"./PermissionRoute-_1Beah9k.js";import"./sheet-qVAPaj3K.js";import"./router-BnJytTjr.js";import"./usePermissions-BOVt13ea.js";const ge=async()=>{const t=await m.get("/api/roles");return t.data.success&&t.data.data?t.data.data:Array.isArray(t.data)?t.data:[]},ue=async t=>{const h=await m.get(`/api/role-page-permissions/role/${t}`);return h.data.success?h.data.data:[]},be=async()=>{const t=await m.get("/api/role-page-permissions/pages");return t.data.success?t.data.data:[]},De=()=>{const[t,h]=d.useState(null),[k,j]=d.useState([]),[f,P]=d.useState(!1),[w,Q]=d.useState(""),[U,x]=d.useState(!1),[c,p]=d.useState({name:"",display_name:"",description:""}),g=te(),{data:R,isLoading:K}=F({queryKey:["roles"],queryFn:ge}),{data:y,isLoading:M}=F({queryKey:["allPages"],queryFn:be});d.useEffect(()=>{t&&y&&(async()=>{try{const a=await ue(t.id),i=y.map(n=>{const r=a.find(J=>J.page_id===n.id),G=r&&(r.can_view||r.can_add||r.can_update||r.can_delete);return{...n,page_id:n.id,can_view:(r==null?void 0:r.can_view)||!1,can_add:(r==null?void 0:r.can_add)||!1,can_update:(r==null?void 0:r.can_update)||!1,can_delete:(r==null?void 0:r.can_delete)||!1,has_permission:!!G}});j(i)}catch(a){console.error("Error loading role permissions:",a),o.error("Failed to load role permissions")}})()},[t,y]);const $=A({mutationFn:async({roleId:s,permissions:a})=>(await m.put(`/api/role-page-permissions/role/${s}`,{pagePermissions:a})).data,onSuccess:()=>{o.success("Role permissions updated successfully"),g.invalidateQueries({queryKey:["rolePermissions"]}),g.invalidateQueries({queryKey:["pagePermissions"]})},onError:s=>{var a,i;o.error(((i=(a=s.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to update role permissions")}}),N=A({mutationFn:async s=>(await m.post("/api/roles",s)).data,onSuccess:()=>{o.success("Role created successfully"),g.invalidateQueries({queryKey:["roles"]}),g.invalidateQueries({queryKey:["pagePermissions"]}),x(!1),p({name:"",display_name:"",description:""})},onError:s=>{var a,i;o.error(((i=(a=s.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to create role")}}),B=s=>{h(s)},u=(s,a)=>{j(i=>i.map(n=>n.page_id===s&&n.has_permission?{...n,[a]:!n[a]}:n))},H=s=>{j(a=>a.map(i=>i.page_id===s?i.has_permission||i.can_view?{...i,has_permission:!1,can_view:!1,can_add:!1,can_update:!1,can_delete:!1}:{...i,has_permission:!0,can_view:!1,can_add:!1,can_update:!1,can_delete:!1}:i))},O=async()=>{if(t){P(!0);try{const s=k.filter(a=>a.has_permission).map(a=>({pageId:a.page_id,canView:a.can_view,canAdd:a.can_add,canUpdate:a.can_update,canDelete:a.can_delete}));await $.mutateAsync({roleId:t.id,permissions:s})}finally{P(!1)}}},V=()=>{N.mutate(c)},S=Array.isArray(R)?R.filter(s=>s.display_name.toLowerCase().includes(w.toLowerCase())||s.name.toLowerCase().includes(w.toLowerCase())):[],z=(k||[]).sort((s,a)=>(s.sort_order||0)-(a.sort_order||0));return e.jsx(pe,{requireSuperAdmin:!0,children:e.jsxs(ie,{children:[e.jsx("div",{"aria-hidden":!0,className:"absolute inset-0 pointer-events-none bg-gradient-to-r from-indigo-500/10 via-purple-500/10 to-pink-500/10"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(re,{title:"Role & Permission Management",buttonText:"Create Role",action:()=>x(!0),filterByName:!0,filterWord:w,onFilterChange:Q,useSheet:!1,showViewToggle:!1,showFilters:!1}),e.jsxs("div",{className:"grid grid-cols-1  lg:grid-cols-3 gap-6 h-[calc(100vh-200px)]",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(v,{className:"h-full bg-white/5 backdrop-blur-md border border-white/10",children:[e.jsxs(q,{children:[e.jsxs(L,{className:"flex items-center gap-2 text-white",children:[e.jsx(D,{className:"h-5 w-5 text-indigo-400"}),"Roles (",S.length,")"]}),e.jsx(E,{className:"text-gray-400",children:"Select a role to manage its page permissions"})]}),e.jsx(_,{className:"p-0",children:e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-y-auto",children:K?Array.from({length:4}).map((s,a)=>e.jsx("div",{className:"p-4 border-b border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{className:"h-4 w-32 mb-2 bg-white/10"}),e.jsx(l,{className:"h-3 w-24 mb-1 bg-white/10"}),e.jsx(l,{className:"h-3 w-48 bg-white/10"})]}),e.jsx(l,{className:"h-6 w-16 bg-white/10"})]})},`role-skeleton-${a}`)):S.map(s=>e.jsx("div",{onClick:()=>B(s),className:`p-4 border-b border-white/10 cursor-pointer hover:bg-white/10 transition-colors ${(t==null?void 0:t.id)===s.id?"bg-indigo-500/20 border-l-4 border-l-indigo-500":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm text-white",children:s.display_name}),e.jsx("p",{className:"text-xs text-gray-400",children:s.name}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:s.description})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[s.is_system_role&&e.jsx(I,{variant:"secondary",className:"text-xs bg-purple-500/20 text-purple-300 border border-purple-500/30",children:"System"}),e.jsx(I,{variant:s.is_active?"default":"destructive",className:`text-xs ${s.is_active?"bg-green-500/20 text-green-300 border border-green-500/30":"bg-red-500/20 text-red-300 border border-red-500/30"}`,children:s.is_active?"Active":"Inactive"})]})]})},s.id))})})]})}),e.jsx("div",{className:"lg:col-span-2",children:t?e.jsxs(v,{className:"h-full bg-white/5 neon-fire-scroll backdrop-blur-md border border-white/10",children:[e.jsx(q,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(L,{className:"flex items-center gap-2 text-white",children:[e.jsx(W,{className:"h-5 w-5 text-indigo-400"}),"Page Permissions for ",t.display_name]}),e.jsx(E,{className:"text-gray-400",children:"Manage page-level permissions for this role"})]}),e.jsxs(ne,{onClick:O,disabled:f,className:"flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white border-0",children:[f?e.jsx(X,{className:"h-4 w-4 animate-spin"}):e.jsx(Y,{className:"h-4 w-4"}),f?"Updating...":"Save Changes"]})]})}),e.jsx(_,{children:e.jsxs("div",{className:"max-h-[calc(100vh-400px)] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-white/5 backdrop-blur-md border-b border-white/10 z-10",children:e.jsxs("div",{className:"grid grid-cols-6 gap-4 p-4 font-medium text-sm text-gray-300",children:[e.jsx("div",{className:"col-span-2",children:"Page"}),e.jsxs("div",{className:"text-center flex items-center justify-center gap-1",children:[e.jsx(Z,{className:"h-4 w-4"}),"View"]}),e.jsxs("div",{className:"text-center flex items-center justify-center gap-1",children:[e.jsx(ee,{className:"h-4 w-4"}),"Add"]}),e.jsxs("div",{className:"text-center flex items-center justify-center gap-1",children:[e.jsx(se,{className:"h-4 w-4"}),"Update"]}),e.jsxs("div",{className:"text-center flex items-center justify-center gap-1",children:[e.jsx(ae,{className:"h-4 w-4"}),"Delete"]})]})}),e.jsx("div",{className:"divide-y divide-white/10",children:M?Array.from({length:6}).map((s,a)=>e.jsxs("div",{className:"grid grid-cols-6 gap-4 p-4",children:[e.jsxs("div",{className:"col-span-2 flex items-center gap-3",children:[e.jsx(l,{className:"h-4 w-4 bg-white/10"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(l,{className:"h-4 w-32 mb-1 bg-white/10"}),e.jsx(l,{className:"h-3 w-24 bg-white/10"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(l,{className:"h-5 w-10 bg-white/10"})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(l,{className:"h-5 w-10 bg-white/10"})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(l,{className:"h-5 w-10 bg-white/10"})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(l,{className:"h-5 w-10 bg-white/10"})})]},`page-skeleton-${a}`)):z.map(s=>e.jsxs("div",{className:"grid grid-cols-6 gap-4 p-4 hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"col-span-2 flex items-center gap-3",children:[e.jsx(xe,{checked:s.has_permission,onCheckedChange:()=>H(s.page_id),className:"flex-shrink-0 data-[state=checked]:bg-indigo-600 data-[state=checked]:border-indigo-600 border-white/30"}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-indigo-500 rounded-sm flex-shrink-0"}),e.jsx("h4",{className:"font-medium text-sm text-white truncate",children:s.page_name})]}),e.jsx("p",{className:"text-xs text-gray-400 truncate ml-5",children:s.page_path})]})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(b,{checked:s.can_view,onCheckedChange:()=>u(s.page_id,"can_view"),disabled:!s.has_permission,className:"data-[state=checked]:bg-indigo-600 data-[state=unchecked]:bg-white/20 disabled:opacity-30 disabled:cursor-not-allowed"})}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(b,{checked:s.can_add,onCheckedChange:()=>u(s.page_id,"can_add"),disabled:!s.has_permission,className:"data-[state=checked]:bg-indigo-600 data-[state=unchecked]:bg-white/20 disabled:opacity-30 disabled:cursor-not-allowed"})}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(b,{checked:s.can_update,onCheckedChange:()=>u(s.page_id,"can_update"),disabled:!s.has_permission,className:"data-[state=checked]:bg-indigo-600 data-[state=unchecked]:bg-white/20 disabled:opacity-30 disabled:cursor-not-allowed"})}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(b,{checked:s.can_delete,onCheckedChange:()=>u(s.page_id,"can_delete"),disabled:!s.has_permission,className:"data-[state=checked]:bg-indigo-600 data-[state=unchecked]:bg-white/20 disabled:opacity-30 disabled:cursor-not-allowed"})})]},s.page_id))})]})})]}):e.jsx(v,{className:"h-full flex items-center justify-center bg-white/5 backdrop-blur-md border border-white/10",children:e.jsx(_,{children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx(D,{className:"h-12 w-12 mx-auto mb-4 text-indigo-400"}),e.jsx("h3",{className:"text-lg font-medium mb-2 text-white",children:"Select a Role"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Choose a role from the left panel to manage its page permissions"})]})})})})]}),e.jsx(le,{open:U,onOpenChange:x,children:e.jsxs(de,{className:"bg-[#0e1340] border border-white/10 text-white",children:[e.jsxs(ce,{children:[e.jsx(oe,{className:"text-white",children:"Create New Role"}),e.jsx(me,{className:"text-gray-400",children:"Create a new role with custom permissions"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"role-name",className:"text-gray-300",children:"Role Name"}),e.jsx(T,{id:"role-name",placeholder:"e.g., manager",value:c.name,onChange:s=>p(a=>({...a,name:s.target.value})),className:"bg-white/5 border-white/20 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"role-display-name",className:"text-gray-300",children:"Display Name"}),e.jsx(T,{id:"role-display-name",placeholder:"e.g., Manager",value:c.display_name,onChange:s=>p(a=>({...a,display_name:s.target.value})),className:"bg-white/5 border-white/20 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"role-description",className:"text-gray-300",children:"Description"}),e.jsx(he,{id:"role-description",placeholder:"Describe the role's responsibilities...",value:c.description,onChange:s=>p(a=>({...a,description:s.target.value})),className:"bg-white/5 border-white/20 text-white placeholder:text-gray-500"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>x(!1),className:"neo-btn flex items-center gap-2 text-red-300 hover:text-red-200",style:{background:"linear-gradient(180deg, rgba(255,77,79,0.25), rgba(168,14,34,0.25))",borderColor:"rgba(255,77,79,0.35)"},children:"Cancel"}),e.jsx("button",{onClick:V,disabled:!c.name||!c.display_name||N.isPending,className:`px-5 py-2
    rounded-lg
    text-sm font-semibold
    text-white
    bg-[linear-gradient(180deg,rgba(90,110,255,0.45),rgba(36,46,151,0.35))]
    border border-white/15
    shadow-[0_2px_5px_rgba(90,110,255,0.45)]
    hover:shadow-[0_5px_10px_rgba(90,110,255,0.65)]
    hover:bg-[linear-gradient(180deg,rgba(90,110,255,0.6),rgba(36,46,151,0.45))]
    disabled:opacity-40
    disabled:cursor-not-allowed
    transition-all
    flex items-center gap-2`,children:N.isPending?"Creating...":"Create Role"})]})]})]})})]})]})})};export{De as default};
//# sourceMappingURL=RolePermissionManagement-CZ28ipUd.js.map
