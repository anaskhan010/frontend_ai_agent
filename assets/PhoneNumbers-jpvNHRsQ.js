import{j as e,aw as O,a5 as Z,aU as F,S as Ce,ci as Pe,b5 as je,aB as Se,cj as Ie,aQ as _e,D as Te,N as Ue,ck as Fe,H as ke,T as Le}from"./ui-S570Xcny.js";import{r as P,b as ge}from"./vendor-DG599jyl.js";import{u as de,b as M,c as z}from"./query-Cab5P5bd.js";import{C as U,b as K,c as B,d as te,a as q}from"./card-DMfGhRm1.js";import{B as b}from"./button-BSd9MMPp.js";import{B as g}from"./badge-ij7fArnn.js";import{I as D}from"./input-jxB46izN.js";import{L as A}from"./label-C1-UM1F-.js";import{S as Q,a as G,b as Y,c as H,d as E}from"./select-D0_OqHwT.js";import{D as ee,a as se,b as ne,c as ae,e as re,d as De}from"./dialog-DGdhV35L.js";import{T as J,a as W,b as S,c as d,d as X,e as l}from"./table-Beiyegzh.js";import{u as Ee,a as qe,t,d as ie}from"./index-C95eVPAi.js";import{P as Me}from"./Page-BJWqKr2O.js";import{i as Re,c as Ke,a as Be,b as Oe,u as Ve,g as $e,s as ze,d as Qe,e as Ge,f as Ye}from"./phoneNumberService-okmGsQRH.js";import{f as He,a as Je}from"./agentService-CSD2ntxe.js";import{C as We}from"./CreditGuard-CLU4RIyl.js";import{g as Xe}from"./userService-C59GROzF.js";import{u as pe}from"./usePermissions-BYlEuFrr.js";import"./index-BHBJ6RT-.js";import"./index-HDeFwIcs.js";import"./router-BavLd_S0.js";import"./scroll-area-C-pzVjaj.js";import"./index-CWMUKvWL.js";const Ze=({onSuccess:u,onCancel:v})=>{const{user:f}=Ee(),{isSuperAdmin:k}=qe(),[n,T]=P.useState({provider:"vapi",phoneNumber:"",name:"",assistantId:"",squadId:"",workflowId:"",fallbackDestination:"",serverUrl:"",serverUrlSecret:"",twilioAccountSid:"",twilioAuthToken:"",vonageApiKey:"",vonageApiSecret:"",telnyxApiKey:"",telnyxApiSecret:"",areaCode:"",twilioPhoneNumber:"",twilioLabel:"",smsEnabled:!0}),[h,o]=P.useState("free"),[V,R]=P.useState(!1),y=de(),{data:I,isLoading:N}=M({queryKey:["assistants","complete",f==null?void 0:f.id],queryFn:()=>He(""),retry:(r,a)=>{var j;return[404,204,402].includes((j=a==null?void 0:a.response)==null?void 0:j.status)?!1:r<1},enabled:!!(f!=null&&f.id)}),w=(I==null?void 0:I.data)||[],C=z({mutationFn:r=>h==="import"?Re(r):Ke(r),onSuccess:()=>{const r=h==="import"?"Twilio phone number imported successfully!":"Phone number created successfully!";t.success(r),y.invalidateQueries({queryKey:["phoneNumbers"]}),u==null||u()},onError:r=>{var m,j;const a=h==="import"?"Failed to import Twilio phone number":"Failed to create phone number";t.error(((j=(m=r.response)==null?void 0:m.data)==null?void 0:j.message)||a)}}),p=(r,a)=>{T(m=>({...m,[r]:a}))},x=()=>{if(!n.provider)return t.error("Please select a provider"),!1;if(n.provider==="vapi"&&h==="free"&&(!n.areaCode||n.areaCode.length!==3))return t.error("Please enter a valid 3-digit area code"),!1;if(h==="import"){if(!n.twilioPhoneNumber)return t.error("Please enter a Twilio phone number"),!1;if(!n.twilioAccountSid)return t.error("Please enter Twilio Account SID"),!1;if(!n.twilioAuthToken)return t.error("Please enter Twilio Auth Token"),!1;if(!n.twilioLabel)return t.error("Please enter a label for the phone number"),!1;if(!/^\+[1-9]\d{1,14}$/.test(n.twilioPhoneNumber))return t.error("Phone number must be in E.164 format (e.g., +14155551234)"),!1}if(n.provider!=="vapi"&&h!=="import"){if(!n.phoneNumber)return t.error("Please enter a phone number"),!1;if(!/^\+[1-9]\d{1,14}$/.test(n.phoneNumber))return t.error("Phone number must be in E.164 format (e.g., +1234567890)"),!1}if(!n.assistantId||n.assistantId==="unassigned")return t.error("Please select an assistant"),!1;if(n.serverUrl)try{new URL(n.serverUrl)}catch{return t.error("Server URL must be a valid URL"),!1}if(n.fallbackDestination)try{JSON.parse(n.fallbackDestination)}catch{return t.error("Fallback destination must be valid JSON"),!1}switch(n.provider){case"vapi":break;case"twilio":if(!n.twilioAccountSid||!n.twilioAuthToken)return t.error("Twilio Account SID and Auth Token are required"),!1;if(!n.twilioAccountSid.startsWith("AC"))return t.error("Twilio Account SID should start with 'AC'"),!1;if(n.twilioAccountSid.length!==34)return t.error("Twilio Account SID should be 34 characters long"),!1;break;case"vonage":if(!n.vonageApiKey||!n.vonageApiSecret)return t.error("Vonage API Key and Secret are required"),!1;break;case"telnyx":if(!n.telnyxApiKey)return t.error("Telnyx API Key is required"),!1;break}return!0},L=r=>{if(r.preventDefault(),!x())return;let a;h==="import"?a={twilioPhoneNumber:n.twilioPhoneNumber,twilioAccountSid:n.twilioAccountSid,twilioAuthToken:n.twilioAuthToken,twilioLabel:n.twilioLabel,assistantId:n.assistantId,smsEnabled:n.smsEnabled}:a={...n},C.mutate(a)};return e.jsx(We,{requiredCredits:1,feature:"phone number creation",showUpgradeButton:!0,children:e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs(U,{children:[e.jsxs(K,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5 text-blue-600"}),"Create Phone Number"]}),e.jsx(te,{children:"Get a free AI CRUITMENT phone number."})]}),e.jsx(q,{className:"space-y-5",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"w-48 space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Phone Number Options"}),e.jsx("button",{type:"button",onClick:()=>o("free"),className:`w-full p-2.5 text-left rounded-md border text-xs transition-colors ${h==="free"?"border-[#12a594] bg-[#12a594] text-white":"border-gray-200 bg-white text-gray-700 hover:bg-gray-50"}`,children:"Free AICRUITMENT Number"}),e.jsx("button",{type:"button",onClick:()=>o("import"),className:`w-full p-2.5 text-left rounded-md border text-sm transition-colors ${h==="import"?"border-[#12a594] bg-white text-[#12a594] ring-1 ring-[#12a594]":"border-gray-200 bg-white text-[#12a594] hover:bg-gray-50"}`,children:"Import Twilio"})]}),e.jsx("div",{className:"flex-1 space-y-4",children:h==="free"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Free Vapi Number"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"provider",className:"text-sm font-medium",children:"Provider *"}),e.jsxs(Q,{value:n.provider,onValueChange:r=>p("provider",r),children:[e.jsx(G,{children:e.jsx(Y,{placeholder:"Select a provider"})}),e.jsx(H,{children:e.jsx(E,{value:"vapi",className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:"#12a594"}}),"AI CRUITMENT (Free US Number)"]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(A,{htmlFor:"areaCode",className:"flex items-center gap-2 text-sm font-medium",children:["Area Code *",e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full text-white font-medium",style:{backgroundColor:"#12a594"},children:"Free"})]}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(D,{id:"areaCode",type:"text",placeholder:"000",value:n.areaCode,onChange:r=>{const a=r.target.value.replace(/\D/g,"").slice(0,3);p("areaCode",a),p("phoneNumber",a)},className:"font-mono text-lg text-center border-2 focus:border-[#12a594] focus:ring-[#12a594]",style:{borderColor:n.areaCode?"#12a594":void 0},maxLength:3}),n.areaCode&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("svg",{className:"h-4 w-4",style:{color:"#12a594"},fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),e.jsx("p",{className:"text-xs mt-1",style:{color:"#12a594"},children:"Enter a 3-digit US area code (e.g., 415, 212, 310)"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"name",className:"text-sm font-medium",children:"Friendly Name"}),e.jsx(D,{id:"name",type:"text",placeholder:"My AI CRUITMENT Number",value:n.name,onChange:r=>p("name",r.target.value),className:"mt-1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{htmlFor:"assistantId",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Z,{className:"h-4 w-4"}),"Assistant *"]}),e.jsxs(Q,{value:n.assistantId,onValueChange:r=>p("assistantId",r),children:[e.jsx(G,{children:e.jsx(Y,{placeholder:"Select an assistant"})}),e.jsx(H,{children:N?e.jsxs("div",{className:"flex items-center justify-center p-2",children:[e.jsx(F,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading assistants..."})]}):w.length===0?e.jsx("div",{className:"flex items-center justify-center p-2 text-gray-500",children:"No assistants available"}):e.jsx(e.Fragment,{children:w.map(r=>e.jsx(E,{value:r.assistant_id||r.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-3 w-3"}),r.name]})},r.id))})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:k?"Super admin can see all assistants":"You can only see your own assistants"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[#12a594]",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"AI CRUITMENT Free Phone Number"})]}),e.jsx("div",{className:"border border-[#12a594] rounded-lg p-4 bg-[#fafefd]",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"h-4 w-4 text-[#12a594]",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-[#12a594]",children:"No credentials required!"}),e.jsx("div",{className:"text-sm text-gray-700",children:"AI CRUITMENT provides free US phone numbers instantly. Just enter your desired area code and we'll assign you a random number in that area."}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[e.jsx("div",{children:"• Up to 10 free numbers per account"}),e.jsx("div",{children:"• Instant activation (2-3 minutes)"}),e.jsx("div",{children:"• US numbers only"}),e.jsx("div",{children:"• No monthly fees"})]})]})]})})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Import Twilio"}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"twilioPhoneNumber",className:"text-sm font-medium",children:"Twilio Phone Number"}),e.jsxs("div",{className:"flex mt-1",children:[e.jsx("div",{className:"flex items-center px-3 border border-r-0 border-gray-300 bg-gray-50 rounded-l-md",children:e.jsx("span",{className:"text-xs font-medium text-gray-600",children:"🇺🇸"})}),e.jsx(D,{id:"twilioPhoneNumber",type:"tel",placeholder:"+1415689........",value:n.twilioPhoneNumber,onChange:r=>p("twilioPhoneNumber",r.target.value),className:"rounded-l-none font-mono"})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"twilioAccountSid",className:"text-sm font-medium",children:"Twilio Account SID"}),e.jsx(D,{id:"twilioAccountSid",type:"text",placeholder:"ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",value:n.twilioAccountSid,onChange:r=>p("twilioAccountSid",r.target.value),className:"font-mono text-sm mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"twilioAuthToken",className:"text-sm font-medium",children:"Twilio Auth Token"}),e.jsx(D,{id:"twilioAuthToken",type:"password",placeholder:"Your Twilio Auth Token",value:n.twilioAuthToken,onChange:r=>p("twilioAuthToken",r.target.value),className:"font-mono text-sm mt-1"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"twilioLabel",className:"text-sm font-medium",children:"Label"}),e.jsx(D,{id:"twilioLabel",type:"text",placeholder:"Label for Phone Number",value:n.twilioLabel,onChange:r=>p("twilioLabel",r.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{htmlFor:"assistantId",className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Z,{className:"h-4 w-4"}),"Assistant *"]}),e.jsxs(Q,{value:n.assistantId,onValueChange:r=>p("assistantId",r),children:[e.jsx(G,{children:e.jsx(Y,{placeholder:"Select an assistant"})}),e.jsx(H,{children:N?e.jsxs("div",{className:"flex items-center justify-center p-2",children:[e.jsx(F,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading assistants..."})]}):w.length===0?e.jsx("div",{className:"flex items-center justify-center p-2 text-gray-500",children:"No assistants available"}):e.jsx(e.Fragment,{children:w.map(r=>e.jsx(E,{value:r.assistant_id||r.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-3 w-3"}),r.name]})},r.id))})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:k?"Super admin can see all assistants":"You can only see your own assistants"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"SMS Enabled"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Enable SMS messaging for this phone number"})]}),e.jsx("button",{type:"button",onClick:()=>p("smsEnabled",!n.smsEnabled),className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors ${n.smsEnabled?"bg-[#12a594]":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-3 w-3 transform rounded-full bg-white transition-transform ${n.smsEnabled?"translate-x-5":"translate-x-1"}`})})]})]})})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(b,{type:"button",variant:"outline",onClick:v,disabled:C.isPending,children:"Cancel"}),e.jsx(b,{type:"submit",disabled:C.isPending,className:"min-w-[140px]",style:h==="free"?{backgroundColor:"#12a594",borderColor:"#12a594",color:"white"}:{backgroundColor:"#12a594",borderColor:"#12a594",color:"white"},children:C.isPending?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),h==="import"?"Importing from Twilio...":"Getting Free Number..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),h==="import"?"Import from Twilio":"Get Free Number"]})})]})]})})},es=()=>{const[u,v]=P.useState(null),[f,k]=P.useState(""),[n,T]=P.useState(!1),h=de(),{data:o,isLoading:V,error:R}=M({queryKey:["admin-vapi-phone-numbers"],queryFn:()=>Be(),retry:1}),{data:y,isLoading:I}=M({queryKey:["all-users"],queryFn:()=>Xe(),retry:1}),N=z({mutationFn:({phoneNumberId:a,userId:m,vapiId:j})=>j?ie.post(`/api/phone-numbers/${j}/assign`,{user_id:m,vapi_id:j}):Oe(a,m),onSuccess:()=>{h.invalidateQueries({queryKey:["admin-vapi-phone-numbers"]}),h.invalidateQueries({queryKey:["admin-phone-numbers"]}),t.success("Phone number assigned successfully!"),T(!1),v(null),k("")},onError:a=>{var m,j;t.error("Failed to assign phone number: "+(((j=(m=a.response)==null?void 0:m.data)==null?void 0:j.message)||a.message))}}),w=z({mutationFn:a=>Ve(a),onSuccess:()=>{h.invalidateQueries({queryKey:["admin-vapi-phone-numbers"]}),h.invalidateQueries({queryKey:["admin-phone-numbers"]}),t.success("Phone number unassigned successfully!")},onError:a=>{var m,j;t.error("Failed to unassign phone number: "+(((j=(m=a.response)==null?void 0:m.data)==null?void 0:j.message)||a.message))}}),C=a=>{v(a),T(!0)},p=()=>{if(!u||!f){t.error("Please select a user to assign the phone number to.");return}N.mutate({phoneNumberId:u.local_id||u.id,userId:f,vapiId:u.vapi_id||u.id})},x=a=>{if(!a.local_id){t.error("Cannot unassign phone number that is not in local database.");return}window.confirm(`Are you sure you want to unassign phone number ${a.number}?`)&&w.mutate(a.local_id)},L=(o==null?void 0:o.data)||[],r=(y==null?void 0:y.data)||[];return V?e.jsx(U,{children:e.jsx(q,{className:"flex items-center justify-center h-32",children:e.jsx(F,{className:"h-8 w-8 animate-spin"})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(U,{children:[e.jsxs(K,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5 text-blue-600"}),e.jsx(B,{children:"Super Admin - Phone Number Management"})]}),e.jsx(te,{children:"Manage phone number assignments for all users. Shows all VAPI phone numbers including Twilio numbers. Assign any available phone number to specific users to control access."}),(o==null?void 0:o.debug_info)&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-900",children:"Total VAPI Numbers:"}),e.jsx("div",{className:"text-blue-700",children:o.debug_info.total_vapi_numbers})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-green-900",children:"Assigned:"}),e.jsx("div",{className:"text-green-700",children:o.debug_info.assigned_numbers})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-orange-900",children:"Available:"}),e.jsx("div",{className:"text-orange-700",children:o.debug_info.unassigned_numbers})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-purple-900",children:"In Local DB:"}),e.jsx("div",{className:"text-purple-700",children:o.debug_info.in_local_db})]})]})})]}),e.jsx(q,{children:L.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(O,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No phone numbers found"}),e.jsx("p",{className:"text-muted-foreground",children:"No phone numbers are available for assignment."})]}):e.jsxs(J,{children:[e.jsx(W,{children:e.jsxs(S,{children:[e.jsx(d,{children:"Phone Number"}),e.jsx(d,{children:"Provider"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Assigned User"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(X,{children:L.map(a=>{var m;return e.jsxs(S,{children:[e.jsx(l,{className:"font-mono",children:a.number||"Unknown"}),e.jsx(l,{children:e.jsx(g,{variant:"outline",className:a.provider==="vapi"?"bg-blue-50 text-blue-700":"bg-gray-50 text-gray-700",children:((m=a.provider)==null?void 0:m.toUpperCase())||"VAPI"})}),e.jsx(l,{children:e.jsxs("div",{className:"flex gap-2",children:[a.is_assigned?e.jsx(g,{variant:"default",className:"bg-green-100 text-green-800",children:"Assigned"}):e.jsx(g,{variant:"outline",className:"text-orange-600",children:"Available"}),a.is_in_local_db?e.jsx(g,{variant:"secondary",className:"text-xs",children:"In DB"}):e.jsx(g,{variant:"outline",className:"text-xs text-blue-600",children:"VAPI Only"})]})}),e.jsx(l,{children:a.user_name?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:a.user_name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.user_email})]}):e.jsx(g,{variant:"outline",className:"text-orange-600",children:"Unassigned"})}),e.jsx(l,{children:e.jsx("div",{className:"flex gap-2",children:a.is_assigned?e.jsxs(b,{size:"sm",variant:"outline",onClick:()=>x(a),disabled:w.isPending||!a.is_in_local_db,title:a.is_in_local_db?"":"Cannot unassign phone number not in local database",children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),"Unassign"]}):e.jsxs(b,{size:"sm",variant:"outline",onClick:()=>C(a),disabled:N.isPending,children:[e.jsx(je,{className:"h-3 w-3 mr-1"}),"Assign"]})})})]},a.id)})})]})})]}),e.jsx(ee,{open:n,onOpenChange:T,children:e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Assign Phone Number"}),e.jsxs(re,{children:["Assign phone number ",u==null?void 0:u.number," to a user. Only the assigned user will be able to see and use this phone number."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Select User"}),e.jsxs(Q,{value:f,onValueChange:k,children:[e.jsx(G,{children:e.jsx(Y,{placeholder:"Choose a user to assign the phone number to"})}),e.jsx(H,{children:r.map(a=>e.jsx(E,{value:a.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[a.first_name||""," ",a.last_name||""]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.email})]})]})},a.id))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(b,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),e.jsx(b,{onClick:p,disabled:!f||N.isPending,children:N.isPending?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Assigning..."]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Assign Phone Number"]})})]})]})]})})]})},ss=()=>{var I,N,w,C,p,x,L,r,a,m,j,$;const{isSuperAdmin:u}=pe(),{data:v,isLoading:f,refetch:k}=M({queryKey:["debug-assignments"],queryFn:async()=>(await ie.get("/api/phone-numbers/debug/assignments")).data,retry:1}),{data:n,isLoading:T,refetch:h}=M({queryKey:["debug-user-numbers"],queryFn:async()=>(await ie.get("/api/phone-numbers/debug/user-numbers")).data,retry:1}),{data:o,isLoading:V,refetch:R}=M({queryKey:["regular-phone-numbers"],queryFn:async()=>(await ie.get("/api/phone-numbers")).data,retry:1}),y=()=>{k(),h(),R()};return f||T||V?e.jsx(U,{children:e.jsx(q,{className:"flex items-center justify-center h-32",children:e.jsx(F,{className:"h-8 w-8 animate-spin"})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{children:e.jsxs(K,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5 text-orange-600"}),e.jsx(B,{children:"Phone Number Assignment Debug"})]}),e.jsx(b,{onClick:y,variant:"outline",size:"sm",children:"Refresh All"})]}),e.jsx(te,{children:"Debug information for phone number assignments. This helps identify why assigned phone numbers might not be showing up for users."})]})}),e.jsxs(U,{children:[e.jsx(K,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),"Current User Debug Info"]})}),e.jsx(q,{children:n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"User ID:"})," ",(I=n.debug_info)==null?void 0:I.user_id]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Is Super Admin:"})," ",(N=n.debug_info)!=null&&N.is_super_admin?"Yes":"No"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone Count:"})," ",(w=n.debug_info)==null?void 0:w.phone_count]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Is Super Admin (Hook):"})," ",u?"Yes":"No"]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Phone Number IDs:"}),e.jsx("div",{className:"mt-2",children:((p=(C=n.debug_info)==null?void 0:C.phone_number_ids)==null?void 0:p.length)>0?n.debug_info.phone_number_ids.map(i=>e.jsx(g,{variant:"outline",className:"mr-2 mb-2",children:i},i)):e.jsx(g,{variant:"destructive",children:"No phone number IDs found"})})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"User's Phone Numbers:"}),((x=n.data)==null?void 0:x.length)>0?e.jsxs(J,{className:"mt-2",children:[e.jsx(W,{children:e.jsxs(S,{children:[e.jsx(d,{children:"DB ID"}),e.jsx(d,{children:"Phone Number ID"}),e.jsx(d,{children:"Number"}),e.jsx(d,{children:"User ID"})]})}),e.jsx(X,{children:n.data.map(i=>e.jsxs(S,{children:[e.jsx(l,{children:i.id}),e.jsx(l,{children:i.phone_number_id||"N/A"}),e.jsx(l,{children:i.number||"N/A"}),e.jsx(l,{children:i.user_id})]},i.id))})]}):e.jsx(g,{variant:"destructive",className:"mt-2",children:"No phone numbers found for user"})]})]})})]}),u&&e.jsxs(U,{children:[e.jsx(K,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"All Phone Number Assignments"]})}),e.jsx(q,{children:v&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Total:"})," ",(L=v.debug_info)==null?void 0:L.total_count]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Assigned:"})," ",(r=v.debug_info)==null?void 0:r.assigned_count]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Unassigned:"})," ",(a=v.debug_info)==null?void 0:a.unassigned_count]})]}),((m=v.data)==null?void 0:m.length)>0?e.jsxs(J,{children:[e.jsx(W,{children:e.jsxs(S,{children:[e.jsx(d,{children:"DB ID"}),e.jsx(d,{children:"Phone Number ID"}),e.jsx(d,{children:"Number"}),e.jsx(d,{children:"Assigned User"}),e.jsx(d,{children:"User ID"})]})}),e.jsx(X,{children:v.data.map(i=>e.jsxs(S,{children:[e.jsx(l,{children:i.id}),e.jsx(l,{children:i.phone_number_id||"N/A"}),e.jsx(l,{children:i.number||"N/A"}),e.jsx(l,{children:i.user_name?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:i.user_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:i.user_email})]}):e.jsx(g,{variant:"outline",children:"Unassigned"})}),e.jsx(l,{children:i.user_id||"NULL"})]},i.id))})]}):e.jsx(g,{variant:"destructive",children:"No phone numbers found in database"})]})})]}),e.jsxs(U,{children:[e.jsx(K,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Regular Phone Numbers API Response"]})}),e.jsx(q,{children:o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Success:"})," ",o.success?"Yes":"No"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Count:"})," ",((j=o.data)==null?void 0:j.length)||0]}),(($=o.data)==null?void 0:$.length)>0?e.jsxs(J,{children:[e.jsx(W,{children:e.jsxs(S,{children:[e.jsx(d,{children:"ID"}),e.jsx(d,{children:"Number"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Created By"})]})}),e.jsx(X,{children:o.data.map(i=>e.jsxs(S,{children:[e.jsx(l,{children:i.id}),e.jsx(l,{children:i.number||"N/A"}),e.jsx(l,{children:i.status||"N/A"}),e.jsx(l,{children:i.created_by||i.user_name||"N/A"})]},i.id))})]}):e.jsx(g,{variant:"destructive",children:"No phone numbers returned by regular API"})]})})]})]})},Cs=()=>{var oe,me,he,ue;const[u,v]=P.useState({country:"US",limit:10}),[f,k]=P.useState(null),[n,T]=P.useState(!1),[h,o]=P.useState(!1),[V,R]=P.useState(!1),[y,I]=P.useState("user"),[N,w]=P.useState({friendlyName:"",assistantId:""}),C=de(),{isSuperAdmin:p}=pe(),{data:x,isLoading:L,error:r}=M({queryKey:["phoneNumbers"],queryFn:()=>$e(),retry:1});ge.useEffect(()=>{var s;x&&(console.log("Phone numbers data received:",x),((s=x==null?void 0:x.data)==null?void 0:s.length)>0&&console.log("First phone number structure:",x.data[0]))},[x]),ge.useEffect(()=>{r&&console.error("Phone numbers fetch error:",r)},[r]);const{data:a,isLoading:m,refetch:j}=M({queryKey:["phoneNumbers","available",u],queryFn:()=>ze(u),enabled:!1}),{data:$}=M({queryKey:["assistants"],queryFn:()=>Je(1,""),retry:1}),i=z({mutationFn:Qe,onSuccess:()=>{C.invalidateQueries({queryKey:["phoneNumbers"]}),t.success("Phone number purchased successfully")},onError:s=>{var c,_;t.error(((_=(c=s.response)==null?void 0:c.data)==null?void 0:_.message)||"Failed to purchase phone number")}}),le=z({mutationFn:({id:s,data:c})=>Ge(s,c),onSuccess:()=>{C.invalidateQueries({queryKey:["phoneNumbers"]}),o(!1),t.success("Phone number updated successfully")},onError:s=>{var c,_;t.error(((_=(c=s.response)==null?void 0:c.data)==null?void 0:_.message)||"Failed to update phone number")}}),ce=z({mutationFn:Ye,onSuccess:()=>{C.invalidateQueries({queryKey:["phoneNumbers"]}),t.success("Phone number deleted successfully")},onError:s=>{var c,_;t.error(((_=(c=s.response)==null?void 0:c.data)==null?void 0:_.message)||"Failed to delete phone number")}}),be=()=>{j()},fe=s=>{i.mutate({number:s.number,friendlyName:s.friendlyName})},Ne=s=>{k(s),w({friendlyName:s.friendlyName||"",assistantId:s.assistantId||"unassigned"}),o(!0)},ve=()=>{f&&le.mutate({id:f.id,data:{...N,assistantId:N.assistantId==="unassigned"?"":N.assistantId}})},ye=s=>{confirm("Are you sure you want to delete this phone number?")&&ce.mutate(s)},we=s=>{const c={active:"default",inactive:"secondary",pending:"outline"};return e.jsx(g,{variant:c[s]||"outline",children:s})},Ae=((oe=$==null?void 0:$.data)==null?void 0:oe.assistants)||[];return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Phone Numbers"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your phone numbers and purchase new ones"})]}),e.jsx(U,{children:e.jsx(q,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Unable to connect to the backend API. Please ensure the backend server is running."}),e.jsx(b,{onClick:()=>window.location.reload(),children:"Retry Connection"})]})})})]}):e.jsx(Me,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Phone Numbers"}),e.jsx("p",{className:"text-muted-foreground",children:y==="admin"?"Manage phone number assignments for all users":"Get free AI CRUITMENT phone numbers."})]}),p&&e.jsxs("div",{className:"flex gap-2 mr-4",children:[e.jsx(b,{variant:y==="user"?"default":"outline",onClick:()=>I("user"),size:"sm",children:"User View"}),e.jsx(b,{variant:y==="admin"?"default":"outline",onClick:()=>I("admin"),size:"sm",children:"Admin Management"}),e.jsx(b,{variant:y==="debug"?"default":"outline",onClick:()=>I("debug"),size:"sm",children:"Debug"})]}),y==="user"&&e.jsxs(ee,{open:V,onOpenChange:R,children:[e.jsx(De,{asChild:!0,children:e.jsxs(b,{children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Create Phone Number"]})}),e.jsxs(se,{className:"max-w-7xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Create New Phone Number"}),e.jsx(re,{children:"Get a free AI CRUITMENT phone number."})]}),e.jsx(Ze,{onSuccess:()=>R(!1),onCancel:()=>R(!1)})]})]})]}),y==="admin"?e.jsx(es,{}):y==="debug"?e.jsx(ss,{}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{open:n,onOpenChange:T,children:e.jsxs(se,{className:"max-w-4xl",children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Search & Buy Phone Numbers"}),e.jsx(re,{children:"Search for available phone numbers to purchase"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"country",children:"Country"}),e.jsxs(Q,{value:u.country,onValueChange:s=>v(c=>({...c,country:s})),children:[e.jsx(G,{children:e.jsx(Y,{})}),e.jsxs(H,{children:[e.jsx(E,{value:"US",children:"United States"}),e.jsx(E,{value:"CA",children:"Canada"}),e.jsx(E,{value:"GB",children:"United Kingdom"})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"areaCode",children:"Area Code"}),e.jsx(D,{id:"areaCode",value:u.areaCode||"",onChange:s=>v(c=>({...c,areaCode:s.target.value})),placeholder:"e.g., 415"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"contains",children:"Contains"}),e.jsx(D,{id:"contains",value:u.contains||"",onChange:s=>v(c=>({...c,contains:s.target.value})),placeholder:"e.g., 1234"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(b,{onClick:be,disabled:m,className:"w-full",children:[m?e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Search"]})})]}),a&&e.jsx("div",{className:"border rounded-lg",children:e.jsxs(J,{children:[e.jsx(W,{children:e.jsxs(S,{children:[e.jsx(d,{children:"Number"}),e.jsx(d,{children:"Location"}),e.jsx(d,{children:"Capabilities"}),e.jsx(d,{children:"Price/Month"}),e.jsx(d,{children:"Action"})]})}),e.jsx(X,{children:(me=a.data)==null?void 0:me.map(s=>{var c,_,xe;return e.jsxs(S,{children:[e.jsx(l,{className:"font-mono",children:s.number}),e.jsx(l,{children:s.locality&&s.region?`${s.locality}, ${s.region}`:s.locality||s.region||"Unknown Location"}),e.jsx(l,{children:e.jsxs("div",{className:"flex gap-1",children:[((c=s.capabilities)==null?void 0:c.voice)&&e.jsx(g,{variant:"outline",children:"Voice"}),((_=s.capabilities)==null?void 0:_.sms)&&e.jsx(g,{variant:"outline",children:"SMS"}),((xe=s.capabilities)==null?void 0:xe.mms)&&e.jsx(g,{variant:"outline",children:"MMS"}),!s.capabilities&&e.jsx(g,{variant:"outline",children:"Unknown"})]})}),e.jsx(l,{children:s.monthlyPrice!==void 0?`$${s.monthlyPrice}`:"Contact for pricing"}),e.jsx(l,{children:e.jsxs(b,{size:"sm",onClick:()=>fe(s),disabled:i.isPending,children:[i.isPending?e.jsx(F,{className:"h-3 w-3 mr-1 animate-spin"}):e.jsx(Fe,{className:"h-3 w-3 mr-1"}),"Buy"]})})]},s.number)})})]})})]})]})}),e.jsxs(U,{children:[e.jsxs(K,{children:[e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Your Phone Numbers"]}),e.jsx(te,{children:"Manage your purchased phone numbers and their assignments"})]}),e.jsx(q,{children:L?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(F,{className:"h-8 w-8 animate-spin"})}):e.jsxs(J,{children:[e.jsx(W,{children:e.jsxs(S,{children:[e.jsx(d,{children:"Number"}),e.jsx(d,{children:"Created By"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Assigned Assistant"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(X,{children:((he=x==null?void 0:x.data)==null?void 0:he.length)===0?e.jsx(S,{children:e.jsx(l,{colSpan:6,className:"text-center text-muted-foreground",children:"No phone numbers found. Purchase your first number to get started."})}):(ue=x==null?void 0:x.data)==null?void 0:ue.map(s=>e.jsxs(S,{children:[e.jsx(l,{className:"font-mono",children:s.number||"Unknown"}),e.jsx(l,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.created_by||s.user_name||"Unknown User"}),s.user_email&&e.jsx("span",{className:"text-xs text-muted-foreground",children:s.user_email})]})}),e.jsx(l,{children:we(s.status||"inactive")}),e.jsx(l,{children:s.assistantId?e.jsx(g,{variant:"secondary",children:"Assigned"}):e.jsx(g,{variant:"outline",children:"Unassigned"})}),e.jsx(l,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{size:"sm",variant:"outline",onClick:()=>Ne(s),children:e.jsx(ke,{className:"h-3 w-3"})}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>ye(s.id),disabled:ce.isPending,children:e.jsx(Le,{className:"h-3 w-3"})})]})})]},s.id))})]})})]}),e.jsx(ee,{open:h,onOpenChange:o,children:e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Edit Phone Number"}),e.jsx(re,{children:"Update the phone number settings"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"friendlyName",children:"Friendly Name"}),e.jsx(D,{id:"friendlyName",value:N.friendlyName,onChange:s=>w(c=>({...c,friendlyName:s.target.value})),placeholder:"Enter a friendly name..."})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"assistantId",children:"Assign to Assistant"}),e.jsxs(Q,{value:N.assistantId,onValueChange:s=>w(c=>({...c,assistantId:s})),children:[e.jsx(G,{children:e.jsx(Y,{placeholder:"Select an assistant"})}),e.jsxs(H,{children:[e.jsx(E,{value:"unassigned",children:"Unassigned"}),Ae.map(s=>e.jsx(E,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs(b,{onClick:ve,disabled:le.isPending,className:"w-full",children:[le.isPending&&e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),"Update Phone Number"]})]})]})})]})]})})};export{Cs as default};
//# sourceMappingURL=PhoneNumbers-jpvNHRsQ.js.map
