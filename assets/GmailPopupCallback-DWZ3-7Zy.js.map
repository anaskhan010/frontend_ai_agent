{"version":3,"file":"GmailPopupCallback-DWZ3-7Zy.js","sources":["../../src/pages/auth/GmailPopupCallback.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport { CheckCircle, AlertCircle, Loader2, Mail } from 'lucide-react';\nimport { toast } from 'sonner';\n\nconst GmailPopupCallback: React.FC = () => {\n  const [searchParams] = useSearchParams();\n  const [status, setStatus] = useState<'loading' | 'success' | 'error'>('loading');\n  const [message, setMessage] = useState('Processing Gmail authentication...');\n\n  useEffect(() => {\n    const handleCallback = async () => {\n      try {\n        const success = searchParams.get('success');\n        const email = searchParams.get('email');\n        const error = searchParams.get('error');\n\n        console.log('ðŸ” GmailPopupCallback params:', { success, email, error });\n        console.log('ðŸ” window.opener:', window.opener);\n        console.log('ðŸ” window.opener closed:', window.opener?.closed);\n\n        // Helper function to notify parent window through multiple methods\n        const notifyParent = (messageData: any) => {\n          let messageSent = false;\n\n          // Method 1: Try window.opener.postMessage\n          if (window.opener && !window.opener.closed) {\n            try {\n              console.log('ðŸ“¤ Sending message via window.opener.postMessage');\n              window.opener.postMessage(messageData, '*');\n              messageSent = true;\n            } catch (e) {\n              console.log('âš ï¸ window.opener.postMessage failed:', e);\n            }\n          }\n\n          // Method 2: Try BroadcastChannel\n          try {\n            const channel = new BroadcastChannel('gmail_oauth_channel');\n            console.log('ðŸ“¤ Sending message via BroadcastChannel');\n            channel.postMessage(messageData);\n            channel.close();\n            messageSent = true;\n          } catch (e) {\n            console.log('âš ï¸ BroadcastChannel failed:', e);\n          }\n\n          // Method 3: Use localStorage as fallback\n          try {\n            console.log('ðŸ“¤ Storing message in localStorage');\n            localStorage.setItem('gmail_oauth_result', JSON.stringify({\n              ...messageData,\n              timestamp: Date.now()\n            }));\n            messageSent = true;\n          } catch (e) {\n            console.log('âš ï¸ localStorage failed:', e);\n          }\n\n          return messageSent;\n        };\n\n        if (success === 'true' && email) {\n          setStatus('success');\n          setMessage('Gmail account connected successfully!');\n\n          console.log('ðŸŽ‰ Gmail OAuth success in popup, notifying parent window');\n\n          const messageData = {\n            type: 'GMAIL_AUTH_SUCCESS',\n            data: {\n              email: decodeURIComponent(email),\n              isConnected: true\n            }\n          };\n\n          notifyParent(messageData);\n\n          // Close popup after a short delay to allow parent to process\n          setTimeout(() => {\n            console.log('ðŸ”’ Closing popup window');\n            window.close();\n          }, 2000);\n        } else if (error) {\n          setStatus('error');\n          setMessage(`Authentication failed: ${decodeURIComponent(error)}`);\n\n          const messageData = {\n            type: 'GMAIL_AUTH_ERROR',\n            message: decodeURIComponent(error)\n          };\n\n          notifyParent(messageData);\n\n          // Close popup after a short delay\n          setTimeout(() => {\n            window.close();\n          }, 3000);\n        } else {\n          setStatus('error');\n          setMessage('Invalid callback parameters');\n\n          // Close popup after error\n          setTimeout(() => {\n            window.close();\n          }, 3000);\n        }\n      } catch (error) {\n        console.error('Error handling Gmail popup callback:', error);\n        setStatus('error');\n        setMessage('An unexpected error occurred');\n\n        // Close popup after error\n        setTimeout(() => {\n          window.close();\n        }, 3000);\n      }\n    };\n\n    handleCallback();\n  }, [searchParams]);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\n      <div className=\"max-w-md w-full bg-white rounded-lg shadow-lg p-6\">\n        {status === 'loading' && (\n          <div className=\"text-center space-y-4\">\n            <div className=\"flex justify-center\">\n              <div className=\"relative\">\n                <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center\">\n                  <Mail className=\"h-8 w-8 text-blue-600\" />\n                </div>\n                <div className=\"absolute -top-1 -right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center\">\n                  <Loader2 className=\"h-3 w-3 text-white animate-spin\" />\n                </div>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <h3 className=\"text-lg font-semibold text-gray-900\">\n                Processing Authentication\n              </h3>\n              <p className=\"text-sm text-gray-600\">\n                {message}\n              </p>\n            </div>\n          </div>\n        )}\n\n        {status === 'success' && (\n          <div className=\"text-center space-y-4\">\n            <div className=\"flex justify-center\">\n              <CheckCircle className=\"h-16 w-16 text-green-600\" />\n            </div>\n            <div className=\"space-y-2\">\n              <h3 className=\"text-lg font-semibold text-green-900\">\n                Successfully Connected!\n              </h3>\n              <p className=\"text-sm text-green-700\">\n                {message}\n              </p>\n              <p className=\"text-xs text-gray-500\">\n                This window will close automatically...\n              </p>\n            </div>\n          </div>\n        )}\n\n        {status === 'error' && (\n          <div className=\"text-center space-y-4\">\n            <div className=\"flex justify-center\">\n              <AlertCircle className=\"h-16 w-16 text-red-600\" />\n            </div>\n            <div className=\"space-y-2\">\n              <h3 className=\"text-lg font-semibold text-red-900\">\n                Connection Failed\n              </h3>\n              <p className=\"text-sm text-red-700\">\n                {message}\n              </p>\n              <p className=\"text-xs text-gray-500\">\n                This window will close automatically...\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default GmailPopupCallback;\n"],"names":["GmailPopupCallback","searchParams","useSearchParams","status","setStatus","useState","message","setMessage","useEffect","success","email","error","_a","notifyParent","messageData","messageSent","e","channel","jsxs","jsx","Mail","Loader2","CheckCircle","AlertCircle"],"mappings":"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"}